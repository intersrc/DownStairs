!function(e){"use strict";function n(e,n){function i(){}i.prototype=e;var t=new i;for(var l in n)t[l]=n[l];return n.toString!==Object.prototype.toString&&(t.toString=n.toString),t}function i(e,n){if(null==n)return null;null==n.__id__&&(n.__id__=rt++);var i;return null==e.hx__closures__?e.hx__closures__={}:i=e.hx__closures__[n.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=e,i.method=n,e.hx__closures__[n.__id__]=i),i}var t=function(){return M.__string_rec(this,"")},l=function(){};l.__name__=!0,l.autoSize=function(){var e=window.document.getElementById("mainCanvas");e.style.width=(e.width=320)+"px",e.style.height=(e.height=568)+"px";var n=window.document.getElementById("mainDiv");n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.width=e.style.width,n.style.height=e.style.height,n.style.marginLeft="-160px",n.style.marginTop="-284px"};var a=function(){};a.__name__=!0,a.stringTime=function(e){var n=Math.floor(e/3600);e-=3600*n;var i=Math.floor(e/60);e-=60*i;var t=Math.floor(e);return a.addZero(n)+":"+a.addZero(i)+":"+a.addZero(t)},a.addZero=function(e){return e<10?"0"+e:null==e?"null":""+e};var r=function(){this.createCdMax=2,this.createCd=0,createjs.Container.call(this),this.floorLayer=new createjs.Container,this.addChild(this.floorLayer),this.floors=[];var e=new w(a.stageWidth/2,a.stageHeight-48,x.Normal);this.floorLayer.addChild(e.container),this.floors.push(e);var n=new createjs.Bitmap("./assets/arrow_0.png");this.addChild(n),this.player=new C(a.stageWidth/2,a.stageHeight/2-128),this.player.container.alpha=0,createjs.Tween.get(this.player.container).to({alpha:1},500),this.addChild(this.player.container),this.layer=new createjs.Text("00:00:00","bold 24px Arial","#FFF"),this.layer.x=4,this.layer.y=a.stageHeight-24-4,this.addChild(this.layer),a.totalTime=0,this.exists=!0;var i=a.space.zpp_inner.wrap_listeners;null==nn.CbEvent_BEGIN&&(nn.internal=!0,nn.CbEvent_BEGIN=new E,nn.internal=!1);var t=nn.CbEvent_BEGIN;null==nn.InteractionType_COLLISION&&(nn.internal=!0,nn.InteractionType_COLLISION=new P,nn.internal=!1);var l=new F(t,nn.InteractionType_COLLISION,C.CB_TYPE,w.CB_TYPE_ELASTIC,function(e){createjs.Sound.play("elastic")});i.zpp_inner.reverse_flag?i.push(l):i.unshift(l)};r.__name__=!0,r.__super__=createjs.Container,r.prototype=n(createjs.Container.prototype,{destory:function(){for(var e=0,n=this.floors;e<n.length;){var i=n[e];++e,null!=i&&i.destroy()}this.player.destroy(),this.floorLayer=null,this.floors=null,this.player=null,this.layer=null},update:function(e){if(this.exists){a.totalTime+=e,this.layer.text=a.stringTime(a.totalTime),a.space.step(e);for(var n=0,i=this.floors.length;n<i;){var t=n++,l=this.floors[t];if(null!=l){l.update();var r=l.body;null==r.zpp_inner.wrap_pos&&r.zpp_inner.setupPosition();var p=r.zpp_inner.wrap_pos,s=p.zpp_inner;null!=s._validate&&s._validate();var o=p.zpp_inner.y,_=l.body.zpp_inner.aabb.wrapper(),h=_.zpp_inner;null!=h._validate&&h._validate();var x=_.zpp_inner;o<-(x.maxy-x.miny)&&(l.destroy(),this.floors[t]=null)}}if(this.player.exists){this.player.update();var u,d=this.player.body;null==d.zpp_inner.wrap_pos&&d.zpp_inner.setupPosition();var v=d.zpp_inner.wrap_pos,c=v.zpp_inner;if(null!=c._validate&&c._validate(),v.zpp_inner.y>=a.stageHeight)u=!0;else{var y=this.player.body;null==y.zpp_inner.wrap_pos&&y.zpp_inner.setupPosition();var m=y.zpp_inner.wrap_pos,z=m.zpp_inner;null!=z._validate&&z._validate(),u=m.zpp_inner.y<=38}u&&this.player.die()}if(this.createCd+=e,this.createCd>=this.createCdMax){this.createCd-=this.createCdMax;var f=new w(Math.random()*a.stageWidth,a.stageHeight+48);this.floorLayer.addChild(f.container);for(var b=0,g=this.floors.length+1;b<g;){var C=b++;if(null==this.floors[C]){this.floors[C]=f;break}}}}},__class__:r});var p=function(){};p.__name__=!0,p.main=function(){l.autoSize(),a.stageWidth=320,a.stageHeight=568;var e=new createjs.Stage(window.document.getElementById("mainCanvas"));a.stage=e;var n;if(null==tt.poolVec2?n=new fe:(n=tt.poolVec2,tt.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var i;null==Sn.zpp_pool?i=new Sn:(i=Sn.zpp_pool,Sn.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=0,i.y=600,n.zpp_inner=i,n.zpp_inner.outer=n}else{var t,p=(n.zpp_inner,n.zpp_inner);if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var _=n.zpp_inner;null!=_._validate&&_._validate(),t=600==n.zpp_inner.y}else t=!1;if(!t){n.zpp_inner.x=0,n.zpp_inner.y=600;var h=n.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}n.zpp_inner.weak=!0,a.space=new Je(n);var x=new o;(a.reset=function(){null!=a.game&&(a.game.destory(),a.stage.removeChild(a.game),a.game=null),a.menu=new s(function(){a.menu.destroy(),a.stage.removeChild(a.menu),a.menu=null,a.game=new r,a.stage.addChild(a.game),a.stage.addChild(x)}),a.space.zpp_inner.wrap_listeners.clear(),a.stage.addChild(a.menu),a.stage.addChild(x)})();var u,d=function(e){u=e.delta/1e3,null!=a.game&&a.game.update(u),a.stage.update(e)};createjs.Ticker.addEventListener("tick",d),createjs.Ticker.setFPS(60)},Math.__name__=!0;var s=function(e){createjs.Container.call(this);var n=new createjs.Shape;if(n.graphics.beginFill("#000"),n.graphics.drawRect(0,0,a.stageWidth,a.stageHeight),n.graphics.endFill(),n.alpha=.5,n.cache(0,0,a.stageWidth,a.stageHeight),this.addChild(n),s.first){s.first=!1;var i=new createjs.Text("点击开始","48px 黑体","#FFFFFF");i.textAlign="center",i.lineHeight=64,i.x=a.stageWidth/2,i.y=(a.stageHeight-i.getBounds().height)/2,this.addChild(i);var t=(a.stageWidth/2-96)/2|0,l=t/2|0,r=new createjs.Shape,p=(a.stageWidth-4*l)/2,o=l+p+l;r.graphics.beginFill("rgba(255, 255, 255, 0.25)"),r.graphics.drawRoundRect(l,l,p,p,l),r.graphics.drawRoundRect(a.stageWidth/2+l,l,p,p,l),r.graphics.endFill(),r.y=a.stageHeight-o,r.cache(0,0,a.stageWidth,o),this.addChild(r);var _=new createjs.Bitmap("./assets/arrow_left_1.png");_.x=t,_.y=r.y+t,_.alpha=.5,this.addChild(_);var h=new createjs.Bitmap("./assets/arrow_right_1.png");h.x=a.stageWidth/2+t,h.y=r.y+t,h.alpha=.5,this.addChild(h),n.addEventListener("click",function(n){e()})}else{var x=new createjs.Text("你坚持了\n"+a.stringTime(a.totalTime),"48px 黑体","#FFFFFF");x.textAlign="center",x.lineHeight=64,x.x=a.stageWidth/2,x.y=(a.stageHeight-x.getBounds().height)/2,x.addEventListener("click",function(n){e()}),this.addChild(x),n.addEventListener("click",function(n){e()}),this.y=-a.stageHeight,createjs.Tween.get(this).to({y:0},1e3,createjs.Ease.bounceOut)}};s.__name__=!0,s.__super__=createjs.Container,s.prototype=n(createjs.Container.prototype,{destroy:function(){},__class__:s});var o=function(){if(createjs.Container.call(this),createjs.Sound.initializeDefaultPlugins()){var e=[0,1,"normal"],n={images:["./assets/mute_0.png"],frames:{width:32,height:32,count:2},animations:{normal:e}},i=new createjs.SpriteSheet(n),t=new createjs.Sprite(i,"normal");t.alpha=.49,t.x=a.stageWidth-32-8,t.y=8;var l=createjs.Sound.getMute()?1:0;t.gotoAndStop(l),this.addChild(t);var r=new createjs.Bitmap("./assets/mute_bg_0.png");r.x=t.x,r.y=t.y,r.alpha=.01,this.addChild(r),r.addEventListener("click",function(){createjs.Sound.setMute(!createjs.Sound.getMute());var e=createjs.Sound.getMute()?1:0;t.gotoAndStop(e)})}};o.__name__=!0,o.__super__=createjs.Container,o.prototype=n(createjs.Container.prototype,{__class__:o});var _=function(){};_.__name__=!0,_.string=function(e){return M.__string_rec(e,"")},_.random=function(e){return e<=0?0:Math.floor(Math.random()*e)};var h=function(){};h.__name__=!0,h.enumEq=function(e,n){if(e==n)return!0;try{if(e[0]!=n[0])return!1;for(var i=2,t=e.length;i<t;){var l=i++;if(!h.enumEq(e[l],n[l]))return!1}var a=e.__enum__;if(a!=n.__enum__||null==a)return!1}catch(e){return!1}return!0};var x={__ename__:!0,__constructs__:["Random","Normal","Elastic","Conveyer"]};x.Random=["Random",0],x.Random.toString=t,x.Random.__enum__=x,x.Normal=["Normal",1],x.Normal.toString=t,x.Normal.__enum__=x,x.Elastic=["Elastic",2],x.Elastic.toString=t,x.Elastic.__enum__=x,x.Conveyer=["Conveyer",3],x.Conveyer.toString=t,x.Conveyer.__enum__=x;var u=function(e,n){this.linearDragY=1,this.linearDragX=1,this.body=e,this.container=new createjs.Container;var i=this.body;null==i.zpp_inner.wrap_pos&&i.zpp_inner.setupPosition();var t=i.zpp_inner.wrap_pos,l=t.zpp_inner;null!=l._validate&&l._validate();var a=t.zpp_inner.x,r=this.body;null==r.zpp_inner.wrap_pos&&r.zpp_inner.setupPosition();var p=r.zpp_inner.wrap_pos,s=p.zpp_inner;null!=s._validate&&s._validate();var o=p.zpp_inner.y,_=this.body.zpp_inner.rot,h=this.body;null==h.zpp_inner.wrap_pos&&h.zpp_inner.setupPosition();var x=h.zpp_inner.wrap_pos,u=this.body;null==u.zpp_inner.wrap_pos&&u.zpp_inner.setupPosition();var d=u.zpp_inner.wrap_pos,v=(d.zpp_inner,d.zpp_inner);if(null!=v._validate&&v._validate(),0!=d.zpp_inner.y){d.zpp_inner.y=0;var c=d.zpp_inner;null!=c._invalidate&&c._invalidate(c)}var y=d.zpp_inner;null!=y._validate&&y._validate();var m=d.zpp_inner.y,z=(x.zpp_inner,x.zpp_inner);if(null!=z._validate&&z._validate(),x.zpp_inner.x!=m){x.zpp_inner.x=m;var f=x.zpp_inner;null!=f._invalidate&&f._invalidate(f)}var b=x.zpp_inner;null!=b._validate&&b._validate();var g=this.body;if(g.zpp_inner.immutable_midstep("Body::rotation"),0!=g.zpp_inner.rot){g.zpp_inner.rot=0;var w=g.zpp_inner;w.zip_axis=!0;for(var C=w.shapes.head;null!=C;){var M=C.elt;1==M.type&&(M.polygon.invalidate_gverts(),M.polygon.invalidate_gaxi()),M.invalidate_worldCOM(),C=C.next}w.zip_worldCOM=!0,g.zpp_inner.wake()}var O=this.body.zpp_inner.aabb.wrapper(),k=O.zpp_inner;null!=k._validate&&k._validate();var S=O.zpp_inner.minx,A=this.body.zpp_inner.aabb.wrapper(),T=A.zpp_inner;null!=T._validate&&T._validate();var E=A.zpp_inner,I=S+(E.maxx-E.minx)/2,j=this.body.zpp_inner.aabb.wrapper(),N=j.zpp_inner;null!=N._validate&&N._validate();var D=j.zpp_inner.miny,L=this.body.zpp_inner.aabb.wrapper(),F=L.zpp_inner;null!=F._validate&&F._validate();var P=L.zpp_inner,R=D+(P.maxy-P.miny)/2;n.x=I-n.getBounds().width/2,n.y=R-n.getBounds().height/2,this.container.addChild(n);var B=this.body;null==B.zpp_inner.wrap_pos&&B.zpp_inner.setupPosition();var V=B.zpp_inner.wrap_pos,G=(V.zpp_inner,V.zpp_inner);if(null!=G._validate&&G._validate(),V.zpp_inner.x!=a){V.zpp_inner.x=a;var U=V.zpp_inner;null!=U._invalidate&&U._invalidate(U)}var Y=V.zpp_inner;null!=Y._validate&&Y._validate();var K=this.body;null==K.zpp_inner.wrap_pos&&K.zpp_inner.setupPosition();var W=K.zpp_inner.wrap_pos,q=(W.zpp_inner,W.zpp_inner);if(null!=q._validate&&q._validate(),W.zpp_inner.y!=o){W.zpp_inner.y=o;var X=W.zpp_inner;null!=X._invalidate&&X._invalidate(X)}var H=W.zpp_inner;null!=H._validate&&H._validate();var Z=this.body;if(Z.zpp_inner.immutable_midstep("Body::rotation"),Z.zpp_inner.rot!=_){Z.zpp_inner.rot=_;var J=Z.zpp_inner;J.zip_axis=!0;for(var Q=J.shapes.head;null!=Q;){var $=Q.elt;1==$.type&&($.polygon.invalidate_gverts(),$.polygon.invalidate_gaxi()),$.invalidate_worldCOM(),Q=Q.next}J.zip_worldCOM=!0,Z.zpp_inner.wake()}this.exists=!0,this.update()};u.__name__=!0,u.prototype={update:function(){if(this.exists){var e=this.body;null==e.zpp_inner.wrap_pos&&e.zpp_inner.setupPosition();var n=e.zpp_inner.wrap_pos,i=n.zpp_inner;null!=i._validate&&i._validate(),this.container.x=n.zpp_inner.x;var t=this.body;null==t.zpp_inner.wrap_pos&&t.zpp_inner.setupPosition();var l=t.zpp_inner.wrap_pos,a=l.zpp_inner;if(null!=a._validate&&a._validate(),this.container.y=l.zpp_inner.y,this.body.zpp_inner.norotate||(this.container.rotation=180*this.body.zpp_inner.rot/Math.PI),this.linearDragX<1){var r=this.body;null==r.zpp_inner.wrap_vel&&r.zpp_inner.setupVelocity();var p=r.zpp_inner.wrap_vel,s=p.zpp_inner;null!=s._validate&&s._validate();var o=p.zpp_inner.x*this.linearDragX,_=(p.zpp_inner,p.zpp_inner);if(null!=_._validate&&_._validate(),p.zpp_inner.x!=o){p.zpp_inner.x=o;var h=p.zpp_inner;null!=h._invalidate&&h._invalidate(h)}var x=p.zpp_inner;null!=x._validate&&x._validate()}if(this.linearDragY<1){var u=this.body;null==u.zpp_inner.wrap_vel&&u.zpp_inner.setupVelocity();var d=u.zpp_inner.wrap_vel,v=d.zpp_inner;null!=v._validate&&v._validate();var c=d.zpp_inner.y*this.linearDragY,y=(d.zpp_inner,d.zpp_inner);if(null!=y._validate&&y._validate(),d.zpp_inner.y!=c){d.zpp_inner.y=c;var m=d.zpp_inner;null!=m._invalidate&&m._invalidate(m)}var z=d.zpp_inner;null!=z._validate&&z._validate()}}},destroy:function(){this.exists=!1,null!=this.body&&(a.space.zpp_inner.wrap_bodies.remove(this.body),this.body=null),null!=this.container&&(null!=this.container.parent&&this.container.parent.removeChild(this.container),this.container=null)},__class__:u};var d=function(){this.zpp_inner=null,this.zpp_inner=new v,this.zpp_inner.outer=this};d.__name__=!0,d.get_ANY_BODY=function(){return v.ANY_BODY},d.get_ANY_CONSTRAINT=function(){return v.ANY_CONSTRAINT},d.get_ANY_SHAPE=function(){return v.ANY_SHAPE},d.get_ANY_COMPOUND=function(){return v.ANY_COMPOUND},d.prototype={toString:function(){return this==v.ANY_BODY?"ANY_BODY":this==v.ANY_SHAPE?"ANY_SHAPE":this==v.ANY_COMPOUND?"ANY_COMPOUND":this==v.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},__class__:d};var v=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.outer=null,this.id=c.CbType(),this.listeners=new y,this.bodylisteners=new m,this.conlisteners=new z,this.constraints=new f,this.interactors=new b,this.cbsets=new g};v.__name__=!0,v.prototype={__class__:v};var c=function(){};c.__name__=!0,c.Interactor=function(){return c._Interactor++},c.CbType=function(){return c._CbType++},c.CbSet=function(){return c._CbSet++},c.Listener=function(){return c._Listener++};var y=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};y.__name__=!0,y.prototype={add:function(e){var n;null==gi.zpp_pool?n=new gi:(n=gi.zpp_pool,gi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=gi.zpp_pool,gi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},clear:function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=gi.zpp_pool,gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},__class__:y};var m=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};m.__name__=!0,m.prototype={remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=Mi.zpp_pool,Mi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},clear:function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Mi.zpp_pool,Mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},__class__:m};var z=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};z.__name__=!0,z.prototype={remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=ki.zpp_pool,ki.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},clear:function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=ki.zpp_pool,ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},__class__:z};var f=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};f.__name__=!0,f.prototype={add:function(e){var n;null==zi.zpp_pool?n=new zi:(n=zi.zpp_pool,zi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=zi.zpp_pool,zi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},erase:function(e){var n,i;null==e?(n=this.head,i=n.next,this.head=i,null==this.head&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0));var t=n;return t.elt=null,t.next=zi.zpp_pool,zi.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:f};var b=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};b.__name__=!0,b.prototype={add:function(e){var n;null==Ci.zpp_pool?n=new Ci:(n=Ci.zpp_pool,Ci.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Ci.zpp_pool,Ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=Ci.zpp_pool,Ci.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:b};var g=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};g.__name__=!0,g.prototype={add:function(e){var n;null==wi.zpp_pool?n=new wi:(n=wi.zpp_pool,wi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=wi.zpp_pool,wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=wi.zpp_pool,wi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},__class__:g};var w=function(e,n,i){null==nn.BodyType_KINEMATIC&&(nn.internal=!0,nn.BodyType_KINEMATIC=new Ae,nn.internal=!1);var t=new Oe(nn.BodyType_KINEMATIC),l=null,r=128,p=16;if(null==i||h.enumEq(i,x.Random)){var s=Math.random();i=s<.2?x.Elastic:s<.35?x.Conveyer:x.Normal}switch(i[1]){case 0:break;case 1:var o=t.zpp_inner.wrap_shapes,d=new Ke(Ke.box(r,p));o.zpp_inner.reverse_flag?o.push(d):o.unshift(d),t.setShapeMaterials(Re.steel()),null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();var v=t.zpp_inner_i.wrap_cbTypes,c=w.CB_TYPE;v.zpp_inner.reverse_flag?v.push(c):v.unshift(c),l=new createjs.Bitmap("./assets/floor_0.png"),l.setBounds(0,0,r,p);for(var y=0,m=0;m<5;){m++;y+=Math.random()}y/=5;var z=.25*Math.PI*(y-.5);t.zpp_inner.angvel!=z&&(t.zpp_inner.angvel=z,t.zpp_inner.wake());break;case 2:var f=t.zpp_inner.wrap_shapes,b=new Ke(Ke.box(r,p));f.zpp_inner.reverse_flag?f.push(b):f.unshift(b);var g=Re.rubber();2!=g.zpp_inner.elasticity&&(g.zpp_inner.elasticity=2,g.zpp_inner.invalidate(Nn.WAKE|Nn.ARBITERS)),t.setShapeMaterials(g),null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();var C=t.zpp_inner_i.wrap_cbTypes,M=w.CB_TYPE_ELASTIC;C.zpp_inner.reverse_flag?C.push(M):C.unshift(M),l=new createjs.Bitmap("./assets/floor_1.png"),l.setBounds(0,0,r,p);break;case 3:var O=t.zpp_inner.wrap_shapes,k=new Ke(Ke.box(r,p));O.zpp_inner.reverse_flag?O.push(k):O.unshift(k);var S=Re.steel();1.4!=S.zpp_inner.dynamicFriction&&(S.zpp_inner.dynamicFriction=1.4,S.zpp_inner.invalidate(Nn.WAKE|Nn.ANGDRAG|Nn.ARBITERS)),1.4!=S.zpp_inner.staticFriction&&(S.zpp_inner.staticFriction=1.4,S.zpp_inner.invalidate(Nn.WAKE|Nn.ARBITERS)),t.setShapeMaterials(S),null==t.zpp_inner.wrap_svel&&t.zpp_inner.setupsvel();var A=t.zpp_inner.wrap_svel,T=0==_.random(2)?-300:300,E=(A.zpp_inner,A.zpp_inner);if(null!=E._validate&&E._validate(),A.zpp_inner.x!=T){A.zpp_inner.x=T;var I=A.zpp_inner;null!=I._invalidate&&I._invalidate(I)}var j=A.zpp_inner;null!=j._validate&&j._validate(),null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();var N=t.zpp_inner_i.wrap_cbTypes,D=w.CB_TYPE;N.zpp_inner.reverse_flag?N.push(D):N.unshift(D);var L=[0,1,"normal"],F={images:["./assets/floor_3.png"],frames:{width:r,height:p,count:2},animations:{normal:L}},P=new createjs.SpriteSheet(F);l=new createjs.Sprite(P,"normal");l.framerate=10,l.setBounds(0,0,r,p)}null==t.zpp_inner.wrap_pos&&t.zpp_inner.setupPosition();var R,B=t.zpp_inner.wrap_pos,V=(B.zpp_inner,B.zpp_inner);if(null!=V._validate&&V._validate(),B.zpp_inner.x==e){var G=B.zpp_inner;null!=G._validate&&G._validate(),R=B.zpp_inner.y==n}else R=!1;if(!R){B.zpp_inner.x=e,B.zpp_inner.y=n;var U=B.zpp_inner;null!=U._invalidate&&U._invalidate(U)}var Y=a.space;if(t.zpp_inner.immutable_midstep("Body::space"),(null==t.zpp_inner.space?null:t.zpp_inner.space.outer)!=Y&&(null!=(null==t.zpp_inner.space?null:t.zpp_inner.space.outer)&&(t.zpp_inner.component.woken=!1),null!=(null==t.zpp_inner.space?null:t.zpp_inner.space.outer)&&(null==t.zpp_inner.space?null:t.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(t),null!=Y)){var K=Y.zpp_inner.wrap_bodies;K.zpp_inner.reverse_flag?K.push(t):K.unshift(t)}t.zpp_inner.space;u.call(this,t,l),this.body.setShapeFilters(new le(2,4));var W=this.body;null==W.zpp_inner.wrap_vel&&W.zpp_inner.setupVelocity();var q=W.zpp_inner.wrap_vel,X=(q.zpp_inner,q.zpp_inner);if(null!=X._validate&&X._validate(),-60!=q.zpp_inner.y){q.zpp_inner.y=-60;var H=q.zpp_inner;null!=H._invalidate&&H._invalidate(H)}var Z=q.zpp_inner;null!=Z._validate&&Z._validate()};w.__name__=!0,w.__super__=u,w.prototype=n(u.prototype,{__class__:w});var C=function(e,n){this.stageMouseY=0,this.stageMouseX=0,this.mousePressed=!1;null==nn.BodyType_DYNAMIC&&(nn.internal=!0,nn.BodyType_DYNAMIC=new Ae,nn.internal=!1);var t=new Oe(nn.BodyType_DYNAMIC),l=t.zpp_inner.wrap_shapes,r=new Ke(Ke.box(16,44));l.zpp_inner.reverse_flag?l.push(r):l.unshift(r),null==t.zpp_inner.wrap_pos&&t.zpp_inner.setupPosition();var p,s=t.zpp_inner.wrap_pos,o=(s.zpp_inner,s.zpp_inner);if(null!=o._validate&&o._validate(),s.zpp_inner.x==e){var _=s.zpp_inner;null!=_._validate&&_._validate(),p=s.zpp_inner.y==n}else p=!1;if(!p){s.zpp_inner.x=e,s.zpp_inner.y=n;var h=s.zpp_inner;null!=h._invalidate&&h._invalidate(h)}t.zpp_inner.immutable_midstep("Body::false"),0!=!t.zpp_inner.norotate&&(t.zpp_inner.norotate=!0,t.zpp_inner.invalidate_inertia()),t.setShapeMaterials(Re.wood());var x=a.space;if(t.zpp_inner.immutable_midstep("Body::space"),(null==t.zpp_inner.space?null:t.zpp_inner.space.outer)!=x&&(null!=(null==t.zpp_inner.space?null:t.zpp_inner.space.outer)&&(t.zpp_inner.component.woken=!1),null!=(null==t.zpp_inner.space?null:t.zpp_inner.space.outer)&&(null==t.zpp_inner.space?null:t.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(t),null!=x)){var d=x.zpp_inner.wrap_bodies;d.zpp_inner.reverse_flag?d.push(t):d.unshift(t)}var v=(t.zpp_inner.space,[0,3,"right_run"]),c=[0,0,"right_stand"],y=[3,3,"right_jump"],m=[4,7,"left_run"],z=[4,4,"left_stand"],f=[7,7,"left_jump"],b={images:["./assets/player_3.png"],frames:{width:48,height:48,count:8},animations:{right_run:v,right_stand:c,right_jump:y,left_run:m,left_stand:z,left_jump:f}},g=new createjs.SpriteSheet(b);this.sprite=new createjs.Sprite(g,"right_jump"),this.sprite.framerate=10,this.sprite.setBounds(0,0,48,52),u.call(this,t,this.sprite),this.linearDragX=.96,this.body.setShapeFilters(new le(4,2));var w=this.body;null==w.zpp_inner_i.wrap_cbTypes&&w.zpp_inner_i.setupcbTypes();var M=w.zpp_inner_i.wrap_cbTypes,O=C.CB_TYPE;M.zpp_inner.reverse_flag?M.push(O):M.unshift(O),createjs.Touch.enable(a.stage),this.stageMouseX=a.stageWidth/2,this.stageMouseY=a.stageHeight/2,a.stage.addEventListener("stagemousedown",i(this,this.onMouseDown)),a.stage.addEventListener("stagemouseup",i(this,this.onMouseUp)),a.stage.addEventListener("stagemousemove",i(this,this.onMouseMove))};C.__name__=!0,C.__super__=u,C.prototype=n(u.prototype,{onMouseDown:function(e){this.mousePressed=!0,this.stageMouseX=e.stageX,this.stageMouseY=e.stageY},onMouseUp:function(e){this.mousePressed=!1},onMouseMove:function(e){this.stageMouseX=e.stageX,this.stageMouseY=e.stageY},destroy:function(){u.prototype.destroy.call(this),this.sprite=null,a.stage.removeEventListener("stagemousedown",i(this,this.onMouseDown)),a.stage.removeEventListener("stagemouseup",i(this,this.onMouseUp)),a.stage.removeEventListener("stagemousemove",i(this,this.onMouseMove))},die:function(){if(this.exists){this.exists=!1;var e=this.container.rotation+720;createjs.Tween.get(this.container).to({alpha:0,visible:!1,rotation:e,scaleX:2,scaleY:2},500).call(a.reset),createjs.Sound.play("die")}},update:function(){if(u.prototype.update.call(this),this.exists){if(this.mousePressed&&this.stageMouseY>48){console.log(this.stageMouseX),this.stageMouseX<a.stageWidth/2?this.facingLeft=!0:this.stageMouseX>a.stageWidth/2&&(this.facingLeft=!1);var e,n=this.body,i=this.facingLeft?-12:12;if(null==tt.poolVec2?e=new fe:(e=tt.poolVec2,tt.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner){var t;null==Sn.zpp_pool?t=new Sn:(t=Sn.zpp_pool,Sn.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=i,t.y=0,e.zpp_inner=t,e.zpp_inner.outer=e}else{var l,r=(e.zpp_inner,e.zpp_inner);if(null!=r._validate&&r._validate(),e.zpp_inner.x==i){var p=e.zpp_inner;null!=p._validate&&p._validate(),l=0==e.zpp_inner.y}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=0;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}e.zpp_inner.weak=!0,n.applyImpulse(e)}var o=this.body;null==o.zpp_inner.wrap_vel&&o.zpp_inner.setupVelocity();var _=o.zpp_inner.wrap_vel,h=_.zpp_inner;null!=h._validate&&h._validate(),Math.abs(_.zpp_inner.x)>2?this.facingLeft?"left_run"!=this.sprite.currentAnimation&&this.sprite.gotoAndPlay("left_run"):"right_run"!=this.sprite.currentAnimation&&this.sprite.gotoAndPlay("right_run"):this.facingLeft?"left_stand"!=this.sprite.currentAnimation&&this.sprite.gotoAndPlay("left_stand"):"right_stand"!=this.sprite.currentAnimation&&this.sprite.gotoAndPlay("right_stand");var x=this.body;null==x.zpp_inner.wrap_pos&&x.zpp_inner.setupPosition();var d=x.zpp_inner.wrap_pos,v=d.zpp_inner;if(null!=v._validate&&v._validate(),d.zpp_inner.x<16){var c=this.body;null==c.zpp_inner.wrap_pos&&c.zpp_inner.setupPosition();var y=c.zpp_inner.wrap_pos,m=(y.zpp_inner,y.zpp_inner);if(null!=m._validate&&m._validate(),16!=y.zpp_inner.x){y.zpp_inner.x=16;var z=y.zpp_inner;null!=z._invalidate&&z._invalidate(z)}var f=y.zpp_inner;null!=f._validate&&f._validate()}else{var b=this.body;null==b.zpp_inner.wrap_pos&&b.zpp_inner.setupPosition();var g=b.zpp_inner.wrap_pos,w=g.zpp_inner;if(null!=w._validate&&w._validate(),g.zpp_inner.x>a.stageWidth-16){var C=this.body;null==C.zpp_inner.wrap_pos&&C.zpp_inner.setupPosition();var M=C.zpp_inner.wrap_pos,O=a.stageWidth-16,k=(M.zpp_inner,M.zpp_inner);if(null!=k._validate&&k._validate(),M.zpp_inner.x!=O){M.zpp_inner.x=O;var S=M.zpp_inner;null!=S._invalidate&&S._invalidate(S)}var A=M.zpp_inner;null!=A._validate&&A._validate()}}}},__class__:C});var M=function(){};M.__name__=!0,M.getClass=function(e){if(e instanceof Array&&null==e.__enum__)return Array;var n=e.__class__;if(null!=n)return n;var i=M.__nativeClassName(e);return null!=i?M.__resolveNativeClass(i):null},M.__string_rec=function(e,n){if(null==e)return"null";if(n.length>=5)return"<...>";var i=typeof e;switch("function"==i&&(e.__name__||e.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var t=e[0]+"(";n+="\t";for(var l=2,a=e.length;l<a;){var r=l++;t+=2!=r?","+M.__string_rec(e[r],n):M.__string_rec(e[r],n)}return t+")"}var p=e.length,s="[";n+="\t";for(var o=0,_=p;o<_;){var h=o++;s+=(h>0?",":"")+M.__string_rec(e[h],n)}return s+="]"}var x;try{x=e.toString}catch(e){return"???"}if(null!=x&&x!=Object.toString&&"function"==typeof x){var u=e.toString();if("[object Object]"!=u)return u}var d=null,v="{\n";n+="\t";var c=null!=e.hasOwnProperty;for(var d in e)c&&!e.hasOwnProperty(d)||"prototype"!=d&&"__class__"!=d&&"__super__"!=d&&"__interfaces__"!=d&&"__properties__"!=d&&(2!=v.length&&(v+=", \n"),v+=n+d+" : "+M.__string_rec(e[d],n));return n=n.substring(1),v+="\n"+n+"}";case"string":return e;default:return String(e)}},M.__interfLoop=function(e,n){if(null==e)return!1;if(e==n)return!0;var i=e.__interfaces__;if(null!=i)for(var t=0,l=i.length;t<l;){var a=t++,r=i[a];if(r==n||M.__interfLoop(r,n))return!0}return M.__interfLoop(e.__super__,n)},M.__instanceof=function(e,n){if(null==n)return!1;switch(n){case Array:return e instanceof Array&&null==e.__enum__;case _t:return"boolean"==typeof e;case st:return!0;case ot:return"number"==typeof e;case pt:return"number"==typeof e&&(0|e)===e;case String:return"string"==typeof e;default:if(null==e)return!1;if("function"==typeof n){if(e instanceof n)return!0;if(M.__interfLoop(M.getClass(e),n))return!0}else if("object"==typeof n&&M.__isNativeObj(n)&&e instanceof n)return!0;return n==ht&&null!=e.__name__||(n==xt&&null!=e.__ename__||e.__enum__==n)}},M.__nativeClassName=function(e){var n=M.__toStr.call(e).slice(8,-1);return"Object"==n||"Function"==n||"Math"==n||"JSON"==n?null:n},M.__isNativeObj=function(e){return null!=M.__nativeClassName(e)},M.__resolveNativeClass=function(n){return e[n]};var O=function(){};O.__name__=!0;var k=function(){this.zpp_inner=null};k.__name__=!0,k.prototype={toString:function(){return""},__class__:k};var S=function(){k.call(this)};S.__name__=!0,S.__super__=k,S.prototype=n(k.prototype,{toString:function(){var e="Cb:";return e+=["WAKE","SLEEP"][this.zpp_inner.event-2],e+=":"+this.zpp_inner.body.outer.toString(),e+=" : listener: "+_.string(this.zpp_inner.listener.outer)},__class__:S});var A=function(){this.zpp_inner=null};A.__name__=!0,A.prototype={toString:function(){var e=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(0==this.zpp_inner.type){var n=this.zpp_inner.body;return"BodyListener{"+e+"::"+_.string(n.outer_zn.zpp_inner_zn.options.outer)+"}"}if(1==this.zpp_inner.type){var i=this.zpp_inner.constraint;return"ConstraintListener{"+e+"::"+_.string(i.outer_zn.zpp_inner_zn.options.outer)+"}"}var t,l=this.zpp_inner.interaction;switch(l.itype){case 1:t="COLLISION";break;case 2:t="SENSOR";break;case 4:t="FLUID";break;default:t="ALL"}return(2==this.zpp_inner.type?"InteractionListener{"+e+"#"+t+"::"+_.string(l.outer_zni.zpp_inner_zn.options1.outer)+":"+_.string(l.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+t+"::"+_.string(l.outer_znp.zpp_inner_zn.options1.outer)+":"+_.string(l.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},__class__:A};var T=function(){this.zpp_inner_zn=null};T.__name__=!0,T.__super__=A,T.prototype=n(A.prototype,{__class__:T});var E=function(){};E.__name__=!0,E.prototype={toString:function(){return null==nn.CbEvent_PRE&&(nn.internal=!0,nn.CbEvent_PRE=new E,nn.internal=!1),this==nn.CbEvent_PRE?"PRE":(null==nn.CbEvent_BEGIN&&(nn.internal=!0,nn.CbEvent_BEGIN=new E,nn.internal=!1),this==nn.CbEvent_BEGIN?"BEGIN":(null==nn.CbEvent_ONGOING&&(nn.internal=!0,nn.CbEvent_ONGOING=new E,nn.internal=!1),this==nn.CbEvent_ONGOING?"ONGOING":(null==nn.CbEvent_END&&(nn.internal=!0,nn.CbEvent_END=new E,nn.internal=!1),this==nn.CbEvent_END?"END":(null==nn.CbEvent_WAKE&&(nn.internal=!0,nn.CbEvent_WAKE=new E,nn.internal=!1),
this==nn.CbEvent_WAKE?"WAKE":(null==nn.CbEvent_SLEEP&&(nn.internal=!0,nn.CbEvent_SLEEP=new E,nn.internal=!1),this==nn.CbEvent_SLEEP?"SLEEP":(null==nn.CbEvent_BREAK&&(nn.internal=!0,nn.CbEvent_BREAK=new E,nn.internal=!1),this==nn.CbEvent_BREAK?"BREAK":""))))))},__class__:E};var I=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};I.__name__=!0,I.get=function(e){var n;if(null==I.zpp_pool){qi.internal=!0;var i=new I;qi.internal=!1,n=i}else{var t=I.zpp_pool;I.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},I.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=I.zpp_pool,I.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:I};var j=function(){this.zpp_inner=null,this.zpp_inner=new qi,this.zpp_inner.outer=this};j.__name__=!0,j.fromArray=function(e){for(var n=new j,i=0;i<e.length;){var t=e[i];++i,n.push(t)}return n},j.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},unshift:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=I.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=I.zpp_pool,I.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:j};var N=function(){k.call(this)};N.__name__=!0,N.__super__=k,N.prototype=n(k.prototype,{toString:function(){var e="Cb:";return e+=["WAKE","SLEEP","BREAK"][this.zpp_inner.event-2],e+=":"+this.zpp_inner.constraint.outer.toString(),e+=" : listener: "+_.string(this.zpp_inner.listener.outer)},__class__:N});var D=function(){this.zpp_inner_zn=null};D.__name__=!0,D.__super__=A,D.prototype=n(A.prototype,{__class__:D});var L=function(){k.call(this)};L.__name__=!0,L.__super__=k,L.prototype=n(k.prototype,{toString:function(){var e="Cb:";return e+=["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event],e+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),e+=" : "+this.zpp_inner.wrap_arbiters.toString(),e+=" : listener: "+_.string(this.zpp_inner.listener.outer)},__class__:L});var F=function(e,n,i,t,l,a){null==a&&(a=0),this.zpp_inner_zn=null,A.call(this);var r=-1;null==nn.CbEvent_BEGIN&&(nn.internal=!0,nn.CbEvent_BEGIN=new E,nn.internal=!1),e==nn.CbEvent_BEGIN?r=0:(null==nn.CbEvent_END&&(nn.internal=!0,nn.CbEvent_END=new E,nn.internal=!1),e==nn.CbEvent_END?r=1:(null==nn.CbEvent_ONGOING&&(nn.internal=!0,nn.CbEvent_ONGOING=new E,nn.internal=!1),e==nn.CbEvent_ONGOING&&(r=6))),this.zpp_inner_zn=new pn(sn.argument(i),sn.argument(t),r,2),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zni=this,this.zpp_inner.precedence=a,this.zpp_inner_zn.handleri=l;var p,s=this.zpp_inner_zn.itype;if(1==s?(null==nn.InteractionType_COLLISION&&(nn.internal=!0,nn.InteractionType_COLLISION=new P,nn.internal=!1),p=nn.InteractionType_COLLISION):2==s?(null==nn.InteractionType_SENSOR&&(nn.internal=!0,nn.InteractionType_SENSOR=new P,nn.internal=!1),p=nn.InteractionType_SENSOR):4==s?(null==nn.InteractionType_FLUID&&(nn.internal=!0,nn.InteractionType_FLUID=new P,nn.internal=!1),p=nn.InteractionType_FLUID):7==s?(null==nn.InteractionType_ANY&&(nn.internal=!0,nn.InteractionType_ANY=new P,nn.internal=!1),p=nn.InteractionType_ANY):p=null,p!=n){var o;null==nn.InteractionType_COLLISION&&(nn.internal=!0,nn.InteractionType_COLLISION=new P,nn.internal=!1),n==nn.InteractionType_COLLISION?o=1:(null==nn.InteractionType_SENSOR&&(nn.internal=!0,nn.InteractionType_SENSOR=new P,nn.internal=!1),n==nn.InteractionType_SENSOR?o=2:(null==nn.InteractionType_FLUID&&(nn.internal=!0,nn.InteractionType_FLUID=new P,nn.internal=!1),o=n==nn.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o}var _=this.zpp_inner_zn.itype;1==_?null==nn.InteractionType_COLLISION&&(nn.internal=!0,nn.InteractionType_COLLISION=new P,nn.internal=!1):2==_?null==nn.InteractionType_SENSOR&&(nn.internal=!0,nn.InteractionType_SENSOR=new P,nn.internal=!1):4==_?null==nn.InteractionType_FLUID&&(nn.internal=!0,nn.InteractionType_FLUID=new P,nn.internal=!1):7==_&&null==nn.InteractionType_ANY&&(nn.internal=!0,nn.InteractionType_ANY=new P,nn.internal=!1)};F.__name__=!0,F.__super__=A,F.prototype=n(A.prototype,{__class__:F});var P=function(){};P.__name__=!0,P.prototype={toString:function(){return null==nn.InteractionType_COLLISION&&(nn.internal=!0,nn.InteractionType_COLLISION=new P,nn.internal=!1),this==nn.InteractionType_COLLISION?"COLLISION":(null==nn.InteractionType_SENSOR&&(nn.internal=!0,nn.InteractionType_SENSOR=new P,nn.internal=!1),this==nn.InteractionType_SENSOR?"SENSOR":(null==nn.InteractionType_FLUID&&(nn.internal=!0,nn.InteractionType_FLUID=new P,nn.internal=!1),this==nn.InteractionType_FLUID?"FLUID":(null==nn.InteractionType_ANY&&(nn.internal=!0,nn.InteractionType_ANY=new P,nn.internal=!1),this==nn.InteractionType_ANY?"ANY":"")))},__class__:P};var R=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};R.__name__=!0,R.get=function(e){var n;if(null==R.zpp_pool){Wi.internal=!0;var i=new R;Wi.internal=!1,n=i}else{var t=R.zpp_pool;R.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},R.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=R.zpp_pool,R.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:R};var B=function(){this.zpp_inner=null,this.zpp_inner=new Wi,this.zpp_inner.outer=this};B.__name__=!0,B.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},unshift:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){e=this.zpp_inner.inner.head.elt;var n=e.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}e=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=e.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var n;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)n=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=i.iterator_at(this.zpp_inner.user_length-2)}e=null==n?this.zpp_inner.inner.head.elt:n.next.elt;var t=e.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)}else{e=this.zpp_inner.inner.head.elt;var l=e.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},remove:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n;n=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){n=!0;break}i=i.next}return n&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),n},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=R.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=R.zpp_pool,R.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:B};var V=function(){};V.__name__=!0,V.prototype={toString:function(){return null==nn.ListenerType_BODY&&(nn.internal=!0,nn.ListenerType_BODY=new V,nn.internal=!1),this==nn.ListenerType_BODY?"BODY":(null==nn.ListenerType_CONSTRAINT&&(nn.internal=!0,nn.ListenerType_CONSTRAINT=new V,nn.internal=!1),this==nn.ListenerType_CONSTRAINT?"CONSTRAINT":(null==nn.ListenerType_INTERACTION&&(nn.internal=!0,nn.ListenerType_INTERACTION=new V,nn.internal=!1),this==nn.ListenerType_INTERACTION?"INTERACTION":(null==nn.ListenerType_PRE&&(nn.internal=!0,nn.ListenerType_PRE=new V,nn.internal=!1),this==nn.ListenerType_PRE?"PRE":"")))},__class__:V};var G=function(e,n){this.zpp_inner=null,this.zpp_inner=new sn,this.zpp_inner.outer=this,null!=e&&this.including(e),null!=n&&this.excluding(n)};G.__name__=!0,G.prototype={including:function(e){return this.zpp_inner.append(this.zpp_inner.includes,e),this},excluding:function(e){return this.zpp_inner.append(this.zpp_inner.excludes,e),this},toString:function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var e=this.zpp_inner.wrap_includes.toString();return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+e+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},__class__:G};var U=function(){k.call(this)};U.__name__=!0,U.__super__=k,U.prototype=n(k.prototype,{toString:function(){var e="Cb:PRE:";return e+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),e+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString(),e+=" : listnener: "+_.string(this.zpp_inner.listener.outer)},__class__:U});var Y=function(){};Y.__name__=!0,Y.prototype={toString:function(){return null==nn.PreFlag_ACCEPT&&(nn.internal=!0,nn.PreFlag_ACCEPT=new Y,nn.internal=!1),this==nn.PreFlag_ACCEPT?"ACCEPT":(null==nn.PreFlag_IGNORE&&(nn.internal=!0,nn.PreFlag_IGNORE=new Y,nn.internal=!1),this==nn.PreFlag_IGNORE?"IGNORE":(null==nn.PreFlag_ACCEPT_ONCE&&(nn.internal=!0,nn.PreFlag_ACCEPT_ONCE=new Y,nn.internal=!1),this==nn.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==nn.PreFlag_IGNORE_ONCE&&(nn.internal=!0,nn.PreFlag_IGNORE_ONCE=new Y,nn.internal=!1),this==nn.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},__class__:Y};var K=function(){this.zpp_inner_zn=null};K.__name__=!0,K.__super__=A,K.prototype=n(A.prototype,{__class__:K});var W=function(){};W.__name__=!0,W.prototype={toString:function(){return"{Constraint}"},__class__:W};var q=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};q.__name__=!0,q.get=function(e){var n;if(null==q.zpp_pool){Gi.internal=!0;var i=new q;Gi.internal=!1,n=i}else{var t=q.zpp_pool;q.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},q.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=q.zpp_pool,q.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:q};var X=function(){this.zpp_inner=null,this.zpp_inner=new Gi,this.zpp_inner.outer=this};X.__name__=!0,X.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},remove:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n;n=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){n=!0;break}i=i.next}return n&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),n},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=q.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=q.zpp_pool,q.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:X};var H=function(){this.zpp_inner=null;_n.internal};H.__name__=!0,H.prototype={toString:function(){var e=this.zpp_inner.type==_n.COL?"CollisionArbiter":this.zpp_inner.type==_n.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return e+"(object-pooled)";var n,i=e+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).toString()+")",t=this.zpp_inner.type==_n.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"",l=this.zpp_inner.immState,a=l;if(5==a)null==nn.PreFlag_ACCEPT&&(nn.internal=!0,nn.PreFlag_ACCEPT=new Y,nn.internal=!1),n=nn.PreFlag_ACCEPT;else if(1==l)null==nn.PreFlag_ACCEPT_ONCE&&(nn.internal=!0,nn.PreFlag_ACCEPT_ONCE=new Y,nn.internal=!1),n=nn.PreFlag_ACCEPT_ONCE;else{var r=l;6==r?(null==nn.PreFlag_IGNORE&&(nn.internal=!0,nn.PreFlag_IGNORE=new Y,nn.internal=!1),n=nn.PreFlag_IGNORE):(null==nn.PreFlag_IGNORE_ONCE&&(nn.internal=!0,nn.PreFlag_IGNORE_ONCE=new Y,nn.internal=!1),n=nn.PreFlag_IGNORE_ONCE)}return i+t+"<-"+n.toString()},__class__:H};var Z=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Z.__name__=!0,Z.get=function(e){var n;if(null==Z.zpp_pool){nt.internal=!0;var i=new Z;nt.internal=!1,n=i}else{var t=Z.zpp_pool;Z.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},Z.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=Z.zpp_pool,Z.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Z};var J=function(){this.zpp_inner=null,this.zpp_inner=new nt,this.zpp_inner.outer=this};J.__name__=!0,J.prototype={zpp_gl:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.head;null!=e;){e.elt.active&&this.zpp_inner.user_length++,e=e.next}}return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(e){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(e=this.zpp_gl()-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;;){var n=this.zpp_inner.at_ite.elt;if(n.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=e;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var i=this.zpp_inner.at_ite.elt;if(i.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.elt.wrapper()},iterator:function(){return this.zpp_vm(),Z.get(this)},toString:function(){for(var e="[",n=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var l;if(i.zpp_i<t?l=!0:(i.zpp_next=Z.zpp_pool,Z.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==a?"NULL":a.toString(),n=!1}return e+"]"},__class__:J};var Q=function(){};Q.__name__=!0,Q.prototype={toString:function(){return null==nn.ArbiterType_COLLISION&&(nn.internal=!0,nn.ArbiterType_COLLISION=new Q,nn.internal=!1),this==nn.ArbiterType_COLLISION?"COLLISION":(null==nn.ArbiterType_SENSOR&&(nn.internal=!0,nn.ArbiterType_SENSOR=new Q,nn.internal=!1),this==nn.ArbiterType_SENSOR?"SENSOR":(null==nn.ArbiterType_FLUID&&(nn.internal=!0,nn.ArbiterType_FLUID=new Q,nn.internal=!1),this==nn.ArbiterType_FLUID?"FLUID":""))},__class__:Q};var $=function(){H.call(this)};$.__name__=!0,$.__super__=H,$.prototype=n(H.prototype,{__class__:$});var ee=function(){this.zpp_inner=null};ee.__name__=!0,ee.prototype={toString:function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},__class__:ee};var ne=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ne.__name__=!0,ne.get=function(e){var n;if(null==ne.zpp_pool){it.internal=!0;var i=new ne;it.internal=!1,n=i}else{var t=ne.zpp_pool;ne.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},ne.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;if(e.zpp_inner.valmod(),e.zpp_inner.zip_length){e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=0;for(var n=e.zpp_inner.inner.next;null!=n;){var i=n;i.active&&i.arbiter.active&&e.zpp_inner.user_length++,n=n.next}}var t=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=ne.zpp_pool,ne.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:ne};var ie=function(){this.zpp_inner=null};ie.__name__=!0,ie.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var i=n;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}e=this.zpp_inner.user_length-1-e}if(e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var t=this.zpp_inner.at_ite;if(t.active&&t.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=e;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var l=this.zpp_inner.at_ite;if(l.active&&l.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=ne.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var l=t.zpp_inner.inner.next;null!=l;){var a=l;a.active&&a.arbiter.active&&t.zpp_inner.user_length++,l=l.next}}var r=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(i.zpp_i<r?p=!0:(i.zpp_next=ne.zpp_pool,ne.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==s?"NULL":s.toString(),n=!1}return e+"]"},__class__:ie};var te=function(){H.call(this)};te.__name__=!0,te.__super__=H,te.prototype=n(H.prototype,{__class__:te});var le=function(e,n,i,t,l,a){null==a&&(a=-1),null==l&&(l=1),null==t&&(t=-1),null==i&&(i=1),null==n&&(n=-1),null==e&&(e=1),this.zpp_inner=null,null==cn.zpp_pool?this.zpp_inner=new cn:(this.zpp_inner=cn.zpp_pool,cn.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner;this.zpp_inner.outer=this,this.zpp_inner.collisionGroup!=e&&(this.zpp_inner.collisionGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=i&&(this.zpp_inner.sensorGroup=i,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=t&&(this.zpp_inner.sensorMask=t,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=l&&(this.zpp_inner.fluidGroup=l,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=a&&(this.zpp_inner.fluidMask=a,this.zpp_inner.invalidate())};le.__name__=!0,le.prototype={__class__:le};var ae=function(){this.zpp_inner=null};ae.__name__=!0,ae.prototype={toString:function(){var e="InteractionGroup";return this.zpp_inner.ignore&&(e+=":ignore"),e},__class__:ae};var re=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};re.__name__=!0,re.get=function(e){var n;if(null==re.zpp_pool){et.internal=!0;var i=new re;et.internal=!1,n=i}else{var t=re.zpp_pool;re.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},re.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=re.zpp_pool,re.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:re};var pe=function(){this.zpp_inner=null};pe.__name__=!0,pe.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=re.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=re.zpp_pool,re.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:pe};var se=function(e,n,i,t){null==t&&(t=0),null==i&&(i=0),null==n&&(n=0),null==e&&(e=0),this.zpp_inner=null;var l;null==mn.zpp_pool?l=new mn:(l=mn.zpp_pool,mn.zpp_pool=l.next,l.next=null),l.minx=e,l.miny=n,l.maxx=e+i,l.maxy=n+t,this.zpp_inner=l,this.zpp_inner.outer=this};se.__name__=!0,se.prototype={toString:function(){var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.toString()},__class__:se};var oe=function(){this.zpp_inner=null};oe.__name__=!0,oe.prototype={toString:function(){return"{ shape: "+_.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},__class__:oe};var _e=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};_e.__name__=!0,_e.get=function(e){var n;if(null==_e.zpp_pool){Ji.internal=!0;var i=new _e;Ji.internal=!1,n=i}else{var t=_e.zpp_pool;_e.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},_e.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=_e.zpp_pool,_e.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:_e};var he=function(){this.zpp_inner=null};he.__name__=!0,he.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=_e.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=_e.zpp_pool,_e.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:he};var xe=function(e){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new wn(this),null!=e){if(e instanceof Array&&null==e.__enum__)for(var n=e,i=0;i<n.length;){var t=n[i];++i;var l=t,a=l.zpp_inner;null!=a._validate&&a._validate();var r=l.zpp_inner.x,p=l.zpp_inner;null!=p._validate&&p._validate();var s,o=l.zpp_inner.y;null==gn.zpp_pool?s=new gn:(s=gn.zpp_pool,gn.zpp_pool=s.next,s.next=null),s.forced=!1,s.x=r,s.y=o;var _=s;null==this.zpp_inner.vertices?this.zpp_inner.vertices=_.prev=_.next=_:(_.prev=this.zpp_inner.vertices,_.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=_,this.zpp_inner.vertices.next=_),this.zpp_inner.vertices=_}else if(M.__instanceof(e,ge))for(var h=e,x=h.iterator();;){x.zpp_inner.zpp_inner.valmod();var u=x.zpp_inner.zpp_gl();x.zpp_critical=!0;var d;if(x.zpp_i<u?d=!0:(x.zpp_next=be.zpp_pool,be.zpp_pool=x,x.zpp_inner=null,d=!1),!d)break;x.zpp_critical=!1;var v=x.zpp_inner.at(x.zpp_i++),c=v.zpp_inner;null!=c._validate&&c._validate();var y=v.zpp_inner.x,m=v.zpp_inner;null!=m._validate&&m._validate();var z,f=v.zpp_inner.y;null==gn.zpp_pool?z=new gn:(z=gn.zpp_pool,gn.zpp_pool=z.next,z.next=null),z.forced=!1,z.x=y,z.y=f;var b=z;null==this.zpp_inner.vertices?this.zpp_inner.vertices=b.prev=b.next=b:(b.prev=this.zpp_inner.vertices,b.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=b,this.zpp_inner.vertices.next=b),this.zpp_inner.vertices=b}else if(M.__instanceof(e,xe)){var g=e,w=g.zpp_inner.vertices;if(null!=w)for(var C=w;;){var O,k=C.x,S=C.y;if(null==tt.poolVec2?O=new fe:(O=tt.poolVec2,tt.poolVec2=O.zpp_pool,O.zpp_pool=null),null==O.zpp_inner){var A;null==Sn.zpp_pool?A=new Sn:(A=Sn.zpp_pool,Sn.zpp_pool=A.next,A.next=null),A.weak=!1,A._immutable=!1,A.x=k,A.y=S,O.zpp_inner=A,O.zpp_inner.outer=O}else{var T,E=(O.zpp_inner,O.zpp_inner);if(null!=E._validate&&E._validate(),O.zpp_inner.x==k){var I=O.zpp_inner;null!=I._validate&&I._validate(),T=O.zpp_inner.y==S}else T=!1;if(!T){O.zpp_inner.x=k,O.zpp_inner.y=S;var j=O.zpp_inner;null!=j._invalidate&&j._invalidate(j)}}O.zpp_inner.weak=!1;var N=O;C=C.next;var D=N.zpp_inner;null!=D._validate&&D._validate();var L=N.zpp_inner.x,F=N.zpp_inner;null!=F._validate&&F._validate();var P,R=N.zpp_inner.y;null==gn.zpp_pool?P=new gn:(P=gn.zpp_pool,gn.zpp_pool=P.next,P.next=null),P.forced=!1,P.x=L,P.y=R;var B=P;null==this.zpp_inner.vertices?this.zpp_inner.vertices=B.prev=B.next=B:(B.prev=this.zpp_inner.vertices,
B.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=B,this.zpp_inner.vertices.next=B),this.zpp_inner.vertices=B;var V=(N.zpp_inner,N.zpp_inner);N.zpp_inner.outer=null,N.zpp_inner=null;var G=N;G.zpp_pool=tt.poolVec2,tt.poolVec2=G;var U=V;if(null!=U.outer&&(U.outer.zpp_inner=null,U.outer=null),U._isimmutable=null,U._validate=null,U._invalidate=null,U.next=Sn.zpp_pool,Sn.zpp_pool=U,C==w)break}}if(this.skipForward(1),e instanceof Array&&null==e.__enum__)for(var Y=e,K=0;K<Y.length;){var W,q=Y[K];if(q.zpp_inner.weak){var X=(q.zpp_inner,q.zpp_inner);q.zpp_inner.outer=null,q.zpp_inner=null;var H=q;H.zpp_pool=tt.poolVec2,tt.poolVec2=H;var Z=X;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=Sn.zpp_pool,Sn.zpp_pool=Z,W=!0}else W=!1;W?Y.splice(K,1):++K}else if(M.__instanceof(e,ge)){var J=e;null!=J.zpp_inner._validate&&J.zpp_inner._validate();for(var Q=J.zpp_inner.inner,$=null,ee=Q.head;null!=ee;){var ne=ee.elt;if(ne.outer.zpp_inner.weak){if(ee=Q.erase($),ne.outer.zpp_inner.weak){var ie=ne.outer,te=(ie.zpp_inner,ie.zpp_inner);ie.zpp_inner.outer=null,ie.zpp_inner=null;var le=ie;le.zpp_pool=tt.poolVec2,tt.poolVec2=le;var ae=te;null!=ae.outer&&(ae.outer.zpp_inner=null,ae.outer=null),ae._isimmutable=null,ae._validate=null,ae._invalidate=null,ae.next=Sn.zpp_pool,Sn.zpp_pool=ae}}else $=ee,ee=ee.next}}}};xe.__name__=!0,xe.get=function(e){var n;if(null==tt.poolGeomPoly?n=new xe:(n=tt.poolGeomPoly,tt.poolGeomPoly=n.zpp_pool,n.zpp_pool=null),null!=e){if(e instanceof Array&&null==e.__enum__)for(var i=e,t=0;t<i.length;){var l=i[t];++t;var a=l,r=a.zpp_inner;null!=r._validate&&r._validate();var p=a.zpp_inner.x,s=a.zpp_inner;null!=s._validate&&s._validate();var o,_=a.zpp_inner.y;null==gn.zpp_pool?o=new gn:(o=gn.zpp_pool,gn.zpp_pool=o.next,o.next=null),o.forced=!1,o.x=p,o.y=_;var h=o;null==n.zpp_inner.vertices?n.zpp_inner.vertices=h.prev=h.next=h:(h.prev=n.zpp_inner.vertices,h.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=h,n.zpp_inner.vertices.next=h),n.zpp_inner.vertices=h}else if(M.__instanceof(e,ge))for(var x=e,u=x.iterator();;){u.zpp_inner.zpp_inner.valmod();var d=u.zpp_inner.zpp_gl();u.zpp_critical=!0;var v;if(u.zpp_i<d?v=!0:(u.zpp_next=be.zpp_pool,be.zpp_pool=u,u.zpp_inner=null,v=!1),!v)break;u.zpp_critical=!1;var c=u.zpp_inner.at(u.zpp_i++),y=c.zpp_inner;null!=y._validate&&y._validate();var m=c.zpp_inner.x,z=c.zpp_inner;null!=z._validate&&z._validate();var f,b=c.zpp_inner.y;null==gn.zpp_pool?f=new gn:(f=gn.zpp_pool,gn.zpp_pool=f.next,f.next=null),f.forced=!1,f.x=m,f.y=b;var g=f;null==n.zpp_inner.vertices?n.zpp_inner.vertices=g.prev=g.next=g:(g.prev=n.zpp_inner.vertices,g.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=g,n.zpp_inner.vertices.next=g),n.zpp_inner.vertices=g}else if(M.__instanceof(e,xe)){var w=e,C=w.zpp_inner.vertices;if(null!=C)for(var O=C;;){var k,S=O.x,A=O.y;if(null==tt.poolVec2?k=new fe:(k=tt.poolVec2,tt.poolVec2=k.zpp_pool,k.zpp_pool=null),null==k.zpp_inner){var T;null==Sn.zpp_pool?T=new Sn:(T=Sn.zpp_pool,Sn.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=S,T.y=A,k.zpp_inner=T,k.zpp_inner.outer=k}else{var E,I=(k.zpp_inner,k.zpp_inner);if(null!=I._validate&&I._validate(),k.zpp_inner.x==S){var j=k.zpp_inner;null!=j._validate&&j._validate(),E=k.zpp_inner.y==A}else E=!1;if(!E){k.zpp_inner.x=S,k.zpp_inner.y=A;var N=k.zpp_inner;null!=N._invalidate&&N._invalidate(N)}}k.zpp_inner.weak=!1;var D=k;O=O.next;var L=D.zpp_inner;null!=L._validate&&L._validate();var F=D.zpp_inner.x,P=D.zpp_inner;null!=P._validate&&P._validate();var R,B=D.zpp_inner.y;null==gn.zpp_pool?R=new gn:(R=gn.zpp_pool,gn.zpp_pool=R.next,R.next=null),R.forced=!1,R.x=F,R.y=B;var V=R;null==n.zpp_inner.vertices?n.zpp_inner.vertices=V.prev=V.next=V:(V.prev=n.zpp_inner.vertices,V.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=V,n.zpp_inner.vertices.next=V),n.zpp_inner.vertices=V;var G=(D.zpp_inner,D.zpp_inner);D.zpp_inner.outer=null,D.zpp_inner=null;var U=D;U.zpp_pool=tt.poolVec2,tt.poolVec2=U;var Y=G;if(null!=Y.outer&&(Y.outer.zpp_inner=null,Y.outer=null),Y._isimmutable=null,Y._validate=null,Y._invalidate=null,Y.next=Sn.zpp_pool,Sn.zpp_pool=Y,O==C)break}}if(n.skipForward(1),e instanceof Array&&null==e.__enum__)for(var K=e,W=0;W<K.length;){var q,X=K[W];if(X.zpp_inner.weak){var H=(X.zpp_inner,X.zpp_inner);X.zpp_inner.outer=null,X.zpp_inner=null;var Z=X;Z.zpp_pool=tt.poolVec2,tt.poolVec2=Z;var J=H;null!=J.outer&&(J.outer.zpp_inner=null,J.outer=null),J._isimmutable=null,J._validate=null,J._invalidate=null,J.next=Sn.zpp_pool,Sn.zpp_pool=J,q=!0}else q=!1;q?K.splice(W,1):++W}else if(M.__instanceof(e,ge)){var Q=e;null!=Q.zpp_inner._validate&&Q.zpp_inner._validate();for(var $=Q.zpp_inner.inner,ee=null,ne=$.head;null!=ne;){var ie=ne.elt;if(ie.outer.zpp_inner.weak){if(ne=$.erase(ee),ie.outer.zpp_inner.weak){var te=ie.outer,le=(te.zpp_inner,te.zpp_inner);te.zpp_inner.outer=null,te.zpp_inner=null;var ae=te;ae.zpp_pool=tt.poolVec2,tt.poolVec2=ae;var re=le;null!=re.outer&&(re.outer.zpp_inner=null,re.outer=null),re._isimmutable=null,re._validate=null,re._invalidate=null,re.next=Sn.zpp_pool,Sn.zpp_pool=re}}else ee=ne,ne=ne.next}}}return n},xe.prototype={skipForward:function(e){if(null!=this.zpp_inner.vertices)if(e>0)for(;e-- >0;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(e<0)for(;e++<0;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},toString:function(){var e="GeomPoly[",n=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=n)for(var t=n;;){var l=t;if(l!=this.zpp_inner.vertices&&(e+=","),e+="{"+l.x+","+l.y+"}",(t=t.next)==i)break}return e+"]"},__class__:xe};var ue=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ue.__name__=!0,ue.get=function(e){var n;if(null==ue.zpp_pool){Hi.internal=!0;var i=new ue;Hi.internal=!1,n=i}else{var t=ue.zpp_pool;ue.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},ue.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=ue.zpp_pool,ue.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:ue};var de=function(){this.zpp_inner=null};de.__name__=!0,de.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=ue.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=ue.zpp_pool,ue.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:de};var ve=function(){this.zpp_inner=null};ve.__name__=!0,ve.prototype={toString:function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},__class__:ve};var ce=function(){this.zpp_inner=null};ce.__name__=!0,ce.prototype={toString:function(){for(var e="{ ",n=!0,i=0,t=this.zpp_inner.m;i<t;){var l=i++;n||(e+="; "),n=!1;for(var a=0,r=this.zpp_inner.n;a<r;){var p=a++;e+=this.zpp_inner.x[l*this.zpp_inner.n+p]+" "}}return e+="}"},__class__:ce};var ye=function(){this.zpp_inner=null};ye.__name__=!0,ye.prototype={toString:function(){return"{ shape: "+_.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+_.string(this.zpp_inner.inner)+" }"},__class__:ye};var me=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};me.__name__=!0,me.get=function(e){var n;if(null==me.zpp_pool){Zi.internal=!0;var i=new me;Zi.internal=!1,n=i}else{var t=me.zpp_pool;me.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},me.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=me.zpp_pool,me.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:me};var ze=function(){this.zpp_inner=null};ze.__name__=!0,ze.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=me.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=me.zpp_pool,me.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:ze};var fe=function(e,n){null==n&&(n=0),null==e&&(e=0),this.zpp_pool=null,this.zpp_inner=null;var i;null==Sn.zpp_pool?i=new Sn:(i=Sn.zpp_pool,Sn.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=e,i.y=n,this.zpp_inner=i,this.zpp_inner.outer=this};fe.__name__=!0,fe.prototype={toString:function(){var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.toString()},__class__:fe};var be=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};be.__name__=!0,be.get=function(e){var n;if(null==be.zpp_pool){Xi.internal=!0;var i=new be;Xi.internal=!1,n=i}else{var t=be.zpp_pool;be.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},be.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=be.zpp_pool,be.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:be};var ge=function(){this.zpp_inner=null,this.zpp_inner=new Xi,this.zpp_inner.outer=this};ge.__name__=!0,ge.fromArray=function(e){for(var n=new ge,i=0;i<e.length;){var t=e[i];++i,n.push(t)}return n},ge.prototype={zpp_gl:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(e){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(e=this.zpp_gl()-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var n=this.zpp_inner.at_ite.elt;if(null==n.outer){n.outer=new fe;var i=n.outer.zpp_inner;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Sn.zpp_pool,Sn.zpp_pool=i,n.outer.zpp_inner=n}return n.outer},push:function(e){this.zpp_inner.modify_test(),this.zpp_vm();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1);this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},empty:function(){return 0==this.zpp_gl()},iterator:function(){return this.zpp_vm(),be.get(this)},toString:function(){for(var e="[",n=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var l;if(i.zpp_i<t?l=!0:(i.zpp_next=be.zpp_pool,be.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==a?"NULL":a.toString(),n=!1}return e+"]"},__class__:ge};var we=function(){this.zpp_inner=null};we.__name__=!0,we.prototype={toString:function(){var e=this.zpp_inner;null!=e._validate&&e._validate();var n="{ x: "+this.zpp_inner.x+" y: ",i=this.zpp_inner;null!=i._validate&&i._validate();var t=n+this.zpp_inner.y+" z: ",l=this.zpp_inner;return null!=l._validate&&l._validate(),t+this.zpp_inner.z+" }"},__class__:we};var Ce=function(){};Ce.__name__=!0,Ce.prototype={toString:function(){return null==nn.Winding_UNDEFINED&&(nn.internal=!0,nn.Winding_UNDEFINED=new Ce,nn.internal=!1),this==nn.Winding_UNDEFINED?"UNDEFINED":(null==nn.Winding_CLOCKWISE&&(nn.internal=!0,nn.Winding_CLOCKWISE=new Ce,nn.internal=!1),this==nn.Winding_CLOCKWISE?"CLOCKWISE":(null==nn.Winding_ANTICLOCKWISE&&(nn.internal=!0,nn.Winding_ANTICLOCKWISE=new Ce,nn.internal=!1),this==nn.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},__class__:Ce};var Me=function(){this.zpp_inner_i=null};Me.__name__=!0,Me.prototype={toString:function(){return""},__class__:Me};var Oe=function(e,n){if(this.zpp_inner=null,Me.call(this),this.zpp_inner=new En,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,null!=n){var i=n.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.posx=n.zpp_inner.x;var t=n.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.posy=n.zpp_inner.y}else this.zpp_inner.posx=0,this.zpp_inner.posy=0;var l;if(null==e?(null==nn.BodyType_DYNAMIC&&(nn.internal=!0,nn.BodyType_DYNAMIC=new Ae,nn.internal=!1),l=nn.BodyType_DYNAMIC):l=e,this.zpp_inner.immutable_midstep("Body::type"),En.types[this.zpp_inner.type]!=l){var a;null==nn.BodyType_DYNAMIC&&(nn.internal=!0,nn.BodyType_DYNAMIC=new Ae,nn.internal=!1),l==nn.BodyType_DYNAMIC?a=2:(null==nn.BodyType_KINEMATIC&&(nn.internal=!0,nn.BodyType_KINEMATIC=new Ae,nn.internal=!1),a=l==nn.BodyType_KINEMATIC?3:1),1==a&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,a):this.zpp_inner.type=a}if(null!=n&&n.zpp_inner.weak){var r=(n.zpp_inner,n.zpp_inner);n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=tt.poolVec2,tt.poolVec2=p;var s=r;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Sn.zpp_pool,Sn.zpp_pool=s}this.zpp_inner_i.insert_cbtype(v.ANY_BODY.zpp_inner)};Oe.__name__=!0,Oe.__super__=Me,Oe.prototype=n(Me.prototype,{applyImpulse:function(e,n,i){if(null==i&&(i=!1),i&&this.zpp_inner.component.sleeping){if(e.zpp_inner.weak){var t=(e.zpp_inner,e.zpp_inner);e.zpp_inner.outer=null,e.zpp_inner=null;var l=e;l.zpp_pool=tt.poolVec2,tt.poolVec2=l;var a=t;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Sn.zpp_pool,Sn.zpp_pool=a}if(null!=n&&n.zpp_inner.weak){var r=(n.zpp_inner,n.zpp_inner);n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=tt.poolVec2,tt.poolVec2=p;var s=r;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Sn.zpp_pool,Sn.zpp_pool=s}return this}this.zpp_inner.validate_mass();var o=this.zpp_inner.imass,_=this.zpp_inner,h=_.velx,x=e.zpp_inner;null!=x._validate&&x._validate(),_.velx=h+e.zpp_inner.x*o;var u=this.zpp_inner,d=u.vely,v=e.zpp_inner;if(null!=v._validate&&v._validate(),u.vely=d+e.zpp_inner.y*o,null!=n){var c=0,y=0,m=n.zpp_inner;null!=m._validate&&m._validate(),c=n.zpp_inner.x-this.zpp_inner.posx;var z=n.zpp_inner;null!=z._validate&&z._validate(),y=n.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia();var f=this.zpp_inner,b=f.angvel,g=e.zpp_inner;null!=g._validate&&g._validate();var w=e.zpp_inner.y*c,C=e.zpp_inner;if(null!=C._validate&&C._validate(),f.angvel=b+(w-e.zpp_inner.x*y)*this.zpp_inner.iinertia,n.zpp_inner.weak){var M=(n.zpp_inner,n.zpp_inner);n.zpp_inner.outer=null,n.zpp_inner=null;var O=n;O.zpp_pool=tt.poolVec2,tt.poolVec2=O;var k=M;null!=k.outer&&(k.outer.zpp_inner=null,k.outer=null),k._isimmutable=null,k._validate=null,k._invalidate=null,k.next=Sn.zpp_pool,Sn.zpp_pool=k}}if(i||2==this.zpp_inner.type&&this.zpp_inner.wake(),e.zpp_inner.weak){var S=(e.zpp_inner,e.zpp_inner);e.zpp_inner.outer=null,e.zpp_inner=null;var A=e;A.zpp_pool=tt.poolVec2,tt.poolVec2=A;var T=S;null!=T.outer&&(T.outer.zpp_inner=null,T.outer=null),T._isimmutable=null,T._validate=null,T._invalidate=null,T.next=Sn.zpp_pool,Sn.zpp_pool=T}return this},setShapeMaterials:function(e){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var n=this.zpp_inner.shapes.head;null!=n;){var i=n.elt,t=i.outer;t.zpp_inner.immutable_midstep("Shape::material"),t.zpp_inner.setMaterial(e.zpp_inner),t.zpp_inner.material.wrapper(),n=n.next}return this},setShapeFilters:function(e){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var n=this.zpp_inner.shapes.head;null!=n;){var i=n.elt,t=i.outer;t.zpp_inner.immutable_midstep("Shape::filter"),t.zpp_inner.setFilter(e.zpp_inner),t.zpp_inner.filter.wrapper(),n=n.next}return this},toString:function(){return(this.zpp_inner.world?"(space::world":"("+(2==this.zpp_inner.type?"dynamic":1==this.zpp_inner.type?"static":"kinematic"))+")#"+this.zpp_inner_i.id},__class__:Oe});var ke=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ke.__name__=!0,ke.get=function(e){var n;if(null==ke.zpp_pool){Ui.internal=!0;var i=new ke;Ui.internal=!1,n=i}else{var t=ke.zpp_pool;ke.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},ke.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=ke.zpp_pool,ke.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:ke};var Se=function(){this.zpp_inner=null,this.zpp_inner=new Ui,this.zpp_inner.outer=this};Se.__name__=!0,Se.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},unshift:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},remove:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n;n=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){n=!0;break}i=i.next}return n&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),n},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=ke.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=ke.zpp_pool,ke.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:Se};var Ae=function(){};Ae.__name__=!0,Ae.prototype={toString:function(){return null==nn.BodyType_STATIC&&(nn.internal=!0,nn.BodyType_STATIC=new Ae,nn.internal=!1),this==nn.BodyType_STATIC?"STATIC":(null==nn.BodyType_DYNAMIC&&(nn.internal=!0,nn.BodyType_DYNAMIC=new Ae,nn.internal=!1),this==nn.BodyType_DYNAMIC?"DYNAMIC":(null==nn.BodyType_KINEMATIC&&(nn.internal=!0,nn.BodyType_KINEMATIC=new Ae,nn.internal=!1),this==nn.BodyType_KINEMATIC?"KINEMATIC":""))},__class__:Ae};var Te=function(){this.zpp_inner=null};Te.__name__=!0,Te.__super__=Me,Te.prototype=n(Me.prototype,{toString:function(){return"Compound"+this.zpp_inner_i.id},__class__:Te});var Ee=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Ee.__name__=!0,Ee.get=function(e){var n;if(null==Ee.zpp_pool){Ki.internal=!0;var i=new Ee;Ki.internal=!1,n=i}else{var t=Ee.zpp_pool;Ee.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},Ee.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Ee.zpp_pool,Ee.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Ee};var Ie=function(){this.zpp_inner=null,this.zpp_inner=new Ki,this.zpp_inner.outer=this};Ie.__name__=!0,Ie.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},remove:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n;n=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){n=!0;break}i=i.next}return n&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),n},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=Ee.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=Ee.zpp_pool,Ee.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:Ie};var je=function(){this.zpp_inner=null};je.__name__=!0,je.prototype={toString:function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+_.string(this.zpp_inner.wrap_gravity)+" }"},__class__:je};var Ne=function(){};Ne.__name__=!0,Ne.prototype={toString:function(){return null==nn.GravMassMode_DEFAULT&&(nn.internal=!0,nn.GravMassMode_DEFAULT=new Ne,nn.internal=!1),this==nn.GravMassMode_DEFAULT?"DEFAULT":(null==nn.GravMassMode_FIXED&&(nn.internal=!0,nn.GravMassMode_FIXED=new Ne,nn.internal=!1),this==nn.GravMassMode_FIXED?"FIXED":(null==nn.GravMassMode_SCALED&&(nn.internal=!0,nn.GravMassMode_SCALED=new Ne,nn.internal=!1),this==nn.GravMassMode_SCALED?"SCALED":""))},__class__:Ne};var De=function(){};De.__name__=!0,De.prototype={toString:function(){return null==nn.InertiaMode_DEFAULT&&(nn.internal=!0,nn.InertiaMode_DEFAULT=new De,nn.internal=!1),this==nn.InertiaMode_DEFAULT?"DEFAULT":(null==nn.InertiaMode_FIXED&&(nn.internal=!0,nn.InertiaMode_FIXED=new De,nn.internal=!1),this==nn.InertiaMode_FIXED?"FIXED":"")},__class__:De};var Le=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Le.__name__=!0,Le.get=function(e){var n;if(null==Le.zpp_pool){Yi.internal=!0;var i=new Le;Yi.internal=!1,n=i}else{var t=Le.zpp_pool;Le.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},Le.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Le.zpp_pool,Le.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Le};var Fe=function(){this.zpp_inner=null};Fe.__name__=!0,Fe.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=Le.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=Le.zpp_pool,Le.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:Fe};var Pe=function(){};Pe.__name__=!0,Pe.prototype={toString:function(){return null==nn.MassMode_DEFAULT&&(nn.internal=!0,nn.MassMode_DEFAULT=new Pe,nn.internal=!1),this==nn.MassMode_DEFAULT?"DEFAULT":(null==nn.MassMode_FIXED&&(nn.internal=!0,nn.MassMode_FIXED=new Pe,nn.internal=!1),this==nn.MassMode_FIXED?"FIXED":"")},__class__:Pe};var Re=function(e,n,i,t,l){null==l&&(l=.001),null==t&&(t=1),null==i&&(i=2),null==n&&(n=1),null==e&&(e=0),this.zpp_inner=null,null==Nn.zpp_pool?this.zpp_inner=new Nn:(this.zpp_inner=Nn.zpp_pool,Nn.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner;this.zpp_inner.outer=this,e!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=e/1,this.zpp_inner.invalidate(Nn.WAKE|Nn.ARBITERS)),n!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=n/1,this.zpp_inner.invalidate(Nn.WAKE|Nn.ANGDRAG|Nn.ARBITERS)),i!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=i/1,this.zpp_inner.invalidate(Nn.WAKE|Nn.ARBITERS)),t!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=t/1e3,this.zpp_inner.invalidate(Nn.WAKE|Nn.PROPS)),l!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=l/1,this.zpp_inner.invalidate(Nn.WAKE|Nn.ARBITERS))};Re.__name__=!0,Re.wood=function(){return new Re(.4,.2,.38,.7,.005)},Re.steel=function(){return new Re(.2,.57,.74,7.8,.001)},Re.rubber=function(){return new Re(.8,1,1.4,1.5,.01)},Re.prototype={toString:function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},__class__:Re};var Be=function(){this.zpp_inner=null,Me.call(this)};Be.__name__=!0,Be.__super__=Me,Be.prototype=n(Me.prototype,{toString:function(){return(0==this.zpp_inner.type?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},__class__:Be});var Ve=function(){};Ve.__name__=!0,Ve.__super__=Be,Ve.prototype=n(Be.prototype,{__class__:Ve});var Ge=function(){this.zpp_inner=null};Ge.__name__=!0,Ge.prototype={toString:function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var e=this.zpp_inner.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var n=e.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var t=e.lverts.next,l=e.gverts.next;null!=l;){var a=l,r=t;t=t.next,a.x=e.body.posx+(e.body.axisy*r.x-e.body.axisx*r.y),a.y=e.body.posy+(r.x*e.body.axisx+r.y*e.body.axisy),l=l.next}}var p=e.edges.head,s=e.gverts.next,o=s;for(s=s.next;null!=s;){var _=s,h=p.elt;p=p.next,h.gp0=o,h.gp1=_,h.gnormx=e.body.axisy*h.lnormx-e.body.axisx*h.lnormy,h.gnormy=h.lnormx*e.body.axisx+h.lnormy*e.body.axisy,h.gprojection=e.body.posx*h.gnormx+e.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,o=_,s=s.next}var x=e.gverts.next,u=p.elt;p=p.next,u.gp0=o,u.gp1=x,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},__class__:Ge};var Ue=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,
this.zpp_inner=null};Ue.__name__=!0,Ue.get=function(e){var n;if(null==Ue.zpp_pool){Qi.internal=!0;var i=new Ue;Qi.internal=!1,n=i}else{var t=Ue.zpp_pool;Ue.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},Ue.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Ue.zpp_pool,Ue.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Ue};var Ye=function(){this.zpp_inner=null};Ye.__name__=!0,Ye.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e==this.zpp_inner.user_length-1?e=e:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-2-e)),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=Ue.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=Ue.zpp_pool,Ue.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:Ye};var Ke=function(e,n,i){if(this.zpp_inner_zn=null,Be.call(this),this.zpp_inner_zn=new Pn,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,e instanceof Array&&null==e.__enum__)for(var t=e,l=0;l<t.length;){var a=t[l];++l;var r=a;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var p=this.zpp_inner_zn.wrap_lverts,s=r.zpp_inner;null!=s._validate&&s._validate();var o=r.zpp_inner.x,_=r.zpp_inner;null!=_._validate&&_._validate();var h,x=r.zpp_inner.y;if(null==tt.poolVec2?h=new fe:(h=tt.poolVec2,tt.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner){var u;null==Sn.zpp_pool?u=new Sn:(u=Sn.zpp_pool,Sn.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=o,u.y=x,h.zpp_inner=u,h.zpp_inner.outer=h}else{var d,c=(h.zpp_inner,h.zpp_inner);if(null!=c._validate&&c._validate(),h.zpp_inner.x==o){var y=h.zpp_inner;null!=y._validate&&y._validate(),d=h.zpp_inner.y==x}else d=!1;if(!d){h.zpp_inner.x=o,h.zpp_inner.y=x;var m=h.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}h.zpp_inner.weak=!1,p.push(h)}else if(M.__instanceof(e,ge))for(var z=e,f=z.iterator();;){f.zpp_inner.zpp_inner.valmod();var b=f.zpp_inner.zpp_gl();f.zpp_critical=!0;var g;if(f.zpp_i<b?g=!0:(f.zpp_next=be.zpp_pool,be.zpp_pool=f,f.zpp_inner=null,g=!1),!g)break;f.zpp_critical=!1;var w=f.zpp_inner.at(f.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var C=this.zpp_inner_zn.wrap_lverts,O=w.zpp_inner;null!=O._validate&&O._validate();var k=w.zpp_inner.x,S=w.zpp_inner;null!=S._validate&&S._validate();var A,T=w.zpp_inner.y;if(null==tt.poolVec2?A=new fe:(A=tt.poolVec2,tt.poolVec2=A.zpp_pool,A.zpp_pool=null),null==A.zpp_inner){var E;null==Sn.zpp_pool?E=new Sn:(E=Sn.zpp_pool,Sn.zpp_pool=E.next,E.next=null),E.weak=!1,E._immutable=!1,E.x=k,E.y=T,A.zpp_inner=E,A.zpp_inner.outer=A}else{var I,j=(A.zpp_inner,A.zpp_inner);if(null!=j._validate&&j._validate(),A.zpp_inner.x==k){var N=A.zpp_inner;null!=N._validate&&N._validate(),I=A.zpp_inner.y==T}else I=!1;if(!I){A.zpp_inner.x=k,A.zpp_inner.y=T;var D=A.zpp_inner;null!=D._invalidate&&D._invalidate(D)}}A.zpp_inner.weak=!1,C.push(A)}else if(M.__instanceof(e,xe)){var L=e,F=L.zpp_inner.vertices;if(null!=F)for(var P=F;;){var R,B=P.x,V=P.y;if(null==tt.poolVec2?R=new fe:(R=tt.poolVec2,tt.poolVec2=R.zpp_pool,R.zpp_pool=null),null==R.zpp_inner){var G;null==Sn.zpp_pool?G=new Sn:(G=Sn.zpp_pool,Sn.zpp_pool=G.next,G.next=null),G.weak=!1,G._immutable=!1,G.x=B,G.y=V,R.zpp_inner=G,R.zpp_inner.outer=R}else{var U,Y=(R.zpp_inner,R.zpp_inner);if(null!=Y._validate&&Y._validate(),R.zpp_inner.x==B){var K=R.zpp_inner;null!=K._validate&&K._validate(),U=R.zpp_inner.y==V}else U=!1;if(!U){R.zpp_inner.x=B,R.zpp_inner.y=V;var W=R.zpp_inner;null!=W._invalidate&&W._invalidate(W)}}R.zpp_inner.weak=!1;var q=R;P=P.next,null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var X=this.zpp_inner_zn.wrap_lverts,H=q.zpp_inner;null!=H._validate&&H._validate();var Z=q.zpp_inner.x,J=q.zpp_inner;null!=J._validate&&J._validate();var Q,$=q.zpp_inner.y;if(null==tt.poolVec2?Q=new fe:(Q=tt.poolVec2,tt.poolVec2=Q.zpp_pool,Q.zpp_pool=null),null==Q.zpp_inner){var ee;null==Sn.zpp_pool?ee=new Sn:(ee=Sn.zpp_pool,Sn.zpp_pool=ee.next,ee.next=null),ee.weak=!1,ee._immutable=!1,ee.x=Z,ee.y=$,Q.zpp_inner=ee,Q.zpp_inner.outer=Q}else{var ne,ie=(Q.zpp_inner,Q.zpp_inner);if(null!=ie._validate&&ie._validate(),Q.zpp_inner.x==Z){var te=Q.zpp_inner;null!=te._validate&&te._validate(),ne=Q.zpp_inner.y==$}else ne=!1;if(!ne){Q.zpp_inner.x=Z,Q.zpp_inner.y=$;var le=Q.zpp_inner;null!=le._invalidate&&le._invalidate(le)}}Q.zpp_inner.weak=!1,X.push(Q);var ae=(q.zpp_inner,q.zpp_inner);q.zpp_inner.outer=null,q.zpp_inner=null;var re=q;re.zpp_pool=tt.poolVec2,tt.poolVec2=re;var pe=ae;if(null!=pe.outer&&(pe.outer.zpp_inner=null,pe.outer=null),pe._isimmutable=null,pe._validate=null,pe._invalidate=null,pe.next=Sn.zpp_pool,Sn.zpp_pool=pe,P==F)break}}if(e instanceof Array&&null==e.__enum__)for(var se=e,oe=0;oe<se.length;){var _e,he=se[oe];if(he.zpp_inner.weak){var ue=(he.zpp_inner,he.zpp_inner);he.zpp_inner.outer=null,he.zpp_inner=null;var de=he;de.zpp_pool=tt.poolVec2,tt.poolVec2=de;var ve=ue;null!=ve.outer&&(ve.outer.zpp_inner=null,ve.outer=null),ve._isimmutable=null,ve._validate=null,ve._invalidate=null,ve.next=Sn.zpp_pool,Sn.zpp_pool=ve,_e=!0}else _e=!1;_e?se.splice(oe,1):++oe}else if(M.__instanceof(e,ge)){var ce=e;null!=ce.zpp_inner._validate&&ce.zpp_inner._validate();for(var ye=ce.zpp_inner.inner,me=null,ze=ye.head;null!=ze;){var we=ze.elt;if(we.outer.zpp_inner.weak){if(ze=ye.erase(me),we.outer.zpp_inner.weak){var Ce=we.outer,Me=(Ce.zpp_inner,Ce.zpp_inner);Ce.zpp_inner.outer=null,Ce.zpp_inner=null;var Oe=Ce;Oe.zpp_pool=tt.poolVec2,tt.poolVec2=Oe;var ke=Me;null!=ke.outer&&(ke.outer.zpp_inner=null,ke.outer=null),ke._isimmutable=null,ke._validate=null,ke._invalidate=null,ke.next=Sn.zpp_pool,Sn.zpp_pool=ke}}else me=ze,ze=ze.next}}if(null==n){null==Nn.zpp_pool?this.zpp_inner.material=new Nn:(this.zpp_inner.material=Nn.zpp_pool,Nn.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null);this.zpp_inner.material}else this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(n.zpp_inner),this.zpp_inner.material.wrapper();if(null==i){null==cn.zpp_pool?this.zpp_inner.filter=new cn:(this.zpp_inner.filter=cn.zpp_pool,cn.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null);this.zpp_inner.filter}else this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper();this.zpp_inner_i.insert_cbtype(v.ANY_SHAPE.zpp_inner)};Ke.__name__=!0,Ke.rect=function(e,n,i,t,l){null==l&&(l=!1);var a;if(null==tt.poolVec2?a=new fe:(a=tt.poolVec2,tt.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner){var r;null==Sn.zpp_pool?r=new Sn:(r=Sn.zpp_pool,Sn.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=e,r.y=n,a.zpp_inner=r,a.zpp_inner.outer=a}else{var p,s=(a.zpp_inner,a.zpp_inner);if(null!=s._validate&&s._validate(),a.zpp_inner.x==e){var o=a.zpp_inner;null!=o._validate&&o._validate(),p=a.zpp_inner.y==n}else p=!1;if(!p){a.zpp_inner.x=e,a.zpp_inner.y=n;var _=a.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}a.zpp_inner.weak=l;var h,x=e+i;if(null==tt.poolVec2?h=new fe:(h=tt.poolVec2,tt.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner){var u;null==Sn.zpp_pool?u=new Sn:(u=Sn.zpp_pool,Sn.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=x,u.y=n,h.zpp_inner=u,h.zpp_inner.outer=h}else{var d,v=(h.zpp_inner,h.zpp_inner);if(null!=v._validate&&v._validate(),h.zpp_inner.x==x){var c=h.zpp_inner;null!=c._validate&&c._validate(),d=h.zpp_inner.y==n}else d=!1;if(!d){h.zpp_inner.x=x,h.zpp_inner.y=n;var y=h.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}h.zpp_inner.weak=l;var m,z=e+i,f=n+t;if(null==tt.poolVec2?m=new fe:(m=tt.poolVec2,tt.poolVec2=m.zpp_pool,m.zpp_pool=null),null==m.zpp_inner){var b;null==Sn.zpp_pool?b=new Sn:(b=Sn.zpp_pool,Sn.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=z,b.y=f,m.zpp_inner=b,m.zpp_inner.outer=m}else{var g,w=(m.zpp_inner,m.zpp_inner);if(null!=w._validate&&w._validate(),m.zpp_inner.x==z){var C=m.zpp_inner;null!=C._validate&&C._validate(),g=m.zpp_inner.y==f}else g=!1;if(!g){m.zpp_inner.x=z,m.zpp_inner.y=f;var M=m.zpp_inner;null!=M._invalidate&&M._invalidate(M)}}m.zpp_inner.weak=l;var O,k=n+t;if(null==tt.poolVec2?O=new fe:(O=tt.poolVec2,tt.poolVec2=O.zpp_pool,O.zpp_pool=null),null==O.zpp_inner){var S;null==Sn.zpp_pool?S=new Sn:(S=Sn.zpp_pool,Sn.zpp_pool=S.next,S.next=null),S.weak=!1,S._immutable=!1,S.x=e,S.y=k,O.zpp_inner=S,O.zpp_inner.outer=O}else{var A,T=(O.zpp_inner,O.zpp_inner);if(null!=T._validate&&T._validate(),O.zpp_inner.x==e){var E=O.zpp_inner;null!=E._validate&&E._validate(),A=O.zpp_inner.y==k}else A=!1;if(!A){O.zpp_inner.x=e,O.zpp_inner.y=k;var I=O.zpp_inner;null!=I._invalidate&&I._invalidate(I)}}return O.zpp_inner.weak=l,[a,h,m,O]},Ke.box=function(e,n,i){return null==i&&(i=!1),Ke.rect(-e/2,-n/2,e,n,i)},Ke.__super__=Be,Ke.prototype=n(Be.prototype,{__class__:Ke});var We=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};We.__name__=!0,We.get=function(e){var n;if(null==We.zpp_pool){$i.internal=!0;var i=new We;$i.internal=!1,n=i}else{var t=We.zpp_pool;We.zpp_pool=t.zpp_next,n=t}return n.zpp_i=0,n.zpp_inner=e,n.zpp_critical=!1,n},We.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var e=this.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);var n=e.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=We.zpp_pool,We.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:We};var qe=function(){this.zpp_inner=null,this.zpp_inner=new $i,this.zpp_inner.outer=this};qe.__name__=!0,qe.prototype={at:function(e){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},unshift:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},remove:function(e){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n;n=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){n=!0;break}i=i.next}return n&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),n},toString:function(){var e="[",n=!0;this.zpp_inner.valmod();for(var i=We.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(i.zpp_i<l?a=!0:(i.zpp_next=We.zpp_pool,We.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n||(e+=","),e+=null==r?"NULL":r.toString(),n=!1}return e+"]"},__class__:qe};var Xe=function(){};Xe.__name__=!0,Xe.prototype={toString:function(){return null==nn.ShapeType_CIRCLE&&(nn.internal=!0,nn.ShapeType_CIRCLE=new Xe,nn.internal=!1),this==nn.ShapeType_CIRCLE?"CIRCLE":(null==nn.ShapeType_POLYGON&&(nn.internal=!0,nn.ShapeType_POLYGON=new Xe,nn.internal=!1),this==nn.ShapeType_POLYGON?"POLYGON":"")},__class__:Xe};var He=function(){};He.__name__=!0,He.prototype={toString:function(){return null==nn.ValidationResult_VALID&&(nn.internal=!0,nn.ValidationResult_VALID=new He,nn.internal=!1),this==nn.ValidationResult_VALID?"VALID":(null==nn.ValidationResult_DEGENERATE&&(nn.internal=!0,nn.ValidationResult_DEGENERATE=new He,nn.internal=!1),this==nn.ValidationResult_DEGENERATE?"DEGENERATE":(null==nn.ValidationResult_CONCAVE&&(nn.internal=!0,nn.ValidationResult_CONCAVE=new He,nn.internal=!1),this==nn.ValidationResult_CONCAVE?"CONCAVE":(null==nn.ValidationResult_SELF_INTERSECTING&&(nn.internal=!0,nn.ValidationResult_SELF_INTERSECTING=new He,nn.internal=!1),this==nn.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},__class__:He};var Ze=function(){};Ze.__name__=!0,Ze.prototype={toString:function(){return null==nn.Broadphase_DYNAMIC_AABB_TREE&&(nn.internal=!0,nn.Broadphase_DYNAMIC_AABB_TREE=new Ze,nn.internal=!1),this==nn.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==nn.Broadphase_SWEEP_AND_PRUNE&&(nn.internal=!0,nn.Broadphase_SWEEP_AND_PRUNE=new Ze,nn.internal=!1),this==nn.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},__class__:Ze};var Je=function(e,n){if(this.zpp_inner=null,this.zpp_inner=new Xn(null==e?null:e.zpp_inner,n),this.zpp_inner.outer=this,null!=e&&e.zpp_inner.weak){var i=(e.zpp_inner,e.zpp_inner);e.zpp_inner.outer=null,e.zpp_inner=null;var t=e;t.zpp_pool=tt.poolVec2,tt.poolVec2=t;var l=i;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Sn.zpp_pool,Sn.zpp_pool=l}};Je.__name__=!0,Je.prototype={step:function(e,n,i){null==i&&(i=10),null==n&&(n=10),this.zpp_inner.step(e,n,i)},__class__:Je};var Qe=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};Qe.__name__=!0,Qe.prototype={wrapper_body:function(){return null==this.outer_body&&(this.outer_body=new S,this.outer_body.zpp_inner=this),this.outer_body},wrapper_con:function(){return null==this.outer_con&&(this.outer_con=new N,this.outer_con.zpp_inner=this),this.outer_con},wrapper_int:function(){return null==this.outer_int&&(this.outer_int=new L,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=nt.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},push:function(e){null!=this.prev?this.prev.next=e:this.next=e,e.prev=this.prev,e.next=null,this.prev=e,this.length++},pop:function(){var e=this.next;return this.next=e.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,e},empty:function(){return null==this.next},__class__:Qe};var $e=function(){this.constraints=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new rn,this.listeners=new y,this.zip_listeners=!0,this.bodylisteners=new m,this.zip_bodylisteners=!0,this.conlisteners=new z,this.zip_conlisteners=!0,this.constraints=new f,this.interactors=new b,this.id=c.CbSet(),this.cbpairs=new ii};$e.__name__=!0,$e.setlt=function(e,n){for(var i=e.cbTypes.head,t=n.cbTypes.head;null!=i&&null!=t;){var l=i.elt,a=t.elt;if(l.id<a.id)return!0;if(a.id<l.id)return!1;i=i.next,t=t.next}return null!=t&&null==i},$e.get=function(e){var n;null==$e.zpp_pool?n=new $e:(n=$e.zpp_pool,$e.zpp_pool=n.next,n.next=null);for(var i=null,t=e.head;null!=t;){var l=t.elt;i=n.cbTypes.insert(i,l),l.cbsets.add(n),t=t.next}return n},$e.single_intersection=function(e,n,i){for(var t=(e.manager,null),l=e.cbpairs.length<n.cbpairs.length?e.cbpairs:n.cbpairs,a=l.head;null!=a;){var r=a.elt;if(r.a==e&&r.b==n||r.a==n&&r.b==e){t=r;break}a=a.next}if(null==t){var p;null==en.zpp_pool?p=new en:(p=en.zpp_pool,en.zpp_pool=p.next,p.next=null),p.zip_listeners=!0,$e.setlt(e,n)?(p.a=e,p.b=n):(p.a=n,p.b=e),t=p,e.cbpairs.add(t),n!=e&&n.cbpairs.add(t)}t.zip_listeners&&(t.zip_listeners=!1,t.__validate());var s=t.listeners.head;return null!=s&&s.elt==i&&null==s.next},$e.prototype={invalidate_pairs:function(){for(var e=this.cbpairs.head;null!=e;){e.elt.zip_listeners=!0,e=e.next}},realvalidate_listeners:function(){this.listeners.clear();for(var e=this.cbTypes.head;null!=e;){for(var n=e.elt,i=null,t=this.listeners.head,l=n.listeners.head;null!=l;){var a=l.elt;if(null!=t&&t.elt==a)l=l.next,i=t,t=t.next;else{var r;if(null!=t){var p=t.elt;r=!(a.precedence<=p.precedence)||a.precedence==p.precedence&&a.id>p.id}else r=!0;if(r){if(a.space==this.manager.space){var s,o=this.listeners;null==gi.zpp_pool?s=new gi:(s=gi.zpp_pool,gi.zpp_pool=s.next,s.next=null),s.elt=a;var _=s;null==i?(_.next=o.head,o.head=_):(_.next=i.next,i.next=_),o.pushmod=o.modified=!0,o.length++,i=_}l=l.next}else i=t,t=t.next}}e=e.next}},realvalidate_bodylisteners:function(){this.bodylisteners.clear();for(var e=this.cbTypes.head;null!=e;){for(var n=e.elt,i=null,t=this.bodylisteners.head,l=n.bodylisteners.head;null!=l;){var a=l.elt;if(null!=t&&t.elt==a)l=l.next,i=t,t=t.next;else{var r;if(null!=t){var p=t.elt;r=!(a.precedence<=p.precedence)||a.precedence==p.precedence&&a.id>p.id}else r=!0;if(r){var s=a.options;if(!s.nonemptyintersection(this.cbTypes,s.excludes)&&a.space==this.manager.space){var o,_=this.bodylisteners;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.elt=a;var h=o;null==i?(h.next=_.head,_.head=h):(h.next=i.next,i.next=h),_.pushmod=_.modified=!0,_.length++,i=h}l=l.next}else i=t,t=t.next}}e=e.next}},realvalidate_conlisteners:function(){this.conlisteners.clear();for(var e=this.cbTypes.head;null!=e;){for(var n=e.elt,i=null,t=this.conlisteners.head,l=n.conlisteners.head;null!=l;){var a=l.elt;if(null!=t&&t.elt==a)l=l.next,i=t,t=t.next;else{var r;if(null!=t){var p=t.elt;r=!(a.precedence<=p.precedence)||a.precedence==p.precedence&&a.id>p.id}else r=!0;if(r){var s=a.options;if(!s.nonemptyintersection(this.cbTypes,s.excludes)&&a.space==this.manager.space){var o,_=this.conlisteners;null==ki.zpp_pool?o=new ki:(o=ki.zpp_pool,ki.zpp_pool=o.next,o.next=null),o.elt=a;var h=o;null==i?(h.next=_.head,_.head=h):(h.next=i.next,i.next=h),_.pushmod=_.modified=!0,_.length++,i=h}l=l.next}else i=t,t=t.next}}e=e.next}},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},__class__:$e};var en=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new y};en.__name__=!0,en.setlt=function(e,n){return!!$e.setlt(e.a,n.a)||e.a==n.a&&$e.setlt(e.b,n.b)},en.prototype={__validate:function(){this.listeners.clear();for(var e=this.a.listeners.head,n=this.b.listeners.head;null!=e&&null!=n;){var i=e.elt,t=n.elt;if(i==t){var l,a,r=i.options1,p=this.a.cbTypes;if(r.nonemptyintersection(p,r.includes)&&!r.nonemptyintersection(p,r.excludes)){var s=i.options2,o=this.b.cbTypes;a=!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}else a=!1;if(a)l=!0;else{var _=i.options2,h=this.a.cbTypes;if(_.nonemptyintersection(h,_.includes)&&!_.nonemptyintersection(h,_.excludes)){var x=i.options1,u=this.b.cbTypes;l=!!x.nonemptyintersection(u,x.includes)&&!x.nonemptyintersection(u,x.excludes)}else l=!1}l&&this.listeners.add(i),e=e.next,n=n.next}else i.precedence>t.precedence||i.precedence==t.precedence&&i.id>t.id?e=e.next:n=n.next}},__class__:en};var nn=function(){};nn.__name__=!0;var tn=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=c.Listener()};tn.__name__=!0,tn.prototype={addedToSpace:function(){},removedFromSpace:function(){},__class__:tn};var ln=function(){this.handler=null,this.options=null,this.outer_zn=null};ln.__name__=!0,ln.__super__=tn,ln.prototype=n(tn.prototype,{addedToSpace:function(){this.options.handler=i(this,this.cbtype_change);for(var e=this.options.includes.head;null!=e;){for(var n=e.elt,t=null,l=n.bodylisteners.head;null!=l;){var a=l.elt;if(this.precedence>a.precedence||this.precedence==a.precedence&&this.id>a.id)break;t=l,l=l.next}var r,p=n.bodylisteners;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.elt=this;var s=r;null==t?(s.next=p.head,p.head=s):(s.next=t.next,t.next=s),p.pushmod=p.modified=!0,p.length++;for(var o=n.cbsets.head;null!=o;){o.elt.zip_bodylisteners=!0,o=o.next}e=e.next}},removedFromSpace:function(){for(var e=this.options.includes.head;null!=e;){var n=e.elt;n.bodylisteners.remove(this);for(var i=n.cbsets.head;null!=i;){i.elt.zip_bodylisteners=!0,i=i.next}e=e.next}this.options.handler=null},cbtype_change:function(e,n,i){this.removedFromSpace();var t=this.options;if(n)if(i){for(var l=null,a=t.includes.head;null!=a;){var r=a.elt;if(e.id<r.id)break;l=a,a=a.next}var p,s=t.includes;null==vi.zpp_pool?p=new vi:(p=vi.zpp_pool,vi.zpp_pool=p.next,p.next=null),p.elt=e;var o=p;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else t.includes.remove(e);else if(i){for(var _=null,h=t.excludes.head;null!=h;){var x=h.elt;if(e.id<x.id)break;_=h,h=h.next}var u,d=t.excludes;null==vi.zpp_pool?u=new vi:(u=vi.zpp_pool,vi.zpp_pool=u.next,u.next=null),u.elt=e;var v=u;null==_?(v.next=d.head,d.head=v):(v.next=_.next,_.next=v),d.pushmod=d.modified=!0,d.length++}else t.excludes.remove(e);this.addedToSpace()},__class__:ln});var an=function(){this.handler=null,this.options=null,this.outer_zn=null};an.__name__=!0,an.__super__=tn,an.prototype=n(tn.prototype,{addedToSpace:function(){this.options.handler=i(this,this.cbtype_change);for(var e=this.options.includes.head;null!=e;){for(var n=e.elt,t=null,l=n.conlisteners.head;null!=l;){var a=l.elt;if(this.precedence>a.precedence||this.precedence==a.precedence&&this.id>a.id)break;t=l,l=l.next}var r,p=n.conlisteners;null==ki.zpp_pool?r=new ki:(r=ki.zpp_pool,ki.zpp_pool=r.next,r.next=null),r.elt=this;var s=r;null==t?(s.next=p.head,p.head=s):(s.next=t.next,t.next=s),p.pushmod=p.modified=!0,p.length++;for(var o=n.cbsets.head;null!=o;){o.elt.zip_conlisteners=!0,o=o.next}e=e.next}},removedFromSpace:function(){for(var e=this.options.includes.head;null!=e;){var n=e.elt;n.conlisteners.remove(this);for(var i=n.cbsets.head;null!=i;){i.elt.zip_conlisteners=!0,i=i.next}e=e.next}this.options.handler=null},cbtype_change:function(e,n,i){this.removedFromSpace();var t=this.options;if(n)if(i){for(var l=null,a=t.includes.head;null!=a;){var r=a.elt;if(e.id<r.id)break;l=a,a=a.next}var p,s=t.includes;null==vi.zpp_pool?p=new vi:(p=vi.zpp_pool,vi.zpp_pool=p.next,p.next=null),p.elt=e;var o=p;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else t.includes.remove(e);else if(i){for(var _=null,h=t.excludes.head;null!=h;){var x=h.elt;if(e.id<x.id)break;_=h,h=h.next}var u,d=t.excludes;null==vi.zpp_pool?u=new vi:(u=vi.zpp_pool,vi.zpp_pool=u.next,u.next=null),u.elt=e;var v=u;null==_?(v.next=d.head,d.head=v):(v.next=_.next,_.next=v),d.pushmod=d.modified=!0,d.length++}else t.excludes.remove(e);this.addedToSpace()},__class__:an});var rn=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};rn.__name__=!0,rn.prototype={add:function(e){var n;null==vi.zpp_pool?n=new vi:(n=vi.zpp_pool,vi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},insert:function(e,n){var i;null==vi.zpp_pool?i=new vi:(i=vi.zpp_pool,vi.zpp_pool=i.next,i.next=null),i.elt=n;var t=i;return null==e?(t.next=this.head,this.head=t):(t.next=e.next,e.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=vi.zpp_pool,vi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},clear:function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},has:function(e){var n;n=!1;for(var i=this.head;null!=i;){if(i.elt==e){n=!0;break}i=i.next}return n},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:rn};var pn=function(e,n,i,t){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,tn.call(this),this.type=t,this.interaction=this,this.event=i,this.options1=e.zpp_inner,this.options2=n.zpp_inner,this.allowSleepingCallbacks=!1};pn.__name__=!0,pn.__super__=tn,pn.prototype=n(tn.prototype,{with_uniquesets:function(e){var n,i=this;null==lt.zpp_pool?n=new lt:(n=lt.zpp_pool,lt.zpp_pool=n.next,n.next=null),n.lt=en.setlt;for(var t=this.options2.includes,l=pn.UCbType,a=pn.VCbType,r=pn.WCbType,p=this.options1.includes.head,s=t.head;null!=p&&null!=s;){var o=p.elt,_=s.elt;if(o==_){var h;null==vi.zpp_pool?h=new vi:(h=vi.zpp_pool,vi.zpp_pool=h.next,h.next=null),h.elt=o;var x=h;x.next=r.head,r.head=x,r.modified=!0,r.length++,p=p.next,s=s.next}else if(o.id<_.id){var u;null==vi.zpp_pool?u=new vi:(u=vi.zpp_pool,vi.zpp_pool=u.next,u.next=null),u.elt=o;var d=u;d.next=l.head,l.head=d,l.modified=!0,l.length++,p=p.next}else{var v;null==vi.zpp_pool?v=new vi:(v=vi.zpp_pool,vi.zpp_pool=v.next,v.next=null),v.elt=_;var c=v;c.next=a.head,a.head=c,a.modified=!0,a.length++,s=s.next}}for(;null!=p;){var y,m=p.elt;null==vi.zpp_pool?y=new vi:(y=vi.zpp_pool,vi.zpp_pool=y.next,y.next=null),y.elt=m;var z=y;z.next=l.head,l.head=z,l.modified=!0,l.length++,p=p.next}for(;null!=s;){var f,b=s.elt;null==vi.zpp_pool?f=new vi:(f=vi.zpp_pool,vi.zpp_pool=f.next,f.next=null),f.elt=b;var g=f;g.next=a.head,a.head=g,a.modified=!0,a.length++,s=s.next}for(;null!=l.head;)for(var w=l.pop_unsafe(),C=t.head;null!=C;){for(var M=C.elt,O=M.cbsets,k=pn.UCbSet,S=pn.VCbSet,A=pn.WCbSet,T=w.cbsets.head,E=O.head;null!=T&&null!=E;){var I=T.elt,j=E.elt;if(I==j){var N;null==wi.zpp_pool?N=new wi:(N=wi.zpp_pool,wi.zpp_pool=N.next,N.next=null),N.elt=I;var D=N;D.next=A.head,A.head=D,A.modified=!0,A.length++,T=T.next,E=E.next}else if($e.setlt(I,j)){var L;null==wi.zpp_pool?L=new wi:(L=wi.zpp_pool,wi.zpp_pool=L.next,L.next=null),L.elt=I;var F=L;F.next=k.head,k.head=F,k.modified=!0,k.length++,T=T.next}else{var P;null==wi.zpp_pool?P=new wi:(P=wi.zpp_pool,wi.zpp_pool=P.next,P.next=null),P.elt=j;var R=P;R.next=S.head,S.head=R,S.modified=!0,S.length++,E=E.next}}for(;null!=T;){var B,V=T.elt;null==wi.zpp_pool?B=new wi:(B=wi.zpp_pool,wi.zpp_pool=B.next,B.next=null),B.elt=V;var G=B;G.next=k.head,k.head=G,k.modified=!0,k.length++,T=T.next}for(;null!=E;){var U,Y=E.elt;null==wi.zpp_pool?U=new wi:(U=wi.zpp_pool,wi.zpp_pool=U.next,U.next=null),U.elt=Y;var K=U;K.next=S.head,S.head=K,S.modified=!0,S.length++,E=E.next}for(;null!=k.head;)for(var W=k.pop_unsafe(),q=O.head;null!=q;){var X=q.elt;if(W.validate(),X.validate(),$e.single_intersection(W,X,i)){var H;null==en.zpp_pool?H=new en:(H=en.zpp_pool,en.zpp_pool=H.next,H.next=null),H.zip_listeners=!0,$e.setlt(W,X)?(H.a=W,H.b=X):(H.a=X,H.b=W),n.try_insert(H)}q=q.next}for(;null!=S.head;)for(var Z=S.pop_unsafe(),J=A.head;null!=J;){var Q=J.elt;if(Z.validate(),Q.validate(),$e.single_intersection(Z,Q,i)){var $;null==en.zpp_pool?$=new en:($=en.zpp_pool,en.zpp_pool=$.next,$.next=null),$.zip_listeners=!0,$e.setlt(Z,Q)?($.a=Z,$.b=Q):($.a=Q,$.b=Z),n.try_insert($)}J=J.next}for(;null!=A.head;){var ee=A.pop_unsafe();if(ee.validate(),ee.validate(),$e.single_intersection(ee,ee,i)){var ne;null==en.zpp_pool?ne=new en:(ne=en.zpp_pool,en.zpp_pool=ne.next,ne.next=null),ne.zip_listeners=!0,$e.setlt(ee,ee),ne.a=ee,ne.b=ee,n.try_insert(ne)}for(var ie=A.head;null!=ie;){var te=ie.elt;if(ee.validate(),te.validate(),$e.single_intersection(ee,te,i)){var le;null==en.zpp_pool?le=new en:(le=en.zpp_pool,en.zpp_pool=le.next,le.next=null),le.zip_listeners=!0,$e.setlt(ee,te)?(le.a=ee,le.b=te):(le.a=te,le.b=ee),n.try_insert(le)}ie=ie.next}}C=C.next}for(;null!=a.head;)for(var ae=a.pop_unsafe(),re=r.head;null!=re;){for(var pe=re.elt,se=pe.cbsets,oe=pn.UCbSet,_e=pn.VCbSet,he=pn.WCbSet,xe=ae.cbsets.head,ue=se.head;null!=xe&&null!=ue;){var de=xe.elt,ve=ue.elt;if(de==ve){var ce;null==wi.zpp_pool?ce=new wi:(ce=wi.zpp_pool,wi.zpp_pool=ce.next,ce.next=null),ce.elt=de;var ye=ce;ye.next=he.head,he.head=ye,he.modified=!0,he.length++,xe=xe.next,ue=ue.next}else if($e.setlt(de,ve)){var me;null==wi.zpp_pool?me=new wi:(me=wi.zpp_pool,wi.zpp_pool=me.next,me.next=null),me.elt=de;var ze=me;ze.next=oe.head,oe.head=ze,oe.modified=!0,oe.length++,xe=xe.next}else{var fe;null==wi.zpp_pool?fe=new wi:(fe=wi.zpp_pool,wi.zpp_pool=fe.next,fe.next=null),fe.elt=ve;var be=fe;be.next=_e.head,_e.head=be,_e.modified=!0,_e.length++,ue=ue.next}}for(;null!=xe;){var ge,we=xe.elt;null==wi.zpp_pool?ge=new wi:(ge=wi.zpp_pool,wi.zpp_pool=ge.next,ge.next=null),ge.elt=we;var Ce=ge;Ce.next=oe.head,oe.head=Ce,oe.modified=!0,oe.length++,xe=xe.next}for(;null!=ue;){var Me,Oe=ue.elt;null==wi.zpp_pool?Me=new wi:(Me=wi.zpp_pool,wi.zpp_pool=Me.next,Me.next=null),
Me.elt=Oe;var ke=Me;ke.next=_e.head,_e.head=ke,_e.modified=!0,_e.length++,ue=ue.next}for(;null!=oe.head;)for(var Se=oe.pop_unsafe(),Ae=se.head;null!=Ae;){var Te=Ae.elt;if(Se.validate(),Te.validate(),$e.single_intersection(Se,Te,i)){var Ee;null==en.zpp_pool?Ee=new en:(Ee=en.zpp_pool,en.zpp_pool=Ee.next,Ee.next=null),Ee.zip_listeners=!0,$e.setlt(Se,Te)?(Ee.a=Se,Ee.b=Te):(Ee.a=Te,Ee.b=Se),n.try_insert(Ee)}Ae=Ae.next}for(;null!=_e.head;)for(var Ie=_e.pop_unsafe(),je=he.head;null!=je;){var Ne=je.elt;if(Ie.validate(),Ne.validate(),$e.single_intersection(Ie,Ne,i)){var De;null==en.zpp_pool?De=new en:(De=en.zpp_pool,en.zpp_pool=De.next,De.next=null),De.zip_listeners=!0,$e.setlt(Ie,Ne)?(De.a=Ie,De.b=Ne):(De.a=Ne,De.b=Ie),n.try_insert(De)}je=je.next}for(;null!=he.head;){var Le=he.pop_unsafe();if(Le.validate(),Le.validate(),$e.single_intersection(Le,Le,i)){var Fe;null==en.zpp_pool?Fe=new en:(Fe=en.zpp_pool,en.zpp_pool=Fe.next,Fe.next=null),Fe.zip_listeners=!0,$e.setlt(Le,Le),Fe.a=Le,Fe.b=Le,n.try_insert(Fe)}for(var Pe=he.head;null!=Pe;){var Re=Pe.elt;if(Le.validate(),Re.validate(),$e.single_intersection(Le,Re,i)){var Be;null==en.zpp_pool?Be=new en:(Be=en.zpp_pool,en.zpp_pool=Be.next,Be.next=null),Be.zip_listeners=!0,$e.setlt(Le,Re)?(Be.a=Le,Be.b=Re):(Be.a=Re,Be.b=Le),n.try_insert(Be)}Pe=Pe.next}}re=re.next}for(;null!=r.head;){for(var Ve=r.pop_unsafe(),Ge=Ve.cbsets,Ue=pn.UCbSet,Ye=pn.VCbSet,Ke=pn.WCbSet,We=Ve.cbsets.head,qe=Ge.head;null!=We&&null!=qe;){var Xe=We.elt,He=qe.elt;if(Xe==He){var Ze;null==wi.zpp_pool?Ze=new wi:(Ze=wi.zpp_pool,wi.zpp_pool=Ze.next,Ze.next=null),Ze.elt=Xe;var Je=Ze;Je.next=Ke.head,Ke.head=Je,Ke.modified=!0,Ke.length++,We=We.next,qe=qe.next}else if($e.setlt(Xe,He)){var Qe;null==wi.zpp_pool?Qe=new wi:(Qe=wi.zpp_pool,wi.zpp_pool=Qe.next,Qe.next=null),Qe.elt=Xe;var nn=Qe;nn.next=Ue.head,Ue.head=nn,Ue.modified=!0,Ue.length++,We=We.next}else{var tn;null==wi.zpp_pool?tn=new wi:(tn=wi.zpp_pool,wi.zpp_pool=tn.next,tn.next=null),tn.elt=He;var ln=tn;ln.next=Ye.head,Ye.head=ln,Ye.modified=!0,Ye.length++,qe=qe.next}}for(;null!=We;){var an,rn=We.elt;null==wi.zpp_pool?an=new wi:(an=wi.zpp_pool,wi.zpp_pool=an.next,an.next=null),an.elt=rn;var sn=an;sn.next=Ue.head,Ue.head=sn,Ue.modified=!0,Ue.length++,We=We.next}for(;null!=qe;){var on,_n=qe.elt;null==wi.zpp_pool?on=new wi:(on=wi.zpp_pool,wi.zpp_pool=on.next,on.next=null),on.elt=_n;var hn=on;hn.next=Ye.head,Ye.head=hn,Ye.modified=!0,Ye.length++,qe=qe.next}for(;null!=Ue.head;)for(var xn=Ue.pop_unsafe(),un=Ge.head;null!=un;){var dn=un.elt;if(xn.validate(),dn.validate(),$e.single_intersection(xn,dn,i)){var vn;null==en.zpp_pool?vn=new en:(vn=en.zpp_pool,en.zpp_pool=vn.next,vn.next=null),vn.zip_listeners=!0,$e.setlt(xn,dn)?(vn.a=xn,vn.b=dn):(vn.a=dn,vn.b=xn),n.try_insert(vn)}un=un.next}for(;null!=Ye.head;)for(var cn=Ye.pop_unsafe(),yn=Ke.head;null!=yn;){var mn=yn.elt;if(cn.validate(),mn.validate(),$e.single_intersection(cn,mn,i)){var zn;null==en.zpp_pool?zn=new en:(zn=en.zpp_pool,en.zpp_pool=zn.next,zn.next=null),zn.zip_listeners=!0,$e.setlt(cn,mn)?(zn.a=cn,zn.b=mn):(zn.a=mn,zn.b=cn),n.try_insert(zn)}yn=yn.next}for(;null!=Ke.head;){var fn=Ke.pop_unsafe();if(fn.validate(),fn.validate(),$e.single_intersection(fn,fn,i)){var bn;null==en.zpp_pool?bn=new en:(bn=en.zpp_pool,en.zpp_pool=bn.next,bn.next=null),bn.zip_listeners=!0,$e.setlt(fn,fn),bn.a=fn,bn.b=fn,n.try_insert(bn)}for(var gn=Ke.head;null!=gn;){var wn=gn.elt;if(fn.validate(),wn.validate(),$e.single_intersection(fn,wn,i)){var Cn;null==en.zpp_pool?Cn=new en:(Cn=en.zpp_pool,en.zpp_pool=Cn.next,Cn.next=null),Cn.zip_listeners=!0,$e.setlt(fn,wn)?(Cn.a=fn,Cn.b=wn):(Cn.a=wn,Cn.b=fn),n.try_insert(Cn)}gn=gn.next}}for(var Mn=r.head;null!=Mn;){for(var On=Mn.elt,kn=On.cbsets,Sn=pn.UCbSet,An=pn.VCbSet,Tn=pn.WCbSet,En=Ve.cbsets.head,In=kn.head;null!=En&&null!=In;){var jn=En.elt,Nn=In.elt;if(jn==Nn){var Dn;null==wi.zpp_pool?Dn=new wi:(Dn=wi.zpp_pool,wi.zpp_pool=Dn.next,Dn.next=null),Dn.elt=jn;var Ln=Dn;Ln.next=Tn.head,Tn.head=Ln,Tn.modified=!0,Tn.length++,En=En.next,In=In.next}else if($e.setlt(jn,Nn)){var Fn;null==wi.zpp_pool?Fn=new wi:(Fn=wi.zpp_pool,wi.zpp_pool=Fn.next,Fn.next=null),Fn.elt=jn;var Pn=Fn;Pn.next=Sn.head,Sn.head=Pn,Sn.modified=!0,Sn.length++,En=En.next}else{var Rn;null==wi.zpp_pool?Rn=new wi:(Rn=wi.zpp_pool,wi.zpp_pool=Rn.next,Rn.next=null),Rn.elt=Nn;var Bn=Rn;Bn.next=An.head,An.head=Bn,An.modified=!0,An.length++,In=In.next}}for(;null!=En;){var Vn,Gn=En.elt;null==wi.zpp_pool?Vn=new wi:(Vn=wi.zpp_pool,wi.zpp_pool=Vn.next,Vn.next=null),Vn.elt=Gn;var Un=Vn;Un.next=Sn.head,Sn.head=Un,Sn.modified=!0,Sn.length++,En=En.next}for(;null!=In;){var Yn,Kn=In.elt;null==wi.zpp_pool?Yn=new wi:(Yn=wi.zpp_pool,wi.zpp_pool=Yn.next,Yn.next=null),Yn.elt=Kn;var Wn=Yn;Wn.next=An.head,An.head=Wn,An.modified=!0,An.length++,In=In.next}for(;null!=Sn.head;)for(var qn=Sn.pop_unsafe(),Xn=kn.head;null!=Xn;){var Hn=Xn.elt;if(qn.validate(),Hn.validate(),$e.single_intersection(qn,Hn,i)){var Zn;null==en.zpp_pool?Zn=new en:(Zn=en.zpp_pool,en.zpp_pool=Zn.next,Zn.next=null),Zn.zip_listeners=!0,$e.setlt(qn,Hn)?(Zn.a=qn,Zn.b=Hn):(Zn.a=Hn,Zn.b=qn),n.try_insert(Zn)}Xn=Xn.next}for(;null!=An.head;)for(var Jn=An.pop_unsafe(),Qn=Tn.head;null!=Qn;){var $n=Qn.elt;if(Jn.validate(),$n.validate(),$e.single_intersection(Jn,$n,i)){var ei;null==en.zpp_pool?ei=new en:(ei=en.zpp_pool,en.zpp_pool=ei.next,ei.next=null),ei.zip_listeners=!0,$e.setlt(Jn,$n)?(ei.a=Jn,ei.b=$n):(ei.a=$n,ei.b=Jn),n.try_insert(ei)}Qn=Qn.next}for(;null!=Tn.head;){var ni=Tn.pop_unsafe();if(ni.validate(),ni.validate(),$e.single_intersection(ni,ni,i)){var ii;null==en.zpp_pool?ii=new en:(ii=en.zpp_pool,en.zpp_pool=ii.next,ii.next=null),ii.zip_listeners=!0,$e.setlt(ni,ni),ii.a=ni,ii.b=ni,n.try_insert(ii)}for(var ti=Tn.head;null!=ti;){var li=ti.elt;if(ni.validate(),li.validate(),$e.single_intersection(ni,li,i)){var ai;null==en.zpp_pool?ai=new en:(ai=en.zpp_pool,en.zpp_pool=ai.next,ai.next=null),ai.zip_listeners=!0,$e.setlt(ni,li)?(ai.a=ni,ai.b=li):(ai.a=li,ai.b=ni),n.try_insert(ai)}ti=ti.next}}Mn=Mn.next}}if(null!=n.parent){for(var ri=n.parent;null!=ri;)if(null!=ri.prev)ri=ri.prev;else if(null!=ri.next)ri=ri.next;else{var pi=ri.data;e?i.space.freshListenerType(pi.a,pi.b):i.space.nullListenerType(pi.a,pi.b);var si=pi;si.a=si.b=null,si.listeners.clear(),si.next=en.zpp_pool,en.zpp_pool=si;var oi=ri.parent;null!=oi&&(ri==oi.prev?oi.prev=null:oi.next=null,ri.parent=null);var _i=ri;_i.data=null,_i.lt=null,_i.swapped=null,_i.next=lt.zpp_pool,lt.zpp_pool=_i,ri=oi}n.parent=null}var hi=n;hi.data=null,hi.lt=null,hi.swapped=null,hi.next=lt.zpp_pool,lt.zpp_pool=hi},addedToSpace:function(){for(var e=this,n=3==this.type,t=this.options1.includes.head,l=this.options2.includes.head;null!=t&&null!=l;){var a=t.elt,r=l.elt;if(a==r){for(var p=null,s=a.listeners.head;null!=s;){var o=s.elt;if(e.precedence>o.precedence||e.precedence==o.precedence&&e.id>o.id)break;p=s,s=s.next}var _,h=a.listeners;null==gi.zpp_pool?_=new gi:(_=gi.zpp_pool,gi.zpp_pool=_.next,_.next=null),_.elt=e;var x=_;null==p?(x.next=h.head,h.head=x):(x.next=p.next,p.next=x),h.pushmod=h.modified=!0,h.length++;for(var u=a.cbsets.head;null!=u;){var d=u.elt;d.zip_listeners=!0,d.invalidate_pairs(),u=u.next}if(n)for(var v=a.interactors.head;null!=v;){var c=v.elt;c.wake(),v=v.next}t=t.next,l=l.next}else if(a.id<r.id){for(var y=null,m=a.listeners.head;null!=m;){var z=m.elt;if(e.precedence>z.precedence||e.precedence==z.precedence&&e.id>z.id)break;y=m,m=m.next}var f,b=a.listeners;null==gi.zpp_pool?f=new gi:(f=gi.zpp_pool,gi.zpp_pool=f.next,f.next=null),f.elt=e;var g=f;null==y?(g.next=b.head,b.head=g):(g.next=y.next,y.next=g),b.pushmod=b.modified=!0,b.length++;for(var w=a.cbsets.head;null!=w;){var C=w.elt;C.zip_listeners=!0,C.invalidate_pairs(),w=w.next}if(n)for(var M=a.interactors.head;null!=M;){var O=M.elt;O.wake(),M=M.next}t=t.next}else{for(var k=null,S=r.listeners.head;null!=S;){var A=S.elt;if(e.precedence>A.precedence||e.precedence==A.precedence&&e.id>A.id)break;k=S,S=S.next}var T,E=r.listeners;null==gi.zpp_pool?T=new gi:(T=gi.zpp_pool,gi.zpp_pool=T.next,T.next=null),T.elt=e;var I=T;null==k?(I.next=E.head,E.head=I):(I.next=k.next,k.next=I),E.pushmod=E.modified=!0,E.length++;for(var j=r.cbsets.head;null!=j;){var N=j.elt;N.zip_listeners=!0,N.invalidate_pairs(),j=j.next}if(n)for(var D=r.interactors.head;null!=D;){var L=D.elt;L.wake(),D=D.next}l=l.next}}for(;null!=t;){for(var F=t.elt,P=null,R=F.listeners.head;null!=R;){var B=R.elt;if(e.precedence>B.precedence||e.precedence==B.precedence&&e.id>B.id)break;P=R,R=R.next}var V,G=F.listeners;null==gi.zpp_pool?V=new gi:(V=gi.zpp_pool,gi.zpp_pool=V.next,V.next=null),V.elt=e;var U=V;null==P?(U.next=G.head,G.head=U):(U.next=P.next,P.next=U),G.pushmod=G.modified=!0,G.length++;for(var Y=F.cbsets.head;null!=Y;){var K=Y.elt;K.zip_listeners=!0,K.invalidate_pairs(),Y=Y.next}if(n)for(var W=F.interactors.head;null!=W;){var q=W.elt;q.wake(),W=W.next}t=t.next}for(;null!=l;){for(var X=l.elt,H=null,Z=X.listeners.head;null!=Z;){var J=Z.elt;if(e.precedence>J.precedence||e.precedence==J.precedence&&e.id>J.id)break;H=Z,Z=Z.next}var Q,$=X.listeners;null==gi.zpp_pool?Q=new gi:(Q=gi.zpp_pool,gi.zpp_pool=Q.next,Q.next=null),Q.elt=e;var ee=Q;null==H?(ee.next=$.head,$.head=ee):(ee.next=H.next,H.next=ee),$.pushmod=$.modified=!0,$.length++;for(var ne=X.cbsets.head;null!=ne;){var ie=ne.elt;ie.zip_listeners=!0,ie.invalidate_pairs(),ne=ne.next}if(n)for(var te=X.interactors.head;null!=te;){var le=te.elt;le.wake(),te=te.next}l=l.next}this.options1.handler=i(this,this.cbtype_change1),this.options2.handler=i(this,this.cbtype_change2),this.with_uniquesets(!0)},removedFromSpace:function(){var e=this;this.with_uniquesets(!1);for(var n=3==this.type,i=this.options1.includes.head,t=this.options2.includes.head;null!=i&&null!=t;){var l=i.elt,a=t.elt;if(l==a){l.listeners.remove(e);for(var r=l.cbsets.head;null!=r;){var p=r.elt;p.zip_listeners=!0,p.invalidate_pairs(),r=r.next}if(n)for(var s=l.interactors.head;null!=s;){var o=s.elt;o.wake(),s=s.next}i=i.next,t=t.next}else if(l.id<a.id){l.listeners.remove(e);for(var _=l.cbsets.head;null!=_;){var h=_.elt;h.zip_listeners=!0,h.invalidate_pairs(),_=_.next}if(n)for(var x=l.interactors.head;null!=x;){var u=x.elt;u.wake(),x=x.next}i=i.next}else{a.listeners.remove(e);for(var d=a.cbsets.head;null!=d;){var v=d.elt;v.zip_listeners=!0,v.invalidate_pairs(),d=d.next}if(n)for(var c=a.interactors.head;null!=c;){var y=c.elt;y.wake(),c=c.next}t=t.next}}for(;null!=i;){var m=i.elt;m.listeners.remove(e);for(var z=m.cbsets.head;null!=z;){var f=z.elt;f.zip_listeners=!0,f.invalidate_pairs(),z=z.next}if(n)for(var b=m.interactors.head;null!=b;){var g=b.elt;g.wake(),b=b.next}i=i.next}for(;null!=t;){var w=t.elt;w.listeners.remove(e);for(var C=w.cbsets.head;null!=C;){var M=C.elt;M.zip_listeners=!0,M.invalidate_pairs(),C=C.next}if(n)for(var O=w.interactors.head;null!=O;){var k=O.elt;k.wake(),O=O.next}t=t.next}this.options1.handler=null,this.options2.handler=null},cbtype_change1:function(e,n,i){this.cbtype_change(this.options1,e,n,i)},cbtype_change2:function(e,n,i){this.cbtype_change(this.options2,e,n,i)},cbtype_change:function(e,n,i,t){this.space;if(this.removedFromSpace(),i)if(t){for(var l=null,a=e.includes.head;null!=a;){var r=a.elt;if(n.id<r.id)break;l=a,a=a.next}var p,s=e.includes;null==vi.zpp_pool?p=new vi:(p=vi.zpp_pool,vi.zpp_pool=p.next,p.next=null),p.elt=n;var o=p;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else e.includes.remove(n);else if(t){for(var _=null,h=e.excludes.head;null!=h;){var x=h.elt;if(n.id<x.id)break;_=h,h=h.next}var u,d=e.excludes;null==vi.zpp_pool?u=new vi:(u=vi.zpp_pool,vi.zpp_pool=u.next,u.next=null),u.elt=n;var v=u;null==_?(v.next=d.head,d.head=v):(v.next=_.next,_.next=v),d.pushmod=d.modified=!0,d.length++}else e.excludes.remove(n);this.addedToSpace();this.space},__class__:pn});var sn=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new rn,this.excludes=new rn};sn.__name__=!0,sn.argument=function(e){return null==e?new G:M.__instanceof(e,G)?e:(new G).including(e)},sn.prototype={setup_includes:function(){this.wrap_includes=qi.get(this.includes,!0)},setup_excludes:function(){this.wrap_excludes=qi.get(this.excludes,!0)},nonemptyintersection:function(e,n){for(var i=!1,t=e.head,l=n.head;null!=l&&null!=t;){var a=l.elt,r=t.elt;if(a==r){i=!0;break}a.id<r.id?l=l.next:t=t.next}return i},append_type:function(e,n){if(e==this.includes){if(!this.includes.has(n))if(this.excludes.has(n))null!=this.handler?this.handler(n,!1,!1):this.excludes.remove(n);else if(null!=this.handler)this.handler(n,!0,!0);else{for(var i=null,t=this.includes.head;null!=t;){var l=t.elt;if(n.id<l.id)break;i=t,t=t.next}var a,r=this.includes;null==vi.zpp_pool?a=new vi:(a=vi.zpp_pool,vi.zpp_pool=a.next,a.next=null),a.elt=n;var p=a;null==i?(p.next=r.head,r.head=p):(p.next=i.next,i.next=p),r.pushmod=r.modified=!0,r.length++}}else if(!this.excludes.has(n))if(this.includes.has(n))null!=this.handler?this.handler(n,!0,!1):this.includes.remove(n);else if(null!=this.handler)this.handler(n,!1,!0);else{for(var s=null,o=this.excludes.head;null!=o;){var _=o.elt;if(n.id<_.id)break;s=o,o=o.next}var h,x=this.excludes;null==vi.zpp_pool?h=new vi:(h=vi.zpp_pool,vi.zpp_pool=h.next,h.next=null),h.elt=n;var u=h;null==s?(u.next=x.head,x.head=u):(u.next=s.next,s.next=u),x.pushmod=x.modified=!0,x.length++}},append:function(e,n){if(M.__instanceof(n,d)){var i=n;this.append_type(e,i.zpp_inner)}else if(M.__instanceof(n,j)){var t=n;t.zpp_inner.valmod();for(var l=I.get(t);;){l.zpp_inner.zpp_inner.valmod();var a=l.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var r=a.zpp_inner.user_length;l.zpp_critical=!0;var p;if(l.zpp_i<r?p=!0:(l.zpp_next=I.zpp_pool,I.zpp_pool=l,l.zpp_inner=null,p=!1),!p)break;l.zpp_critical=!1;var s=l.zpp_inner.at(l.zpp_i++);this.append_type(e,s.zpp_inner)}}else if(n instanceof Array&&null==n.__enum__)for(var o=n,_=0;_<o.length;){var h=o[_];++_;var x=h;this.append_type(e,x.zpp_inner)}},__class__:sn};var on=function(){this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.outer=null};on.__name__=!0,on.prototype={alloc_cbSet:function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},dealloc_cbSet:function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var e=this.cbSet;for(e.listeners.clear(),e.zip_listeners=!0,e.bodylisteners.clear(),e.zip_bodylisteners=!0,e.conlisteners.clear(),e.zip_conlisteners=!0;null!=e.cbTypes.head;){e.cbTypes.pop_unsafe().cbsets.remove(e)}e.next=$e.zpp_pool,$e.zpp_pool=e}this.cbSet=null}},addedToSpace:function(){this.active&&this.activeInSpace(),this.activeBodies();for(var e=this.cbTypes.head;null!=e;){e.elt.constraints.add(this),e=e.next}},removedFromSpace:function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var e=this.cbTypes.head;null!=e;){e.elt.constraints.remove(this),e=e.next}},activeInSpace:function(){this.alloc_cbSet(),null==Kn.zpp_pool?this.component=new Kn:(this.component=Kn.zpp_pool,Kn.zpp_pool=this.component.next,this.component.next=null);this.component;this.component.isBody=!1,this.component.constraint=this},inactiveOrOutSpace:function(){this.dealloc_cbSet();var e=this.component;e.body=null,e.constraint=null,e.next=Kn.zpp_pool,Kn.zpp_pool=e,this.component=null},activeBodies:function(){},inactiveBodies:function(){},clearcache:function(){},wake_connected:function(){},forest:function(){},pair_exists:function(e,n){return!1},broken:function(){},warmStart:function(){},preStep:function(e){return!1},applyImpulseVel:function(){return!1},applyImpulsePos:function(){return!1},__class__:on};var _n=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.outer=null};_n.__name__=!0,_n.prototype={wrapper:function(){return null==this.outer&&(_n.internal=!0,this.type==_n.COL?(this.colarb.outer_zn=new $,this.outer=this.colarb.outer_zn):this.type==_n.FLUID?(this.fluidarb.outer_zn=new te,this.outer=this.fluidarb.outer_zn):this.outer=new H,this.outer.zpp_inner=this,_n.internal=!1),this.outer},__class__:_n};var hn=function(){this.next=null,_n.call(this),this.type=_n.SENSOR,this.sensorarb=this};hn.__name__=!0,hn.__super__=_n,hn.prototype=n(_n.prototype,{__class__:hn});var xn=function(){this.pre_dt=0,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,_n.call(this),this.type=_n.FLUID,this.fluidarb=this,this.buoyx=0,this.buoyy=0,this.pre_dt=-1};xn.__name__=!0,xn.__super__=_n,xn.prototype=n(_n.prototype,{__class__:xn});var un=function(){this.pre_dt=0,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.ny=0,this.nx=0,this.innards=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,_n.call(this),this.pre_dt=-1,this.contacts=new dn,this.innards=new vn,this.type=_n.COL,this.colarb=this};un.__name__=!0,un.__super__=_n,un.prototype=n(_n.prototype,{__class__:un});var dn=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.py=0,this.px=0,this.outer=null,this.inner=new vn};dn.__name__=!0,dn.prototype={wrapper:function(){return null==this.outer&&(dn.internal=!0,this.outer=new ee,dn.internal=!1,this.outer.zpp_inner=this),this.outer},pop:function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},__class__:dn};var vn=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};vn.__name__=!0,vn.prototype={add:function(e){e._inuse=!0;var n=e;return n.next=this.next,this.next=n,this.modified=!0,this.length++,e},__class__:vn};var cn=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.shapes=null,this.outer=null,this.next=null,this.shapes=new Qn,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};cn.__name__=!0,cn.prototype={wrapper:function(){if(null==this.outer){this.outer=new le;var e=this.outer.zpp_inner;e.outer=null,e.next=cn.zpp_pool,cn.zpp_pool=e,this.outer.zpp_inner=this}return this.outer},invalidate:function(){for(var e=this.shapes.head;null!=e;){e.elt.invalidate_filter(),e=e.next}},__class__:cn};var yn=function(){this.depth=0,this.interactors=null,this.group=null,this.ignore=!1,this.outer=null};yn.__name__=!0,yn.prototype={__class__:yn};var mn=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};mn.__name__=!0,mn.prototype={wrapper:function(){if(null==this.outer){this.outer=new se;var e=this.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e.wrap_min=e.wrap_max=null,e._invalidate=null,e._validate=null,e.next=mn.zpp_pool,mn.zpp_pool=e,this.outer.zpp_inner=this}return this.outer},toString:function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},__class__:mn};var zn=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};zn.__name__=!0,zn.prototype={add:function(e){var n;null==Si.zpp_pool?n=new Si:(n=Si.zpp_pool,Si.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},insert:function(e,n){var i;null==Si.zpp_pool?i=new Si:(i=Si.zpp_pool,Si.zpp_pool=i.next,i.next=null),i.elt=n;var t=i;return null==e?(t.next=this.head,this.head=t):(t.next=e.next,e.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Si.zpp_pool,Si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},erase:function(e){var n,i;null==e?(n=this.head,i=n.next,this.head=i,null==this.head&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0));var t=n;return t.elt=null,t.next=Si.zpp_pool,Si.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},clear:function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Si.zpp_pool,Si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:zn};var fn=function(){};fn.__name__=!0,fn.contactCollide=function(e,n,i,t){if(1==n.type){if(1==e.type){for(var l=!0,a=-1e100,r=-1,p=null,s=null,o=e.polygon.edges.head;null!=o;){for(var _=o.elt,h=1e100,x=n.polygon.gverts.next;null!=x;){var u=x,d=_.gnormx*u.x+_.gnormy*u.y;if(d<h&&(h=d),h-_.gprojection<=a)break;x=x.next}if((h-=_.gprojection)>=0){l=!1;break}h>a&&(a=h,p=_,r=1),o=o.next}if(l){for(var v=n.polygon.edges.head;null!=v;){for(var c=v.elt,y=1e100,m=e.polygon.gverts.next;null!=m;){var z=m,f=c.gnormx*z.x+c.gnormy*z.y;if(f<y&&(y=f),y-c.gprojection<=a)break;m=m.next}if((y-=c.gprojection)>=0){l=!1;break}y>a&&(a=y,s=c,r=2),v=v.next}if(l){var b,g,w;1==r?(e.polygon,b=n.polygon,g=p,w=1):(n.polygon,b=e.polygon,g=s,w=-1);for(var C=null,M=1e100,k=b.edges.head;null!=k;){var S=k.elt,A=g.gnormx*S.gnormx+g.gnormy*S.gnormy;A<M&&(M=A,C=S),k=k.next}var T=0,E=0;T=C.gp0.x,E=C.gp0.y;var I=0,j=0;I=C.gp1.x,j=C.gp1.y;var N=0,D=0;N=I-T,D=j-E;var L=g.gnormy*T-g.gnormx*E,F=g.gnormy*I-g.gnormx*j,P=1/(F-L),R=(-g.tp1-L)*P;if(R>O.epsilon){var B=R;T+=N*B,E+=D*B}var V=(-g.tp0-F)*P;if(V<-O.epsilon){var G=V;I+=N*G,j+=D*G}var U=0,Y=0,K=w;U=g.gnormx*K,Y=g.gnormy*K,i.lnormx=g.lnormx,i.lnormy=g.lnormy,i.lproj=g.lprojection,i.radius=0,i.rev=t!=(-1==w),i.ptype=i.rev?1:0;var W=T*g.gnormx+E*g.gnormy-g.gprojection,q=I*g.gnormx+j*g.gnormy-g.gprojection;if(W>0&&q>0)return!1;t&&(U=-U,Y=-Y);for(var X=T-g.gnormx*W*.5,H=E-g.gnormy*W*.5,Z=i.rev?1:0,J=null,Q=i.contacts.next;null!=Q;){var $=Q;if(Z==$.hash){J=$;break}Q=Q.next}if(null==J){null==dn.zpp_pool?J=new dn:(J=dn.zpp_pool,dn.zpp_pool=J.next,J.next=null);var ee=J.inner;ee.jnAcc=ee.jtAcc=0,J.hash=Z,J.fresh=!0,J.arbiter=i,i.jrAcc=0;var ne=i.contacts;J._inuse=!0;var ie=J;ie.next=ne.next,ne.next=ie,ne.modified=!0,ne.length++,i.innards.add(ee)}else J.fresh=!1;J.px=X,J.py=H,i.nx=U,i.ny=Y,J.dist=W,J.stamp=i.stamp,J.posOnly=W>0;var te=J;T-=1*b.body.posx,E-=1*b.body.posy,te.inner.lr1x=T*b.body.axisy+E*b.body.axisx,te.inner.lr1y=E*b.body.axisy-T*b.body.axisx;for(var le=I-g.gnormx*q*.5,ae=j-g.gnormy*q*.5,re=i.rev?0:1,pe=null,se=i.contacts.next;null!=se;){var oe=se;if(re==oe.hash){pe=oe;break}se=se.next}if(null==pe){null==dn.zpp_pool?pe=new dn:(pe=dn.zpp_pool,dn.zpp_pool=pe.next,pe.next=null);var _e=pe.inner;_e.jnAcc=_e.jtAcc=0,pe.hash=re,pe.fresh=!0,pe.arbiter=i,i.jrAcc=0;var he=i.contacts;pe._inuse=!0;var xe=pe;xe.next=he.next,he.next=xe,he.modified=!0,he.length++,i.innards.add(_e)}else pe.fresh=!1;pe.px=le,pe.py=ae,i.nx=U,i.ny=Y,pe.dist=q,pe.stamp=i.stamp,pe.posOnly=q>0,te=pe;return I-=1*b.body.posx,j-=1*b.body.posy,te.inner.lr1x=I*b.body.axisy+j*b.body.axisx,te.inner.lr1y=j*b.body.axisy-I*b.body.axisx,1==r?(i.__ref_edge1=g,i.__ref_edge2=C):(i.__ref_edge2=g,i.__ref_edge1=C),!0}return!1}return!1}for(var ue=-1e100,de=!0,ve=null,ce=null,ye=n.polygon.gverts.next,me=n.polygon.edges.head;null!=me;){var ze=me.elt,fe=ze.gnormx*e.circle.worldCOMx+ze.gnormy*e.circle.worldCOMy-ze.gprojection-e.circle.radius;if(fe>0){de=!1;break}fe>ue&&(ue=fe,ve=ze,ce=ye),ye=ye.next,me=me.next}if(de){var be=ce,ge=null==ce.next?n.polygon.gverts.next:ce.next,we=e.circle.worldCOMy*ve.gnormx-e.circle.worldCOMx*ve.gnormy;if(we<=be.y*ve.gnormx-be.x*ve.gnormy){var Ce=e.circle.radius,Me=0,Oe=0;Me=be.x-e.circle.worldCOMx,Oe=be.y-e.circle.worldCOMy;var ke,Se=Me*Me+Oe*Oe;if(Se>Ce*Ce)ke=null;else if(Se<O.epsilon*O.epsilon){for(var Ae=e.circle.worldCOMx,Te=e.circle.worldCOMy,Ee=null,Ie=i.contacts.next;null!=Ie;){var je=Ie;if(0==je.hash){Ee=je;break}Ie=Ie.next}if(null==Ee){null==dn.zpp_pool?Ee=new dn:(Ee=dn.zpp_pool,dn.zpp_pool=Ee.next,Ee.next=null);var Ne=Ee.inner;Ne.jnAcc=Ne.jtAcc=0,Ee.hash=0,Ee.fresh=!0,Ee.arbiter=i,i.jrAcc=0;var De=i.contacts;Ee._inuse=!0;var Le=Ee;Le.next=De.next,De.next=Le,De.modified=!0,De.length++,i.innards.add(Ne)}else Ee.fresh=!1;Ee.px=Ae,Ee.py=Te,i.nx=1,i.ny=0,Ee.dist=-Ce,Ee.stamp=i.stamp,Ee.posOnly=!1,ke=Ee}else{var Fe=1/Math.sqrt(Se),Pe=Fe<O.epsilon?1e100:1/Fe,Re=.5+(e.circle.radius-.5*Ce)*Fe;if(t){for(var Be=e.circle.worldCOMx+Me*Re,Ve=e.circle.worldCOMy+Oe*Re,Ge=null,Ue=i.contacts.next;null!=Ue;){var Ye=Ue;if(0==Ye.hash){Ge=Ye;break}Ue=Ue.next}if(null==Ge){null==dn.zpp_pool?Ge=new dn:(Ge=dn.zpp_pool,dn.zpp_pool=Ge.next,Ge.next=null);var Ke=Ge.inner;Ke.jnAcc=Ke.jtAcc=0,Ge.hash=0,Ge.fresh=!0,Ge.arbiter=i,i.jrAcc=0;var We=i.contacts;Ge._inuse=!0;var qe=Ge;qe.next=We.next,We.next=qe,We.modified=!0,We.length++,i.innards.add(Ke)}else Ge.fresh=!1;Ge.px=Be,Ge.py=Ve,i.nx=-Me*Fe,i.ny=-Oe*Fe,Ge.dist=Pe-Ce,Ge.stamp=i.stamp,Ge.posOnly=!1,ke=Ge}else{for(var Xe=e.circle.worldCOMx+Me*Re,He=e.circle.worldCOMy+Oe*Re,Ze=null,Je=i.contacts.next;null!=Je;){var Qe=Je;if(0==Qe.hash){Ze=Qe;break}Je=Je.next}if(null==Ze){null==dn.zpp_pool?Ze=new dn:(Ze=dn.zpp_pool,dn.zpp_pool=Ze.next,Ze.next=null);var $e=Ze.inner;$e.jnAcc=$e.jtAcc=0,Ze.hash=0,Ze.fresh=!0,Ze.arbiter=i,i.jrAcc=0;var en=i.contacts;Ze._inuse=!0;var nn=Ze;nn.next=en.next,en.next=nn,en.modified=!0,en.length++,i.innards.add($e)}else Ze.fresh=!1;Ze.px=Xe,Ze.py=He,i.nx=Me*Fe,i.ny=Oe*Fe,Ze.dist=Pe-Ce,Ze.stamp=i.stamp,Ze.posOnly=!1,ke=Ze}}if(null!=ke){var tn=ke.inner;i.ptype=2;var ln=0,an=0;ln=be.x-n.polygon.body.posx,an=be.y-n.polygon.body.posy,i.__ref_edge1=ve,i.__ref_vertex=-1,t?(tn.lr1x=ln*n.polygon.body.axisy+an*n.polygon.body.axisx,tn.lr1y=an*n.polygon.body.axisy-ln*n.polygon.body.axisx,tn.lr2x=e.circle.localCOMx,tn.lr2y=e.circle.localCOMy):(tn.lr2x=ln*n.polygon.body.axisy+an*n.polygon.body.axisx,tn.lr2y=an*n.polygon.body.axisy-ln*n.polygon.body.axisx,tn.lr1x=e.circle.localCOMx,tn.lr1y=e.circle.localCOMy),i.radius=e.circle.radius}return null!=ke}if(we>=ge.y*ve.gnormx-ge.x*ve.gnormy){var rn=e.circle.radius,pn=0,sn=0;pn=ge.x-e.circle.worldCOMx,sn=ge.y-e.circle.worldCOMy;var on,_n=pn*pn+sn*sn;if(_n>rn*rn)on=null;else if(_n<O.epsilon*O.epsilon){for(var hn=e.circle.worldCOMx,xn=e.circle.worldCOMy,un=null,vn=i.contacts.next;null!=vn;){var cn=vn;if(0==cn.hash){un=cn;break}vn=vn.next}if(null==un){null==dn.zpp_pool?un=new dn:(un=dn.zpp_pool,dn.zpp_pool=un.next,un.next=null);var yn=un.inner;yn.jnAcc=yn.jtAcc=0,un.hash=0,un.fresh=!0,un.arbiter=i,i.jrAcc=0;var mn=i.contacts;un._inuse=!0;var zn=un;zn.next=mn.next,mn.next=zn,mn.modified=!0,mn.length++,i.innards.add(yn)}else un.fresh=!1;un.px=hn,un.py=xn,i.nx=1,i.ny=0,un.dist=-rn,un.stamp=i.stamp,un.posOnly=!1,on=un}else{var fn=1/Math.sqrt(_n),bn=fn<O.epsilon?1e100:1/fn,gn=.5+(e.circle.radius-.5*rn)*fn;if(t){for(var wn=e.circle.worldCOMx+pn*gn,Cn=e.circle.worldCOMy+sn*gn,Mn=null,On=i.contacts.next;null!=On;){var kn=On;if(0==kn.hash){Mn=kn;break}On=On.next}if(null==Mn){null==dn.zpp_pool?Mn=new dn:(Mn=dn.zpp_pool,dn.zpp_pool=Mn.next,Mn.next=null);var Sn=Mn.inner;Sn.jnAcc=Sn.jtAcc=0,Mn.hash=0,Mn.fresh=!0,Mn.arbiter=i,i.jrAcc=0;var An=i.contacts;Mn._inuse=!0;var Tn=Mn;Tn.next=An.next,An.next=Tn,An.modified=!0,An.length++,i.innards.add(Sn)}else Mn.fresh=!1;Mn.px=wn,Mn.py=Cn,i.nx=-pn*fn,i.ny=-sn*fn,Mn.dist=bn-rn,Mn.stamp=i.stamp,Mn.posOnly=!1,on=Mn}else{for(var En=e.circle.worldCOMx+pn*gn,In=e.circle.worldCOMy+sn*gn,jn=null,Nn=i.contacts.next;null!=Nn;){var Dn=Nn;if(0==Dn.hash){jn=Dn;break}Nn=Nn.next}if(null==jn){null==dn.zpp_pool?jn=new dn:(jn=dn.zpp_pool,dn.zpp_pool=jn.next,jn.next=null);var Ln=jn.inner;Ln.jnAcc=Ln.jtAcc=0,jn.hash=0,jn.fresh=!0,jn.arbiter=i,i.jrAcc=0;var Fn=i.contacts;jn._inuse=!0;var Pn=jn;Pn.next=Fn.next,Fn.next=Pn,Fn.modified=!0,Fn.length++,i.innards.add(Ln)}else jn.fresh=!1;jn.px=En,jn.py=In,i.nx=pn*fn,i.ny=sn*fn,jn.dist=bn-rn,jn.stamp=i.stamp,jn.posOnly=!1,on=jn}}if(null!=on){var Rn=on.inner;i.ptype=2;var Bn=0,Vn=0;Bn=ge.x-n.polygon.body.posx,Vn=ge.y-n.polygon.body.posy,i.__ref_edge1=ve,i.__ref_vertex=1,t?(Rn.lr1x=Bn*n.polygon.body.axisy+Vn*n.polygon.body.axisx,Rn.lr1y=Vn*n.polygon.body.axisy-Bn*n.polygon.body.axisx,Rn.lr2x=e.circle.localCOMx,Rn.lr2y=e.circle.localCOMy):(Rn.lr2x=Bn*n.polygon.body.axisy+Vn*n.polygon.body.axisx,Rn.lr2y=Vn*n.polygon.body.axisy-Bn*n.polygon.body.axisx,Rn.lr1x=e.circle.localCOMx,Rn.lr1y=e.circle.localCOMy),i.radius=e.circle.radius}return null!=on}var Gn=0,Un=0,Yn=e.circle.radius+.5*ue;Gn=ve.gnormx*Yn,Un=ve.gnormy*Yn;var Kn=0,Wn=0;Kn=e.circle.worldCOMx-Gn,Wn=e.circle.worldCOMy-Un;var qn;if(t){for(var Xn=ve.gnormx,Hn=ve.gnormy,Zn=null,Jn=i.contacts.next;null!=Jn;){var Qn=Jn;if(0==Qn.hash){Zn=Qn;break}Jn=Jn.next}if(null==Zn){null==dn.zpp_pool?Zn=new dn:(Zn=dn.zpp_pool,dn.zpp_pool=Zn.next,Zn.next=null);var $n=Zn.inner;$n.jnAcc=$n.jtAcc=0,Zn.hash=0,Zn.fresh=!0,Zn.arbiter=i,i.jrAcc=0;var ei=i.contacts;Zn._inuse=!0;var ni=Zn;ni.next=ei.next,ei.next=ni,ei.modified=!0,ei.length++,i.innards.add($n)}else Zn.fresh=!1;Zn.px=Kn,Zn.py=Wn,i.nx=Xn,i.ny=Hn,Zn.dist=ue,Zn.stamp=i.stamp,Zn.posOnly=!1,qn=Zn}else{for(var ii=-ve.gnormx,ti=-ve.gnormy,li=null,ai=i.contacts.next;null!=ai;){var ri=ai;if(0==ri.hash){li=ri;break}ai=ai.next}if(null==li){null==dn.zpp_pool?li=new dn:(li=dn.zpp_pool,dn.zpp_pool=li.next,li.next=null);var pi=li.inner;pi.jnAcc=pi.jtAcc=0,li.hash=0,li.fresh=!0,li.arbiter=i,i.jrAcc=0;var si=i.contacts;li._inuse=!0;var oi=li;oi.next=si.next,si.next=oi,si.modified=!0,si.length++,i.innards.add(pi)}else li.fresh=!1;li.px=Kn,li.py=Wn,i.nx=ii,i.ny=ti,li.dist=ue,li.stamp=i.stamp,li.posOnly=!1,qn=li}return i.ptype=t?0:1,i.lnormx=ve.lnormx,i.lnormy=ve.lnormy,i.rev=!t,i.lproj=ve.lprojection,i.radius=e.circle.radius,qn.inner.lr1x=e.circle.localCOMx,qn.inner.lr1y=e.circle.localCOMy,i.__ref_edge1=ve,i.__ref_vertex=0,!0}return!1}var _i=e.circle.radius+n.circle.radius,hi=0,xi=0;hi=n.circle.worldCOMx-e.circle.worldCOMx,xi=n.circle.worldCOMy-e.circle.worldCOMy;var ui,di=hi*hi+xi*xi;if(di>_i*_i)ui=null;else if(di<O.epsilon*O.epsilon){for(var vi=e.circle.worldCOMx,ci=e.circle.worldCOMy,yi=null,mi=i.contacts.next;null!=mi;){var zi=mi;if(0==zi.hash){yi=zi;break}mi=mi.next}if(null==yi){null==dn.zpp_pool?yi=new dn:(yi=dn.zpp_pool,dn.zpp_pool=yi.next,yi.next=null);var fi=yi.inner
;fi.jnAcc=fi.jtAcc=0,yi.hash=0,yi.fresh=!0,yi.arbiter=i,i.jrAcc=0;var bi=i.contacts;yi._inuse=!0;var gi=yi;gi.next=bi.next,bi.next=gi,bi.modified=!0,bi.length++,i.innards.add(fi)}else yi.fresh=!1;yi.px=vi,yi.py=ci,i.nx=1,i.ny=0,yi.dist=-_i,yi.stamp=i.stamp,yi.posOnly=!1,ui=yi}else{var wi=1/Math.sqrt(di),Ci=wi<O.epsilon?1e100:1/wi,Mi=.5+(e.circle.radius-.5*_i)*wi;if(t){for(var Oi=e.circle.worldCOMx+hi*Mi,ki=e.circle.worldCOMy+xi*Mi,Si=null,Ai=i.contacts.next;null!=Ai;){var Ti=Ai;if(0==Ti.hash){Si=Ti;break}Ai=Ai.next}if(null==Si){null==dn.zpp_pool?Si=new dn:(Si=dn.zpp_pool,dn.zpp_pool=Si.next,Si.next=null);var Ei=Si.inner;Ei.jnAcc=Ei.jtAcc=0,Si.hash=0,Si.fresh=!0,Si.arbiter=i,i.jrAcc=0;var Ii=i.contacts;Si._inuse=!0;var ji=Si;ji.next=Ii.next,Ii.next=ji,Ii.modified=!0,Ii.length++,i.innards.add(Ei)}else Si.fresh=!1;Si.px=Oi,Si.py=ki,i.nx=-hi*wi,i.ny=-xi*wi,Si.dist=Ci-_i,Si.stamp=i.stamp,Si.posOnly=!1,ui=Si}else{for(var Ni=e.circle.worldCOMx+hi*Mi,Di=e.circle.worldCOMy+xi*Mi,Li=null,Fi=i.contacts.next;null!=Fi;){var Pi=Fi;if(0==Pi.hash){Li=Pi;break}Fi=Fi.next}if(null==Li){null==dn.zpp_pool?Li=new dn:(Li=dn.zpp_pool,dn.zpp_pool=Li.next,Li.next=null);var Ri=Li.inner;Ri.jnAcc=Ri.jtAcc=0,Li.hash=0,Li.fresh=!0,Li.arbiter=i,i.jrAcc=0;var Bi=i.contacts;Li._inuse=!0;var Vi=Li;Vi.next=Bi.next,Bi.next=Vi,Bi.modified=!0,Bi.length++,i.innards.add(Ri)}else Li.fresh=!1;Li.px=Ni,Li.py=Di,i.nx=hi*wi,i.ny=xi*wi,Li.dist=Ci-_i,Li.stamp=i.stamp,Li.posOnly=!1,ui=Li}}if(null!=ui){var Gi=ui.inner;return t?(Gi.lr1x=n.circle.localCOMx,Gi.lr1y=n.circle.localCOMy,Gi.lr2x=e.circle.localCOMx,Gi.lr2y=e.circle.localCOMy):(Gi.lr1x=e.circle.localCOMx,Gi.lr1y=e.circle.localCOMy,Gi.lr2x=n.circle.localCOMx,Gi.lr2y=n.circle.localCOMy),i.radius=e.circle.radius+n.circle.radius,i.ptype=2,!0}return!1},fn.testCollide_safe=function(e,n){if(0==n.type){var i=e;e=n,n=i}return fn.testCollide(e,n)},fn.testCollide=function(e,n){if(1==n.type){if(1==e.type){for(var i=!0,t=e.polygon.edges.head;null!=t;){for(var l=t.elt,a=1e100,r=n.polygon.gverts.next;null!=r;){var p=r,s=l.gnormx*p.x+l.gnormy*p.y;s<a&&(a=s),r=r.next}if((a-=l.gprojection)>0){i=!1;break}t=t.next}if(i){for(var o=n.polygon.edges.head;null!=o;){for(var _=o.elt,h=1e100,x=e.polygon.gverts.next;null!=x;){var u=x,d=_.gnormx*u.x+_.gnormy*u.y;d<h&&(h=d),x=x.next}if((h-=_.gprojection)>0){i=!1;break}o=o.next}return i}return!1}for(var v=null,c=null,y=!0,m=-1e100,z=n.polygon.gverts.next,f=n.polygon.edges.head;null!=f;){var b=f.elt,g=b.gnormx*e.circle.worldCOMx+b.gnormy*e.circle.worldCOMy-b.gprojection-e.circle.radius;if(g>0){y=!1;break}g>m&&(m=g,v=b,c=z),z=z.next,f=f.next}if(y){var w=c,C=null==c.next?n.polygon.gverts.next:c.next,M=e.circle.worldCOMy*v.gnormx-e.circle.worldCOMx*v.gnormy;if(M<=w.y*v.gnormx-w.x*v.gnormy){var O=e.circle.radius,k=0,S=0;k=w.x-e.circle.worldCOMx,S=w.y-e.circle.worldCOMy;return k*k+S*S<=O*O}if(M>=C.y*v.gnormx-C.x*v.gnormy){var A=e.circle.radius,T=0,E=0;T=C.x-e.circle.worldCOMx,E=C.y-e.circle.worldCOMy;return T*T+E*E<=A*A}return!0}return!1}var I=e.circle.radius+n.circle.radius,j=0,N=0;return j=n.circle.worldCOMx-e.circle.worldCOMx,N=n.circle.worldCOMy-e.circle.worldCOMy,j*j+N*N<=I*I},fn.flowCollide=function(e,n,i){if(1==n.type){if(1==e.type){for(var t=[],l=[],a=!0,r=!0,p=e.polygon.edges.head;null!=p;){for(var s=p.elt,o=1e100,_=0,h=n.polygon.gverts.next;null!=h;){var x=h,u=s.gnormx*x.x+s.gnormy*x.y;u<o&&(o=u),u>=s.gprojection+O.epsilon&&(l[_]=!0,r=!1),++_,h=h.next}if((o-=s.gprojection)>0){a=!1;break}p=p.next}if(r){var d=n.polygon;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var v=d.polygon;if(null==v.lverts.next.next)v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;else if(null==v.lverts.next.next.next){v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;v.localCOMx+=1*v.lverts.next.next.x,v.localCOMy+=1*v.lverts.next.next.y;v.localCOMx*=.5,v.localCOMy*=.5}else{v.localCOMx=0,v.localCOMy=0;var c=0,y=v.lverts.next,m=y;y=y.next;var z=y;for(y=y.next;null!=y;){var f=y;c+=z.x*(f.y-m.y);var b=f.y*z.x-f.x*z.y;v.localCOMx+=(z.x+f.x)*b,v.localCOMy+=(z.y+f.y)*b,m=z,z=f,y=y.next}y=v.lverts.next;var g=y;c+=z.x*(g.y-m.y);var w=g.y*z.x-g.x*z.y;v.localCOMx+=(z.x+g.x)*w,v.localCOMy+=(z.y+g.y)*w,m=z,z=g,y=y.next;var C=y;c+=z.x*(C.y-m.y);var M=C.y*z.x-C.x*z.y;v.localCOMx+=(z.x+C.x)*M,v.localCOMy+=(z.y+C.y)*M,c=1/(3*c);var k=c;v.localCOMx*=k,v.localCOMy*=k}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}var S=d.body;S.zip_axis&&(S.zip_axis=!1,S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}return i.overlap=n.polygon.area,i.centroidx=n.polygon.worldCOMx,i.centroidy=n.polygon.worldCOMy,!0}if(a){r=!0;for(var A=n.polygon.edges.head;null!=A;){for(var T=A.elt,E=1e100,I=0,j=e.polygon.gverts.next;null!=j;){var N=j,D=T.gnormx*N.x+T.gnormy*N.y;D<E&&(E=D),D>=T.gprojection+O.epsilon&&(t[I]=!0,r=!1),++I,j=j.next}if((E-=T.gprojection)>0){a=!1;break}A=A.next}if(r){var L=e.polygon;if(L.zip_worldCOM&&null!=L.body){if(L.zip_worldCOM=!1,L.zip_localCOM){if(L.zip_localCOM=!1,1==L.type){var F=L.polygon;if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next){F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;F.localCOMx+=1*F.lverts.next.next.x,F.localCOMy+=1*F.lverts.next.next.y;F.localCOMx*=.5,F.localCOMy*=.5}else{F.localCOMx=0,F.localCOMy=0;var P=0,R=F.lverts.next,B=R;R=R.next;var V=R;for(R=R.next;null!=R;){var G=R;P+=V.x*(G.y-B.y);var U=G.y*V.x-G.x*V.y;F.localCOMx+=(V.x+G.x)*U,F.localCOMy+=(V.y+G.y)*U,B=V,V=G,R=R.next}R=F.lverts.next;var Y=R;P+=V.x*(Y.y-B.y);var K=Y.y*V.x-Y.x*V.y;F.localCOMx+=(V.x+Y.x)*K,F.localCOMy+=(V.y+Y.y)*K,B=V,V=Y,R=R.next;var W=R;P+=V.x*(W.y-B.y);var q=W.y*V.x-W.x*V.y;F.localCOMx+=(V.x+W.x)*q,F.localCOMy+=(V.y+W.y)*q,P=1/(3*P);var X=P;F.localCOMx*=X,F.localCOMy*=X}}null!=L.wrap_localCOM&&(L.wrap_localCOM.zpp_inner.x=L.localCOMx,L.wrap_localCOM.zpp_inner.y=L.localCOMy)}var H=L.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),L.worldCOMx=L.body.posx+(L.body.axisy*L.localCOMx-L.body.axisx*L.localCOMy),L.worldCOMy=L.body.posy+(L.localCOMx*L.body.axisx+L.localCOMy*L.body.axisy)}return i.overlap=e.polygon.area,i.centroidx=e.polygon.worldCOMx,i.centroidy=e.polygon.worldCOMy,!0}if(a){for(;null!=fn.flowpoly.head;){var Z=fn.flowpoly.pop_unsafe();if(!Z._inuse){var J=Z;null!=J.outer&&(J.outer.zpp_inner=null,J.outer=null),J._isimmutable=null,J._validate=null,J._invalidate=null,J.next=Sn.zpp_pool,Sn.zpp_pool=J}}for(var Q=null,$=!1,ee=e.polygon.gverts.next,ne=0,ie=n.polygon.gverts.next,te=0,le=0,ae=n.polygon.edgeCnt;le<ae;){var re=le++;if(!l[re]){te=re;break}ie=ie.next}if(null==ie){ie=n.polygon.gverts.next,$=!0;for(var pe=0,se=e.polygon.edgeCnt;pe<se;){var oe=pe++;if(!t[oe]){ne=oe;break}ee=ee.next}null==ee?ee=e.polygon.gverts.next:(fn.flowpoly.add(ee),Q=fn.flowpoly.head.elt)}else fn.flowpoly.add(ie),Q=fn.flowpoly.head.elt;var _e=1;if(null==fn.flowpoly.head){for(var he=!0,xe=e.polygon.gverts.next,ue=xe,de=xe.next;null!=de;){for(var ve=de,ce=2,ye=n.polygon.gverts.next,me=ye,ze=ye.next;null!=ze;){var fe=ze,be=0,ge=0,we=0;ge=ue.x-me.x,we=ue.y-me.y;var Ce=0,Me=0;Ce=ve.x-ue.x,Me=ve.y-ue.y;var Oe=0,ke=0;Oe=fe.x-me.x,ke=fe.y-me.y;var Se,Ae=Me*Oe-Ce*ke;if(Ae*Ae>O.epsilon*O.epsilon){Ae=1/Ae;var Te=(ke*ge-Oe*we)*Ae;if(Te>O.epsilon&&Te<1-O.epsilon){var Ee=(Me*ge-Ce*we)*Ae;Ee>O.epsilon&&Ee<1-O.epsilon?(be=Te,Se=!0):Se=!1}else Se=!1}else Se=!1;Se&&be<ce&&(ce=be,ie=ye),ye=ze,me=fe,ze=ze.next}for(;;){ze=n.polygon.gverts.next;var Ie=ze,je=0,Ne=0,De=0;Ne=ue.x-me.x,De=ue.y-me.y;var Le=0,Fe=0;Le=ve.x-ue.x,Fe=ve.y-ue.y;var Pe=0,Re=0;Pe=Ie.x-me.x,Re=Ie.y-me.y;var Be,Ve=Fe*Pe-Le*Re;if(Ve*Ve>O.epsilon*O.epsilon){Ve=1/Ve;var Ge=(Re*Ne-Pe*De)*Ve;if(Ge>O.epsilon&&Ge<1-O.epsilon){var Ue=(Fe*Ne-Le*De)*Ve;Ue>O.epsilon&&Ue<1-O.epsilon?(je=Ge,Be=!0):Be=!1}else Be=!1}else Be=!1;Be&&je<ce&&(ce=je,ie=ye);break}if(2!=ce){var Ye=0,Ke=0,We=ce;Ye=ue.x+(ve.x-ue.x)*We,Ke=ue.y+(ve.y-ue.y)*We;var qe;null==Sn.zpp_pool?qe=new Sn:(qe=Sn.zpp_pool,Sn.zpp_pool=qe.next,qe.next=null),qe.weak=!1,qe._immutable=!1,qe.x=Ye,qe.y=Ke,Q=qe,fn.flowpoly.add(Q),$=!0,ee=xe,he=!1;break}xe=de,ue=ve,de=de.next}if(he)for(;;){de=e.polygon.gverts.next;for(var Xe=de,He=2,Ze=n.polygon.gverts.next,Je=Ze,Qe=Ze.next;null!=Qe;){var $e=Qe,en=0,nn=0,tn=0;nn=ue.x-Je.x,tn=ue.y-Je.y;var ln=0,an=0;ln=Xe.x-ue.x,an=Xe.y-ue.y;var rn=0,pn=0;rn=$e.x-Je.x,pn=$e.y-Je.y;var sn,on=an*rn-ln*pn;if(on*on>O.epsilon*O.epsilon){on=1/on;var _n=(pn*nn-rn*tn)*on;if(_n>O.epsilon&&_n<1-O.epsilon){var hn=(an*nn-ln*tn)*on;hn>O.epsilon&&hn<1-O.epsilon?(en=_n,sn=!0):sn=!1}else sn=!1}else sn=!1;sn&&en<He&&(He=en,ie=Ze),Ze=Qe,Je=$e,Qe=Qe.next}for(;;){Qe=n.polygon.gverts.next;var xn=Qe,un=0,dn=0,vn=0;dn=ue.x-Je.x,vn=ue.y-Je.y;var cn=0,yn=0;cn=Xe.x-ue.x,yn=Xe.y-ue.y;var mn=0,zn=0;mn=xn.x-Je.x,zn=xn.y-Je.y;var bn,gn=yn*mn-cn*zn;if(gn*gn>O.epsilon*O.epsilon){gn=1/gn;var wn=(zn*dn-mn*vn)*gn;if(wn>O.epsilon&&wn<1-O.epsilon){var Cn=(yn*dn-cn*vn)*gn;Cn>O.epsilon&&Cn<1-O.epsilon?(un=wn,bn=!0):bn=!1}else bn=!1}else bn=!1;bn&&un<He&&(He=un,ie=Ze);break}if(2!=He){var Mn=0,On=0,kn=He;Mn=ue.x+(Xe.x-ue.x)*kn,On=ue.y+(Xe.y-ue.y)*kn;var An;null==Sn.zpp_pool?An=new Sn:(An=Sn.zpp_pool,Sn.zpp_pool=An.next,An.next=null),An.weak=!1,An._immutable=!1,An.x=Mn,An.y=On,Q=An,fn.flowpoly.add(Q),$=!0,ee=xe;break}break}_e=2}for(;;)if($)if(ee=ee.next,++ne,null==ee&&(ee=e.polygon.gverts.next,ne=0),t[ne]){var Tn=fn.flowpoly.head.elt,En=ee,In=ie,jn=ie.next;null==jn&&(jn=n.polygon.gverts.next);for(var Nn=-1,Dn=null,Ln=0,Fn=0,Pn=jn,Rn=jn;;){var Bn=Rn,Vn=0,Gn=0,Un=0;Gn=In.x-Tn.x,Un=In.y-Tn.y;var Yn=0,Kn=0;Yn=Bn.x-In.x,Kn=Bn.y-In.y;var Wn=0,qn=0;Wn=En.x-Tn.x,qn=En.y-Tn.y;var Xn,Hn=Kn*Wn-Yn*qn;if(Hn*Hn>O.epsilon*O.epsilon){Hn=1/Hn;var Zn=(qn*Gn-Wn*Un)*Hn;if(Zn>O.epsilon&&Zn<1-O.epsilon){var Jn=(Kn*Gn-Yn*Un)*Hn;Jn>O.epsilon&&Jn<1-O.epsilon?(Vn=Zn,Xn=!0):Xn=!1}else Xn=!1}else Xn=!1;if(Xn&&Vn>=Nn){if(Dn=ie,Ln=te,++Fn==_e){Nn=Vn,Rn=Pn;break}Nn=Vn}In=Bn,ie=Rn,++te,te>=n.polygon.edgeCnt&&(te=0),Rn=Rn.next,null==Rn&&(Rn=n.polygon.gverts.next);break}for(;Rn!=Pn;){var Qn=Rn,$n=0,ei=0,ni=0;ei=In.x-Tn.x,ni=In.y-Tn.y;var ii=0,ti=0;ii=Qn.x-In.x,ti=Qn.y-In.y;var li=0,ai=0;li=En.x-Tn.x,ai=En.y-Tn.y;var ri,pi=ti*li-ii*ai;if(pi*pi>O.epsilon*O.epsilon){pi=1/pi;var si=(ai*ei-li*ni)*pi;if(si>O.epsilon&&si<1-O.epsilon){var oi=(ti*ei-ii*ni)*pi;oi>O.epsilon&&oi<1-O.epsilon?($n=si,ri=!0):ri=!1}else ri=!1}else ri=!1;if(ri&&$n>=Nn){if(Dn=ie,Ln=te,++Fn==_e){Nn=$n,Rn=Pn;break}Nn=$n}In=Qn,ie=Rn,++te,te>=n.polygon.edgeCnt&&(te=0),Rn=Rn.next,null==Rn&&(Rn=n.polygon.gverts.next)}if(null==Dn)break;var _i=Dn,hi=Dn.next;null==hi&&(hi=n.polygon.gverts.next);var xi=hi,ui=0,di=0,vi=Nn;ui=_i.x+(xi.x-_i.x)*vi,di=_i.y+(xi.y-_i.y)*vi;var ci;if(null!=Q){var yi=0,mi=0;yi=ui-Q.x,mi=di-Q.y,ci=yi*yi+mi*mi<O.epsilon}else ci=!1;if(ci)break;var zi,fi=fn.flowpoly;null==Sn.zpp_pool?zi=new Sn:(zi=Sn.zpp_pool,Sn.zpp_pool=zi.next,zi.next=null),zi.weak=!1,zi._immutable=!1,zi.x=ui,zi.y=di,fi.add(zi),null==Q&&(Q=fn.flowpoly.head.elt),ie=Dn,te=Ln,$=!$,_e=2}else{var bi,gi=ee;if(null!=Q){var wi=0,Ci=0;wi=gi.x-Q.x,Ci=gi.y-Q.y,bi=wi*wi+Ci*Ci<O.epsilon}else bi=!1;if(bi)break;fn.flowpoly.add(gi),null==Q&&(Q=fn.flowpoly.head.elt),_e=1}else if(ie=ie.next,++te,null==ie&&(ie=n.polygon.gverts.next,te=0),l[te]){var Mi=fn.flowpoly.head.elt,Oi=ie,ki=ee,Si=ee.next;null==Si&&(Si=e.polygon.gverts.next);for(var Ai=-1,Ti=null,Ei=0,Ii=0,ji=Si,Ni=Si;;){var Di=Ni,Li=0,Fi=0,Pi=0;Fi=ki.x-Mi.x,Pi=ki.y-Mi.y;var Ri=0,Bi=0;Ri=Di.x-ki.x,Bi=Di.y-ki.y;var Vi=0,Gi=0;Vi=Oi.x-Mi.x,Gi=Oi.y-Mi.y;var Ui,Yi=Bi*Vi-Ri*Gi;if(Yi*Yi>O.epsilon*O.epsilon){Yi=1/Yi;var Ki=(Gi*Fi-Vi*Pi)*Yi;if(Ki>O.epsilon&&Ki<1-O.epsilon){var Wi=(Bi*Fi-Ri*Pi)*Yi;Wi>O.epsilon&&Wi<1-O.epsilon?(Li=Ki,Ui=!0):Ui=!1}else Ui=!1}else Ui=!1;if(Ui&&Li>=Ai){if(Ti=ee,Ei=ne,++Ii==_e){Ai=Li,Ni=ji;break}Ai=Li}ki=Di,ee=Ni,++ne,ne>=e.polygon.edgeCnt&&(ne=0),Ni=Ni.next,null==Ni&&(Ni=e.polygon.gverts.next);break}for(;Ni!=ji;){var qi=Ni,Xi=0,Hi=0,Zi=0;Hi=ki.x-Mi.x,Zi=ki.y-Mi.y;var Ji=0,Qi=0;Ji=qi.x-ki.x,Qi=qi.y-ki.y;var $i=0,et=0;$i=Oi.x-Mi.x,et=Oi.y-Mi.y;var nt,it=Qi*$i-Ji*et;if(it*it>O.epsilon*O.epsilon){it=1/it;var tt=(et*Hi-$i*Zi)*it;if(tt>O.epsilon&&tt<1-O.epsilon){var lt=(Qi*Hi-Ji*Zi)*it;lt>O.epsilon&&lt<1-O.epsilon?(Xi=tt,nt=!0):nt=!1}else nt=!1}else nt=!1;if(nt&&Xi>=Ai){if(Ti=ee,Ei=ne,++Ii==_e){Ai=Xi,Ni=ji;break}Ai=Xi}ki=qi,ee=Ni,++ne,ne>=e.polygon.edgeCnt&&(ne=0),Ni=Ni.next,null==Ni&&(Ni=e.polygon.gverts.next)}if(null==Ti)break;var at=Ti,rt=Ti.next;null==rt&&(rt=e.polygon.gverts.next);var pt=rt,st=0,ot=0,_t=Ai;st=at.x+(pt.x-at.x)*_t,ot=at.y+(pt.y-at.y)*_t;var ht;if(null!=Q){var xt=0,ut=0;xt=st-Q.x,ut=ot-Q.y,ht=xt*xt+ut*ut<O.epsilon}else ht=!1;if(ht)break;var dt,vt=fn.flowpoly;null==Sn.zpp_pool?dt=new Sn:(dt=Sn.zpp_pool,Sn.zpp_pool=dt.next,dt.next=null),dt.weak=!1,dt._immutable=!1,dt.x=st,dt.y=ot,vt.add(dt),null==Q&&(Q=fn.flowpoly.head.elt),ee=Ti,ne=Ei,$=!$,_e=2}else{var ct,yt=ie;if(null!=Q){var mt=0,zt=0;mt=yt.x-Q.x,zt=yt.y-Q.y,ct=mt*mt+zt*zt<O.epsilon}else ct=!1;if(ct)break;fn.flowpoly.add(yt),null==Q&&(Q=fn.flowpoly.head.elt),_e=1}if(null!=fn.flowpoly.head&&null!=fn.flowpoly.head.next&&null!=fn.flowpoly.head.next.next){var ft=0,bt=0,gt=0;bt=0,gt=0,ft=0;var wt=fn.flowpoly.head,Ct=wt.elt;wt=wt.next;var Mt=wt.elt;for(wt=wt.next;null!=wt;){var Ot=wt.elt;ft+=Mt.x*(Ot.y-Ct.y);var kt=Ot.y*Mt.x-Ot.x*Mt.y;bt+=(Mt.x+Ot.x)*kt,gt+=(Mt.y+Ot.y)*kt,Ct=Mt,Mt=Ot,wt=wt.next}wt=fn.flowpoly.head;var St=wt.elt;ft+=Mt.x*(St.y-Ct.y);var At=St.y*Mt.x-St.x*Mt.y;bt+=(Mt.x+St.x)*At,gt+=(Mt.y+St.y)*At,Ct=Mt,Mt=St,wt=wt.next;var Tt=wt.elt;ft+=Mt.x*(Tt.y-Ct.y);var Et=Tt.y*Mt.x-Tt.x*Mt.y;bt+=(Mt.x+Tt.x)*Et,gt+=(Mt.y+Tt.y)*Et,ft*=.5;var It=1/(6*ft),jt=It;return bt*=jt,gt*=jt,i.overlap=-ft,i.centroidx=bt,i.centroidy=gt,!0}return!1}return!1}return!1}for(var Nt=[],Dt=!0,Lt=null,Ft=null,Pt=-1e100,Rt=!0,Bt=n.polygon.gverts.next,Vt=0,Gt=n.polygon.edges.head;null!=Gt;){var Ut=Gt.elt,Yt=Ut.gnormx*e.circle.worldCOMx+Ut.gnormy*e.circle.worldCOMy;if(Yt>Ut.gprojection+e.circle.radius){Rt=!1;break}Yt+e.circle.radius>Ut.gprojection+O.epsilon&&(Dt=!1,Nt[Vt]=!0),Yt-=Ut.gprojection+e.circle.radius,Yt>Pt&&(Pt=Yt,Lt=Ut,Ft=Bt),Bt=Bt.next,++Vt,Gt=Gt.next}if(Rt){if(Dt)return i.overlap=e.circle.area,i.centroidx=e.circle.worldCOMx,i.centroidy=e.circle.worldCOMy,!0;var Kt,Wt=Ft,qt=null==Ft.next?n.polygon.gverts.next:Ft.next,Xt=e.circle.worldCOMy*Lt.gnormx-e.circle.worldCOMx*Lt.gnormy;if(Xt<=Wt.y*Lt.gnormx-Wt.x*Lt.gnormy){var Ht=e.circle.radius,Zt=0,Jt=0;Zt=Wt.x-e.circle.worldCOMx,Jt=Wt.y-e.circle.worldCOMy;Kt=Zt*Zt+Jt*Jt<=Ht*Ht}else if(Xt>=qt.y*Lt.gnormx-qt.x*Lt.gnormy){var Qt=e.circle.radius,$t=0,el=0;$t=qt.x-e.circle.worldCOMx,el=qt.y-e.circle.worldCOMy;var nl=$t*$t+el*el;Kt=nl<=Qt*Qt}else Kt=!0;if(Kt){for(var il=[],tl=0,ll=!0,al=null,rl=0,pl=n.polygon.gverts.next;null!=pl;){var sl=pl,ol=0,_l=0;ol=sl.x-e.circle.worldCOMx,_l=sl.y-e.circle.worldCOMy;var hl=ol*ol+_l*_l;(il[tl]=hl<=e.circle.radius*e.circle.radius)?(rl=tl,al=pl):ll=!1,++tl,pl=pl.next}if(ll){var xl=n.polygon;if(xl.zip_worldCOM&&null!=xl.body){if(xl.zip_worldCOM=!1,xl.zip_localCOM){if(xl.zip_localCOM=!1,1==xl.type){var ul=xl.polygon;if(null==ul.lverts.next.next)ul.localCOMx=ul.lverts.next.x,ul.localCOMy=ul.lverts.next.y;else if(null==ul.lverts.next.next.next){ul.localCOMx=ul.lverts.next.x,ul.localCOMy=ul.lverts.next.y;ul.localCOMx+=1*ul.lverts.next.next.x,ul.localCOMy+=1*ul.lverts.next.next.y;ul.localCOMx*=.5,ul.localCOMy*=.5}else{ul.localCOMx=0,ul.localCOMy=0;var dl=0,vl=ul.lverts.next,cl=vl;vl=vl.next;var yl=vl;for(vl=vl.next;null!=vl;){var ml=vl;dl+=yl.x*(ml.y-cl.y);var zl=ml.y*yl.x-ml.x*yl.y;ul.localCOMx+=(yl.x+ml.x)*zl,ul.localCOMy+=(yl.y+ml.y)*zl,cl=yl,yl=ml,vl=vl.next}vl=ul.lverts.next;var fl=vl;dl+=yl.x*(fl.y-cl.y);var bl=fl.y*yl.x-fl.x*yl.y;ul.localCOMx+=(yl.x+fl.x)*bl,ul.localCOMy+=(yl.y+fl.y)*bl,cl=yl,yl=fl,vl=vl.next;var gl=vl;dl+=yl.x*(gl.y-cl.y);var wl=gl.y*yl.x-gl.x*yl.y;ul.localCOMx+=(yl.x+gl.x)*wl,ul.localCOMy+=(yl.y+gl.y)*wl,dl=1/(3*dl);var Cl=dl;ul.localCOMx*=Cl,ul.localCOMy*=Cl}}null!=xl.wrap_localCOM&&(xl.wrap_localCOM.zpp_inner.x=xl.localCOMx,xl.wrap_localCOM.zpp_inner.y=xl.localCOMy)}var Ml=xl.body;Ml.zip_axis&&(Ml.zip_axis=!1,Ml.axisx=Math.sin(Ml.rot),Ml.axisy=Math.cos(Ml.rot)),xl.worldCOMx=xl.body.posx+(xl.body.axisy*xl.localCOMx-xl.body.axisx*xl.localCOMy),xl.worldCOMy=xl.body.posy+(xl.localCOMx*xl.body.axisx+xl.localCOMy*xl.body.axisy)}return i.overlap=n.polygon.area,i.centroidx=n.polygon.worldCOMx,i.centroidy=n.polygon.worldCOMy,!0}for(;null!=fn.flowpoly.head;){var Ol=fn.flowpoly.pop_unsafe();if(!Ol._inuse){var kl=Ol;null!=kl.outer&&(kl.outer.zpp_inner=null,kl.outer=null),kl._isimmutable=null,kl._validate=null,kl._invalidate=null,kl.next=Sn.zpp_pool,Sn.zpp_pool=kl}}fn.flowsegs.clear();var Sl=null,Al=1;for(null==al?(al=n.polygon.gverts.next,Al=2):(Sl=al,fn.flowpoly.add(Sl));0!=Al;)if(1==Al)if(al=al.next,null==al&&(al=n.polygon.gverts.next),++rl,rl>=n.polygon.edgeCnt&&(rl=0),il[rl]){var Tl=0,El=0;if(Tl=Sl.x-al.x,El=Sl.y-al.y,Tl*Tl+El*El<O.epsilon)break;fn.flowpoly.add(al)}else{var Il=fn.flowpoly.head.elt,jl=al,Nl=0,Dl=0;Nl=jl.x-Il.x,Dl=jl.y-Il.y;var Ll=0,Fl=0;Ll=Il.x-e.circle.worldCOMx,Fl=Il.y-e.circle.worldCOMy;var Pl=Nl*Nl+Dl*Dl,Rl=2*(Ll*Nl+Fl*Dl),Bl=Ll*Ll+Fl*Fl-e.circle.radius*e.circle.radius,Vl=Math.sqrt(Rl*Rl-4*Pl*Bl);Pl=1/(2*Pl);var Gl=(-Rl-Vl)*Pl,Ul=Gl<O.epsilon?(-Rl+Vl)*Pl:Gl,Yl=0,Kl=0,Wl=Ul;Yl=Il.x+(jl.x-Il.x)*Wl,Kl=Il.y+(jl.y-Il.y)*Wl;var ql=0,Xl=0;if(ql=Sl.x-Yl,Xl=Sl.y-Kl,ql*ql+Xl*Xl<O.epsilon)break;var Hl,Zl=fn.flowpoly;null==Sn.zpp_pool?Hl=new Sn:(Hl=Sn.zpp_pool,Sn.zpp_pool=Hl.next,Hl.next=null),Hl.weak=!1,Hl._immutable=!1,Hl.x=Yl,Hl.y=Kl,Zl.add(Hl),Al=2}else if(2==Al){var Jl=al.next;null==Jl&&(Jl=n.polygon.gverts.next);var Ql=al;Al=0;for(var $l=Jl,ea=Jl;;){var na=ea,ia=rl+1;if(ia==n.polygon.edgeCnt&&(ia=0),Nt[rl]){if(il[ia]){var ta=0,la=0;ta=na.x-Ql.x,la=na.y-Ql.y;var aa=0,ra=0;aa=Ql.x-e.circle.worldCOMx,ra=Ql.y-e.circle.worldCOMy;var pa=ta*ta+la*la,sa=2*(aa*ta+ra*la),oa=aa*aa+ra*ra-e.circle.radius*e.circle.radius,_a=Math.sqrt(sa*sa-4*pa*oa);pa=1/(2*pa);var ha=(-sa-_a)*pa,xa=ha<O.epsilon?(-sa+_a)*pa:ha,ua=0,da=0,va=xa;ua=Ql.x+(na.x-Ql.x)*va,da=Ql.y+(na.y-Ql.y)*va;var ca=0,ya=0;if(ca=Sl.x-ua,ya=Sl.y-da,ca*ca+ya*ya<O.epsilon){Al=0,ea=$l;break}var ma;null==Sn.zpp_pool?ma=new Sn:(ma=Sn.zpp_pool,Sn.zpp_pool=ma.next,ma.next=null),ma.weak=!1,ma._immutable=!1,ma.x=ua,ma.y=da;var za=ma;fn.flowsegs.add(fn.flowpoly.head.elt),fn.flowsegs.add(za),fn.flowpoly.add(za),Al=1,ea=$l;break}var fa=0,ba=0,ga=0,wa=0;ga=na.x-Ql.x,wa=na.y-Ql.y;var Ca=0,Ma=0;Ca=Ql.x-e.circle.worldCOMx,Ma=Ql.y-e.circle.worldCOMy;var Oa,ka=ga*ga+wa*wa,Sa=2*(Ca*ga+Ma*wa),Aa=Ca*Ca+Ma*Ma-e.circle.radius*e.circle.radius,Ta=Sa*Sa-4*ka*Aa;if(Ta*Ta<O.epsilon?(Ta<0?fa=10:(ba=-Sa/(2*ka),fa=ba),Oa=!1):(Ta=Math.sqrt(Ta),ka=1/(2*ka),fa=(-Sa-Ta)*ka,ba=(-Sa+Ta)*ka,Oa=!0),fa<1-O.epsilon&&ba>O.epsilon){var Ea=0,Ia=0,ja=fa;Ea=Ql.x+(na.x-Ql.x)*ja,Ia=Ql.y+(na.y-Ql.y)*ja;var Na;if(null!=Sl){var Da=0,La=0;Da=Sl.x-Ea,La=Sl.y-Ia,Na=Da*Da+La*La<O.epsilon}else Na=!1;if(Na){Al=0,ea=$l;break}var Fa;null==Sn.zpp_pool?Fa=new Sn:(Fa=Sn.zpp_pool,Sn.zpp_pool=Fa.next,Fa.next=null),Fa.weak=!1,Fa._immutable=!1,Fa.x=Ea,Fa.y=Ia;var Pa=Fa;if(null!=fn.flowpoly.head&&(fn.flowsegs.add(fn.flowpoly.head.elt),fn.flowsegs.add(Pa)),fn.flowpoly.add(Pa),null==Sl&&(Sl=fn.flowpoly.head.elt),Oa){var Ra=0,Ba=0,Va=ba;Ra=Ql.x+(na.x-Ql.x)*Va,Ba=Ql.y+(na.y-Ql.y)*Va;var Ga,Ua=fn.flowpoly;null==Sn.zpp_pool?Ga=new Sn:(Ga=Sn.zpp_pool,Sn.zpp_pool=Ga.next,Ga.next=null),Ga.weak=!1,Ga._immutable=!1,Ga.x=Ra,Ga.y=Ba,Ua.add(Ga)}}}Ql=na,al=ea,rl=ia,ea=ea.next,null==ea&&(ea=n.polygon.gverts.next);break}for(;ea!=$l;){var Ya=ea,Ka=rl+1;if(Ka==n.polygon.edgeCnt&&(Ka=0),Nt[rl]){if(il[Ka]){var Wa=0,qa=0;Wa=Ya.x-Ql.x,qa=Ya.y-Ql.y;var Xa=0,Ha=0;Xa=Ql.x-e.circle.worldCOMx,Ha=Ql.y-e.circle.worldCOMy;var Za=Wa*Wa+qa*qa,Ja=2*(Xa*Wa+Ha*qa),Qa=Xa*Xa+Ha*Ha-e.circle.radius*e.circle.radius,$a=Math.sqrt(Ja*Ja-4*Za*Qa);Za=1/(2*Za);var er=(-Ja-$a)*Za,nr=er<O.epsilon?(-Ja+$a)*Za:er,ir=0,tr=0,lr=nr;ir=Ql.x+(Ya.x-Ql.x)*lr,tr=Ql.y+(Ya.y-Ql.y)*lr;var ar=0,rr=0;if(ar=Sl.x-ir,rr=Sl.y-tr,ar*ar+rr*rr<O.epsilon){Al=0,ea=$l;break}var pr;null==Sn.zpp_pool?pr=new Sn:(pr=Sn.zpp_pool,Sn.zpp_pool=pr.next,pr.next=null),pr.weak=!1,pr._immutable=!1,pr.x=ir,pr.y=tr;var sr=pr;fn.flowsegs.add(fn.flowpoly.head.elt),fn.flowsegs.add(sr),fn.flowpoly.add(sr),Al=1,ea=$l;break}var or=0,_r=0,hr=0,xr=0;hr=Ya.x-Ql.x,xr=Ya.y-Ql.y;var ur=0,dr=0;ur=Ql.x-e.circle.worldCOMx,dr=Ql.y-e.circle.worldCOMy;var vr,cr=hr*hr+xr*xr,yr=2*(ur*hr+dr*xr),mr=ur*ur+dr*dr-e.circle.radius*e.circle.radius,zr=yr*yr-4*cr*mr;if(zr*zr<O.epsilon?(zr<0?or=10:(_r=-yr/(2*cr),or=_r),vr=!1):(zr=Math.sqrt(zr),cr=1/(2*cr),or=(-yr-zr)*cr,_r=(-yr+zr)*cr,vr=!0),or<1-O.epsilon&&_r>O.epsilon){var fr=0,br=0,gr=or;fr=Ql.x+(Ya.x-Ql.x)*gr,br=Ql.y+(Ya.y-Ql.y)*gr;var wr;if(null!=Sl){var Cr=0,Mr=0;Cr=Sl.x-fr,Mr=Sl.y-br,wr=Cr*Cr+Mr*Mr<O.epsilon}else wr=!1;if(wr){Al=0,ea=$l;break}var Or;null==Sn.zpp_pool?Or=new Sn:(Or=Sn.zpp_pool,Sn.zpp_pool=Or.next,Or.next=null),Or.weak=!1,Or._immutable=!1,Or.x=fr,Or.y=br;var kr=Or;if(null!=fn.flowpoly.head&&(fn.flowsegs.add(fn.flowpoly.head.elt),fn.flowsegs.add(kr)),fn.flowpoly.add(kr),null==Sl&&(Sl=fn.flowpoly.head.elt),vr){var Sr=0,Ar=0,Tr=_r;Sr=Ql.x+(Ya.x-Ql.x)*Tr,Ar=Ql.y+(Ya.y-Ql.y)*Tr;var Er,Ir=fn.flowpoly;null==Sn.zpp_pool?Er=new Sn:(Er=Sn.zpp_pool,Sn.zpp_pool=Er.next,Er.next=null),Er.weak=!1,Er._immutable=!1,Er.x=Sr,Er.y=Ar,Ir.add(Er)}}}Ql=Ya,al=ea,rl=Ka,ea=ea.next,null==ea&&(ea=n.polygon.gverts.next)}}if(null==fn.flowpoly.head)return!1;if(null==fn.flowpoly.head.next){for(var jr=!0,Nr=n.polygon.edges.head;null!=Nr;){var Dr=Nr.elt;if(Dr.gnormx*e.circle.worldCOMx+Dr.gnormy*e.circle.worldCOMy>Dr.gprojection){jr=!1;break}Nr=Nr.next}return!!jr&&(i.overlap=e.circle.area,i.centroidx=e.circle.worldCOMx,i.centroidy=e.circle.worldCOMy,!0)}var Lr=0,Fr=0,Pr=0;if(null!=fn.flowpoly.head.next.next){var Rr=0,Br=0,Vr=0;Br=0,Vr=0,Rr=0;var Gr=fn.flowpoly.head,Ur=Gr.elt;Gr=Gr.next;var Yr=Gr.elt;for(Gr=Gr.next;null!=Gr;){var Kr=Gr.elt;Rr+=Yr.x*(Kr.y-Ur.y);var Wr=Kr.y*Yr.x-Kr.x*Yr.y;Br+=(Yr.x+Kr.x)*Wr,Vr+=(Yr.y+Kr.y)*Wr,Ur=Yr,Yr=Kr,Gr=Gr.next}Gr=fn.flowpoly.head;var qr=Gr.elt;Rr+=Yr.x*(qr.y-Ur.y);var Xr=qr.y*Yr.x-qr.x*Yr.y;Br+=(Yr.x+qr.x)*Xr,Vr+=(Yr.y+qr.y)*Xr,Ur=Yr,Yr=qr,Gr=Gr.next;var Hr=Gr.elt;Rr+=Yr.x*(Hr.y-Ur.y);var Zr=Hr.y*Yr.x-Hr.x*Yr.y;Br+=(Yr.x+Hr.x)*Zr,Vr+=(Yr.y+Hr.y)*Zr,Rr*=.5;var Jr=1/(6*Rr),Qr=Jr;Br*=Qr,Vr*=Qr;var $r=-Rr;Lr+=Br*$r,Fr+=Vr*$r,Pr-=Rr}else fn.flowsegs.add(fn.flowpoly.head.elt),fn.flowsegs.add(fn.flowpoly.head.next.elt);for(;null!=fn.flowsegs.head;){var ep=fn.flowsegs.pop_unsafe(),np=fn.flowsegs.pop_unsafe(),ip=0,tp=0;ip=np.x-ep.x,tp=np.y-ep.y;var lp=0,ap=0;lp=ip,ap=tp;var rp=lp*lp+ap*ap,pp=1/Math.sqrt(rp),sp=pp;lp*=sp,ap*=sp;var op=lp;lp=-ap,ap=op;var _p=0,hp=0;_p=ep.x+np.x,hp=ep.y+np.y;_p*=.5,hp*=.5;_p-=1*e.circle.worldCOMx,hp-=1*e.circle.worldCOMy;var xp=lp*_p+ap*hp,up=0,dp=0,vp=xp,cp=vp/e.circle.radius,yp=Math.sqrt(1-cp*cp),mp=Math.acos(cp);up=e.circle.radius*(e.circle.radius*mp-vp*yp),dp=.6666666666666666*e.circle.radius*yp*yp*yp/(mp-cp*yp),_p=e.circle.worldCOMx,hp=e.circle.worldCOMy;var zp=dp;_p+=lp*zp,hp+=ap*zp;var fp=up;Lr+=_p*fp,Fr+=hp*fp,Pr+=up}var bp=1/Pr;return Lr*=bp,Fr*=bp,i.overlap=Pr,i.centroidx=Lr,i.centroidy=Fr,!0}return!1}return!1}var gp=e.circle,wp=n.circle,Cp=0,Mp=0;Cp=wp.worldCOMx-gp.worldCOMx,Mp=wp.worldCOMy-gp.worldCOMy;var Op=gp.radius+wp.radius,kp=Cp*Cp+Mp*Mp;if(kp>Op*Op)return!1;if(kp<O.epsilon*O.epsilon)return gp.radius<wp.radius?(i.overlap=gp.area,i.centroidx=gp.worldCOMx,i.centroidy=gp.worldCOMy):(i.overlap=wp.area,i.centroidx=wp.worldCOMx,i.centroidy=wp.worldCOMy),!0;var Sp=Math.sqrt(kp),Ap=1/Sp,Tp=.5*(Sp-(wp.radius*wp.radius-gp.radius*gp.radius)*Ap);if(Tp<=-gp.radius)i.overlap=gp.area,i.centroidx=gp.worldCOMx,i.centroidy=gp.worldCOMy;else{var Ep=Sp-Tp;if(Ep<=-wp.radius)i.overlap=wp.area,i.centroidx=wp.worldCOMx,i.centroidy=wp.worldCOMy;else{var Ip=0,jp=0,Np=0,Dp=0,Lp=Tp,Fp=Lp/gp.radius,Pp=Math.sqrt(1-Fp*Fp),Rp=Math.acos(Fp);Ip=gp.radius*(gp.radius*Rp-Lp*Pp),jp=.6666666666666666*gp.radius*Pp*Pp*Pp/(Rp-Fp*Pp);var Bp=Ep,Vp=Bp/wp.radius,Gp=Math.sqrt(1-Vp*Vp),Up=Math.acos(Vp);Np=wp.radius*(wp.radius*Up-Bp*Gp),Dp=.6666666666666666*wp.radius*Gp*Gp*Gp/(Up-Vp*Gp);var Yp=Ip+Np,Kp=(jp*Ip+(Sp-Dp)*Np)/Yp*Ap;i.overlap=Yp,i.centroidx=gp.worldCOMx+Cp*Kp,i.centroidy=gp.worldCOMy+Mp*Kp}}return!0};var bn=function(){this.toiDistance=0,this.inner=!1,this.shape=null};bn.__name__=!0,bn.prototype={__class__:bn};var gn=function(){this.forced=!1,this.next=null,this.prev=null,this.y=0,this.x=0};gn.__name__=!0,gn.prototype={__class__:gn};var wn=function(e){this.vertices=null,this.outer=null,this.outer=e};wn.__name__=!0,wn.prototype={__class__:wn};var Cn=function(){this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0};Cn.__name__=!0,Cn.prototype={__class__:Cn};var Mn=function(){this.x=null,this.n=0,this.m=0};Mn.__name__=!0,Mn.prototype={__class__:Mn};var On=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new Sn,this.c2=new Sn,this.axis=new Sn};On.__name__=!0,On.prototype={__class__:On};var kn=function(){};kn.__name__=!0,kn.dynamicSweep=function(e,n,i,t,l){null==l&&(l=!1);var a=e.s1,r=e.s2,p=a.body,s=r.body,o=0,_=0;o=s.velx-p.velx,_=s.vely-p.vely;var h=p.angvel;h<0&&(h=-h);var x=s.angvel;x<0&&(x=-x);var u=a.sweepCoef*h+r.sweepCoef*x;if(!l&&!e.kinematic&&o*o+_*_<O.dynamicSweepLinearThreshold*O.dynamicSweepLinearThreshold&&u<O.dynamicSweepAngularThreshold)return e.toi=-1,void(e.failed=!0);for(var d=e.c1,v=e.c2,c=e.axis,y=i,m=0;;){var z=y*n,f=z-p.sweepTime;if(0!=f){p.sweepTime=z;var b=f;if(p.posx+=p.velx*b,p.posy+=p.vely*b,0!=p.angvel){var g=p.sweep_angvel*f;if(p.rot+=g,g*g>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var w=g*g,C=1-.5*w,M=1-w*w/8,k=(C*p.axisx+g*p.axisy)*M;p.axisy=(C*p.axisy-g*p.axisx)*M,p.axisx=k}}}if(0==a.type)a.worldCOMx=p.posx+(p.axisy*a.localCOMx-p.axisx*a.localCOMy),a.worldCOMy=p.posy+(a.localCOMx*p.axisx+a.localCOMy*p.axisy);else{for(var S=a.polygon,A=S.lverts.next,T=S.gverts.next;null!=T;){var E=T,I=A;A=A.next,E.x=p.posx+(p.axisy*I.x-p.axisx*I.y),E.y=p.posy+(I.x*p.axisx+I.y*p.axisy),T=T.next}var j=S.edges.head,N=S.gverts.next,D=N;for(N=N.next;null!=N;){var L=N,F=j.elt;j=j.next,F.gnormx=p.axisy*F.lnormx-p.axisx*F.lnormy,F.gnormy=F.lnormx*p.axisx+F.lnormy*p.axisy,F.gprojection=p.posx*F.gnormx+p.posy*F.gnormy+F.lprojection,F.tp0=D.y*F.gnormx-D.x*F.gnormy,F.tp1=L.y*F.gnormx-L.x*F.gnormy,D=L,N=N.next}var P=S.gverts.next,R=j.elt;j=j.next,R.gnormx=p.axisy*R.lnormx-p.axisx*R.lnormy,R.gnormy=R.lnormx*p.axisx+R.lnormy*p.axisy,R.gprojection=p.posx*R.gnormx+p.posy*R.gnormy+R.lprojection,R.tp0=D.y*R.gnormx-D.x*R.gnormy,R.tp1=P.y*R.gnormx-P.x*R.gnormy}var B=y*n,V=B-s.sweepTime;if(0!=V){s.sweepTime=B;var G=V;if(s.posx+=s.velx*G,s.posy+=s.vely*G,0!=s.angvel){var U=s.sweep_angvel*V;if(s.rot+=U,U*U>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var Y=U*U,K=1-.5*Y,W=1-Y*Y/8,q=(K*s.axisx+U*s.axisy)*W;s.axisy=(K*s.axisy-U*s.axisx)*W,s.axisx=q}}}if(0==r.type)r.worldCOMx=s.posx+(s.axisy*r.localCOMx-s.axisx*r.localCOMy),r.worldCOMy=s.posy+(r.localCOMx*s.axisx+r.localCOMy*s.axisy);else{for(var X=r.polygon,H=X.lverts.next,Z=X.gverts.next;null!=Z;){var J=Z,Q=H;H=H.next,J.x=s.posx+(s.axisy*Q.x-s.axisx*Q.y),J.y=s.posy+(Q.x*s.axisx+Q.y*s.axisy),Z=Z.next}var $=X.edges.head,ee=X.gverts.next,ne=ee;for(ee=ee.next;null!=ee;){var ie=ee,te=$.elt;$=$.next,te.gnormx=s.axisy*te.lnormx-s.axisx*te.lnormy,te.gnormy=te.lnormx*s.axisx+te.lnormy*s.axisy,te.gprojection=s.posx*te.gnormx+s.posy*te.gnormy+te.lprojection,te.tp0=ne.y*te.gnormx-ne.x*te.gnormy,te.tp1=ie.y*te.gnormx-ie.x*te.gnormy,ne=ie,ee=ee.next}var le=X.gverts.next,ae=$.elt;$=$.next,ae.gnormx=s.axisy*ae.lnormx-s.axisx*ae.lnormy,ae.gnormy=ae.lnormx*s.axisx+ae.lnormy*s.axisy,ae.gprojection=s.posx*ae.gnormx+s.posy*ae.gnormy+ae.lprojection,ae.tp0=ne.y*ae.gnormx-ne.x*ae.gnormy,ae.tp1=le.y*ae.gnormx-le.x*ae.gnormy}var re,pe=a,se=r,oe=d,_e=v;if(0==pe.type&&0==se.type){var he,xe=pe.circle,ue=se.circle,de=0,ve=0;de=ue.worldCOMx-xe.worldCOMx,ve=ue.worldCOMy-xe.worldCOMy;var ce=Math.sqrt(de*de+ve*ve);if((he=ce-(xe.radius+ue.radius))<1e100){if(0==ce)de=1,ve=0;else{var ye=1/ce;de*=ye,ve*=ye}var me=xe.radius;oe.x=xe.worldCOMx+de*me,oe.y=xe.worldCOMy+ve*me;var ze=-ue.radius;_e.x=ue.worldCOMx+de*ze,_e.y=ue.worldCOMy+ve*ze,c.x=de,c.y=ve}re=he}else{var fe=!1;if(0==pe.type&&1==se.type){var be=pe;pe=se,se=be;var ge=oe;oe=_e,_e=ge,fe=!0}if(1==pe.type&&0==se.type){for(var we=pe.polygon,Ce=se.circle,Me=-1e100,Oe=null,ke=we.edges.head;null!=ke;){var Se=ke.elt,Ae=Se.gnormx*Ce.worldCOMx+Se.gnormy*Ce.worldCOMy-Se.gprojection-Ce.radius;if(Ae>1e100){Me=Ae;break}Ae>0?Ae>Me&&(Me=Ae,Oe=Se):Me<0&&Ae>Me&&(Me=Ae,Oe=Se),ke=ke.next}if(Me<1e100){var Te=Oe.gp0,Ee=Oe.gp1,Ie=Ce.worldCOMy*Oe.gnormx-Ce.worldCOMx*Oe.gnormy;if(Ie<=Te.y*Oe.gnormx-Te.x*Oe.gnormy){var je=0,Ne=0;je=Ce.worldCOMx-Te.x,Ne=Ce.worldCOMy-Te.y;var De=Math.sqrt(je*je+Ne*Ne);if((Me=De-Ce.radius)<1e100){if(0==De)je=1,Ne=0;else{var Le=1/De;je*=Le,Ne*=Le}oe.x=Te.x+0*je,oe.y=Te.y+0*Ne;var Fe=-Ce.radius;_e.x=Ce.worldCOMx+je*Fe,_e.y=Ce.worldCOMy+Ne*Fe,c.x=je,c.y=Ne}}else if(Ie>=Ee.y*Oe.gnormx-Ee.x*Oe.gnormy){var Pe=0,Re=0;Pe=Ce.worldCOMx-Ee.x,Re=Ce.worldCOMy-Ee.y;var Be=Math.sqrt(Pe*Pe+Re*Re);if((Me=Be-Ce.radius)<1e100){if(0==Be)Pe=1,Re=0;else{var Ve=1/Be;Pe*=Ve,Re*=Ve}oe.x=Ee.x+0*Pe,oe.y=Ee.y+0*Re;var Ge=-Ce.radius;_e.x=Ce.worldCOMx+Pe*Ge,_e.y=Ce.worldCOMy+Re*Ge,c.x=Pe,c.y=Re}}else{var Ue=-Ce.radius;_e.x=Ce.worldCOMx+Oe.gnormx*Ue,_e.y=Ce.worldCOMy+Oe.gnormy*Ue;var Ye=-Me;oe.x=_e.x+Oe.gnormx*Ye,oe.y=_e.y+Oe.gnormy*Ye,c.x=Oe.gnormx,c.y=Oe.gnormy}}fe&&(c.x=-c.x,c.y=-c.y),re=Me}else{for(var Ke=pe.polygon,We=se.polygon,qe=-1e100,Xe=null,He=null,Ze=0,Je=Ke.edges.head;null!=Je;){for(var Qe=Je.elt,$e=1e100,en=We.gverts.next;null!=en;){var nn=en,tn=Qe.gnormx*nn.x+Qe.gnormy*nn.y;tn<$e&&($e=tn),en=en.next}if(($e-=Qe.gprojection)>1e100){qe=$e;break}$e>0?$e>qe&&(qe=$e,Xe=Qe,Ze=1):qe<0&&$e>qe&&(qe=$e,Xe=Qe,Ze=1),Je=Je.next}if(qe<1e100){for(var ln=We.edges.head;null!=ln;){for(var an=ln.elt,rn=1e100,pn=Ke.gverts.next;null!=pn;){var sn=pn,on=an.gnormx*sn.x+an.gnormy*sn.y;on<rn&&(rn=on),pn=pn.next}if((rn-=an.gprojection)>1e100){qe=rn;break}rn>0?rn>qe&&(qe=rn,He=an,Ze=2):qe<0&&rn>qe&&(qe=rn,He=an,Ze=2),ln=ln.next}if(qe<1e100){var _n,hn;if(1==Ze)Ke,_n=We,hn=Xe;else{We,_n=Ke,hn=He;var xn=oe;oe=_e,_e=xn,fe=!fe}for(var un=null,dn=1e100,vn=_n.edges.head;null!=vn;){var cn=vn.elt,yn=hn.gnormx*cn.gnormx+hn.gnormy*cn.gnormy;yn<dn&&(dn=yn,un=cn),vn=vn.next}if(fe?(c.x=-hn.gnormx,c.y=-hn.gnormy):(c.x=hn.gnormx,c.y=hn.gnormy),qe>=0){var mn=hn.gp0,zn=hn.gp1,fn=un.gp0,bn=un.gp1,gn=0,wn=0,Cn=0,Mn=0;gn=zn.x-mn.x,wn=zn.y-mn.y,Cn=bn.x-fn.x,Mn=bn.y-fn.y;var On=1/(gn*gn+wn*wn),kn=1/(Cn*Cn+Mn*Mn),Sn=-(gn*(mn.x-fn.x)+wn*(mn.y-fn.y))*On,An=-(gn*(mn.x-bn.x)+wn*(mn.y-bn.y))*On,Tn=-(Cn*(fn.x-mn.x)+Mn*(fn.y-mn.y))*kn,En=-(Cn*(fn.x-zn.x)+Mn*(fn.y-zn.y))*kn;Sn<0?Sn=0:Sn>1&&(Sn=1),An<0?An=0:An>1&&(An=1),Tn<0?Tn=0:Tn>1&&(Tn=1),En<0?En=0:En>1&&(En=1);var In=0,jn=0,Nn=Sn;In=mn.x+gn*Nn,jn=mn.y+wn*Nn;var Dn=0,Ln=0,Fn=An;Dn=mn.x+gn*Fn,Ln=mn.y+wn*Fn;var Pn=0,Rn=0,Bn=Tn;Pn=fn.x+Cn*Bn,Rn=fn.y+Mn*Bn;var Vn=0,Gn=0,Un=En;Vn=fn.x+Cn*Un,Gn=fn.y+Mn*Un;var Yn=0,Kn=0;Yn=In-fn.x,Kn=jn-fn.y;var Wn=Yn*Yn+Kn*Kn,qn=0,Xn=0;qn=Dn-bn.x,Xn=Ln-bn.y;var Hn=qn*qn+Xn*Xn,Zn=0,Jn=0;Zn=Pn-mn.x,Jn=Rn-mn.y;var Qn=Zn*Zn+Jn*Jn,$n=0,ei=0;$n=Vn-zn.x,ei=Gn-zn.y;var ni=$n*$n+ei*ei,ii=0,ti=0,li=null;Wn<Hn?(ii=In,ti=jn,li=fn):(ii=Dn,ti=Ln,li=bn,Wn=Hn);var ai=0,ri=0,pi=null;if(Qn<ni?(ai=Pn,ri=Rn,pi=mn):(ai=Vn,ri=Gn,pi=zn,Qn=ni),Wn<Qn?(oe.x=ii,oe.y=ti,_e.x=li.x,_e.y=li.y,qe=Math.sqrt(Wn)):(_e.x=ai,_e.y=ri,oe.x=pi.x,oe.y=pi.y,qe=Math.sqrt(Qn)),0!=qe){
c.x=_e.x-oe.x,c.y=_e.y-oe.y;var si=1/qe;c.x*=si,c.y*=si,fe&&(c.x=-c.x,c.y=-c.y)}re=qe}else{var oi=0,_i=0;oi=un.gp0.x,_i=un.gp0.y;var hi=0,xi=0;hi=un.gp1.x,xi=un.gp1.y;var ui=0,di=0;ui=hi-oi,di=xi-_i;var vi=hn.gnormy*oi-hn.gnormx*_i,ci=hn.gnormy*hi-hn.gnormx*xi,yi=1/(ci-vi),mi=(-hn.tp1-vi)*yi;if(mi>O.epsilon){var zi=mi;oi+=ui*zi,_i+=di*zi}var fi=(-hn.tp0-ci)*yi;if(fi<-O.epsilon){var bi=fi;hi+=ui*bi,xi+=di*bi}var gi=oi*hn.gnormx+_i*hn.gnormy-hn.gprojection,wi=hi*hn.gnormx+xi*hn.gnormy-hn.gprojection;if(gi<wi){_e.x=oi,_e.y=_i;var Ci=-gi;oe.x=_e.x+hn.gnormx*Ci,oe.y=_e.y+hn.gnormy*Ci,re=gi}else{_e.x=hi,_e.y=xi;var Mi=-wi;oe.x=_e.x+hn.gnormx*Mi,oe.y=_e.y+hn.gnormy*Mi,re=wi}}}else re=1e100}else re=1e100}}var Oi=re+t,ki=o*c.x+_*c.y;if(Oi<O.distanceThresholdCCD){if(l)break;var Si=0,Ai=0;Si=d.x-p.posx,Ai=d.y-p.posy;var Ti=0,Ei=0;Ti=v.x-s.posx,Ei=v.y-s.posy;var Ii=ki-p.sweep_angvel*(c.y*Si-c.x*Ai)+s.sweep_angvel*(c.y*Ti-c.x*Ei);if(Ii>0&&(e.slipped=!0),Ii<=0||Oi<.5*O.distanceThresholdCCD)break}var ji=(u-ki)*n;if(ji<=0){y=-1;break}var Ni=Oi/ji;if(Ni<1e-6&&(Ni=1e-6),(y+=Ni)>=1){y=1;var Di=y*n,Li=Di-p.sweepTime;if(0!=Li){p.sweepTime=Di;var Fi=Li;if(p.posx+=p.velx*Fi,p.posy+=p.vely*Fi,0!=p.angvel){var Pi=p.sweep_angvel*Li;if(p.rot+=Pi,Pi*Pi>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var Ri=Pi*Pi,Bi=1-.5*Ri,Vi=1-Ri*Ri/8,Gi=(Bi*p.axisx+Pi*p.axisy)*Vi;p.axisy=(Bi*p.axisy-Pi*p.axisx)*Vi,p.axisx=Gi}}}if(0==a.type)a.worldCOMx=p.posx+(p.axisy*a.localCOMx-p.axisx*a.localCOMy),a.worldCOMy=p.posy+(a.localCOMx*p.axisx+a.localCOMy*p.axisy);else{for(var Ui=a.polygon,Yi=Ui.lverts.next,Ki=Ui.gverts.next;null!=Ki;){var Wi=Ki,qi=Yi;Yi=Yi.next,Wi.x=p.posx+(p.axisy*qi.x-p.axisx*qi.y),Wi.y=p.posy+(qi.x*p.axisx+qi.y*p.axisy),Ki=Ki.next}var Xi=Ui.edges.head,Hi=Ui.gverts.next,Zi=Hi;for(Hi=Hi.next;null!=Hi;){var Ji=Hi,Qi=Xi.elt;Xi=Xi.next,Qi.gnormx=p.axisy*Qi.lnormx-p.axisx*Qi.lnormy,Qi.gnormy=Qi.lnormx*p.axisx+Qi.lnormy*p.axisy,Qi.gprojection=p.posx*Qi.gnormx+p.posy*Qi.gnormy+Qi.lprojection,Qi.tp0=Zi.y*Qi.gnormx-Zi.x*Qi.gnormy,Qi.tp1=Ji.y*Qi.gnormx-Ji.x*Qi.gnormy,Zi=Ji,Hi=Hi.next}var $i=Ui.gverts.next,et=Xi.elt;Xi=Xi.next,et.gnormx=p.axisy*et.lnormx-p.axisx*et.lnormy,et.gnormy=et.lnormx*p.axisx+et.lnormy*p.axisy,et.gprojection=p.posx*et.gnormx+p.posy*et.gnormy+et.lprojection,et.tp0=Zi.y*et.gnormx-Zi.x*et.gnormy,et.tp1=$i.y*et.gnormx-$i.x*et.gnormy}var nt=y*n,it=nt-s.sweepTime;if(0!=it){s.sweepTime=nt;var tt=it;if(s.posx+=s.velx*tt,s.posy+=s.vely*tt,0!=s.angvel){var lt=s.sweep_angvel*it;if(s.rot+=lt,lt*lt>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var at=lt*lt,rt=1-.5*at,pt=1-at*at/8,st=(rt*s.axisx+lt*s.axisy)*pt;s.axisy=(rt*s.axisy-lt*s.axisx)*pt,s.axisx=st}}}if(0==r.type)r.worldCOMx=s.posx+(s.axisy*r.localCOMx-s.axisx*r.localCOMy),r.worldCOMy=s.posy+(r.localCOMx*s.axisx+r.localCOMy*s.axisy);else{for(var ot=r.polygon,_t=ot.lverts.next,ht=ot.gverts.next;null!=ht;){var xt=ht,ut=_t;_t=_t.next,xt.x=s.posx+(s.axisy*ut.x-s.axisx*ut.y),xt.y=s.posy+(ut.x*s.axisx+ut.y*s.axisy),ht=ht.next}var dt=ot.edges.head,vt=ot.gverts.next,ct=vt;for(vt=vt.next;null!=vt;){var yt=vt,mt=dt.elt;dt=dt.next,mt.gnormx=s.axisy*mt.lnormx-s.axisx*mt.lnormy,mt.gnormy=mt.lnormx*s.axisx+mt.lnormy*s.axisy,mt.gprojection=s.posx*mt.gnormx+s.posy*mt.gnormy+mt.lprojection,mt.tp0=ct.y*mt.gnormx-ct.x*mt.gnormy,mt.tp1=yt.y*mt.gnormx-yt.x*mt.gnormy,ct=yt,vt=vt.next}var zt=ot.gverts.next,ft=dt.elt;dt=dt.next,ft.gnormx=s.axisy*ft.lnormx-s.axisx*ft.lnormy,ft.gnormy=ft.lnormx*s.axisx+ft.lnormy*s.axisy,ft.gprojection=s.posx*ft.gnormx+s.posy*ft.gnormy+ft.lprojection,ft.tp0=ct.y*ft.gnormx-ct.x*ft.gnormy,ft.tp1=zt.y*ft.gnormx-zt.x*ft.gnormy}var bt,gt=a,wt=r,Ct=d,Mt=v;if(0==gt.type&&0==wt.type){var Ot,kt=gt.circle,St=wt.circle,At=0,Tt=0;At=St.worldCOMx-kt.worldCOMx,Tt=St.worldCOMy-kt.worldCOMy;var Et=Math.sqrt(At*At+Tt*Tt);if((Ot=Et-(kt.radius+St.radius))<1e100){if(0==Et)At=1,Tt=0;else{var It=1/Et;At*=It,Tt*=It}var jt=kt.radius;Ct.x=kt.worldCOMx+At*jt,Ct.y=kt.worldCOMy+Tt*jt;var Nt=-St.radius;Mt.x=St.worldCOMx+At*Nt,Mt.y=St.worldCOMy+Tt*Nt,c.x=At,c.y=Tt}bt=Ot}else{var Dt=!1;if(0==gt.type&&1==wt.type){var Lt=gt;gt=wt,wt=Lt;var Ft=Ct;Ct=Mt,Mt=Ft,Dt=!0}if(1==gt.type&&0==wt.type){for(var Pt=gt.polygon,Rt=wt.circle,Bt=-1e100,Vt=null,Gt=Pt.edges.head;null!=Gt;){var Ut=Gt.elt,Yt=Ut.gnormx*Rt.worldCOMx+Ut.gnormy*Rt.worldCOMy-Ut.gprojection-Rt.radius;if(Yt>1e100){Bt=Yt;break}Yt>0?Yt>Bt&&(Bt=Yt,Vt=Ut):Bt<0&&Yt>Bt&&(Bt=Yt,Vt=Ut),Gt=Gt.next}if(Bt<1e100){var Kt=Vt.gp0,Wt=Vt.gp1,qt=Rt.worldCOMy*Vt.gnormx-Rt.worldCOMx*Vt.gnormy;if(qt<=Kt.y*Vt.gnormx-Kt.x*Vt.gnormy){var Xt=0,Ht=0;Xt=Rt.worldCOMx-Kt.x,Ht=Rt.worldCOMy-Kt.y;var Zt=Math.sqrt(Xt*Xt+Ht*Ht);if((Bt=Zt-Rt.radius)<1e100){if(0==Zt)Xt=1,Ht=0;else{var Jt=1/Zt;Xt*=Jt,Ht*=Jt}Ct.x=Kt.x+0*Xt,Ct.y=Kt.y+0*Ht;var Qt=-Rt.radius;Mt.x=Rt.worldCOMx+Xt*Qt,Mt.y=Rt.worldCOMy+Ht*Qt,c.x=Xt,c.y=Ht}}else if(qt>=Wt.y*Vt.gnormx-Wt.x*Vt.gnormy){var $t=0,el=0;$t=Rt.worldCOMx-Wt.x,el=Rt.worldCOMy-Wt.y;var nl=Math.sqrt($t*$t+el*el);if((Bt=nl-Rt.radius)<1e100){if(0==nl)$t=1,el=0;else{var il=1/nl;$t*=il,el*=il}Ct.x=Wt.x+0*$t,Ct.y=Wt.y+0*el;var tl=-Rt.radius;Mt.x=Rt.worldCOMx+$t*tl,Mt.y=Rt.worldCOMy+el*tl,c.x=$t,c.y=el}}else{var ll=-Rt.radius;Mt.x=Rt.worldCOMx+Vt.gnormx*ll,Mt.y=Rt.worldCOMy+Vt.gnormy*ll;var al=-Bt;Ct.x=Mt.x+Vt.gnormx*al,Ct.y=Mt.y+Vt.gnormy*al,c.x=Vt.gnormx,c.y=Vt.gnormy}}Dt&&(c.x=-c.x,c.y=-c.y),bt=Bt}else{for(var rl=gt.polygon,pl=wt.polygon,sl=-1e100,ol=null,_l=null,hl=0,xl=rl.edges.head;null!=xl;){for(var ul=xl.elt,dl=1e100,vl=pl.gverts.next;null!=vl;){var cl=vl,yl=ul.gnormx*cl.x+ul.gnormy*cl.y;yl<dl&&(dl=yl),vl=vl.next}if((dl-=ul.gprojection)>1e100){sl=dl;break}dl>0?dl>sl&&(sl=dl,ol=ul,hl=1):sl<0&&dl>sl&&(sl=dl,ol=ul,hl=1),xl=xl.next}if(sl<1e100){for(var ml=pl.edges.head;null!=ml;){for(var zl=ml.elt,fl=1e100,bl=rl.gverts.next;null!=bl;){var gl=bl,wl=zl.gnormx*gl.x+zl.gnormy*gl.y;wl<fl&&(fl=wl),bl=bl.next}if((fl-=zl.gprojection)>1e100){sl=fl;break}fl>0?fl>sl&&(sl=fl,_l=zl,hl=2):sl<0&&fl>sl&&(sl=fl,_l=zl,hl=2),ml=ml.next}if(sl<1e100){var Cl,Ml;if(1==hl)rl,Cl=pl,Ml=ol;else{pl,Cl=rl,Ml=_l;var Ol=Ct;Ct=Mt,Mt=Ol,Dt=!Dt}for(var kl=null,Sl=1e100,Al=Cl.edges.head;null!=Al;){var Tl=Al.elt,El=Ml.gnormx*Tl.gnormx+Ml.gnormy*Tl.gnormy;El<Sl&&(Sl=El,kl=Tl),Al=Al.next}if(Dt?(c.x=-Ml.gnormx,c.y=-Ml.gnormy):(c.x=Ml.gnormx,c.y=Ml.gnormy),sl>=0){var Il=Ml.gp0,jl=Ml.gp1,Nl=kl.gp0,Dl=kl.gp1,Ll=0,Fl=0,Pl=0,Rl=0;Ll=jl.x-Il.x,Fl=jl.y-Il.y,Pl=Dl.x-Nl.x,Rl=Dl.y-Nl.y;var Bl=1/(Ll*Ll+Fl*Fl),Vl=1/(Pl*Pl+Rl*Rl),Gl=-(Ll*(Il.x-Nl.x)+Fl*(Il.y-Nl.y))*Bl,Ul=-(Ll*(Il.x-Dl.x)+Fl*(Il.y-Dl.y))*Bl,Yl=-(Pl*(Nl.x-Il.x)+Rl*(Nl.y-Il.y))*Vl,Kl=-(Pl*(Nl.x-jl.x)+Rl*(Nl.y-jl.y))*Vl;Gl<0?Gl=0:Gl>1&&(Gl=1),Ul<0?Ul=0:Ul>1&&(Ul=1),Yl<0?Yl=0:Yl>1&&(Yl=1),Kl<0?Kl=0:Kl>1&&(Kl=1);var Wl=0,ql=0,Xl=Gl;Wl=Il.x+Ll*Xl,ql=Il.y+Fl*Xl;var Hl=0,Zl=0,Jl=Ul;Hl=Il.x+Ll*Jl,Zl=Il.y+Fl*Jl;var Ql=0,$l=0,ea=Yl;Ql=Nl.x+Pl*ea,$l=Nl.y+Rl*ea;var na=0,ia=0,ta=Kl;na=Nl.x+Pl*ta,ia=Nl.y+Rl*ta;var la=0,aa=0;la=Wl-Nl.x,aa=ql-Nl.y;var ra=la*la+aa*aa,pa=0,sa=0;pa=Hl-Dl.x,sa=Zl-Dl.y;var oa=pa*pa+sa*sa,_a=0,ha=0;_a=Ql-Il.x,ha=$l-Il.y;var xa=_a*_a+ha*ha,ua=0,da=0;ua=na-jl.x,da=ia-jl.y;var va=ua*ua+da*da,ca=0,ya=0,ma=null;ra<oa?(ca=Wl,ya=ql,ma=Nl):(ca=Hl,ya=Zl,ma=Dl,ra=oa);var za=0,fa=0,ba=null;if(xa<va?(za=Ql,fa=$l,ba=Il):(za=na,fa=ia,ba=jl,xa=va),ra<xa?(Ct.x=ca,Ct.y=ya,Mt.x=ma.x,Mt.y=ma.y,sl=Math.sqrt(ra)):(Mt.x=za,Mt.y=fa,Ct.x=ba.x,Ct.y=ba.y,sl=Math.sqrt(xa)),0!=sl){c.x=Mt.x-Ct.x,c.y=Mt.y-Ct.y;var ga=1/sl;c.x*=ga,c.y*=ga,Dt&&(c.x=-c.x,c.y=-c.y)}bt=sl}else{var wa=0,Ca=0;wa=kl.gp0.x,Ca=kl.gp0.y;var Ma=0,Oa=0;Ma=kl.gp1.x,Oa=kl.gp1.y;var ka=0,Sa=0;ka=Ma-wa,Sa=Oa-Ca;var Aa=Ml.gnormy*wa-Ml.gnormx*Ca,Ta=Ml.gnormy*Ma-Ml.gnormx*Oa,Ea=1/(Ta-Aa),Ia=(-Ml.tp1-Aa)*Ea;if(Ia>O.epsilon){var ja=Ia;wa+=ka*ja,Ca+=Sa*ja}var Na=(-Ml.tp0-Ta)*Ea;if(Na<-O.epsilon){var Da=Na;Ma+=ka*Da,Oa+=Sa*Da}var La=wa*Ml.gnormx+Ca*Ml.gnormy-Ml.gprojection,Fa=Ma*Ml.gnormx+Oa*Ml.gnormy-Ml.gprojection;if(La<Fa){Mt.x=wa,Mt.y=Ca;var Pa=-La;Ct.x=Mt.x+Ml.gnormx*Pa,Ct.y=Mt.y+Ml.gnormy*Pa,bt=La}else{Mt.x=Ma,Mt.y=Oa;var Ra=-Fa;Ct.x=Mt.x+Ml.gnormx*Ra,Ct.y=Mt.y+Ml.gnormy*Ra,bt=Fa}}}else bt=1e100}else bt=1e100}}var Ba=bt+t,Va=o*c.x+_*c.y;if(Ba<O.distanceThresholdCCD){if(l)break;var Ga=0,Ua=0;Ga=d.x-p.posx,Ua=d.y-p.posy;var Ya=0,Ka=0;Ya=v.x-s.posx,Ka=v.y-s.posy;var Wa=Va-p.sweep_angvel*(c.y*Ga-c.x*Ua)+s.sweep_angvel*(c.y*Ya-c.x*Ka);if(Wa>0&&(e.slipped=!0),Wa<=0||Ba<.5*O.distanceThresholdCCD)break}y=-1;break}if(++m>=40){Oi>t&&(e.failed=!0);break}}e.toi=y},kn.staticSweep=function(e,n,i,t){var l=e.s1,a=e.s2,r=l.body,p=(a.body,0),s=0;p=-r.velx,s=-r.vely;var o=r.sweep_angvel;o<0&&(o=-o);for(var _=l.sweepCoef*o,h=e.c1,x=e.c2,u=e.axis,d=i,v=0;;){var c=d*n,y=c-r.sweepTime;if(0!=y){r.sweepTime=c;var m=y;if(r.posx+=r.velx*m,r.posy+=r.vely*m,0!=r.angvel){var z=r.sweep_angvel*y;if(r.rot+=z,z*z>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var f=z*z,b=1-.5*f,g=1-f*f/8,w=(b*r.axisx+z*r.axisy)*g;r.axisy=(b*r.axisy-z*r.axisx)*g,r.axisx=w}}}if(0==l.type)l.worldCOMx=r.posx+(r.axisy*l.localCOMx-r.axisx*l.localCOMy),l.worldCOMy=r.posy+(l.localCOMx*r.axisx+l.localCOMy*r.axisy);else{for(var C=l.polygon,M=C.lverts.next,k=C.gverts.next;null!=k;){var S=k,A=M;M=M.next,S.x=r.posx+(r.axisy*A.x-r.axisx*A.y),S.y=r.posy+(A.x*r.axisx+A.y*r.axisy),k=k.next}var T=C.edges.head,E=C.gverts.next,I=E;for(E=E.next;null!=E;){var j=E,N=T.elt;T=T.next,N.gnormx=r.axisy*N.lnormx-r.axisx*N.lnormy,N.gnormy=N.lnormx*r.axisx+N.lnormy*r.axisy,N.gprojection=r.posx*N.gnormx+r.posy*N.gnormy+N.lprojection,N.tp0=I.y*N.gnormx-I.x*N.gnormy,N.tp1=j.y*N.gnormx-j.x*N.gnormy,I=j,E=E.next}var D=C.gverts.next,L=T.elt;T=T.next,L.gnormx=r.axisy*L.lnormx-r.axisx*L.lnormy,L.gnormy=L.lnormx*r.axisx+L.lnormy*r.axisy,L.gprojection=r.posx*L.gnormx+r.posy*L.gnormy+L.lprojection,L.tp0=I.y*L.gnormx-I.x*L.gnormy,L.tp1=D.y*L.gnormx-D.x*L.gnormy}var F,P=l,R=a,B=h,V=x;if(0==P.type&&0==R.type){var G,U=P.circle,Y=R.circle,K=0,W=0;K=Y.worldCOMx-U.worldCOMx,W=Y.worldCOMy-U.worldCOMy;var q=Math.sqrt(K*K+W*W);if((G=q-(U.radius+Y.radius))<1e100){if(0==q)K=1,W=0;else{var X=1/q;K*=X,W*=X}var H=U.radius;B.x=U.worldCOMx+K*H,B.y=U.worldCOMy+W*H;var Z=-Y.radius;V.x=Y.worldCOMx+K*Z,V.y=Y.worldCOMy+W*Z,u.x=K,u.y=W}F=G}else{var J=!1;if(0==P.type&&1==R.type){var Q=P;P=R,R=Q;var $=B;B=V,V=$,J=!0}if(1==P.type&&0==R.type){for(var ee=P.polygon,ne=R.circle,ie=-1e100,te=null,le=ee.edges.head;null!=le;){var ae=le.elt,re=ae.gnormx*ne.worldCOMx+ae.gnormy*ne.worldCOMy-ae.gprojection-ne.radius;if(re>1e100){ie=re;break}re>0?re>ie&&(ie=re,te=ae):ie<0&&re>ie&&(ie=re,te=ae),le=le.next}if(ie<1e100){var pe=te.gp0,se=te.gp1,oe=ne.worldCOMy*te.gnormx-ne.worldCOMx*te.gnormy;if(oe<=pe.y*te.gnormx-pe.x*te.gnormy){var _e=0,he=0;_e=ne.worldCOMx-pe.x,he=ne.worldCOMy-pe.y;var xe=Math.sqrt(_e*_e+he*he);if((ie=xe-ne.radius)<1e100){if(0==xe)_e=1,he=0;else{var ue=1/xe;_e*=ue,he*=ue}B.x=pe.x+0*_e,B.y=pe.y+0*he;var de=-ne.radius;V.x=ne.worldCOMx+_e*de,V.y=ne.worldCOMy+he*de,u.x=_e,u.y=he}}else if(oe>=se.y*te.gnormx-se.x*te.gnormy){var ve=0,ce=0;ve=ne.worldCOMx-se.x,ce=ne.worldCOMy-se.y;var ye=Math.sqrt(ve*ve+ce*ce);if((ie=ye-ne.radius)<1e100){if(0==ye)ve=1,ce=0;else{var me=1/ye;ve*=me,ce*=me}B.x=se.x+0*ve,B.y=se.y+0*ce;var ze=-ne.radius;V.x=ne.worldCOMx+ve*ze,V.y=ne.worldCOMy+ce*ze,u.x=ve,u.y=ce}}else{var fe=-ne.radius;V.x=ne.worldCOMx+te.gnormx*fe,V.y=ne.worldCOMy+te.gnormy*fe;var be=-ie;B.x=V.x+te.gnormx*be,B.y=V.y+te.gnormy*be,u.x=te.gnormx,u.y=te.gnormy}}J&&(u.x=-u.x,u.y=-u.y),F=ie}else{for(var ge=P.polygon,we=R.polygon,Ce=-1e100,Me=null,Oe=null,ke=0,Se=ge.edges.head;null!=Se;){for(var Ae=Se.elt,Te=1e100,Ee=we.gverts.next;null!=Ee;){var Ie=Ee,je=Ae.gnormx*Ie.x+Ae.gnormy*Ie.y;je<Te&&(Te=je),Ee=Ee.next}if((Te-=Ae.gprojection)>1e100){Ce=Te;break}Te>0?Te>Ce&&(Ce=Te,Me=Ae,ke=1):Ce<0&&Te>Ce&&(Ce=Te,Me=Ae,ke=1),Se=Se.next}if(Ce<1e100){for(var Ne=we.edges.head;null!=Ne;){for(var De=Ne.elt,Le=1e100,Fe=ge.gverts.next;null!=Fe;){var Pe=Fe,Re=De.gnormx*Pe.x+De.gnormy*Pe.y;Re<Le&&(Le=Re),Fe=Fe.next}if((Le-=De.gprojection)>1e100){Ce=Le;break}Le>0?Le>Ce&&(Ce=Le,Oe=De,ke=2):Ce<0&&Le>Ce&&(Ce=Le,Oe=De,ke=2),Ne=Ne.next}if(Ce<1e100){var Be,Ve;if(1==ke)ge,Be=we,Ve=Me;else{we,Be=ge,Ve=Oe;var Ge=B;B=V,V=Ge,J=!J}for(var Ue=null,Ye=1e100,Ke=Be.edges.head;null!=Ke;){var We=Ke.elt,qe=Ve.gnormx*We.gnormx+Ve.gnormy*We.gnormy;qe<Ye&&(Ye=qe,Ue=We),Ke=Ke.next}if(J?(u.x=-Ve.gnormx,u.y=-Ve.gnormy):(u.x=Ve.gnormx,u.y=Ve.gnormy),Ce>=0){var Xe=Ve.gp0,He=Ve.gp1,Ze=Ue.gp0,Je=Ue.gp1,Qe=0,$e=0,en=0,nn=0;Qe=He.x-Xe.x,$e=He.y-Xe.y,en=Je.x-Ze.x,nn=Je.y-Ze.y;var tn=1/(Qe*Qe+$e*$e),ln=1/(en*en+nn*nn),an=-(Qe*(Xe.x-Ze.x)+$e*(Xe.y-Ze.y))*tn,rn=-(Qe*(Xe.x-Je.x)+$e*(Xe.y-Je.y))*tn,pn=-(en*(Ze.x-Xe.x)+nn*(Ze.y-Xe.y))*ln,sn=-(en*(Ze.x-He.x)+nn*(Ze.y-He.y))*ln;an<0?an=0:an>1&&(an=1),rn<0?rn=0:rn>1&&(rn=1),pn<0?pn=0:pn>1&&(pn=1),sn<0?sn=0:sn>1&&(sn=1);var on=0,_n=0,hn=an;on=Xe.x+Qe*hn,_n=Xe.y+$e*hn;var xn=0,un=0,dn=rn;xn=Xe.x+Qe*dn,un=Xe.y+$e*dn;var vn=0,cn=0,yn=pn;vn=Ze.x+en*yn,cn=Ze.y+nn*yn;var mn=0,zn=0,fn=sn;mn=Ze.x+en*fn,zn=Ze.y+nn*fn;var bn=0,gn=0;bn=on-Ze.x,gn=_n-Ze.y;var wn=bn*bn+gn*gn,Cn=0,Mn=0;Cn=xn-Je.x,Mn=un-Je.y;var On=Cn*Cn+Mn*Mn,kn=0,Sn=0;kn=vn-Xe.x,Sn=cn-Xe.y;var An=kn*kn+Sn*Sn,Tn=0,En=0;Tn=mn-He.x,En=zn-He.y;var In=Tn*Tn+En*En,jn=0,Nn=0,Dn=null;wn<On?(jn=on,Nn=_n,Dn=Ze):(jn=xn,Nn=un,Dn=Je,wn=On);var Ln=0,Fn=0,Pn=null;if(An<In?(Ln=vn,Fn=cn,Pn=Xe):(Ln=mn,Fn=zn,Pn=He,An=In),wn<An?(B.x=jn,B.y=Nn,V.x=Dn.x,V.y=Dn.y,Ce=Math.sqrt(wn)):(V.x=Ln,V.y=Fn,B.x=Pn.x,B.y=Pn.y,Ce=Math.sqrt(An)),0!=Ce){u.x=V.x-B.x,u.y=V.y-B.y;var Rn=1/Ce;u.x*=Rn,u.y*=Rn,J&&(u.x=-u.x,u.y=-u.y)}F=Ce}else{var Bn=0,Vn=0;Bn=Ue.gp0.x,Vn=Ue.gp0.y;var Gn=0,Un=0;Gn=Ue.gp1.x,Un=Ue.gp1.y;var Yn=0,Kn=0;Yn=Gn-Bn,Kn=Un-Vn;var Wn=Ve.gnormy*Bn-Ve.gnormx*Vn,qn=Ve.gnormy*Gn-Ve.gnormx*Un,Xn=1/(qn-Wn),Hn=(-Ve.tp1-Wn)*Xn;if(Hn>O.epsilon){var Zn=Hn;Bn+=Yn*Zn,Vn+=Kn*Zn}var Jn=(-Ve.tp0-qn)*Xn;if(Jn<-O.epsilon){var Qn=Jn;Gn+=Yn*Qn,Un+=Kn*Qn}var $n=Bn*Ve.gnormx+Vn*Ve.gnormy-Ve.gprojection,ei=Gn*Ve.gnormx+Un*Ve.gnormy-Ve.gprojection;if($n<ei){V.x=Bn,V.y=Vn;var ni=-$n;B.x=V.x+Ve.gnormx*ni,B.y=V.y+Ve.gnormy*ni,F=$n}else{V.x=Gn,V.y=Un;var ii=-ei;B.x=V.x+Ve.gnormx*ii,B.y=V.y+Ve.gnormy*ii,F=ei}}}else F=1e100}else F=1e100}}var ti=F+t,li=p*u.x+s*u.y;if(ti<O.distanceThresholdCCD){var ai=0,ri=0;ai=h.x-r.posx,ri=h.y-r.posy;var pi=li-r.sweep_angvel*(u.y*ai-u.x*ri);if(pi>0&&(e.slipped=!0),pi<=0||ti<.5*O.distanceThresholdCCD)break}var si=(_-li)*n;if(si<=0){d=-1;break}var oi=ti/si;if(oi<1e-6&&(oi=1e-6),(d+=oi)>=1){d=1;var _i=d*n,hi=_i-r.sweepTime;if(0!=hi){r.sweepTime=_i;var xi=hi;if(r.posx+=r.velx*xi,r.posy+=r.vely*xi,0!=r.angvel){var ui=r.sweep_angvel*hi;if(r.rot+=ui,ui*ui>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var di=ui*ui,vi=1-.5*di,ci=1-di*di/8,yi=(vi*r.axisx+ui*r.axisy)*ci;r.axisy=(vi*r.axisy-ui*r.axisx)*ci,r.axisx=yi}}}if(0==l.type)l.worldCOMx=r.posx+(r.axisy*l.localCOMx-r.axisx*l.localCOMy),l.worldCOMy=r.posy+(l.localCOMx*r.axisx+l.localCOMy*r.axisy);else{for(var mi=l.polygon,zi=mi.lverts.next,fi=mi.gverts.next;null!=fi;){var bi=fi,gi=zi;zi=zi.next,bi.x=r.posx+(r.axisy*gi.x-r.axisx*gi.y),bi.y=r.posy+(gi.x*r.axisx+gi.y*r.axisy),fi=fi.next}var wi=mi.edges.head,Ci=mi.gverts.next,Mi=Ci;for(Ci=Ci.next;null!=Ci;){var Oi=Ci,ki=wi.elt;wi=wi.next,ki.gnormx=r.axisy*ki.lnormx-r.axisx*ki.lnormy,ki.gnormy=ki.lnormx*r.axisx+ki.lnormy*r.axisy,ki.gprojection=r.posx*ki.gnormx+r.posy*ki.gnormy+ki.lprojection,ki.tp0=Mi.y*ki.gnormx-Mi.x*ki.gnormy,ki.tp1=Oi.y*ki.gnormx-Oi.x*ki.gnormy,Mi=Oi,Ci=Ci.next}var Si=mi.gverts.next,Ai=wi.elt;wi=wi.next,Ai.gnormx=r.axisy*Ai.lnormx-r.axisx*Ai.lnormy,Ai.gnormy=Ai.lnormx*r.axisx+Ai.lnormy*r.axisy,Ai.gprojection=r.posx*Ai.gnormx+r.posy*Ai.gnormy+Ai.lprojection,Ai.tp0=Mi.y*Ai.gnormx-Mi.x*Ai.gnormy,Ai.tp1=Si.y*Ai.gnormx-Si.x*Ai.gnormy}var Ti,Ei=l,Ii=a,ji=h,Ni=x;if(0==Ei.type&&0==Ii.type){var Di,Li=Ei.circle,Fi=Ii.circle,Pi=0,Ri=0;Pi=Fi.worldCOMx-Li.worldCOMx,Ri=Fi.worldCOMy-Li.worldCOMy;var Bi=Math.sqrt(Pi*Pi+Ri*Ri);if((Di=Bi-(Li.radius+Fi.radius))<1e100){if(0==Bi)Pi=1,Ri=0;else{var Vi=1/Bi;Pi*=Vi,Ri*=Vi}var Gi=Li.radius;ji.x=Li.worldCOMx+Pi*Gi,ji.y=Li.worldCOMy+Ri*Gi;var Ui=-Fi.radius;Ni.x=Fi.worldCOMx+Pi*Ui,Ni.y=Fi.worldCOMy+Ri*Ui,u.x=Pi,u.y=Ri}Ti=Di}else{var Yi=!1;if(0==Ei.type&&1==Ii.type){var Ki=Ei;Ei=Ii,Ii=Ki;var Wi=ji;ji=Ni,Ni=Wi,Yi=!0}if(1==Ei.type&&0==Ii.type){for(var qi=Ei.polygon,Xi=Ii.circle,Hi=-1e100,Zi=null,Ji=qi.edges.head;null!=Ji;){var Qi=Ji.elt,$i=Qi.gnormx*Xi.worldCOMx+Qi.gnormy*Xi.worldCOMy-Qi.gprojection-Xi.radius;if($i>1e100){Hi=$i;break}$i>0?$i>Hi&&(Hi=$i,Zi=Qi):Hi<0&&$i>Hi&&(Hi=$i,Zi=Qi),Ji=Ji.next}if(Hi<1e100){var et=Zi.gp0,nt=Zi.gp1,it=Xi.worldCOMy*Zi.gnormx-Xi.worldCOMx*Zi.gnormy;if(it<=et.y*Zi.gnormx-et.x*Zi.gnormy){var tt=0,lt=0;tt=Xi.worldCOMx-et.x,lt=Xi.worldCOMy-et.y;var at=Math.sqrt(tt*tt+lt*lt);if((Hi=at-Xi.radius)<1e100){if(0==at)tt=1,lt=0;else{var rt=1/at;tt*=rt,lt*=rt}ji.x=et.x+0*tt,ji.y=et.y+0*lt;var pt=-Xi.radius;Ni.x=Xi.worldCOMx+tt*pt,Ni.y=Xi.worldCOMy+lt*pt,u.x=tt,u.y=lt}}else if(it>=nt.y*Zi.gnormx-nt.x*Zi.gnormy){var st=0,ot=0;st=Xi.worldCOMx-nt.x,ot=Xi.worldCOMy-nt.y;var _t=Math.sqrt(st*st+ot*ot);if((Hi=_t-Xi.radius)<1e100){if(0==_t)st=1,ot=0;else{var ht=1/_t;st*=ht,ot*=ht}ji.x=nt.x+0*st,ji.y=nt.y+0*ot;var xt=-Xi.radius;Ni.x=Xi.worldCOMx+st*xt,Ni.y=Xi.worldCOMy+ot*xt,u.x=st,u.y=ot}}else{var ut=-Xi.radius;Ni.x=Xi.worldCOMx+Zi.gnormx*ut,Ni.y=Xi.worldCOMy+Zi.gnormy*ut;var dt=-Hi;ji.x=Ni.x+Zi.gnormx*dt,ji.y=Ni.y+Zi.gnormy*dt,u.x=Zi.gnormx,u.y=Zi.gnormy}}Yi&&(u.x=-u.x,u.y=-u.y),Ti=Hi}else{for(var vt=Ei.polygon,ct=Ii.polygon,yt=-1e100,mt=null,zt=null,ft=0,bt=vt.edges.head;null!=bt;){for(var gt=bt.elt,wt=1e100,Ct=ct.gverts.next;null!=Ct;){var Mt=Ct,Ot=gt.gnormx*Mt.x+gt.gnormy*Mt.y;Ot<wt&&(wt=Ot),Ct=Ct.next}if((wt-=gt.gprojection)>1e100){yt=wt;break}wt>0?wt>yt&&(yt=wt,mt=gt,ft=1):yt<0&&wt>yt&&(yt=wt,mt=gt,ft=1),bt=bt.next}if(yt<1e100){for(var kt=ct.edges.head;null!=kt;){for(var St=kt.elt,At=1e100,Tt=vt.gverts.next;null!=Tt;){var Et=Tt,It=St.gnormx*Et.x+St.gnormy*Et.y;It<At&&(At=It),Tt=Tt.next}if((At-=St.gprojection)>1e100){yt=At;break}At>0?At>yt&&(yt=At,zt=St,ft=2):yt<0&&At>yt&&(yt=At,zt=St,ft=2),kt=kt.next}if(yt<1e100){var jt,Nt;if(1==ft)vt,jt=ct,Nt=mt;else{ct,jt=vt,Nt=zt;var Dt=ji;ji=Ni,Ni=Dt,Yi=!Yi}for(var Lt=null,Ft=1e100,Pt=jt.edges.head;null!=Pt;){var Rt=Pt.elt,Bt=Nt.gnormx*Rt.gnormx+Nt.gnormy*Rt.gnormy;Bt<Ft&&(Ft=Bt,Lt=Rt),Pt=Pt.next}if(Yi?(u.x=-Nt.gnormx,u.y=-Nt.gnormy):(u.x=Nt.gnormx,u.y=Nt.gnormy),yt>=0){var Vt=Nt.gp0,Gt=Nt.gp1,Ut=Lt.gp0,Yt=Lt.gp1,Kt=0,Wt=0,qt=0,Xt=0;Kt=Gt.x-Vt.x,Wt=Gt.y-Vt.y,qt=Yt.x-Ut.x,Xt=Yt.y-Ut.y;var Ht=1/(Kt*Kt+Wt*Wt),Zt=1/(qt*qt+Xt*Xt),Jt=-(Kt*(Vt.x-Ut.x)+Wt*(Vt.y-Ut.y))*Ht,Qt=-(Kt*(Vt.x-Yt.x)+Wt*(Vt.y-Yt.y))*Ht,$t=-(qt*(Ut.x-Vt.x)+Xt*(Ut.y-Vt.y))*Zt,el=-(qt*(Ut.x-Gt.x)+Xt*(Ut.y-Gt.y))*Zt;Jt<0?Jt=0:Jt>1&&(Jt=1),Qt<0?Qt=0:Qt>1&&(Qt=1),$t<0?$t=0:$t>1&&($t=1),el<0?el=0:el>1&&(el=1);var nl=0,il=0,tl=Jt;nl=Vt.x+Kt*tl,il=Vt.y+Wt*tl;var ll=0,al=0,rl=Qt;ll=Vt.x+Kt*rl,al=Vt.y+Wt*rl;var pl=0,sl=0,ol=$t;pl=Ut.x+qt*ol,sl=Ut.y+Xt*ol;var _l=0,hl=0,xl=el;_l=Ut.x+qt*xl,hl=Ut.y+Xt*xl;var ul=0,dl=0;ul=nl-Ut.x,dl=il-Ut.y;var vl=ul*ul+dl*dl,cl=0,yl=0;cl=ll-Yt.x,yl=al-Yt.y;var ml=cl*cl+yl*yl,zl=0,fl=0;zl=pl-Vt.x,fl=sl-Vt.y;var bl=zl*zl+fl*fl,gl=0,wl=0;gl=_l-Gt.x,wl=hl-Gt.y;var Cl=gl*gl+wl*wl,Ml=0,Ol=0,kl=null;vl<ml?(Ml=nl,Ol=il,kl=Ut):(Ml=ll,Ol=al,kl=Yt,vl=ml);var Sl=0,Al=0,Tl=null;if(bl<Cl?(Sl=pl,Al=sl,Tl=Vt):(Sl=_l,Al=hl,Tl=Gt,bl=Cl),vl<bl?(ji.x=Ml,ji.y=Ol,Ni.x=kl.x,Ni.y=kl.y,yt=Math.sqrt(vl)):(Ni.x=Sl,Ni.y=Al,ji.x=Tl.x,ji.y=Tl.y,yt=Math.sqrt(bl)),0!=yt){u.x=Ni.x-ji.x,u.y=Ni.y-ji.y;var El=1/yt;u.x*=El,u.y*=El,Yi&&(u.x=-u.x,u.y=-u.y)}Ti=yt}else{var Il=0,jl=0;Il=Lt.gp0.x,jl=Lt.gp0.y;var Nl=0,Dl=0;Nl=Lt.gp1.x,Dl=Lt.gp1.y;var Ll=0,Fl=0;Ll=Nl-Il,Fl=Dl-jl;var Pl=Nt.gnormy*Il-Nt.gnormx*jl,Rl=Nt.gnormy*Nl-Nt.gnormx*Dl,Bl=1/(Rl-Pl),Vl=(-Nt.tp1-Pl)*Bl;if(Vl>O.epsilon){var Gl=Vl;Il+=Ll*Gl,jl+=Fl*Gl}var Ul=(-Nt.tp0-Rl)*Bl;if(Ul<-O.epsilon){var Yl=Ul;Nl+=Ll*Yl,Dl+=Fl*Yl}var Kl=Il*Nt.gnormx+jl*Nt.gnormy-Nt.gprojection,Wl=Nl*Nt.gnormx+Dl*Nt.gnormy-Nt.gprojection;if(Kl<Wl){Ni.x=Il,Ni.y=jl;var ql=-Kl;ji.x=Ni.x+Nt.gnormx*ql,ji.y=Ni.y+Nt.gnormy*ql,Ti=Kl}else{Ni.x=Nl,Ni.y=Dl;var Xl=-Wl;ji.x=Ni.x+Nt.gnormx*Xl,ji.y=Ni.y+Nt.gnormy*Xl,Ti=Wl}}}else Ti=1e100}else Ti=1e100}}var Hl=Ti+t,Zl=p*u.x+s*u.y;if(Hl<O.distanceThresholdCCD){var Jl=0,Ql=0;Jl=h.x-r.posx,Ql=h.y-r.posy;var $l=Zl-r.sweep_angvel*(u.y*Jl-u.x*Ql);if($l>0&&(e.slipped=!0),$l<=0||Hl<.5*O.distanceThresholdCCD)break}d=-1;break}if(++v>=40){ti>t&&(e.failed=!0);break}}e.toi=d};var Sn=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};Sn.__name__=!0,Sn.prototype={add:function(e){e._inuse=!0;var n=e;return n.next=this.next,this.next=n,this.modified=!0,this.length++,e},insert:function(e,n){n._inuse=!0;var i=n;return null==e?(i.next=this.next,this.next=i):(i.next=e.next,e.next=i),this.pushmod=this.modified=!0,this.length++,i},erase:function(e){var n,i;return null==e?(n=this.next,i=n.next,this.next=i,null==this.next&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0)),n._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},reverse:function(){for(var e=this.next,n=null;null!=e;){var i=e.next;e.next=n,this.next=e,n=e,e=i}this.modified=!0,this.pushmod=!0},iterator_at:function(e){for(var n=this.next;e-- >0&&null!=n;)n=n.next;return n},toString:function(){return"{ x: "+this.x+" y: "+this.y+" }"},__class__:Sn};var An=function(){this._validate=null,this.z=0,this.y=0,this.x=0};An.__name__=!0,An.prototype={__class__:An};var Tn=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.id=0,this.outer_i=null,this.id=c.Interactor(),this.cbsets=new Jn,this.cbTypes=new rn};Tn.__name__=!0,Tn.get=function(e,n){for(var i=e.id<n.id?e.id:n.id,t=e.id<n.id?n.id:e.id,l=e.cbsets.length<n.cbsets.length?e.cbsets:n.cbsets,a=null,r=l.head;null!=r;){var p=r.elt;if(p.id==i&&p.di==t){a=p;break}r=r.next}return a},Tn.prototype={__iaddedToSpace:function(){null!=this.group&&this.group.interactors.add(this);for(var e=this.cbTypes.head;null!=e;){e.elt.interactors.add(this),e=e.next}this.alloc_cbSet()},__iremovedFromSpace:function(){null!=this.group&&this.group.interactors.remove(this);for(var e=this.cbTypes.head;null!=e;){e.elt.interactors.remove(this),e=e.next}this.dealloc_cbSet()},wake:function(){if(null!=this.ishape){var e=this.ishape.body;null!=e&&null!=e.space&&e.space.non_inlined_wake(e)}else null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},setupcbTypes:function(){this.wrap_cbTypes=qi.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=i(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=i(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},wrap_cbTypes_subber:function(e){var n=e.zpp_inner;if(this.cbTypes.has(n)){var i=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=i&&(this.dealloc_cbSet(),n.interactors.remove(this)),this.cbTypes.remove(n),null!=i&&(this.alloc_cbSet(),this.wake())}},wrap_cbTypes_adder:function(e){return this.insert_cbtype(e.zpp_inner),!1},insert_cbtype:function(e){if(!this.cbTypes.has(e)){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=n&&(this.dealloc_cbSet(),e.interactors.add(this));for(var i=null,t=this.cbTypes.head;null!=t;){var l=t.elt;if(e.id<l.id)break;i=t,t=t.next}var a,r=this.cbTypes;null==vi.zpp_pool?a=new vi:(a=vi.zpp_pool,vi.zpp_pool=a.next,a.next=null),a.elt=e;var p=a;null==i?(p.next=r.head,r.head=p):(p.next=i.next,i.next=p),r.pushmod=r.modified=!0,r.length++,null!=n&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=e.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),e.freshInteractorType(this))},dealloc_cbSet:function(){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),e.nullInteractorType(this),0==--this.cbSet.count){e.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;){n.cbTypes.pop_unsafe().cbsets.remove(n)}n.next=$e.zpp_pool,$e.zpp_pool=n}this.cbSet=null}},immutable_midstep:function(e){if(null!=this.ibody){this.ibody}else null!=this.ishape?this.ishape.__immutable_midstep(e):this.icompound.__imutable_midstep(e)},__class__:Tn};var En=function(){this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrap_svel=null,this.svely=0,this.svelx=0,this.kinvely=0,this.kinvelx=0,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.component=null,this.constraints=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,Tn.call(this),this.ibody=this,this.world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=1/0,this.pre_posy=1/0,this.pre_rot=1/0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0;var e;null==mn.zpp_pool?e=new mn:(e=mn.zpp_pool,mn.zpp_pool=e.next,e.next=null),e.minx=0,e.miny=0,e.maxx=0,e.maxy=0,this.aabb=e,this.aabb._immutable=!0;this.aabb._validate=i(this,this.aabb_validate),this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.arbiters=new ni,this.constraints=new f,this.shapes=new Qn,this.wrap_shapes=$i.get(this.shapes),this.wrap_shapes.zpp_inner.adder=i(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=i(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=i(this,this.shapes_invalidate),this.kinematicDelaySleep=!1};En.__name__=!0,En.__static=function(){null==nn.BodyType_STATIC&&(nn.internal=!0,nn.BodyType_STATIC=new Ae,nn.internal=!1);var e=new Oe(nn.BodyType_STATIC),n=e.zpp_inner;return n.world=!0,n.wrap_shapes.zpp_inner.immutable=!0,n.smass=n.imass=n.cmass=n.mass=n.gravMass=0,n.sinertia=n.iinertia=n.cinertia=n.inertia=0,n.cbTypes.clear(),e},En.__super__=Tn,En.prototype=n(Tn.prototype,{invalidate_type:function(){this.invalidate_mass(),this.invalidate_inertia()},invalidate_shapes:function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},atRest:function(e){if(2!=this.type)return this.component.sleeping;var n=O.linearSleepThreshold;n*=n;var i;if(this.velx*this.velx+this.vely*this.vely>n)i=!1;else{var t=0,l=0;if(t=this.posx-this.pre_posx,l=this.posy-this.pre_posy,t*t+l*l>.25*n*e*e)i=!1;else{var a=0,r=0;a=this.aabb.maxx-this.aabb.minx,r=this.aabb.maxy-this.aabb.miny;var p=a*a+r*r,s=O.angularSleepThreshold;if(s*=s,4*this.angvel*this.angvel*p>s)i=!1;else{var o=this.rot-this.pre_rot;i=!(o*o*p>s*e*e)}}}return i||(this.component.waket=this.space.stamp),this.component.waket+O.sleepDelay<this.space.stamp},refreshArbiters:function(){for(var e=this.arbiters.head;null!=e;){e.elt.invalidated=!0,e=e.next}},pos_invalidate:function(e){if(this.immutable_midstep("Body::position"),this.posx!=e.x||this.posy!=e.y){this.posx=e.x,this.posy=e.y;for(var n=this.shapes.head;null!=n;){var i=n.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0,this.wake()}},pos_validate:function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},vel_invalidate:function(e){this.velx=e.x,this.vely=e.y,this.wake()},vel_validate:function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},svel_invalidate:function(e){this.svelx=e.x,this.svely=e.y,this.wake()},svel_validate:function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},setupPosition:function(){var e,n=this.posx,t=this.posy;if(null==tt.poolVec2?e=new fe:(e=tt.poolVec2,tt.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner){var l;null==Sn.zpp_pool?l=new Sn:(l=Sn.zpp_pool,Sn.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=t,e.zpp_inner=l,e.zpp_inner.outer=e}else{var a,r=(e.zpp_inner,e.zpp_inner);if(null!=r._validate&&r._validate(),e.zpp_inner.x==n){var p=e.zpp_inner;null!=p._validate&&p._validate(),a=e.zpp_inner.y==t}else a=!1;if(!a){e.zpp_inner.x=n,e.zpp_inner.y=t;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}e.zpp_inner.weak=!1,this.wrap_pos=e,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=i(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=i(this,this.pos_validate))},setupVelocity:function(){var e,n=this.velx,t=this.vely;if(null==tt.poolVec2?e=new fe:(e=tt.poolVec2,tt.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner){var l;null==Sn.zpp_pool?l=new Sn:(l=Sn.zpp_pool,Sn.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=t,e.zpp_inner=l,e.zpp_inner.outer=e}else{var a,r=(e.zpp_inner,e.zpp_inner);if(null!=r._validate&&r._validate(),e.zpp_inner.x==n){var p=e.zpp_inner;null!=p._validate&&p._validate(),a=e.zpp_inner.y==t}else a=!1;if(!a){e.zpp_inner.x=n,e.zpp_inner.y=t;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}e.zpp_inner.weak=!1,this.wrap_vel=e,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=i(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=i(this,this.vel_validate))},setupsvel:function(){var e,n=this.svelx,t=this.svely;if(null==tt.poolVec2?e=new fe:(e=tt.poolVec2,tt.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner){var l;null==Sn.zpp_pool?l=new Sn:(l=Sn.zpp_pool,Sn.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=t,e.zpp_inner=l,e.zpp_inner.outer=e}else{var a,r=(e.zpp_inner,e.zpp_inner);if(null!=r._validate&&r._validate(),e.zpp_inner.x==n){var p=e.zpp_inner;null!=p._validate&&p._validate(),a=e.zpp_inner.y==t}else a=!1;if(!a){e.zpp_inner.x=n,e.zpp_inner.y=t;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}e.zpp_inner.weak=!1,this.wrap_svel=e,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=i(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=i(this,this.svel_validate))},invalidate_mass:function(){this.zip_mass=!0,this.invalidate_gravMass()},validate_mass:function(){if(this.zip_mass||(this.massMode,!1)){if(this.zip_mass=!1,0==this.massMode){this.cmass=0;for(var e=this.shapes.head;null!=e;){var n=e.elt;n.refmaterial.density=n.material.density,
n.validate_area_inertia(),this.cmass+=n.area*n.material.density,e=e.next}}2!=this.type||this.nomove?(this.mass=1/0,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},invalidate_gravMass:function(){1!=this.gravMassMode&&(this.zip_gravMass=!0),2!=this.gravMassMode&&(this.zip_gravMassScale=!0),this.wake()},validate_gravMass:function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),0==this.gravMassMode?(this.validate_mass(),this.gravMass=this.cmass):2==this.gravMassMode&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},invalidate_inertia:function(){this.zip_inertia=!0,this.wake()},validate_inertia:function(){if(this.zip_inertia||(this.inertiaMode,!1)){if(this.zip_inertia=!1,0==this.inertiaMode){this.cinertia=0;for(var e=this.shapes.head;null!=e;){var n=e.elt;n.refmaterial.density=n.material.density,n.validate_area_inertia(),this.cinertia+=n.inertia*n.area*n.material.density,e=e.next}}2!=this.type||this.norotate?(this.inertia=1/0,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},validate_localCOM:function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var e=0,n=0,i=0,t=this.shapes.head;null!=t;){var l=t.elt;if(l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var a=l.polygon;if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next){a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;a.localCOMx+=1*a.lverts.next.next.x,a.localCOMy+=1*a.lverts.next.next.y;a.localCOMx*=.5,a.localCOMy*=.5}else{a.localCOMx=0,a.localCOMy=0;var r=0,p=a.lverts.next,s=p;p=p.next;var o=p;for(p=p.next;null!=p;){var _=p;r+=o.x*(_.y-s.y);var h=_.y*o.x-_.x*o.y;a.localCOMx+=(o.x+_.x)*h,a.localCOMy+=(o.y+_.y)*h,s=o,o=_,p=p.next}p=a.lverts.next;var x=p;r+=o.x*(x.y-s.y);var u=x.y*o.x-x.x*o.y;a.localCOMx+=(o.x+x.x)*u,a.localCOMy+=(o.y+x.y)*u,s=o,o=x,p=p.next;var d=p;r+=o.x*(d.y-s.y);var v=d.y*o.x-d.x*o.y;a.localCOMx+=(o.x+d.x)*v,a.localCOMy+=(o.y+d.y)*v,r=1/(3*r);var c=r;a.localCOMx*=c,a.localCOMy*=c}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}l.validate_area_inertia();var y=l.area*l.material.density;e+=l.localCOMx*y,n+=l.localCOMy*y,i+=l.area*l.material.density,t=t.next}if(0!=i){var m=1/i;this.localCOMx=e*m,this.localCOMy=n*m}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&0==this.massMode&&(this.zip_mass=!1,this.cmass=i,2==this.type?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=1/0,this.imass=this.smass=0))}},validate_worldCOM:function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},aabb_validate:function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var e=this.shapes.head;null!=e;){var n=e.elt;if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var i=n.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var t=i.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var l=0,a=t.lverts.next,r=a;a=a.next;var p=a;for(a=a.next;null!=a;){var s=a;l+=p.x*(s.y-r.y);var o=s.y*p.x-s.x*p.y;t.localCOMx+=(p.x+s.x)*o,t.localCOMy+=(p.y+s.y)*o,r=p,p=s,a=a.next}a=t.lverts.next;var _=a;l+=p.x*(_.y-r.y);var h=_.y*p.x-_.x*p.y;t.localCOMx+=(p.x+_.x)*h,t.localCOMy+=(p.y+_.y)*h,r=p,p=_,a=a.next;var x=a;l+=p.x*(x.y-r.y);var u=x.y*p.x-x.x*p.y;t.localCOMx+=(p.x+x.x)*u,t.localCOMy+=(p.y+x.y)*u,l=1/(3*l);var d=l;t.localCOMx*=d,t.localCOMy*=d}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var v=i.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var c=i.radius,y=i.radius;i.aabb.minx=i.worldCOMx-c,i.aabb.miny=i.worldCOMy-y,i.aabb.maxx=i.worldCOMx+c,i.aabb.maxy=i.worldCOMy+y}else{var m=n.polygon;if(m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var z=m.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot));for(var f=m.lverts.next,b=m.gverts.next;null!=b;){var g=b,w=f;f=f.next,g.x=m.body.posx+(m.body.axisy*w.x-m.body.axisx*w.y),g.y=m.body.posy+(w.x*m.body.axisx+w.y*m.body.axisy),b=b.next}}var C=m.gverts.next;m.aabb.minx=C.x,m.aabb.miny=C.y,m.aabb.maxx=C.x,m.aabb.maxy=C.y;for(var M=m.gverts.next.next;null!=M;){var O=M;O.x<m.aabb.minx&&(m.aabb.minx=O.x),O.x>m.aabb.maxx&&(m.aabb.maxx=O.x),O.y<m.aabb.miny&&(m.aabb.miny=O.y),O.y>m.aabb.maxy&&(m.aabb.maxy=O.y),M=M.next}}var k=this.aabb,S=n.aabb;S.minx<k.minx&&(k.minx=S.minx),S.maxx>k.maxx&&(k.maxx=S.maxx),S.miny<k.miny&&(k.miny=S.miny),S.maxy>k.maxy&&(k.maxy=S.maxy),e=e.next}}},shapes_adder:function(e){if(e.zpp_inner.body!=this){if(null!=e.zpp_inner.body&&e.zpp_inner.body.wrap_shapes.remove(e),e.zpp_inner.body=this,e.zpp_inner.addedToBody(),null!=this.space){var n=this.space,i=e.zpp_inner,t=i.body;t.world||(t.component.waket=n.stamp+(n.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&n.really_wake(t,!1)),n.bphase.insert(i),i.addedToSpace()}return 1==e.zpp_inner.type&&(e.zpp_inner.polygon.invalidate_gaxi(),e.zpp_inner.polygon.invalidate_gverts()),!0}return!1},shapes_subber:function(e){null!=this.space&&this.space.removed_shape(e.zpp_inner),e.zpp_inner.body=null,e.zpp_inner.removedFromBody()},shapes_invalidate:function(e){this.invalidate_shapes()},addedToSpace:function(){null==Kn.zpp_pool?this.component=new Kn:(this.component=Kn.zpp_pool,Kn.zpp_pool=this.component.next,this.component.next=null);this.component;this.component.isBody=!0,this.component.body=this,this.__iaddedToSpace()},removedFromSpace:function(){for(;null!=this.arbiters.head;){var e=this.arbiters.pop_unsafe(),n=this.space;if(e.cleared=!0,e.b2==this)for(var i=e.b1.arbiters,t=null,l=i.head;null!=l;){if(l.elt==e){var a,r;null==t?(a=i.head,r=a.next,i.head=r,null==i.head&&(i.pushmod=!0)):(a=t.next,r=a.next,t.next=r,null==r&&(i.pushmod=!0));var p=a;p.elt=null,p.next=bi.zpp_pool,bi.zpp_pool=p,i.modified=!0,i.length--,i.pushmod=!0,!0;break}t=l,l=l.next}if(e.b1==this)for(var s=e.b2.arbiters,o=null,_=s.head;null!=_;){if(_.elt==e){var h,x;null==o?(h=s.head,x=h.next,s.head=x,null==s.head&&(s.pushmod=!0)):(h=o.next,x=h.next,o.next=x,null==x&&(s.pushmod=!0));var u=h;u.elt=null,u.next=bi.zpp_pool,bi.zpp_pool=u,s.modified=!0,s.length--,s.pushmod=!0,!0;break}o=_,_=_.next}null!=e.pair&&(e.pair.arb=null,e.pair=null),e.active=!1,n.f_arbiters.modified=!0}var d=this.component;d.body=null,d.constraint=null,d.next=Kn.zpp_pool,Kn.zpp_pool=d,this.component=null,this.__iremovedFromSpace()},__class__:En});var In=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_constraints=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null};In.__name__=!0,In.__super__=Tn,In.prototype=n(Tn.prototype,{__imutable_midstep:function(e){},addedToSpace:function(){this.__iaddedToSpace()},removedFromSpace:function(){this.__iremovedFromSpace()},__class__:In});var jn=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.shapes=null};jn.__name__=!0,jn.prototype={__class__:jn};var Nn=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.shapes=null,this.outer=null,this.next=null,this.shapes=new Qn,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};Nn.__name__=!0,Nn.prototype={wrapper:function(){if(null==this.outer){this.outer=new Re;var e=this.outer.zpp_inner;e.outer=null,e.next=Nn.zpp_pool,Nn.zpp_pool=e,this.outer.zpp_inner=this}return this.outer},set:function(e){this.dynamicFriction=e.dynamicFriction,this.staticFriction=e.staticFriction,this.density=e.density,this.elasticity=e.elasticity,this.rollingFriction=e.rollingFriction},invalidate:function(e){for(var n=this.shapes.head;null!=n;){n.elt.invalidate_material(e),n=n.next}},__class__:Nn};var Dn=function(e){this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,Tn.call(this),this.pairs=new ti,this.ishape=this,this.type=e;var n;null==mn.zpp_pool?n=new mn:(n=mn.zpp_pool,mn.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0;this.aabb._validate=i(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new Nn,this.sweepRadius=this.sweepCoef=0};Dn.__name__=!0,Dn.__super__=Tn,Dn.prototype=n(Tn.prototype,{validate_sweepRadius:function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,0==this.type?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},validate_area_inertia:function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,0==this.type?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},validate_angDrag:function(){(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)&&(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,0==this.type?this.circle.__validate_angDrag():this.polygon.__validate_angDrag())},invalidate_area_inertia:function(){if(this.zip_area_inertia=!0,null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}},invalidate_angDrag:function(){this.zip_angDrag=!0},invalidate_localCOM:function(){if(this.zip_localCOM=!0,this.invalidate_area_inertia(),0==this.type&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0}},invalidate_worldCOM:function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},invalidate_material:function(e){if(0!=(e&Nn.WAKE)&&this.wake(),0!=(e&Nn.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(e&Nn.PROPS)&&null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}0!=(e&Nn.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},invalidate_filter:function(){this.wake()},aabb_validate:function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var e=this.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var n=e.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var i=0,t=n.lverts.next,l=t;t=t.next;var a=t;for(t=t.next;null!=t;){var r=t;i+=a.x*(r.y-l.y);var p=r.y*a.x-r.x*a.y;n.localCOMx+=(a.x+r.x)*p,n.localCOMy+=(a.y+r.y)*p,l=a,a=r,t=t.next}t=n.lverts.next;var s=t;i+=a.x*(s.y-l.y);var o=s.y*a.x-s.x*a.y;n.localCOMx+=(a.x+s.x)*o,n.localCOMy+=(a.y+s.y)*o,l=a,a=s,t=t.next;var _=t;i+=a.x*(_.y-l.y);var h=_.y*a.x-_.x*a.y;n.localCOMx+=(a.x+_.x)*h,n.localCOMy+=(a.y+_.y)*h,i=1/(3*i);var x=i;n.localCOMx*=x,n.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var u=e.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var d=e.radius,v=e.radius;e.aabb.minx=e.worldCOMx-d,e.aabb.miny=e.worldCOMy-v,e.aabb.maxx=e.worldCOMx+d,e.aabb.maxy=e.worldCOMy+v}else{var c=this.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var y=c.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var m=c.lverts.next,z=c.gverts.next;null!=z;){var f=z,b=m;m=m.next,f.x=c.body.posx+(c.body.axisy*b.x-c.body.axisx*b.y),f.y=c.body.posy+(b.x*c.body.axisx+b.y*c.body.axisy),z=z.next}}var g=c.gverts.next;c.aabb.minx=g.x,c.aabb.miny=g.y,c.aabb.maxx=g.x,c.aabb.maxy=g.y;for(var w=c.gverts.next.next;null!=w;){var C=w;C.x<c.aabb.minx&&(c.aabb.minx=C.x),C.x>c.aabb.maxx&&(c.aabb.maxx=C.x),C.y<c.aabb.miny&&(c.aabb.miny=C.y),C.y>c.aabb.maxy&&(c.aabb.maxy=C.y),w=w.next}}},setMaterial:function(e){this.material!=e&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=e,null!=this.body&&null!=this.body.space&&e.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},setFilter:function(e){this.filter!=e&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=e,null!=this.body&&null!=this.body.space&&e.shapes.add(this),this.wake())},__immutable_midstep:function(e){},addedToBody:function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},removedFromBody:function(){},addedToSpace:function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},removedFromSpace:function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},__class__:Dn});var Ln=function(){this.radius=0};Ln.__name__=!0,Ln.__super__=Dn,Ln.prototype=n(Dn.prototype,{__validate_sweepRadius:function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},__validate_area_inertia:function(){var e=this.radius*this.radius;this.area=e*Math.PI,this.inertia=.5*e+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},__validate_angDrag:function(){var e=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,n=this.radius*this.radius,i=this.material.dynamicFriction*O.fluidAngularDragFriction;this.angDrag=(e+2*n)*i+.5*O.fluidAngularDrag*(1+O.fluidVacuumDrag)*e,this.angDrag/=2*(e+.5*n)},__class__:Ln});var Fn=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};Fn.__name__=!0,Fn.prototype={wrapper:function(){return null==this.outer&&(Fn.internal=!0,this.outer=new Ge,Fn.internal=!1,this.outer.zpp_inner=this),this.outer},__class__:Fn};var Pn=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,Dn.call(this,1),this.polygon=this,this.lverts=new Sn,this.gverts=new Sn,this.edges=new li,this.edgeCnt=0};Pn.__name__=!0,Pn.__super__=Dn,Pn.prototype=n(Dn.prototype,{lverts_pa_invalidate:function(e){this.invalidate_lverts()},gverts_pa_validate:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var n=this.lverts.next,i=this.gverts.next;null!=i;){var t=i,l=n;n=n.next,t.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),t.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}},lverts_post_adder:function(e){e.zpp_inner._invalidate=i(this,this.lverts_pa_invalidate);for(var n=null,t=null,l=this.lverts.next;null!=l;){if(l==e.zpp_inner)break;n=null==n?this.gverts.next:n.next,t=null==t?this.edges.head:t.next,l=l.next}var a;null==Sn.zpp_pool?a=new Sn:(a=Sn.zpp_pool,Sn.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!0,a.x=0,a.y=0;var r=a;if(this.gverts.insert(n,r),null!=this.lverts.next.next)if(null==this.lverts.next.next.next){var p;null==Fn.zpp_pool?p=new Fn:(p=Fn.zpp_pool,Fn.zpp_pool=p.next,p.next=null),p.polygon=this,this.edges.add(p);var s;null==Fn.zpp_pool?s=new Fn:(s=Fn.zpp_pool,Fn.zpp_pool=s.next,s.next=null),s.polygon=this,this.edges.add(s),this.edgeCnt+=2}else{var o;null==Fn.zpp_pool?o=new Fn:(o=Fn.zpp_pool,Fn.zpp_pool=o.next,o.next=null),o.polygon=this,this.edges.insert(t,o),this.edgeCnt++}r._validate=i(this,this.gverts_pa_validate)},lverts_subber:function(e){this.cleanup_lvert(e.zpp_inner)},lverts_invalidate:function(e){this.invalidate_lverts()},lverts_validate:function(){this.validate_lverts()},getlverts:function(){this.wrap_lverts=Vi.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=i(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=i(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=i(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=i(this,this.lverts_validate),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},invalidate_lverts:function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},invalidate_laxi:function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},invalidate_gverts:function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},invalidate_gaxi:function(){this.zip_gaxi=!0},validate_lverts:function(){this.zip_lverts&&(this.zip_lverts=!1,this.lverts.length>2&&(this.validate_area_inertia(),this.area<0&&(this.reverse_vertices(),this.area=-this.area)))},cleanup_lvert:function(e){for(var n=null,i=null,t=this.lverts.next;null!=t;){if(t==e)break;n=null==n?this.gverts.next:n.next,i=null==i?this.edges.head:i.next,t=t.next}var l=null==n?this.gverts.next:n.next;this.gverts.erase(n);var a=l;if(null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Sn.zpp_pool,Sn.zpp_pool=a,2==this.edgeCnt){var r=this.edges.pop_unsafe(),p=r;p.polygon=null,p.next=Fn.zpp_pool,Fn.zpp_pool=p,r=this.edges.pop_unsafe();var s=r;s.polygon=null,s.next=Fn.zpp_pool,Fn.zpp_pool=s,this.edgeCnt=0}else if(0!=this.edgeCnt){var o=null==i?this.edges.head.elt:i.next.elt;this.edges.erase(i);var _=o;_.polygon=null,_.next=Fn.zpp_pool,Fn.zpp_pool=_,this.edgeCnt--}},splice_collinear_real:function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var e=null,n=this.lverts.next;null!=n;){var i=null==n.next?this.lverts.next:n.next,t=n,l=i,a=0,r=0;a=t.x-l.x,r=t.y-l.y,a*a+r*r<O.epsilon*O.epsilon?(this.cleanup_lvert(n),n=this.lverts.erase(e)):(e=n,n=n.next)}if(null!=this.lverts.next)for(var p;;){p=!1;for(var s=this.lverts.next;null!=s;){var o=null==s.next?this.lverts.next:s.next,_=null==o.next?this.lverts.next:o.next,h=s,x=o,u=_,d=0,v=0;d=x.x-h.x,v=x.y-h.y;var c=0,y=0;c=u.x-x.x,y=u.y-x.y;var m=y*d-c*v;m*m>=O.epsilon*O.epsilon?s=s.next:(this.cleanup_lvert(o),this.lverts.erase(null==s.next?null:s),p=!0,s=s.next)}if(!p)break}}},reverse_vertices:function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse();var e=this.edges.iterator_at(this.edgeCnt-1),n=this.edges.pop_unsafe();this.edges.insert(e,n),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},validate_laxi:function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();var e=this.edges.head,n=this.lverts.next,i=n;for(n=n.next;null!=n;){var t=n,l=e.elt;e=e.next,l.lp0=i,l.lp1=t;var a=0,r=0;a=i.x-t.x,r=i.y-t.y;var p=Math.sqrt(a*a+r*r);l.length=p;var s=1/p;a*=s,r*=s;var o=a;a=-r,r=o,l.lprojection=a*i.x+r*i.y,l.lnormx=a,l.lnormy=r,null!=l.wrap_lnorm&&(l.wrap_lnorm.zpp_inner.x=a,l.wrap_lnorm.zpp_inner.y=r),i=t,n=n.next}var _=this.lverts.next,h=e.elt;e=e.next,h.lp0=i,h.lp1=_;var x=0,u=0;x=i.x-_.x,u=i.y-_.y;var d=Math.sqrt(x*x+u*u);h.length=d;var v=1/d;x*=v,u*=v;var c=x;x=-u,u=c,h.lprojection=x*i.x+u*i.y,h.lnormx=x,h.lnormy=u,null!=h.wrap_lnorm&&(h.wrap_lnorm.zpp_inner.x=x,h.wrap_lnorm.zpp_inner.y=u)}},__validate_sweepRadius:function(){var e=0,n=0;this.validate_laxi();for(var i=this.lverts.next;null!=i;){var t=i,l=t.x*t.x+t.y*t.y;l>e&&(e=l),i=i.next}for(var a=this.edges.head;null!=a;){var r=a.elt;if(r.lprojection<n&&(n=r.lprojection)<0)break;a=a.next}n<0&&(n=0),this.sweepRadius=Math.sqrt(e),this.sweepCoef=this.sweepRadius-n},__validate_area_inertia:function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{this.area=0;var e=0,n=0,i=this.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var a=i,r=l.y*t.x-l.x*t.y;e+=r*(l.x*l.x+l.y*l.y+(l.x*t.x+l.y*t.y)+(t.x*t.x+t.y*t.y)),n+=r,this.area+=l.x*(a.y-t.y),t=l,l=a,i=i.next}i=this.lverts.next;var p=i,s=l.y*t.x-l.x*t.y;e+=s*(l.x*l.x+l.y*l.y+(l.x*t.x+l.y*t.y)+(t.x*t.x+t.y*t.y)),n+=s,this.area+=l.x*(p.y-t.y),t=l,l=p,i=i.next;var o=i,_=l.y*t.x-l.x*t.y;e+=_*(l.x*l.x+l.y*l.y+(l.x*t.x+l.y*t.y)+(t.x*t.x+t.y*t.y)),n+=_,this.area+=l.x*(o.y-t.y),this.inertia=e/(6*n),this.area*=.5,this.area<0&&(this.area=-this.area,this.reverse_vertices())}},__validate_angDrag:function(){this.validate_area_inertia(),this.validate_laxi();for(var e=0,n=this.edges.head,i=0,t=this.lverts.next,l=t,a=t.next;null!=a;){var r=a,p=n.elt;n=n.next,i+=p.length;var s=0,o=0;s=r.x-l.x,o=r.y-l.y,e+=p.length*O.fluidAngularDragFriction*this.material.dynamicFriction*p.lprojection*p.lprojection;var _=-(l.y*p.lnormx-l.x*p.lnormy)/(o*p.lnormx-s*p.lnormy);if(_>0){var h=_>1?1:_,x=0,u=0;x=l.x,u=l.y;var d=h;x+=s*d,u+=o*d;var v=p.lnormy*l.x-p.lnormx*l.y,c=p.lnormy*x-p.lnormx*u;e+=(c*c*c-v*v*v)/(3*(c-v))*h*p.length*O.fluidAngularDrag}if(_<1){var y=_<0?0:_,m=0,z=0;m=l.x,z=l.y;var f=y;m+=s*f,z+=o*f;var b=p.lnormy*m-p.lnormx*z,g=p.lnormy*r.x-p.lnormx*r.y;e+=(g*g*g-b*b*b)/(3*(g-b))*O.fluidVacuumDrag*(1-y)*p.length*O.fluidAngularDrag}t=a,l=r,a=a.next}for(;;){a=this.lverts.next;var w=a,C=n.elt;n=n.next,i+=C.length;var M=0,k=0;M=w.x-l.x,k=w.y-l.y,e+=C.length*O.fluidAngularDragFriction*this.material.dynamicFriction*C.lprojection*C.lprojection;var S=-(l.y*C.lnormx-l.x*C.lnormy)/(k*C.lnormx-M*C.lnormy);if(S>0){var A=S>1?1:S,T=0,E=0;T=l.x,E=l.y;var I=A;T+=M*I,E+=k*I;var j=C.lnormy*l.x-C.lnormx*l.y,N=C.lnormy*T-C.lnormx*E;e+=(N*N*N-j*j*j)/(3*(N-j))*A*C.length*O.fluidAngularDrag}if(S<1){var D=S<0?0:S,L=0,F=0;L=l.x,F=l.y;var P=D;L+=M*P,F+=k*P;var R=C.lnormy*L-C.lnormx*F,B=C.lnormy*w.x-C.lnormx*w.y;e+=(B*B*B-R*R*R)/(3*(B-R))*O.fluidVacuumDrag*(1-D)*C.length*O.fluidAngularDrag}break}this.angDrag=e/(this.inertia*i)},__class__:Pn});var Rn=function(){this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};Rn.__name__=!0,Rn.prototype={insert:function(e){this.is_sweep?this.sweep.__insert(e):this.dynab.__insert(e)},remove:function(e){this.is_sweep?this.sweep.__remove(e):this.dynab.__remove(e)},sync:function(e){if(this.is_sweep){if(!this.sweep.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var n=e.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var t=0,l=i.lverts.next,a=l;l=l.next;var r=l;for(l=l.next;null!=l;){var p=l;t+=r.x*(p.y-a.y);var s=p.y*r.x-p.x*r.y;i.localCOMx+=(r.x+p.x)*s,i.localCOMy+=(r.y+p.y)*s,a=r,r=p,l=l.next}l=i.lverts.next;var o=l;t+=r.x*(o.y-a.y);var _=o.y*r.x-o.x*r.y;i.localCOMx+=(r.x+o.x)*_,i.localCOMy+=(r.y+o.y)*_,a=r,r=o,l=l.next;var h=l;t+=r.x*(h.y-a.y);var x=h.y*r.x-h.x*r.y;i.localCOMx+=(r.x+h.x)*x,i.localCOMy+=(r.y+h.y)*x,t=1/(3*t);var u=t;i.localCOMx*=u,i.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var d=n.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var v=n.radius,c=n.radius;n.aabb.minx=n.worldCOMx-v,n.aabb.miny=n.worldCOMy-c,n.aabb.maxx=n.worldCOMx+v,n.aabb.maxy=n.worldCOMy+c}else{var y=e.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var m=y.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var z=y.lverts.next,f=y.gverts.next;null!=f;){var b=f,g=z;z=z.next,b.x=y.body.posx+(y.body.axisy*g.x-y.body.axisx*g.y),b.y=y.body.posy+(g.x*y.body.axisx+g.y*y.body.axisy),f=f.next}}var w=y.gverts.next;y.aabb.minx=w.x,y.aabb.miny=w.y,y.aabb.maxx=w.x,y.aabb.maxy=w.y;for(var C=y.gverts.next.next;null!=C;){var M=C;M.x<y.aabb.minx&&(y.aabb.minx=M.x),M.x>y.aabb.maxx&&(y.aabb.maxx=M.x),M.y<y.aabb.miny&&(y.aabb.miny=M.y),M.y>y.aabb.maxy&&(y.aabb.maxy=M.y),C=C.next}}}else{var O=this.dynab,k=e.node;if(!k.synced){if(!O.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var S=e.circle;if(S.zip_worldCOM&&null!=S.body){if(S.zip_worldCOM=!1,S.zip_localCOM){if(S.zip_localCOM=!1,1==S.type){var A=S.polygon;if(null==A.lverts.next.next)A.localCOMx=A.lverts.next.x,A.localCOMy=A.lverts.next.y;else if(null==A.lverts.next.next.next){A.localCOMx=A.lverts.next.x,A.localCOMy=A.lverts.next.y;A.localCOMx+=1*A.lverts.next.next.x,A.localCOMy+=1*A.lverts.next.next.y;A.localCOMx*=.5,A.localCOMy*=.5}else{A.localCOMx=0,A.localCOMy=0;var T=0,E=A.lverts.next,I=E;E=E.next;var j=E;for(E=E.next;null!=E;){var N=E;T+=j.x*(N.y-I.y);var D=N.y*j.x-N.x*j.y;A.localCOMx+=(j.x+N.x)*D,A.localCOMy+=(j.y+N.y)*D,I=j,j=N,E=E.next}E=A.lverts.next;var L=E;T+=j.x*(L.y-I.y);var F=L.y*j.x-L.x*j.y;A.localCOMx+=(j.x+L.x)*F,A.localCOMy+=(j.y+L.y)*F,I=j,j=L,E=E.next;var P=E;T+=j.x*(P.y-I.y);var R=P.y*j.x-P.x*j.y;A.localCOMx+=(j.x+P.x)*R,A.localCOMy+=(j.y+P.y)*R,T=1/(3*T);var B=T;A.localCOMx*=B,A.localCOMy*=B}}null!=S.wrap_localCOM&&(S.wrap_localCOM.zpp_inner.x=S.localCOMx,S.wrap_localCOM.zpp_inner.y=S.localCOMy)}var V=S.body;V.zip_axis&&(V.zip_axis=!1,V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)),S.worldCOMx=S.body.posx+(S.body.axisy*S.localCOMx-S.body.axisx*S.localCOMy),S.worldCOMy=S.body.posy+(S.localCOMx*S.body.axisx+S.localCOMy*S.body.axisy)}var G=S.radius,U=S.radius;S.aabb.minx=S.worldCOMx-G,S.aabb.miny=S.worldCOMy-U,S.aabb.maxx=S.worldCOMx+G,S.aabb.maxy=S.worldCOMy+U}else{var Y=e.polygon;if(Y.zip_gverts&&null!=Y.body){Y.zip_gverts=!1,Y.validate_lverts();var K=Y.body;K.zip_axis&&(K.zip_axis=!1,K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot));for(var W=Y.lverts.next,q=Y.gverts.next;null!=q;){var X=q,H=W;W=W.next,X.x=Y.body.posx+(Y.body.axisy*H.x-Y.body.axisx*H.y),X.y=Y.body.posy+(H.x*Y.body.axisx+H.y*Y.body.axisy),q=q.next}}var Z=Y.gverts.next;Y.aabb.minx=Z.x,Y.aabb.miny=Z.y,Y.aabb.maxx=Z.x,Y.aabb.maxy=Z.y;for(var J=Y.gverts.next.next;null!=J;){var Q=J;Q.x<Y.aabb.minx&&(Y.aabb.minx=Q.x),Q.x>Y.aabb.maxx&&(Y.aabb.maxx=Q.x),Q.y<Y.aabb.miny&&(Y.aabb.miny=Q.y),Q.y>Y.aabb.maxy&&(Y.aabb.maxy=Q.y),J=J.next}}var $;if(k.dyn==(1!=e.body.type&&!e.body.component.sleeping)){var ee=k.aabb,ne=e.aabb;$=!(ne.minx>=ee.minx&&ne.miny>=ee.miny&&ne.maxx<=ee.maxx&&ne.maxy<=ee.maxy)}else $=!0;$&&(k.synced=!0,k.snext=O.syncs,O.syncs=k)}}},broadphase:function(e,n){},__class__:Rn};var Bn=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};Bn.__name__=!0,Bn.prototype={__class__:Bn};var Vn=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};Vn.__name__=!0,Vn.prototype={__class__:Vn};var Gn=function(){this.root=null};Gn.__name__=!0,Gn.prototype={removeLeaf:function(e){if(e==this.root)this.root=null;else{var n=e.parent,i=n.parent,t=n.child1==e?n.child2:n.child1;if(null!=i){i.child1==n?i.child1=t:i.child2=t,t.parent=i;var l=n;l.height=-1;var a=l.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=mn.zpp_pool,mn.zpp_pool=a,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=Bn.zpp_pool,Bn.zpp_pool=l;for(var r=i;null!=r;){if(null==r.child1||r.height<2)r=r;else{var p=r.child1,s=r.child2,o=s.height-p.height;if(o>1){var _=s.child1,h=s.child2;if(s.child1=r,s.parent=r.parent,r.parent=s,null!=s.parent?s.parent.child1==r?s.parent.child1=s:s.parent.child2=s:this.root=s,_.height>h.height){s.child2=_,r.child2=h,h.parent=r;var x=r.aabb,u=p.aabb,d=h.aabb;x.minx=u.minx<d.minx?u.minx:d.minx,x.miny=u.miny<d.miny?u.miny:d.miny,x.maxx=u.maxx>d.maxx?u.maxx:d.maxx,x.maxy=u.maxy>d.maxy?u.maxy:d.maxy;var v=s.aabb,c=r.aabb,y=_.aabb;v.minx=c.minx<y.minx?c.minx:y.minx,v.miny=c.miny<y.miny?c.miny:y.miny,v.maxx=c.maxx>y.maxx?c.maxx:y.maxx,v.maxy=c.maxy>y.maxy?c.maxy:y.maxy;var m=p.height,z=h.height;r.height=1+(m>z?m:z);var f=r.height,b=_.height;s.height=1+(f>b?f:b)}else{s.child2=h,r.child2=_,_.parent=r;var g=r.aabb,w=p.aabb,C=_.aabb;g.minx=w.minx<C.minx?w.minx:C.minx,g.miny=w.miny<C.miny?w.miny:C.miny,g.maxx=w.maxx>C.maxx?w.maxx:C.maxx,g.maxy=w.maxy>C.maxy?w.maxy:C.maxy;var M=s.aabb,O=r.aabb,k=h.aabb;M.minx=O.minx<k.minx?O.minx:k.minx,M.miny=O.miny<k.miny?O.miny:k.miny,M.maxx=O.maxx>k.maxx?O.maxx:k.maxx,M.maxy=O.maxy>k.maxy?O.maxy:k.maxy;var S=p.height,A=_.height;r.height=1+(S>A?S:A);var T=r.height,E=h.height;s.height=1+(T>E?T:E)}r=s}else if(o<-1){var I=p.child1,j=p.child2;if(p.child1=r,p.parent=r.parent,r.parent=p,null!=p.parent?p.parent.child1==r?p.parent.child1=p:p.parent.child2=p:this.root=p,I.height>j.height){p.child2=I,r.child1=j,j.parent=r;var N=r.aabb,D=s.aabb,L=j.aabb;N.minx=D.minx<L.minx?D.minx:L.minx,N.miny=D.miny<L.miny?D.miny:L.miny,N.maxx=D.maxx>L.maxx?D.maxx:L.maxx,N.maxy=D.maxy>L.maxy?D.maxy:L.maxy;var F=p.aabb,P=r.aabb,R=I.aabb;F.minx=P.minx<R.minx?P.minx:R.minx,F.miny=P.miny<R.miny?P.miny:R.miny,F.maxx=P.maxx>R.maxx?P.maxx:R.maxx,F.maxy=P.maxy>R.maxy?P.maxy:R.maxy;var B=s.height,V=j.height;r.height=1+(B>V?B:V);var G=r.height,U=I.height
;p.height=1+(G>U?G:U)}else{p.child2=j,r.child1=I,I.parent=r;var Y=r.aabb,K=s.aabb,W=I.aabb;Y.minx=K.minx<W.minx?K.minx:W.minx,Y.miny=K.miny<W.miny?K.miny:W.miny,Y.maxx=K.maxx>W.maxx?K.maxx:W.maxx,Y.maxy=K.maxy>W.maxy?K.maxy:W.maxy;var q=p.aabb,X=r.aabb,H=j.aabb;q.minx=X.minx<H.minx?X.minx:H.minx,q.miny=X.miny<H.miny?X.miny:H.miny,q.maxx=X.maxx>H.maxx?X.maxx:H.maxx,q.maxy=X.maxy>H.maxy?X.maxy:H.maxy;var Z=s.height,J=I.height;r.height=1+(Z>J?Z:J);var Q=r.height,$=j.height;p.height=1+(Q>$?Q:$)}r=p}else r=r}var ee=r.child1,ne=r.child2,ie=r.aabb,te=ee.aabb,le=ne.aabb;ie.minx=te.minx<le.minx?te.minx:le.minx,ie.miny=te.miny<le.miny?te.miny:le.miny,ie.maxx=te.maxx>le.maxx?te.maxx:le.maxx,ie.maxy=te.maxy>le.maxy?te.maxy:le.maxy;var ae=ee.height,re=ne.height;r.height=1+(ae>re?ae:re),r=r.parent}}else{this.root=t,t.parent=null;var pe=n;pe.height=-1;var se=pe.aabb;null!=se.outer&&(se.outer.zpp_inner=null,se.outer=null),se.wrap_min=se.wrap_max=null,se._invalidate=null,se._validate=null,se.next=mn.zpp_pool,mn.zpp_pool=se,pe.child1=pe.child2=pe.parent=null,pe.next=null,pe.snext=null,pe.mnext=null,pe.next=Bn.zpp_pool,Bn.zpp_pool=pe}}},__class__:Gn};var Un=function(e){this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,Rn.call(this),this.space=e,this.is_sweep=!1,this.dynab=this,this.stree=new Gn,this.dtree=new Gn};Un.__name__=!0,Un.__super__=Rn,Un.prototype=n(Rn.prototype,{__insert:function(e){var n;null==Bn.zpp_pool?n=new Bn:(n=Bn.zpp_pool,Bn.zpp_pool=n.next,n.next=null),null==mn.zpp_pool?n.aabb=new mn:(n.aabb=mn.zpp_pool,mn.zpp_pool=n.aabb.next,n.aabb.next=null);n.aabb;n.moved=!1,n.synced=!1,n.first_sync=!1,n.shape=e,e.node=n,n.synced=!0,n.first_sync=!0,n.snext=this.syncs,this.syncs=n},__remove:function(e){var n=e.node;if(n.first_sync||(n.dyn?this.dtree.removeLeaf(n):this.stree.removeLeaf(n)),e.node=null,n.synced){for(var i=null,t=this.syncs;null!=t&&t!=n;)i=t,t=t.snext;null==i?this.syncs=t.snext:i.snext=t.snext,t.snext=null,n.synced=!1}if(n.moved){for(var l=null,a=this.moves;null!=a&&a!=n;)l=a,a=a.mnext;null==l?this.moves=a.mnext:l.mnext=a.mnext,a.mnext=null,n.moved=!1}for(var r=null,p=this.pairs;null!=p;){var s=p.next;if(p.n1!=n&&p.n2!=n)r=p,p=s;else{null==r?this.pairs=s:r.next=s,null!=p.arb&&(p.arb.pair=null),p.arb=null,p.n1.shape.pairs.remove(p),p.n2.shape.pairs.remove(p);var o=p;o.n1=o.n2=null,o.sleeping=!1,o.next=Vn.zpp_pool,Vn.zpp_pool=o,p=s}}for(;null!=e.pairs.head;){var _=e.pairs.pop_unsafe();_.n1==n?_.n2.shape.pairs.remove(_):_.n1.shape.pairs.remove(_),null!=_.arb&&(_.arb.pair=null),_.arb=null;var h=_;h.n1=h.n2=null,h.sleeping=!1,h.next=Vn.zpp_pool,Vn.zpp_pool=h}var x=n;x.height=-1;var u=x.aabb;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u.wrap_min=u.wrap_max=null,u._invalidate=null,u._validate=null,u.next=mn.zpp_pool,mn.zpp_pool=u,x.child1=x.child2=x.parent=null,x.next=null,x.snext=null,x.mnext=null,x.next=Bn.zpp_pool,Bn.zpp_pool=x},broadphase:function(e,n){for(var i=this.syncs;null!=i;){var t=i.shape;if(i.first_sync)i.first_sync=!1;else{var l=i.dyn?this.dtree:this.stree;if(i==l.root)l.root=null;else{var a=i.parent,r=a.parent,p=a.child1==i?a.child2:a.child1;if(null!=r){r.child1==a?r.child1=p:r.child2=p,p.parent=r;var s=a;s.height=-1;var o=s.aabb;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o.wrap_min=o.wrap_max=null,o._invalidate=null,o._validate=null,o.next=mn.zpp_pool,mn.zpp_pool=o,s.child1=s.child2=s.parent=null,s.next=null,s.snext=null,s.mnext=null,s.next=Bn.zpp_pool,Bn.zpp_pool=s;for(var _=r;null!=_;){if(null==_.child1||_.height<2)_=_;else{var h=_.child1,x=_.child2,u=x.height-h.height;if(u>1){var d=x.child1,v=x.child2;if(x.child1=_,x.parent=_.parent,_.parent=x,null!=x.parent?x.parent.child1==_?x.parent.child1=x:x.parent.child2=x:l.root=x,d.height>v.height){x.child2=d,_.child2=v,v.parent=_;var c=_.aabb,y=h.aabb,m=v.aabb;c.minx=y.minx<m.minx?y.minx:m.minx,c.miny=y.miny<m.miny?y.miny:m.miny,c.maxx=y.maxx>m.maxx?y.maxx:m.maxx,c.maxy=y.maxy>m.maxy?y.maxy:m.maxy;var z=x.aabb,f=_.aabb,b=d.aabb;z.minx=f.minx<b.minx?f.minx:b.minx,z.miny=f.miny<b.miny?f.miny:b.miny,z.maxx=f.maxx>b.maxx?f.maxx:b.maxx,z.maxy=f.maxy>b.maxy?f.maxy:b.maxy;var g=h.height,w=v.height;_.height=1+(g>w?g:w);var C=_.height,M=d.height;x.height=1+(C>M?C:M)}else{x.child2=v,_.child2=d,d.parent=_;var O=_.aabb,k=h.aabb,S=d.aabb;O.minx=k.minx<S.minx?k.minx:S.minx,O.miny=k.miny<S.miny?k.miny:S.miny,O.maxx=k.maxx>S.maxx?k.maxx:S.maxx,O.maxy=k.maxy>S.maxy?k.maxy:S.maxy;var A=x.aabb,T=_.aabb,E=v.aabb;A.minx=T.minx<E.minx?T.minx:E.minx,A.miny=T.miny<E.miny?T.miny:E.miny,A.maxx=T.maxx>E.maxx?T.maxx:E.maxx,A.maxy=T.maxy>E.maxy?T.maxy:E.maxy;var I=h.height,j=d.height;_.height=1+(I>j?I:j);var N=_.height,D=v.height;x.height=1+(N>D?N:D)}_=x}else if(u<-1){var L=h.child1,F=h.child2;if(h.child1=_,h.parent=_.parent,_.parent=h,null!=h.parent?h.parent.child1==_?h.parent.child1=h:h.parent.child2=h:l.root=h,L.height>F.height){h.child2=L,_.child1=F,F.parent=_;var P=_.aabb,R=x.aabb,B=F.aabb;P.minx=R.minx<B.minx?R.minx:B.minx,P.miny=R.miny<B.miny?R.miny:B.miny,P.maxx=R.maxx>B.maxx?R.maxx:B.maxx,P.maxy=R.maxy>B.maxy?R.maxy:B.maxy;var V=h.aabb,G=_.aabb,U=L.aabb;V.minx=G.minx<U.minx?G.minx:U.minx,V.miny=G.miny<U.miny?G.miny:U.miny,V.maxx=G.maxx>U.maxx?G.maxx:U.maxx,V.maxy=G.maxy>U.maxy?G.maxy:U.maxy;var Y=x.height,K=F.height;_.height=1+(Y>K?Y:K);var W=_.height,q=L.height;h.height=1+(W>q?W:q)}else{h.child2=F,_.child1=L,L.parent=_;var X=_.aabb,H=x.aabb,Z=L.aabb;X.minx=H.minx<Z.minx?H.minx:Z.minx,X.miny=H.miny<Z.miny?H.miny:Z.miny,X.maxx=H.maxx>Z.maxx?H.maxx:Z.maxx,X.maxy=H.maxy>Z.maxy?H.maxy:Z.maxy;var J=h.aabb,Q=_.aabb,$=F.aabb;J.minx=Q.minx<$.minx?Q.minx:$.minx,J.miny=Q.miny<$.miny?Q.miny:$.miny,J.maxx=Q.maxx>$.maxx?Q.maxx:$.maxx,J.maxy=Q.maxy>$.maxy?Q.maxy:$.maxy;var ee=x.height,ne=L.height;_.height=1+(ee>ne?ee:ne);var ie=_.height,te=F.height;h.height=1+(ie>te?ie:te)}_=h}else _=_}var le=_.child1,ae=_.child2,re=_.aabb,pe=le.aabb,se=ae.aabb;re.minx=pe.minx<se.minx?pe.minx:se.minx,re.miny=pe.miny<se.miny?pe.miny:se.miny,re.maxx=pe.maxx>se.maxx?pe.maxx:se.maxx,re.maxy=pe.maxy>se.maxy?pe.maxy:se.maxy;var oe=le.height,_e=ae.height;_.height=1+(oe>_e?oe:_e),_=_.parent}}else{l.root=p,p.parent=null;var he=a;he.height=-1;var xe=he.aabb;null!=xe.outer&&(xe.outer.zpp_inner=null,xe.outer=null),xe.wrap_min=xe.wrap_max=null,xe._invalidate=null,xe._validate=null,xe.next=mn.zpp_pool,mn.zpp_pool=xe,he.child1=he.child2=he.parent=null,he.next=null,he.snext=null,he.mnext=null,he.next=Bn.zpp_pool,Bn.zpp_pool=he}}}var ue=i.aabb;if(!e.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var de=t.circle;if(de.zip_worldCOM&&null!=de.body){if(de.zip_worldCOM=!1,de.zip_localCOM){if(de.zip_localCOM=!1,1==de.type){var ve=de.polygon;if(null==ve.lverts.next.next)ve.localCOMx=ve.lverts.next.x,ve.localCOMy=ve.lverts.next.y;else if(null==ve.lverts.next.next.next){ve.localCOMx=ve.lverts.next.x,ve.localCOMy=ve.lverts.next.y;ve.localCOMx+=1*ve.lverts.next.next.x,ve.localCOMy+=1*ve.lverts.next.next.y;ve.localCOMx*=.5,ve.localCOMy*=.5}else{ve.localCOMx=0,ve.localCOMy=0;var ce=0,ye=ve.lverts.next,me=ye;ye=ye.next;var ze=ye;for(ye=ye.next;null!=ye;){var fe=ye;ce+=ze.x*(fe.y-me.y);var be=fe.y*ze.x-fe.x*ze.y;ve.localCOMx+=(ze.x+fe.x)*be,ve.localCOMy+=(ze.y+fe.y)*be,me=ze,ze=fe,ye=ye.next}ye=ve.lverts.next;var ge=ye;ce+=ze.x*(ge.y-me.y);var we=ge.y*ze.x-ge.x*ze.y;ve.localCOMx+=(ze.x+ge.x)*we,ve.localCOMy+=(ze.y+ge.y)*we,me=ze,ze=ge,ye=ye.next;var Ce=ye;ce+=ze.x*(Ce.y-me.y);var Me=Ce.y*ze.x-Ce.x*ze.y;ve.localCOMx+=(ze.x+Ce.x)*Me,ve.localCOMy+=(ze.y+Ce.y)*Me,ce=1/(3*ce);var Oe=ce;ve.localCOMx*=Oe,ve.localCOMy*=Oe}}null!=de.wrap_localCOM&&(de.wrap_localCOM.zpp_inner.x=de.localCOMx,de.wrap_localCOM.zpp_inner.y=de.localCOMy)}var ke=de.body;ke.zip_axis&&(ke.zip_axis=!1,ke.axisx=Math.sin(ke.rot),ke.axisy=Math.cos(ke.rot)),de.worldCOMx=de.body.posx+(de.body.axisy*de.localCOMx-de.body.axisx*de.localCOMy),de.worldCOMy=de.body.posy+(de.localCOMx*de.body.axisx+de.localCOMy*de.body.axisy)}var Se=de.radius,Ae=de.radius;de.aabb.minx=de.worldCOMx-Se,de.aabb.miny=de.worldCOMy-Ae,de.aabb.maxx=de.worldCOMx+Se,de.aabb.maxy=de.worldCOMy+Ae}else{var Te=t.polygon;if(Te.zip_gverts&&null!=Te.body){Te.zip_gverts=!1,Te.validate_lverts();var Ee=Te.body;Ee.zip_axis&&(Ee.zip_axis=!1,Ee.axisx=Math.sin(Ee.rot),Ee.axisy=Math.cos(Ee.rot));for(var Ie=Te.lverts.next,je=Te.gverts.next;null!=je;){var Ne=je,De=Ie;Ie=Ie.next,Ne.x=Te.body.posx+(Te.body.axisy*De.x-Te.body.axisx*De.y),Ne.y=Te.body.posy+(De.x*Te.body.axisx+De.y*Te.body.axisy),je=je.next}}var Le=Te.gverts.next;Te.aabb.minx=Le.x,Te.aabb.miny=Le.y,Te.aabb.maxx=Le.x,Te.aabb.maxy=Le.y;for(var Fe=Te.gverts.next.next;null!=Fe;){var Pe=Fe;Pe.x<Te.aabb.minx&&(Te.aabb.minx=Pe.x),Pe.x>Te.aabb.maxx&&(Te.aabb.maxx=Pe.x),Pe.y<Te.aabb.miny&&(Te.aabb.miny=Pe.y),Pe.y>Te.aabb.maxy&&(Te.aabb.maxy=Pe.y),Fe=Fe.next}}var Re=t.aabb;ue.minx=Re.minx-3,ue.miny=Re.miny-3,ue.maxx=Re.maxx+3,ue.maxy=Re.maxy+3;var Be=(i.dyn=1!=t.body.type&&!t.body.component.sleeping)?this.dtree:this.stree;if(null==Be.root)Be.root=i,Be.root.parent=null;else{for(var Ve=i.aabb,Ge=Be.root;null!=Ge.child1;){var Ue=Ge.child1,Ye=Ge.child2,Ke=Ge.aabb,We=2*(Ke.maxx-Ke.minx+(Ke.maxy-Ke.miny)),qe=Gn.tmpaabb,Xe=Ge.aabb;qe.minx=Xe.minx<Ve.minx?Xe.minx:Ve.minx,qe.miny=Xe.miny<Ve.miny?Xe.miny:Ve.miny,qe.maxx=Xe.maxx>Ve.maxx?Xe.maxx:Ve.maxx,qe.maxy=Xe.maxy>Ve.maxy?Xe.maxy:Ve.maxy;var He=Gn.tmpaabb,Ze=2*(He.maxx-He.minx+(He.maxy-He.miny)),Je=2*Ze,Qe=2*(Ze-We),$e=Gn.tmpaabb,en=Ue.aabb;$e.minx=Ve.minx<en.minx?Ve.minx:en.minx,$e.miny=Ve.miny<en.miny?Ve.miny:en.miny,$e.maxx=Ve.maxx>en.maxx?Ve.maxx:en.maxx,$e.maxy=Ve.maxy>en.maxy?Ve.maxy:en.maxy;var nn;if(null==Ue.child1){var tn=Gn.tmpaabb;nn=2*(tn.maxx-tn.minx+(tn.maxy-tn.miny))+Qe}else{var ln=Ue.aabb,an=2*(ln.maxx-ln.minx+(ln.maxy-ln.miny)),rn=Gn.tmpaabb;nn=2*(rn.maxx-rn.minx+(rn.maxy-rn.miny))-an+Qe}var pn=Gn.tmpaabb,sn=Ye.aabb;pn.minx=Ve.minx<sn.minx?Ve.minx:sn.minx,pn.miny=Ve.miny<sn.miny?Ve.miny:sn.miny,pn.maxx=Ve.maxx>sn.maxx?Ve.maxx:sn.maxx,pn.maxy=Ve.maxy>sn.maxy?Ve.maxy:sn.maxy;var on;if(null==Ye.child1){var _n=Gn.tmpaabb;on=2*(_n.maxx-_n.minx+(_n.maxy-_n.miny))+Qe}else{var hn=Ye.aabb,xn=2*(hn.maxx-hn.minx+(hn.maxy-hn.miny)),un=Gn.tmpaabb;on=2*(un.maxx-un.minx+(un.maxy-un.miny))-xn+Qe}if(Je<nn&&Je<on)break;Ge=nn<on?Ue:Ye}var dn,vn=Ge,cn=vn.parent;null==Bn.zpp_pool?dn=new Bn:(dn=Bn.zpp_pool,Bn.zpp_pool=dn.next,dn.next=null),null==mn.zpp_pool?dn.aabb=new mn:(dn.aabb=mn.zpp_pool,mn.zpp_pool=dn.aabb.next,dn.aabb.next=null);dn.aabb;dn.moved=!1,dn.synced=!1,dn.first_sync=!1,dn.parent=cn;var yn=dn.aabb,zn=vn.aabb;for(yn.minx=Ve.minx<zn.minx?Ve.minx:zn.minx,yn.miny=Ve.miny<zn.miny?Ve.miny:zn.miny,yn.maxx=Ve.maxx>zn.maxx?Ve.maxx:zn.maxx,yn.maxy=Ve.maxy>zn.maxy?Ve.maxy:zn.maxy,dn.height=vn.height+1,null!=cn?(cn.child1==vn?cn.child1=dn:cn.child2=dn,dn.child1=vn,dn.child2=i,vn.parent=dn,i.parent=dn):(dn.child1=vn,dn.child2=i,vn.parent=dn,i.parent=dn,Be.root=dn),Ge=i.parent;null!=Ge;){if(null==Ge.child1||Ge.height<2)Ge=Ge;else{var fn=Ge.child1,bn=Ge.child2,gn=bn.height-fn.height;if(gn>1){var wn=bn.child1,Cn=bn.child2;if(bn.child1=Ge,bn.parent=Ge.parent,Ge.parent=bn,null!=bn.parent?bn.parent.child1==Ge?bn.parent.child1=bn:bn.parent.child2=bn:Be.root=bn,wn.height>Cn.height){bn.child2=wn,Ge.child2=Cn,Cn.parent=Ge;var Mn=Ge.aabb,On=fn.aabb,kn=Cn.aabb;Mn.minx=On.minx<kn.minx?On.minx:kn.minx,Mn.miny=On.miny<kn.miny?On.miny:kn.miny,Mn.maxx=On.maxx>kn.maxx?On.maxx:kn.maxx,Mn.maxy=On.maxy>kn.maxy?On.maxy:kn.maxy;var Sn=bn.aabb,An=Ge.aabb,Tn=wn.aabb;Sn.minx=An.minx<Tn.minx?An.minx:Tn.minx,Sn.miny=An.miny<Tn.miny?An.miny:Tn.miny,Sn.maxx=An.maxx>Tn.maxx?An.maxx:Tn.maxx,Sn.maxy=An.maxy>Tn.maxy?An.maxy:Tn.maxy;var En=fn.height,In=Cn.height;Ge.height=1+(En>In?En:In);var jn=Ge.height,Nn=wn.height;bn.height=1+(jn>Nn?jn:Nn)}else{bn.child2=Cn,Ge.child2=wn,wn.parent=Ge;var Dn=Ge.aabb,Ln=fn.aabb,Fn=wn.aabb;Dn.minx=Ln.minx<Fn.minx?Ln.minx:Fn.minx,Dn.miny=Ln.miny<Fn.miny?Ln.miny:Fn.miny,Dn.maxx=Ln.maxx>Fn.maxx?Ln.maxx:Fn.maxx,Dn.maxy=Ln.maxy>Fn.maxy?Ln.maxy:Fn.maxy;var Pn=bn.aabb,Rn=Ge.aabb,Un=Cn.aabb;Pn.minx=Rn.minx<Un.minx?Rn.minx:Un.minx,Pn.miny=Rn.miny<Un.miny?Rn.miny:Un.miny,Pn.maxx=Rn.maxx>Un.maxx?Rn.maxx:Un.maxx,Pn.maxy=Rn.maxy>Un.maxy?Rn.maxy:Un.maxy;var Yn=fn.height,Kn=wn.height;Ge.height=1+(Yn>Kn?Yn:Kn);var Wn=Ge.height,qn=Cn.height;bn.height=1+(Wn>qn?Wn:qn)}Ge=bn}else if(gn<-1){var Xn=fn.child1,Hn=fn.child2;if(fn.child1=Ge,fn.parent=Ge.parent,Ge.parent=fn,null!=fn.parent?fn.parent.child1==Ge?fn.parent.child1=fn:fn.parent.child2=fn:Be.root=fn,Xn.height>Hn.height){fn.child2=Xn,Ge.child1=Hn,Hn.parent=Ge;var Zn=Ge.aabb,Jn=bn.aabb,Qn=Hn.aabb;Zn.minx=Jn.minx<Qn.minx?Jn.minx:Qn.minx,Zn.miny=Jn.miny<Qn.miny?Jn.miny:Qn.miny,Zn.maxx=Jn.maxx>Qn.maxx?Jn.maxx:Qn.maxx,Zn.maxy=Jn.maxy>Qn.maxy?Jn.maxy:Qn.maxy;var $n=fn.aabb,ei=Ge.aabb,ni=Xn.aabb;$n.minx=ei.minx<ni.minx?ei.minx:ni.minx,$n.miny=ei.miny<ni.miny?ei.miny:ni.miny,$n.maxx=ei.maxx>ni.maxx?ei.maxx:ni.maxx,$n.maxy=ei.maxy>ni.maxy?ei.maxy:ni.maxy;var ii=bn.height,ti=Hn.height;Ge.height=1+(ii>ti?ii:ti);var li=Ge.height,ai=Xn.height;fn.height=1+(li>ai?li:ai)}else{fn.child2=Hn,Ge.child1=Xn,Xn.parent=Ge;var ri=Ge.aabb,pi=bn.aabb,si=Xn.aabb;ri.minx=pi.minx<si.minx?pi.minx:si.minx,ri.miny=pi.miny<si.miny?pi.miny:si.miny,ri.maxx=pi.maxx>si.maxx?pi.maxx:si.maxx,ri.maxy=pi.maxy>si.maxy?pi.maxy:si.maxy;var oi=fn.aabb,_i=Ge.aabb,hi=Hn.aabb;oi.minx=_i.minx<hi.minx?_i.minx:hi.minx,oi.miny=_i.miny<hi.miny?_i.miny:hi.miny,oi.maxx=_i.maxx>hi.maxx?_i.maxx:hi.maxx,oi.maxy=_i.maxy>hi.maxy?_i.maxy:hi.maxy;var xi=bn.height,ui=Xn.height;Ge.height=1+(xi>ui?xi:ui);var di=Ge.height,vi=Hn.height;fn.height=1+(di>vi?di:vi)}Ge=fn}else Ge=Ge}var ci=Ge.child1,yi=Ge.child2,mi=ci.height,zi=yi.height;Ge.height=1+(mi>zi?mi:zi);var fi=Ge.aabb,bi=ci.aabb,gi=yi.aabb;fi.minx=bi.minx<gi.minx?bi.minx:gi.minx,fi.miny=bi.miny<gi.miny?bi.miny:gi.miny,fi.maxx=bi.maxx>gi.maxx?bi.maxx:gi.maxx,fi.maxy=bi.maxy>gi.maxy?bi.maxy:gi.maxy,Ge=Ge.parent}}i.synced=!1,i=i.snext}for(;null!=this.syncs;){var wi=this.syncs;this.syncs=wi.snext,wi.snext=null;var Ci=wi;if(!Ci.moved){Ci.moved=!1;var Mi=Ci.shape;if(!Mi.body.component.sleeping){var Oi=Ci.aabb,ki=null;for(null!=this.dtree.root&&(this.dtree.root.next=ki,ki=this.dtree.root);null!=ki;){var Si=ki;ki=Si.next,Si.next=null;var Ti=Si;if(Ti!=Ci)if(null==Ti.child1){var Ei=Ti.shape;if(Ei.body!=Mi.body&&(1!=Ei.body.type||1!=Mi.body.type)){var Ii=Ti.aabb;if(Ii.miny<=Oi.maxy&&Oi.miny<=Ii.maxy&&Ii.minx<=Oi.maxx&&Oi.minx<=Ii.maxx){var ji,Ni;Mi.id<Ei.id?(ji=Mi.id,Ni=Ei.id):(ji=Ei.id,Ni=Mi.id);for(var Di=Mi.pairs.length<Ei.pairs.length?Mi:Ei,Li=null,Fi=Di.pairs.head;null!=Fi;){var Pi=Fi.elt;if(Pi.id==ji&&Pi.di==Ni){Li=Pi;break}Fi=Fi.next}if(null!=Li){Li.sleeping&&(Li.sleeping=!1,Li.next=this.pairs,this.pairs=Li,Li.first=!0);continue}null==Vn.zpp_pool?Li=new Vn:(Li=Vn.zpp_pool,Vn.zpp_pool=Li.next,Li.next=null),Li.n1=Ci,Li.n2=Ti,Li.id=ji,Li.di=Ni,Li.next=this.pairs,this.pairs=Li,Li.first=!0;var Ri,Bi=Mi.pairs;null==Ai.zpp_pool?Ri=new Ai:(Ri=Ai.zpp_pool,Ai.zpp_pool=Ri.next,Ri.next=null),Ri.elt=Li;var Vi=Ri;Vi.next=Bi.head,Bi.head=Vi,Bi.modified=!0,Bi.length++;var Gi,Ui=Ei.pairs;null==Ai.zpp_pool?Gi=new Ai:(Gi=Ai.zpp_pool,Ai.zpp_pool=Gi.next,Gi.next=null),Gi.elt=Li;var Yi=Gi;Yi.next=Ui.head,Ui.head=Yi,Ui.modified=!0,Ui.length++}}}else{var Ki=Ti.aabb;Ki.miny<=Oi.maxy&&Oi.miny<=Ki.maxy&&Ki.minx<=Oi.maxx&&Oi.minx<=Ki.maxx&&(null!=Ti.child1&&(Ti.child1.next=ki,ki=Ti.child1),null!=Ti.child2&&(Ti.child2.next=ki,ki=Ti.child2))}}for(null!=this.stree.root&&(this.stree.root.next=ki,ki=this.stree.root);null!=ki;){var Wi=ki;ki=Wi.next,Wi.next=null;var qi=Wi;if(qi!=Ci)if(null==qi.child1){var Xi=qi.shape;if(Xi.body!=Mi.body&&(1!=Xi.body.type||1!=Mi.body.type)){var Hi=qi.aabb;if(Hi.miny<=Oi.maxy&&Oi.miny<=Hi.maxy&&Hi.minx<=Oi.maxx&&Oi.minx<=Hi.maxx){var Zi,Ji;Mi.id<Xi.id?(Zi=Mi.id,Ji=Xi.id):(Zi=Xi.id,Ji=Mi.id);for(var Qi=Mi.pairs.length<Xi.pairs.length?Mi:Xi,$i=null,et=Qi.pairs.head;null!=et;){var nt=et.elt;if(nt.id==Zi&&nt.di==Ji){$i=nt;break}et=et.next}if(null!=$i){$i.sleeping&&($i.sleeping=!1,$i.next=this.pairs,this.pairs=$i,$i.first=!0);continue}null==Vn.zpp_pool?$i=new Vn:($i=Vn.zpp_pool,Vn.zpp_pool=$i.next,$i.next=null),$i.n1=Ci,$i.n2=qi,$i.id=Zi,$i.di=Ji,$i.next=this.pairs,this.pairs=$i,$i.first=!0;var it,tt=Mi.pairs;null==Ai.zpp_pool?it=new Ai:(it=Ai.zpp_pool,Ai.zpp_pool=it.next,it.next=null),it.elt=$i;var lt=it;lt.next=tt.head,tt.head=lt,tt.modified=!0,tt.length++;var at,rt=Xi.pairs;null==Ai.zpp_pool?at=new Ai:(at=Ai.zpp_pool,Ai.zpp_pool=at.next,at.next=null),at.elt=$i;var pt=at;pt.next=rt.head,rt.head=pt,rt.modified=!0,rt.length++}}}else{var st=qi.aabb;st.miny<=Oi.maxy&&Oi.miny<=st.maxy&&st.minx<=Oi.maxx&&Oi.minx<=st.maxx&&(null!=qi.child1&&(qi.child1.next=ki,ki=qi.child1),null!=qi.child2&&(qi.child2.next=ki,ki=qi.child2))}}}}}for(;null!=this.moves;){var ot=this.moves;this.moves=ot.mnext,ot.mnext=null;var _t=ot;_t.moved=!1;var ht=_t.shape;if(!ht.body.component.sleeping){var xt=_t.aabb,ut=null;for(null!=this.dtree.root&&(this.dtree.root.next=ut,ut=this.dtree.root);null!=ut;){var dt=ut;ut=dt.next,dt.next=null;var vt=dt;if(vt!=_t)if(null==vt.child1){var ct=vt.shape;if(ct.body!=ht.body&&(1!=ct.body.type||1!=ht.body.type)){var yt=vt.aabb;if(yt.miny<=xt.maxy&&xt.miny<=yt.maxy&&yt.minx<=xt.maxx&&xt.minx<=yt.maxx){var mt,zt;ht.id<ct.id?(mt=ht.id,zt=ct.id):(mt=ct.id,zt=ht.id);for(var ft=ht.pairs.length<ct.pairs.length?ht:ct,bt=null,gt=ft.pairs.head;null!=gt;){var wt=gt.elt;if(wt.id==mt&&wt.di==zt){bt=wt;break}gt=gt.next}if(null!=bt){bt.sleeping&&(bt.sleeping=!1,bt.next=this.pairs,this.pairs=bt,bt.first=!0);continue}null==Vn.zpp_pool?bt=new Vn:(bt=Vn.zpp_pool,Vn.zpp_pool=bt.next,bt.next=null),bt.n1=_t,bt.n2=vt,bt.id=mt,bt.di=zt,bt.next=this.pairs,this.pairs=bt,bt.first=!0;var Ct,Mt=ht.pairs;null==Ai.zpp_pool?Ct=new Ai:(Ct=Ai.zpp_pool,Ai.zpp_pool=Ct.next,Ct.next=null),Ct.elt=bt;var Ot=Ct;Ot.next=Mt.head,Mt.head=Ot,Mt.modified=!0,Mt.length++;var kt,St=ct.pairs;null==Ai.zpp_pool?kt=new Ai:(kt=Ai.zpp_pool,Ai.zpp_pool=kt.next,kt.next=null),kt.elt=bt;var At=kt;At.next=St.head,St.head=At,St.modified=!0,St.length++}}}else{var Tt=vt.aabb;Tt.miny<=xt.maxy&&xt.miny<=Tt.maxy&&Tt.minx<=xt.maxx&&xt.minx<=Tt.maxx&&(null!=vt.child1&&(vt.child1.next=ut,ut=vt.child1),null!=vt.child2&&(vt.child2.next=ut,ut=vt.child2))}}for(null!=this.stree.root&&(this.stree.root.next=ut,ut=this.stree.root);null!=ut;){var Et=ut;ut=Et.next,Et.next=null;var It=Et;if(It!=_t)if(null==It.child1){var jt=It.shape;if(jt.body!=ht.body&&(1!=jt.body.type||1!=ht.body.type)){var Nt=It.aabb;if(Nt.miny<=xt.maxy&&xt.miny<=Nt.maxy&&Nt.minx<=xt.maxx&&xt.minx<=Nt.maxx){var Dt,Lt;ht.id<jt.id?(Dt=ht.id,Lt=jt.id):(Dt=jt.id,Lt=ht.id);for(var Ft=ht.pairs.length<jt.pairs.length?ht:jt,Pt=null,Rt=Ft.pairs.head;null!=Rt;){var Bt=Rt.elt;if(Bt.id==Dt&&Bt.di==Lt){Pt=Bt;break}Rt=Rt.next}if(null!=Pt){Pt.sleeping&&(Pt.sleeping=!1,Pt.next=this.pairs,this.pairs=Pt,Pt.first=!0);continue}null==Vn.zpp_pool?Pt=new Vn:(Pt=Vn.zpp_pool,Vn.zpp_pool=Pt.next,Pt.next=null),Pt.n1=_t,Pt.n2=It,Pt.id=Dt,Pt.di=Lt,Pt.next=this.pairs,this.pairs=Pt,Pt.first=!0;var Vt,Gt=ht.pairs;null==Ai.zpp_pool?Vt=new Ai:(Vt=Ai.zpp_pool,Ai.zpp_pool=Vt.next,Vt.next=null),Vt.elt=Pt;var Ut=Vt;Ut.next=Gt.head,Gt.head=Ut,Gt.modified=!0,Gt.length++;var Yt,Kt=jt.pairs;null==Ai.zpp_pool?Yt=new Ai:(Yt=Ai.zpp_pool,Ai.zpp_pool=Yt.next,Yt.next=null),Yt.elt=Pt;var Wt=Yt;Wt.next=Kt.head,Kt.head=Wt,Kt.modified=!0,Kt.length++}}}else{var qt=It.aabb;qt.miny<=xt.maxy&&xt.miny<=qt.maxy&&qt.minx<=xt.maxx&&xt.minx<=qt.maxx&&(null!=It.child1&&(It.child1.next=ut,ut=It.child1),null!=It.child2&&(It.child2.next=ut,ut=It.child2))}}}}for(var Xt=null,Ht=this.pairs;null!=Ht;){var Zt;if(Ht.first)Zt=!1;else{var Jt=Ht.n1.aabb,Qt=Ht.n2.aabb;Zt=!(Qt.miny<=Jt.maxy&&Jt.miny<=Qt.maxy&&Qt.minx<=Jt.maxx&&Jt.minx<=Qt.maxx)}if(Zt){null==Xt?this.pairs=Ht.next:Xt.next=Ht.next;for(var $t=Ht.n1.shape.pairs,el=null,nl=$t.head;null!=nl;){if(nl.elt==Ht){var il,tl;null==el?(il=$t.head,tl=il.next,$t.head=tl,null==$t.head&&($t.pushmod=!0)):(il=el.next,tl=il.next,el.next=tl,null==tl&&($t.pushmod=!0));var ll=il;ll.elt=null,ll.next=Ai.zpp_pool,Ai.zpp_pool=ll,$t.modified=!0,$t.length--,$t.pushmod=!0,!0;break}el=nl,nl=nl.next}for(var al=Ht.n2.shape.pairs,rl=null,pl=al.head;null!=pl;){if(pl.elt==Ht){var sl,ol;null==rl?(sl=al.head,ol=sl.next,al.head=ol,null==al.head&&(al.pushmod=!0)):(sl=rl.next,ol=sl.next,rl.next=ol,null==ol&&(al.pushmod=!0));var _l=sl;_l.elt=null,_l.next=Ai.zpp_pool,Ai.zpp_pool=_l,al.modified=!0,al.length--,al.pushmod=!0,!0;break}rl=pl,pl=pl.next}var hl=Ht.next;null!=Ht.arb&&(Ht.arb.pair=null),Ht.arb=null;var xl=Ht;xl.n1=xl.n2=null,xl.sleeping=!1,xl.next=Vn.zpp_pool,Vn.zpp_pool=xl,Ht=hl}else{var ul=Ht.n1.shape,dl=ul.body,vl=Ht.n2.shape,cl=vl.body;if(Ht.first||!dl.component.sleeping&&1!=dl.type||!cl.component.sleeping&&1!=cl.type){Ht.first=!1;var yl=ul.aabb,ml=vl.aabb;if(ml.miny<=yl.maxy&&yl.miny<=ml.maxy&&ml.minx<=yl.maxx&&yl.minx<=ml.maxx){var zl=Ht.arb;Ht.arb=n?e.narrowPhase(ul,vl,2!=dl.type||2!=cl.type,Ht.arb,!1):e.continuousEvent(ul,vl,2!=dl.type||2!=cl.type,Ht.arb,!1),null==Ht.arb?null!=zl&&(zl.pair=null):Ht.arb.pair=Ht}Xt=Ht,Ht=Ht.next}else Ht.sleeping=!0,null==Xt?this.pairs=Ht.next:Xt.next=Ht.next,Ht=Ht.next}}},__class__:Un});var Yn=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new ai};Yn.__name__=!0,Yn.prototype={pop:function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},__class__:Yn};var Kn=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,this.parent=this,this.rank=0,this.woken=!1};Kn.__name__=!0,Kn.prototype={__class__:Kn};var Wn=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new ni};Wn.__name__=!0,Wn.get=function(e,n){var i;return null==Wn.zpp_pool?i=new Wn:(i=Wn.zpp_pool,Wn.zpp_pool=i.next,i.next=null),i.freed=!1,i.lazydel=!1,i.COLLISIONstate=1,i.COLLISIONstamp=0,i.SENSORstate=1,i.SENSORstamp=0,i.FLUIDstate=1,i.FLUIDstamp=0,e.id<n.id?(i.int1=e,i.int2=n):(i.int1=n,i.int2=e),i.id=i.int1.id,i.di=i.int2.id,i},Wn.prototype={remove_arb:function(e){for(var n=this.arbiters,i=null,t=n.head;null!=t;){if(t.elt==e){var l,a;null==i?(l=n.head,a=l.next,n.head=a,null==n.head&&(n.pushmod=!0)):(l=i.next,a=l.next,i.next=a,null==a&&(n.pushmod=!0));var r=l;r.elt=null,r.next=bi.zpp_pool,bi.zpp_pool=r,n.modified=!0,n.length--,n.pushmod=!0,!0;break}i=t,t=t.next}},empty_arb:function(e){var n;n=!0;for(var i=this.arbiters.head;null!=i;){{if(0!=(i.elt.type&e)){n=!1;break}i=i.next}}return n},__class__:Wn};var qn=function(e){this.space=null,this.cbsets=null,null==at.zpp_pool?this.cbsets=new at:(this.cbsets=at.zpp_pool,at.zpp_pool=this.cbsets.next,this.cbsets.next=null);this.cbsets;this.cbsets.lt=$e.setlt,this.space=e};qn.__name__=!0,qn.prototype={get:function(e){if(null==e.head)return null;var n;null==$e.zpp_pool?n=new $e:(n=$e.zpp_pool,$e.zpp_pool=n.next,n.next=null);var i=n.cbTypes;n.cbTypes=e;var t,l=this.cbsets.find_weak(n);if(null!=l)t=l.data;else{var a=$e.get(e);this.cbsets.insert(a),a.manager=this,t=a}n.cbTypes=i;var r=n;for(r.listeners.clear(),r.zip_listeners=!0,r.bodylisteners.clear(),r.zip_bodylisteners=!0,r.conlisteners.clear(),r.zip_conlisteners=!0;null!=r.cbTypes.head;){r.cbTypes.pop_unsafe().cbsets.remove(r)}return r.next=$e.zpp_pool,$e.zpp_pool=r,t},remove:function(e){for(this.cbsets.remove(e);null!=e.cbpairs.head;){var n=e.cbpairs.pop_unsafe();n.a!=n.b&&(e==n.a?n.b.cbpairs.remove(n):n.a.cbpairs.remove(n));var i=n;i.a=i.b=null,i.listeners.clear(),i.next=en.zpp_pool,en.zpp_pool=i}e.manager=null},__class__:qn};var Xn=function(e,n){this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.gravityy=0,this.gravityx=0,this.outer=null,this.toiEvents=new hi,this.global_lin_drag=.015,this.global_ang_drag=.015,this.precb=new U,this.precb.zpp_inner=new Qe,this.sortcontacts=!0,this.pre_dt=0;var t;null!=n?(null==nn.Broadphase_DYNAMIC_AABB_TREE&&(nn.internal=!0,nn.Broadphase_DYNAMIC_AABB_TREE=new Ze,nn.internal=!1),t=n==nn.Broadphase_DYNAMIC_AABB_TREE):t=!0,t?this.bphase=new Un(this):(null==nn.Broadphase_SWEEP_AND_PRUNE&&(nn.internal=!0,nn.Broadphase_SWEEP_AND_PRUNE=new Ze,nn.internal=!1),n==nn.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new Zn(this))),this.time=0;null!=e?(this.gravityx=e.x,this.gravityy=e.y):(this.gravityx=0,this.gravityy=0),this.bodies=new $n,this.wrap_bodies=Ui.get(this.bodies),this.wrap_bodies.zpp_inner.adder=i(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=i(this,this.bodies_subber),this.compounds=new ei,this.wrap_compounds=Ki.get(this.compounds),this.wrap_compounds.zpp_inner.adder=i(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=i(this,this.compounds_subber),this.kinematics=new $n,this.c_arbiters_true=new oi,this.c_arbiters_false=new oi,this.f_arbiters=new ri,this.s_arbiters=new pi,this.islands=new Yn,this.live=new $n,this.wrap_live=Ui.get(this.live,!0),this.staticsleep=new $n,this.constraints=new f,this.wrap_constraints=Gi.get(this.constraints),this.wrap_constraints.zpp_inner.adder=i(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=i(this,this.constraints_subber),this.live_constraints=new f,this.wrap_livecon=Gi.get(this.live_constraints,!0),this.__static=En.__static(),this.__static.zpp_inner.space=this,this.callbacks=new Qe,this.midstep=!1,this.listeners=new si,this.wrap_listeners=Wi.get(this.listeners),this.wrap_listeners.zpp_inner.adder=i(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=i(this,this.listeners_subber),this.callbackset_list=new Wn,this.mrca1=new b,this.mrca2=new b,this.prelisteners=new y,this.cbsets=new qn(this)};Xn.__name__=!0,Xn.prototype={bodies_adder:function(e){return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(e),this.addBody(e.zpp_inner),!0)},bodies_subber:function(e){this.remBody(e.zpp_inner)},compounds_adder:function(e){return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.wrap_compounds.remove(e),this.addCompound(e.zpp_inner),!0)},compounds_subber:function(e){this.remCompound(e.zpp_inner)},constraints_adder:function(e){return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(e),this.addConstraint(e.zpp_inner),!0)},constraints_subber:function(e){this.remConstraint(e.zpp_inner)},listeners_adder:function(e){return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(e),this.addListener(e.zpp_inner),!0)},listeners_subber:function(e){this.remListener(e.zpp_inner)},addListener:function(e){if(e.space=this,e.addedToSpace(),null!=e.interaction){e.interaction}},remListener:function(e){if(null!=e.interaction){e.interaction}e.removedFromSpace(),e.space=null},add_callbackset:function(e){var n,i=e.int1.cbsets;null==ci.zpp_pool?n=new ci:(n=ci.zpp_pool,ci.zpp_pool=n.next,n.next=null),n.elt=e;var t=n;t.next=i.head,i.head=t,i.modified=!0,i.length++;var l,a=e.int2.cbsets;null==ci.zpp_pool?l=new ci:(l=ci.zpp_pool,ci.zpp_pool=l.next,l.next=null),l.elt=e;var r=l;r.next=a.head,a.head=r,a.modified=!0,a.length++;var p=this.callbackset_list;e._inuse=!0;var s=e;s.next=p.next,p.next=s,p.modified=!0,p.length++},remove_callbackset:function(e){e.lazydel=!0;for(var n=e.int1.cbsets,i=null,t=n.head;null!=t;){if(t.elt==e){var l,a;null==i?(l=n.head,a=l.next,n.head=a,null==n.head&&(n.pushmod=!0)):(l=i.next,a=l.next,i.next=a,null==a&&(n.pushmod=!0));var r=l;r.elt=null,r.next=ci.zpp_pool,ci.zpp_pool=r,n.modified=!0,n.length--,n.pushmod=!0,!0;break}i=t,t=t.next}for(var p=e.int2.cbsets,s=null,o=p.head;null!=o;){if(o.elt==e){var _,h;null==s?(_=p.head,h=_.next,p.head=h,null==p.head&&(p.pushmod=!0)):(_=s.next,h=_.next,s.next=h,null==h&&(p.pushmod=!0));var x=_;x.elt=null,x.next=ci.zpp_pool,ci.zpp_pool=x,p.modified=!0,p.length--,p.pushmod=!0,!0;break}s=o,o=o.next}},transmitType:function(e,n){var i=e;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),2==e.type?this.live.remove(e):3==e.type?(this.kinematics.remove(e),this.staticsleep.remove(e)):1==e.type&&this.staticsleep.remove(e),e.type=n,3==e.type&&this.kinematics.add(e),1==e.type&&this.static_validation(e),e.component.sleeping=!0;var t=e;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0))},removed_shape:function(e,n){null==n&&(n=!1);var i=this,t=e.body;n||t.wake();for(var l=null,a=t.arbiters.head;null!=a;){var r=a.elt;if(r.ws1==e||r.ws2==e){if(0!=r.present){this.MRCA_chains(r.ws1,r.ws2);for(var p=this.mrca1.head;null!=p;){for(var s=p.elt,o=this.mrca2.head;null!=o;){var _=o.elt,h=s.cbSet,x=_.cbSet;h.validate(),x.validate();for(var u=(h.manager,null),d=h.cbpairs.length<x.cbpairs.length?h.cbpairs:x.cbpairs,v=d.head;null!=v;){var c=v.elt;if(c.a==h&&c.b==x||c.a==x&&c.b==h){u=c;break}v=v.next}if(null==u){var y;null==en.zpp_pool?y=new en:(y=en.zpp_pool,en.zpp_pool=y.next,y.next=null),y.zip_listeners=!0,$e.setlt(h,x)?(y.a=h,y.b=x):(y.a=x,y.b=h),u=y,h.cbpairs.add(u),x!=h&&x.cbpairs.add(u)}if(u.zip_listeners&&(u.zip_listeners=!1,u.__validate()),null!=u.listeners.head){var m=Tn.get(s,_);m.remove_arb(r),r.present--;for(var z=(h.manager,null),f=h.cbpairs.length<x.cbpairs.length?h.cbpairs:x.cbpairs,b=f.head;null!=b;){var g=b.elt;if(g.a==h&&g.b==x||g.a==x&&g.b==h){z=g;break}b=b.next}if(null==z){var w;null==en.zpp_pool?w=new en:(w=en.zpp_pool,en.zpp_pool=w.next,w.next=null),w.zip_listeners=!0,$e.setlt(h,x)?(w.a=h,w.b=x):(w.a=x,w.b=h),z=w,h.cbpairs.add(z),x!=h&&x.cbpairs.add(z)}z.zip_listeners&&(z.zip_listeners=!1,z.__validate());for(var C=z.listeners.head;null!=C;){var M=C.elt;if(1==M.event&&0!=(M.itype&r.type)&&m.empty_arb(M.itype)){var O=i.push_callback(M);O.event=1;var k,S=m.int1,A=m.int2,T=M.options1,E=S.cbTypes;if(T.nonemptyintersection(E,T.includes)&&!T.nonemptyintersection(E,T.excludes)){var I=M.options2,j=A.cbTypes;k=!!I.nonemptyintersection(j,I.includes)&&!I.nonemptyintersection(j,I.excludes)}else k=!1;k?(O.int1=S,O.int2=A):(O.int1=A,O.int2=S),O.set=m}C=C.next}null==m.arbiters.head&&this.remove_callbackset(m),o=o.next}else o=o.next}p=p.next}}if(r.b1!=t&&2==r.b1.type){var N=r.b1;N.world||(N.component.waket=this.stamp+(this.midstep?0:1),3==N.type&&(N.kinematicDelaySleep=!0),N.component.sleeping&&this.really_wake(N,!1))}if(r.b2!=t&&2==r.b2.type){var D=r.b2;D.world||(D.component.waket=this.stamp+(this.midstep?0:1),3==D.type&&(D.kinematicDelaySleep=!0),D.component.sleeping&&this.really_wake(D,!1))}if(r.cleared=!0,null==t||r.b2==t)for(var L=r.b1.arbiters,F=null,P=L.head;null!=P;){if(P.elt==r){var R,B;null==F?(R=L.head,B=R.next,L.head=B,null==L.head&&(L.pushmod=!0)):(R=F.next,B=R.next,F.next=B,null==B&&(L.pushmod=!0));var V=R;V.elt=null,V.next=bi.zpp_pool,bi.zpp_pool=V,L.modified=!0,L.length--,L.pushmod=!0,!0;break}F=P,P=P.next}if(null==t||r.b1==t)for(var G=r.b2.arbiters,U=null,Y=G.head;null!=Y;){if(Y.elt==r){var K,W;null==U?(K=G.head,
W=K.next,G.head=W,null==G.head&&(G.pushmod=!0)):(K=U.next,W=K.next,U.next=W,null==W&&(G.pushmod=!0));var q=K;q.elt=null,q.next=bi.zpp_pool,bi.zpp_pool=q,G.modified=!0,G.length--,G.pushmod=!0,!0;break}U=Y,Y=Y.next}null!=r.pair&&(r.pair.arb=null,r.pair=null),r.active=!1,this.f_arbiters.modified=!0,a=t.arbiters.erase(l)}else l=a,a=a.next}this.bphase.remove(e),e.removedFromSpace()},addConstraint:function(e){e.space=this,e.addedToSpace(),e.active&&(e.component.sleeping=!0,this.wake_constraint(e,!0))},remConstraint:function(e){e.active&&(this.wake_constraint(e,!0),this.live_constraints.remove(e)),e.removedFromSpace(),e.space=null},addCompound:function(e){e.space=this,e.addedToSpace();for(var n=e.bodies.head;null!=n;){var i=n.elt;this.addBody(i),n=n.next}for(var t=e.constraints.head;null!=t;){var l=t.elt;this.addConstraint(l),t=t.next}for(var a=e.compounds.head;null!=a;){var r=a.elt;this.addCompound(r),a=a.next}},remCompound:function(e){for(var n=e.bodies.head;null!=n;){var i=n.elt;this.remBody(i),n=n.next}for(var t=e.constraints.head;null!=t;){var l=t.elt;this.remConstraint(l),t=t.next}for(var a=e.compounds.head;null!=a;){var r=a.elt;this.remCompound(r),a=a.next}e.removedFromSpace(),e.space=null},addBody:function(e,n){null==n&&(n=-1),e.space=this,e.addedToSpace(),e.component.sleeping=!0;var i=e;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0));for(var t=e.shapes.head;null!=t;){var l=t.elt;this.bphase.insert(l),l.addedToSpace(),t=t.next}1==e.type?this.static_validation(e):2!=e.type&&3!=n&&this.kinematics.add(e)},remBody:function(e,n){if(null==n&&(n=-1),1==e.type){var i=e;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0)),this.staticsleep.remove(e)}else if(2==e.type){var t=e;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0)),this.live.remove(e)}else{3!=n&&this.kinematics.remove(e);var l=e;l.world||(l.component.waket=this.stamp+(this.midstep?0:1),3==l.type&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!0)),this.staticsleep.remove(e)}for(var a=e.shapes.head;null!=a;){var r=a.elt;this.removed_shape(r,!0),a=a.next}e.removedFromSpace(),e.space=null},push_callback:function(e){var n;return null==Qe.zpp_pool?n=new Qe:(n=Qe.zpp_pool,Qe.zpp_pool=n.next,n.next=null),this.callbacks.push(n),n.listener=e,n},step:function(e,n,i){var t=this;if(this.time+=e,this.pre_dt=e,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(e),this.sortcontacts){var l=this.c_arbiters_false;if(null!=l.head&&null!=l.head.next){for(var a,r,p,s=l.head,o=null,_=null,h=null,x=null,u=1;;){for(a=0,_=s,s=null,o=s;null!=_;){for(++a,h=_,r=0,p=u;null!=h&&r<u;)++r,h=h.next;for(;r>0||p>0&&null!=h;)0==r?(x=h,h=h.next,--p):0==p||null==h?(x=_,_=_.next,--r):!_.elt.active||!h.elt.active||_.elt.oc1.dist<h.elt.oc1.dist?(x=_,_=_.next,--r):(x=h,h=h.next,--p),null!=o?o.next=x:s=x,o=x;_=h}if(o.next=null,u<<=1,!(a>1))break}l.head=s,l.modified=!0,l.pushmod=!0}}this.updateVel(e),this.warmStart(),this.iterateVel(n);for(var d=this.kinematics.head;null!=d;){var v=d.elt;v.pre_posx=v.posx,v.pre_posy=v.posy,v.pre_rot=v.rot,d=d.next}for(var c=this.live.head;null!=c;){var y=c.elt;y.pre_posx=y.posx,y.pre_posy=y.posy,y.pre_rot=y.rot,c=c.next}this.updatePos(e),this.continuous=!0,this.continuousCollisions(e),this.continuous=!1,this.iteratePos(i);for(var m=this.kinematics.head;null!=m;){var z=m.elt,f=!(z.posx==z.pre_posx&&z.posy==z.pre_posy),b=z.pre_rot!=z.rot;if(f){for(var g=z.shapes.head;null!=g;){var w=g.elt;1==w.type&&(w.polygon.invalidate_gverts(),w.polygon.invalidate_gaxi()),w.invalidate_worldCOM(),g=g.next}z.zip_worldCOM=!0}if(b){z.zip_axis=!0;for(var C=z.shapes.head;null!=C;){var M=C.elt;1==M.type&&(M.polygon.invalidate_gverts(),M.polygon.invalidate_gaxi()),M.invalidate_worldCOM(),C=C.next}z.zip_worldCOM=!0}m=m.next}for(var O=this.live.head;null!=O;){var k=O.elt,S=!(k.posx==k.pre_posx&&k.posy==k.pre_posy),A=k.pre_rot!=k.rot;if(S){for(var T=k.shapes.head;null!=T;){var E=T.elt;1==E.type&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),T=T.next}k.zip_worldCOM=!0}if(A){k.zip_axis=!0;for(var I=k.shapes.head;null!=I;){var j=I.elt;1==j.type&&(j.polygon.invalidate_gverts(),j.polygon.invalidate_gaxi()),j.invalidate_worldCOM(),I=I.next}k.zip_worldCOM=!0}O=O.next}for(var N=null,D=this.staticsleep.head;null!=D;){var L=D.elt;if(3!=L.type||0==L.velx&&0==L.vely&&0==L.angvel){if(L.kinematicDelaySleep){L.kinematicDelaySleep=!1,D=D.next;continue}L.component.sleeping=!0;var F,P,R=this.staticsleep;null==N?(F=R.head,P=F.next,R.head=P,null==R.head&&(R.pushmod=!0)):(F=N.next,P=F.next,N.next=P,null==P&&(R.pushmod=!0));var B=F;B.elt=null,B.next=mi.zpp_pool,mi.zpp_pool=B,R.modified=!0,R.length--,R.pushmod=!0,D=P}else N=D,D=D.next}this.doForests(e),this.sleepArbiters(),this.midstep=!1;for(var V=null,G=this.callbackset_list.next;null!=G;){var U=G;if(null!=U.arbiters.head){var Y;Y=!0;for(var K=U.arbiters.head;null!=K;){{if(!K.elt.sleeping){Y=!1;break}K=K.next}}for(var W=Y,q=U.int1.cbSet,X=U.int2.cbSet,H=(q.manager,null),Z=q.cbpairs.length<X.cbpairs.length?q.cbpairs:X.cbpairs,J=Z.head;null!=J;){var Q=J.elt;if(Q.a==q&&Q.b==X||Q.a==X&&Q.b==q){H=Q;break}J=J.next}if(null==H){var $;null==en.zpp_pool?$=new en:($=en.zpp_pool,en.zpp_pool=$.next,$.next=null),$.zip_listeners=!0,$e.setlt(q,X)?($.a=q,$.b=X):($.a=X,$.b=q),H=$,q.cbpairs.add(H),X!=q&&X.cbpairs.add(H)}H.zip_listeners&&(H.zip_listeners=!1,H.__validate());for(var ee=H.listeners.head;null!=ee;){var ne=ee.elt;if(6==ne.event&&(!W||ne.allowSleepingCallbacks)&&!U.empty_arb(ne.itype)){var ie=t.push_callback(ne);ie.event=6;var te,le=U.int1,ae=U.int2,re=ne.options1,pe=le.cbTypes;if(re.nonemptyintersection(pe,re.includes)&&!re.nonemptyintersection(pe,re.excludes)){var se=ne.options2,oe=ae.cbTypes;te=!!se.nonemptyintersection(oe,se.includes)&&!se.nonemptyintersection(oe,se.excludes)}else te=!1;te?(ie.int1=le,ie.int2=ae):(ie.int1=ae,ie.int2=le),ie.set=U}ee=ee.next}V=G,G=G.next}else{var _e,he,xe=this.callbackset_list;null==V?(_e=xe.next,he=_e.next,xe.next=he,null==xe.next&&(xe.pushmod=!0)):(_e=V.next,he=_e.next,V.next=he,null==he&&(xe.pushmod=!0)),_e._inuse=!1,xe.modified=!0,xe.length--,xe.pushmod=!0,G=he;var ue=U;ue.int1=ue.int2=null,ue.id=ue.di=-1,ue.freed=!0,ue.next=Wn.zpp_pool,Wn.zpp_pool=ue}}for(;!this.callbacks.empty();){var de=this.callbacks.pop();if(0==de.listener.type){de.listener.body.handler(de.wrapper_body())}else if(1==de.listener.type){var ve=de.listener.constraint;ve.handler(de.wrapper_con())}else if(2==de.listener.type){var ce=de.listener.interaction;ce.handleri(de.wrapper_int())}var ye=de;ye.int1=ye.int2=null,ye.body=null,ye.constraint=null,ye.listener=null,null!=ye.wrap_arbiters&&(ye.wrap_arbiters.zpp_inner.inner=null),ye.set=null,ye.next=Qe.zpp_pool,Qe.zpp_pool=ye}},continuousCollisions:function(e){var n=2*Math.PI/e;this.bphase.broadphase(this,!1);for(var i=0;i<1&&null!=this.toiEvents.head;){for(var t=null,l=2,a=!1,r=null,p=null,s=this.toiEvents.head;null!=s;){var o=s.elt,_=o.s1.body,h=o.s2.body;if(_.sweepFrozen&&h.sweepFrozen){if(0==o.toi||!fn.testCollide_safe(o.s1,o.s2)){s=this.toiEvents.erase(p);var x=o;x.next=On.zpp_pool,On.zpp_pool=x;continue}o.toi=0}if(o.frozen1!=_.sweepFrozen||o.frozen2!=h.sweepFrozen){if(o.kinematic){s=this.toiEvents.erase(p);var u=o;u.next=On.zpp_pool,On.zpp_pool=u;continue}if(o.frozen1=_.sweepFrozen,o.frozen2=h.sweepFrozen,o.frozen1){var d=o.s1;o.s1=o.s2,o.s2=d,o.frozen1=!1,o.frozen2=!0}if(kn.staticSweep(o,e,0,O.collisionSlopCCD),o.toi<0){s=this.toiEvents.erase(p);var v=o;v.next=On.zpp_pool,On.zpp_pool=v;continue}}o.toi>=0&&(o.toi<l||!a&&o.kinematic)&&(t=o,l=o.toi,a=o.kinematic,r=p),p=s,s=s.next}if(null==t)break;this.toiEvents.erase(r),i=t.toi;var c=t.s1.body,y=t.s2.body;if(!c.sweepFrozen){var m=i*e,z=m-c.sweepTime;if(0!=z){c.sweepTime=m;var f=z;if(c.posx+=c.velx*f,c.posy+=c.vely*f,0!=c.angvel){var b=c.sweep_angvel*z;if(c.rot+=b,b*b>1e-4)c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot);else{var g=b*b,w=1-.5*g,C=1-g*g/8,M=(w*c.axisx+b*c.axisy)*C;c.axisy=(w*c.axisy-b*c.axisx)*C,c.axisx=M}}}var k=t.s1;if(0==k.type)k.worldCOMx=c.posx+(c.axisy*k.localCOMx-c.axisx*k.localCOMy),k.worldCOMy=c.posy+(k.localCOMx*c.axisx+k.localCOMy*c.axisy);else{for(var S=k.polygon,A=S.lverts.next,T=S.gverts.next;null!=T;){var E=T,I=A;A=A.next,E.x=c.posx+(c.axisy*I.x-c.axisx*I.y),E.y=c.posy+(I.x*c.axisx+I.y*c.axisy),T=T.next}var j=S.edges.head,N=S.gverts.next,D=N;for(N=N.next;null!=N;){var L=N,F=j.elt;j=j.next,F.gnormx=c.axisy*F.lnormx-c.axisx*F.lnormy,F.gnormy=F.lnormx*c.axisx+F.lnormy*c.axisy,F.gprojection=c.posx*F.gnormx+c.posy*F.gnormy+F.lprojection,F.tp0=D.y*F.gnormx-D.x*F.gnormy,F.tp1=L.y*F.gnormx-L.x*F.gnormy,D=L,N=N.next}var P=S.gverts.next,R=j.elt;j=j.next,R.gnormx=c.axisy*R.lnormx-c.axisx*R.lnormy,R.gnormy=R.lnormx*c.axisx+R.lnormy*c.axisy,R.gprojection=c.posx*R.gnormx+c.posy*R.gnormy+R.lprojection,R.tp0=D.y*R.gnormx-D.x*R.gnormy,R.tp1=P.y*R.gnormx-P.x*R.gnormy}}if(!y.sweepFrozen){var B=i*e,V=B-y.sweepTime;if(0!=V){y.sweepTime=B;var G=V;if(y.posx+=y.velx*G,y.posy+=y.vely*G,0!=y.angvel){var U=y.sweep_angvel*V;if(y.rot+=U,U*U>1e-4)y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot);else{var Y=U*U,K=1-.5*Y,W=1-Y*Y/8,q=(K*y.axisx+U*y.axisy)*W;y.axisy=(K*y.axisy-U*y.axisx)*W,y.axisx=q}}}var X=t.s2;if(0==X.type)X.worldCOMx=y.posx+(y.axisy*X.localCOMx-y.axisx*X.localCOMy),X.worldCOMy=y.posy+(X.localCOMx*y.axisx+X.localCOMy*y.axisy);else{for(var H=X.polygon,Z=H.lverts.next,J=H.gverts.next;null!=J;){var Q=J,$=Z;Z=Z.next,Q.x=y.posx+(y.axisy*$.x-y.axisx*$.y),Q.y=y.posy+($.x*y.axisx+$.y*y.axisy),J=J.next}var ee=H.edges.head,ne=H.gverts.next,ie=ne;for(ne=ne.next;null!=ne;){var te=ne,le=ee.elt;ee=ee.next,le.gnormx=y.axisy*le.lnormx-y.axisx*le.lnormy,le.gnormy=le.lnormx*y.axisx+le.lnormy*y.axisy,le.gprojection=y.posx*le.gnormx+y.posy*le.gnormy+le.lprojection,le.tp0=ie.y*le.gnormx-ie.x*le.gnormy,le.tp1=te.y*le.gnormx-te.x*le.gnormy,ie=te,ne=ne.next}var ae=H.gverts.next,re=ee.elt;ee=ee.next,re.gnormx=y.axisy*re.lnormx-y.axisx*re.lnormy,re.gnormy=re.lnormx*y.axisx+re.lnormy*y.axisy,re.gprojection=y.posx*re.gnormx+y.posy*re.gnormy+re.lprojection,re.tp0=ie.y*re.gnormx-ie.x*re.gnormy,re.tp1=ae.y*re.gnormx-ae.x*re.gnormy}}var pe=(t.arbiter,this.narrowPhase(t.s1,t.s2,!0,t.arbiter,!0));if(null==pe)null!=t.arbiter&&null!=t.arbiter.pair&&(t.arbiter.pair.arb=null,t.arbiter.pair=null);else if(!this.presteparb(pe,e,!0)&&pe.type==_n.COL&&pe.active&&0!=(1&pe.immState)){var se=pe.colarb,oe=se.nx*se.c1.jnAcc-se.ny*se.c1.jtAcc,_e=se.ny*se.c1.jnAcc+se.nx*se.c1.jtAcc,he=se.b1.imass;se.b1.velx-=oe*he,se.b1.vely-=_e*he,se.b1.angvel-=se.b1.iinertia*(_e*se.c1.r1x-oe*se.c1.r1y);var xe=se.b2.imass;if(se.b2.velx+=oe*xe,se.b2.vely+=_e*xe,se.b2.angvel+=se.b2.iinertia*(_e*se.c1.r2x-oe*se.c1.r2y),se.hc2){var ue=se.nx*se.c2.jnAcc-se.ny*se.c2.jtAcc,de=se.ny*se.c2.jnAcc+se.nx*se.c2.jtAcc,ve=se.b1.imass;se.b1.velx-=ue*ve,se.b1.vely-=de*ve,se.b1.angvel-=se.b1.iinertia*(de*se.c2.r1x-ue*se.c2.r1y);var ce=se.b2.imass;se.b2.velx+=ue*ce,se.b2.vely+=de*ce,se.b2.angvel+=se.b2.iinertia*(de*se.c2.r2x-ue*se.c2.r2y)}se.b2.angvel+=se.jrAcc*se.b2.iinertia,se.b1.angvel-=se.jrAcc*se.b1.iinertia;var ye,me,ze,fe,be,ge,we=pe.colarb,Ce=we.k1x+we.b2.velx-we.c1.r2y*we.b2.angvel-(we.b1.velx-we.c1.r1y*we.b1.angvel),Me=we.k1y+we.b2.vely+we.c1.r2x*we.b2.angvel-(we.b1.vely+we.c1.r1x*we.b1.angvel);if(ze=(Me*we.nx-Ce*we.ny+we.surfacex)*we.c1.tMass,fe=we.c1.friction*we.c1.jnAcc,be=we.c1.jtAcc,ge=be-ze,ge>fe?ge=fe:ge<-fe&&(ge=-fe),ze=ge-be,we.c1.jtAcc=ge,ye=-we.ny*ze,me=we.nx*ze,we.b2.velx+=ye*we.b2.imass,we.b2.vely+=me*we.b2.imass,we.b1.velx-=ye*we.b1.imass,we.b1.vely-=me*we.b1.imass,we.b2.angvel+=we.rt1b*ze*we.b2.iinertia,we.b1.angvel-=we.rt1a*ze*we.b1.iinertia,we.hc2){var Oe=we.k2x+we.b2.velx-we.c2.r2y*we.b2.angvel-(we.b1.velx-we.c2.r1y*we.b1.angvel),ke=we.k2y+we.b2.vely+we.c2.r2x*we.b2.angvel-(we.b1.vely+we.c2.r1x*we.b1.angvel);ze=(ke*we.nx-Oe*we.ny+we.surfacex)*we.c2.tMass,fe=we.c2.friction*we.c2.jnAcc,be=we.c2.jtAcc,ge=be-ze,ge>fe?ge=fe:ge<-fe&&(ge=-fe),ze=ge-be,we.c2.jtAcc=ge,ye=-we.ny*ze,me=we.nx*ze,we.b2.velx+=ye*we.b2.imass,we.b2.vely+=me*we.b2.imass,we.b1.velx-=ye*we.b1.imass,we.b1.vely-=me*we.b1.imass,we.b2.angvel+=we.rt2b*ze*we.b2.iinertia,we.b1.angvel-=we.rt2a*ze*we.b1.iinertia,Ce=we.k1x+we.b2.velx-we.c1.r2y*we.b2.angvel-(we.b1.velx-we.c1.r1y*we.b1.angvel),Me=we.k1y+we.b2.vely+we.c1.r2x*we.b2.angvel-(we.b1.vely+we.c1.r1x*we.b1.angvel),Oe=we.k2x+we.b2.velx-we.c2.r2y*we.b2.angvel-(we.b1.velx-we.c2.r1y*we.b1.angvel),ke=we.k2y+we.b2.vely+we.c2.r2x*we.b2.angvel-(we.b1.vely+we.c2.r1x*we.b1.angvel);var Se=we.c1.jnAcc,Ae=we.c2.jnAcc,Te=Ce*we.nx+Me*we.ny+we.surfacey+we.c1.bounce-(we.Ka*Se+we.Kb*Ae),Ee=Oe*we.nx+ke*we.ny+we.surfacey+we.c2.bounce-(we.Kb*Se+we.Kc*Ae),Ie=-(we.kMassa*Te+we.kMassb*Ee),je=-(we.kMassb*Te+we.kMassc*Ee);Ie>=0&&je>=0?(Te=Ie-Se,Ee=je-Ae,we.c1.jnAcc=Ie,we.c2.jnAcc=je):(Ie=-we.c1.nMass*Te,Ie>=0&&we.Kb*Ie+Ee>=0?(Te=Ie-Se,Ee=-Ae,we.c1.jnAcc=Ie,we.c2.jnAcc=0):(je=-we.c2.nMass*Ee,je>=0&&we.Kb*je+Te>=0?(Te=-Se,Ee=je-Ae,we.c1.jnAcc=0,we.c2.jnAcc=je):Te>=0&&Ee>=0?(Te=-Se,Ee=-Ae,we.c1.jnAcc=we.c2.jnAcc=0):(Te=0,Ee=0))),ze=Te+Ee,ye=we.nx*ze,me=we.ny*ze,we.b2.velx+=ye*we.b2.imass,we.b2.vely+=me*we.b2.imass,we.b1.velx-=ye*we.b1.imass,we.b1.vely-=me*we.b1.imass,we.b2.angvel+=(we.rn1b*Te+we.rn2b*Ee)*we.b2.iinertia,we.b1.angvel-=(we.rn1a*Te+we.rn2a*Ee)*we.b1.iinertia}else{if(0!=we.radius){var Ne=we.b2.angvel-we.b1.angvel;ze=Ne*we.rMass,fe=we.rfric*we.c1.jnAcc,be=we.jrAcc,we.jrAcc-=ze,we.jrAcc>fe?we.jrAcc=fe:we.jrAcc<-fe&&(we.jrAcc=-fe),ze=we.jrAcc-be,we.b2.angvel+=ze*we.b2.iinertia,we.b1.angvel-=ze*we.b1.iinertia}Ce=we.k1x+we.b2.velx-we.c1.r2y*we.b2.angvel-(we.b1.velx-we.c1.r1y*we.b1.angvel),Me=we.k1y+we.b2.vely+we.c1.r2x*we.b2.angvel-(we.b1.vely+we.c1.r1x*we.b1.angvel),ze=(we.c1.bounce+(we.nx*Ce+we.ny*Me)+we.surfacey)*we.c1.nMass,be=we.c1.jnAcc,ge=be-ze,ge<0&&(ge=0),ze=ge-be,we.c1.jnAcc=ge,ye=we.nx*ze,me=we.ny*ze,we.b2.velx+=ye*we.b2.imass,we.b2.vely+=me*we.b2.imass,we.b1.velx-=ye*we.b1.imass,we.b1.vely-=me*we.b1.imass,we.b2.angvel+=we.rn1b*ze*we.b2.iinertia,we.b1.angvel-=we.rn1a*ze*we.b1.iinertia}var De,Le,Fe,Pe,Re,Be,Ve=pe.colarb,Ge=Ve.k1x+Ve.b2.velx-Ve.c1.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c1.r1y*Ve.b1.angvel),Ue=Ve.k1y+Ve.b2.vely+Ve.c1.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c1.r1x*Ve.b1.angvel);if(Fe=(Ue*Ve.nx-Ge*Ve.ny+Ve.surfacex)*Ve.c1.tMass,Pe=Ve.c1.friction*Ve.c1.jnAcc,Re=Ve.c1.jtAcc,Be=Re-Fe,Be>Pe?Be=Pe:Be<-Pe&&(Be=-Pe),Fe=Be-Re,Ve.c1.jtAcc=Be,De=-Ve.ny*Fe,Le=Ve.nx*Fe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Le*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Le*Ve.b1.imass,Ve.b2.angvel+=Ve.rt1b*Fe*Ve.b2.iinertia,Ve.b1.angvel-=Ve.rt1a*Fe*Ve.b1.iinertia,Ve.hc2){var Ye=Ve.k2x+Ve.b2.velx-Ve.c2.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c2.r1y*Ve.b1.angvel),Ke=Ve.k2y+Ve.b2.vely+Ve.c2.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c2.r1x*Ve.b1.angvel);Fe=(Ke*Ve.nx-Ye*Ve.ny+Ve.surfacex)*Ve.c2.tMass,Pe=Ve.c2.friction*Ve.c2.jnAcc,Re=Ve.c2.jtAcc,Be=Re-Fe,Be>Pe?Be=Pe:Be<-Pe&&(Be=-Pe),Fe=Be-Re,Ve.c2.jtAcc=Be,De=-Ve.ny*Fe,Le=Ve.nx*Fe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Le*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Le*Ve.b1.imass,Ve.b2.angvel+=Ve.rt2b*Fe*Ve.b2.iinertia,Ve.b1.angvel-=Ve.rt2a*Fe*Ve.b1.iinertia,Ge=Ve.k1x+Ve.b2.velx-Ve.c1.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c1.r1y*Ve.b1.angvel),Ue=Ve.k1y+Ve.b2.vely+Ve.c1.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c1.r1x*Ve.b1.angvel),Ye=Ve.k2x+Ve.b2.velx-Ve.c2.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c2.r1y*Ve.b1.angvel),Ke=Ve.k2y+Ve.b2.vely+Ve.c2.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c2.r1x*Ve.b1.angvel);var We=Ve.c1.jnAcc,qe=Ve.c2.jnAcc,Xe=Ge*Ve.nx+Ue*Ve.ny+Ve.surfacey+Ve.c1.bounce-(Ve.Ka*We+Ve.Kb*qe),He=Ye*Ve.nx+Ke*Ve.ny+Ve.surfacey+Ve.c2.bounce-(Ve.Kb*We+Ve.Kc*qe),Ze=-(Ve.kMassa*Xe+Ve.kMassb*He),Je=-(Ve.kMassb*Xe+Ve.kMassc*He);Ze>=0&&Je>=0?(Xe=Ze-We,He=Je-qe,Ve.c1.jnAcc=Ze,Ve.c2.jnAcc=Je):(Ze=-Ve.c1.nMass*Xe,Ze>=0&&Ve.Kb*Ze+He>=0?(Xe=Ze-We,He=-qe,Ve.c1.jnAcc=Ze,Ve.c2.jnAcc=0):(Je=-Ve.c2.nMass*He,Je>=0&&Ve.Kb*Je+Xe>=0?(Xe=-We,He=Je-qe,Ve.c1.jnAcc=0,Ve.c2.jnAcc=Je):Xe>=0&&He>=0?(Xe=-We,He=-qe,Ve.c1.jnAcc=Ve.c2.jnAcc=0):(Xe=0,He=0))),Fe=Xe+He,De=Ve.nx*Fe,Le=Ve.ny*Fe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Le*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Le*Ve.b1.imass,Ve.b2.angvel+=(Ve.rn1b*Xe+Ve.rn2b*He)*Ve.b2.iinertia,Ve.b1.angvel-=(Ve.rn1a*Xe+Ve.rn2a*He)*Ve.b1.iinertia}else{if(0!=Ve.radius){var Qe=Ve.b2.angvel-Ve.b1.angvel;Fe=Qe*Ve.rMass,Pe=Ve.rfric*Ve.c1.jnAcc,Re=Ve.jrAcc,Ve.jrAcc-=Fe,Ve.jrAcc>Pe?Ve.jrAcc=Pe:Ve.jrAcc<-Pe&&(Ve.jrAcc=-Pe),Fe=Ve.jrAcc-Re,Ve.b2.angvel+=Fe*Ve.b2.iinertia,Ve.b1.angvel-=Fe*Ve.b1.iinertia}Ge=Ve.k1x+Ve.b2.velx-Ve.c1.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c1.r1y*Ve.b1.angvel),Ue=Ve.k1y+Ve.b2.vely+Ve.c1.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c1.r1x*Ve.b1.angvel),Fe=(Ve.c1.bounce+(Ve.nx*Ge+Ve.ny*Ue)+Ve.surfacey)*Ve.c1.nMass,Re=Ve.c1.jnAcc,Be=Re-Fe,Be<0&&(Be=0),Fe=Be-Re,Ve.c1.jnAcc=Be,De=Ve.nx*Fe,Le=Ve.ny*Fe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Le*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Le*Ve.b1.imass,Ve.b2.angvel+=Ve.rn1b*Fe*Ve.b2.iinertia,Ve.b1.angvel-=Ve.rn1a*Fe*Ve.b1.iinertia}var $e,en,nn,tn,ln,an,rn=pe.colarb,pn=rn.k1x+rn.b2.velx-rn.c1.r2y*rn.b2.angvel-(rn.b1.velx-rn.c1.r1y*rn.b1.angvel),sn=rn.k1y+rn.b2.vely+rn.c1.r2x*rn.b2.angvel-(rn.b1.vely+rn.c1.r1x*rn.b1.angvel);if(nn=(sn*rn.nx-pn*rn.ny+rn.surfacex)*rn.c1.tMass,tn=rn.c1.friction*rn.c1.jnAcc,ln=rn.c1.jtAcc,an=ln-nn,an>tn?an=tn:an<-tn&&(an=-tn),nn=an-ln,rn.c1.jtAcc=an,$e=-rn.ny*nn,en=rn.nx*nn,rn.b2.velx+=$e*rn.b2.imass,rn.b2.vely+=en*rn.b2.imass,rn.b1.velx-=$e*rn.b1.imass,rn.b1.vely-=en*rn.b1.imass,rn.b2.angvel+=rn.rt1b*nn*rn.b2.iinertia,rn.b1.angvel-=rn.rt1a*nn*rn.b1.iinertia,rn.hc2){var on=rn.k2x+rn.b2.velx-rn.c2.r2y*rn.b2.angvel-(rn.b1.velx-rn.c2.r1y*rn.b1.angvel),hn=rn.k2y+rn.b2.vely+rn.c2.r2x*rn.b2.angvel-(rn.b1.vely+rn.c2.r1x*rn.b1.angvel);nn=(hn*rn.nx-on*rn.ny+rn.surfacex)*rn.c2.tMass,tn=rn.c2.friction*rn.c2.jnAcc,ln=rn.c2.jtAcc,an=ln-nn,an>tn?an=tn:an<-tn&&(an=-tn),nn=an-ln,rn.c2.jtAcc=an,$e=-rn.ny*nn,en=rn.nx*nn,rn.b2.velx+=$e*rn.b2.imass,rn.b2.vely+=en*rn.b2.imass,rn.b1.velx-=$e*rn.b1.imass,rn.b1.vely-=en*rn.b1.imass,rn.b2.angvel+=rn.rt2b*nn*rn.b2.iinertia,rn.b1.angvel-=rn.rt2a*nn*rn.b1.iinertia,pn=rn.k1x+rn.b2.velx-rn.c1.r2y*rn.b2.angvel-(rn.b1.velx-rn.c1.r1y*rn.b1.angvel),sn=rn.k1y+rn.b2.vely+rn.c1.r2x*rn.b2.angvel-(rn.b1.vely+rn.c1.r1x*rn.b1.angvel),on=rn.k2x+rn.b2.velx-rn.c2.r2y*rn.b2.angvel-(rn.b1.velx-rn.c2.r1y*rn.b1.angvel),hn=rn.k2y+rn.b2.vely+rn.c2.r2x*rn.b2.angvel-(rn.b1.vely+rn.c2.r1x*rn.b1.angvel);var xn=rn.c1.jnAcc,un=rn.c2.jnAcc,dn=pn*rn.nx+sn*rn.ny+rn.surfacey+rn.c1.bounce-(rn.Ka*xn+rn.Kb*un),vn=on*rn.nx+hn*rn.ny+rn.surfacey+rn.c2.bounce-(rn.Kb*xn+rn.Kc*un),cn=-(rn.kMassa*dn+rn.kMassb*vn),yn=-(rn.kMassb*dn+rn.kMassc*vn);cn>=0&&yn>=0?(dn=cn-xn,vn=yn-un,rn.c1.jnAcc=cn,rn.c2.jnAcc=yn):(cn=-rn.c1.nMass*dn,cn>=0&&rn.Kb*cn+vn>=0?(dn=cn-xn,vn=-un,rn.c1.jnAcc=cn,rn.c2.jnAcc=0):(yn=-rn.c2.nMass*vn,yn>=0&&rn.Kb*yn+dn>=0?(dn=-xn,vn=yn-un,rn.c1.jnAcc=0,rn.c2.jnAcc=yn):dn>=0&&vn>=0?(dn=-xn,vn=-un,rn.c1.jnAcc=rn.c2.jnAcc=0):(dn=0,vn=0))),nn=dn+vn,$e=rn.nx*nn,en=rn.ny*nn,rn.b2.velx+=$e*rn.b2.imass,rn.b2.vely+=en*rn.b2.imass,rn.b1.velx-=$e*rn.b1.imass,rn.b1.vely-=en*rn.b1.imass,rn.b2.angvel+=(rn.rn1b*dn+rn.rn2b*vn)*rn.b2.iinertia,rn.b1.angvel-=(rn.rn1a*dn+rn.rn2a*vn)*rn.b1.iinertia}else{if(0!=rn.radius){var mn=rn.b2.angvel-rn.b1.angvel;nn=mn*rn.rMass,tn=rn.rfric*rn.c1.jnAcc,ln=rn.jrAcc,rn.jrAcc-=nn,rn.jrAcc>tn?rn.jrAcc=tn:rn.jrAcc<-tn&&(rn.jrAcc=-tn),nn=rn.jrAcc-ln,rn.b2.angvel+=nn*rn.b2.iinertia,rn.b1.angvel-=nn*rn.b1.iinertia}pn=rn.k1x+rn.b2.velx-rn.c1.r2y*rn.b2.angvel-(rn.b1.velx-rn.c1.r1y*rn.b1.angvel),sn=rn.k1y+rn.b2.vely+rn.c1.r2x*rn.b2.angvel-(rn.b1.vely+rn.c1.r1x*rn.b1.angvel),nn=(rn.c1.bounce+(rn.nx*pn+rn.ny*sn)+rn.surfacey)*rn.c1.nMass,ln=rn.c1.jnAcc,an=ln-nn,an<0&&(an=0),nn=an-ln,rn.c1.jnAcc=an,$e=rn.nx*nn,en=rn.ny*nn,rn.b2.velx+=$e*rn.b2.imass,rn.b2.vely+=en*rn.b2.imass,rn.b1.velx-=$e*rn.b1.imass,rn.b1.vely-=en*rn.b1.imass,rn.b2.angvel+=rn.rn1b*nn*rn.b2.iinertia,rn.b1.angvel-=rn.rn1a*nn*rn.b1.iinertia}var zn,bn,gn,wn,Cn,Mn,Sn=pe.colarb,An=Sn.k1x+Sn.b2.velx-Sn.c1.r2y*Sn.b2.angvel-(Sn.b1.velx-Sn.c1.r1y*Sn.b1.angvel),Tn=Sn.k1y+Sn.b2.vely+Sn.c1.r2x*Sn.b2.angvel-(Sn.b1.vely+Sn.c1.r1x*Sn.b1.angvel);if(gn=(Tn*Sn.nx-An*Sn.ny+Sn.surfacex)*Sn.c1.tMass,wn=Sn.c1.friction*Sn.c1.jnAcc,Cn=Sn.c1.jtAcc,Mn=Cn-gn,Mn>wn?Mn=wn:Mn<-wn&&(Mn=-wn),gn=Mn-Cn,Sn.c1.jtAcc=Mn,zn=-Sn.ny*gn,bn=Sn.nx*gn,Sn.b2.velx+=zn*Sn.b2.imass,Sn.b2.vely+=bn*Sn.b2.imass,Sn.b1.velx-=zn*Sn.b1.imass,Sn.b1.vely-=bn*Sn.b1.imass,Sn.b2.angvel+=Sn.rt1b*gn*Sn.b2.iinertia,Sn.b1.angvel-=Sn.rt1a*gn*Sn.b1.iinertia,Sn.hc2){var En=Sn.k2x+Sn.b2.velx-Sn.c2.r2y*Sn.b2.angvel-(Sn.b1.velx-Sn.c2.r1y*Sn.b1.angvel),In=Sn.k2y+Sn.b2.vely+Sn.c2.r2x*Sn.b2.angvel-(Sn.b1.vely+Sn.c2.r1x*Sn.b1.angvel);gn=(In*Sn.nx-En*Sn.ny+Sn.surfacex)*Sn.c2.tMass,wn=Sn.c2.friction*Sn.c2.jnAcc,Cn=Sn.c2.jtAcc,Mn=Cn-gn,Mn>wn?Mn=wn:Mn<-wn&&(Mn=-wn),gn=Mn-Cn,Sn.c2.jtAcc=Mn,zn=-Sn.ny*gn,bn=Sn.nx*gn,Sn.b2.velx+=zn*Sn.b2.imass,Sn.b2.vely+=bn*Sn.b2.imass,Sn.b1.velx-=zn*Sn.b1.imass,Sn.b1.vely-=bn*Sn.b1.imass,Sn.b2.angvel+=Sn.rt2b*gn*Sn.b2.iinertia,Sn.b1.angvel-=Sn.rt2a*gn*Sn.b1.iinertia,An=Sn.k1x+Sn.b2.velx-Sn.c1.r2y*Sn.b2.angvel-(Sn.b1.velx-Sn.c1.r1y*Sn.b1.angvel),Tn=Sn.k1y+Sn.b2.vely+Sn.c1.r2x*Sn.b2.angvel-(Sn.b1.vely+Sn.c1.r1x*Sn.b1.angvel),En=Sn.k2x+Sn.b2.velx-Sn.c2.r2y*Sn.b2.angvel-(Sn.b1.velx-Sn.c2.r1y*Sn.b1.angvel),In=Sn.k2y+Sn.b2.vely+Sn.c2.r2x*Sn.b2.angvel-(Sn.b1.vely+Sn.c2.r1x*Sn.b1.angvel);var jn=Sn.c1.jnAcc,Nn=Sn.c2.jnAcc,Dn=An*Sn.nx+Tn*Sn.ny+Sn.surfacey+Sn.c1.bounce-(Sn.Ka*jn+Sn.Kb*Nn),Ln=En*Sn.nx+In*Sn.ny+Sn.surfacey+Sn.c2.bounce-(Sn.Kb*jn+Sn.Kc*Nn),Fn=-(Sn.kMassa*Dn+Sn.kMassb*Ln),Pn=-(Sn.kMassb*Dn+Sn.kMassc*Ln);Fn>=0&&Pn>=0?(Dn=Fn-jn,Ln=Pn-Nn,Sn.c1.jnAcc=Fn,Sn.c2.jnAcc=Pn):(Fn=-Sn.c1.nMass*Dn,Fn>=0&&Sn.Kb*Fn+Ln>=0?(Dn=Fn-jn,Ln=-Nn,Sn.c1.jnAcc=Fn,Sn.c2.jnAcc=0):(Pn=-Sn.c2.nMass*Ln,Pn>=0&&Sn.Kb*Pn+Dn>=0?(Dn=-jn,Ln=Pn-Nn,Sn.c1.jnAcc=0,Sn.c2.jnAcc=Pn):Dn>=0&&Ln>=0?(Dn=-jn,Ln=-Nn,Sn.c1.jnAcc=Sn.c2.jnAcc=0):(Dn=0,Ln=0))),gn=Dn+Ln,zn=Sn.nx*gn,bn=Sn.ny*gn,Sn.b2.velx+=zn*Sn.b2.imass,Sn.b2.vely+=bn*Sn.b2.imass,Sn.b1.velx-=zn*Sn.b1.imass,Sn.b1.vely-=bn*Sn.b1.imass,Sn.b2.angvel+=(Sn.rn1b*Dn+Sn.rn2b*Ln)*Sn.b2.iinertia,Sn.b1.angvel-=(Sn.rn1a*Dn+Sn.rn2a*Ln)*Sn.b1.iinertia}else{if(0!=Sn.radius){var Rn=Sn.b2.angvel-Sn.b1.angvel;gn=Rn*Sn.rMass,wn=Sn.rfric*Sn.c1.jnAcc,Cn=Sn.jrAcc,Sn.jrAcc-=gn,Sn.jrAcc>wn?Sn.jrAcc=wn:Sn.jrAcc<-wn&&(Sn.jrAcc=-wn),gn=Sn.jrAcc-Cn,Sn.b2.angvel+=gn*Sn.b2.iinertia,Sn.b1.angvel-=gn*Sn.b1.iinertia}An=Sn.k1x+Sn.b2.velx-Sn.c1.r2y*Sn.b2.angvel-(Sn.b1.velx-Sn.c1.r1y*Sn.b1.angvel),Tn=Sn.k1y+Sn.b2.vely+Sn.c1.r2x*Sn.b2.angvel-(Sn.b1.vely+Sn.c1.r1x*Sn.b1.angvel),gn=(Sn.c1.bounce+(Sn.nx*An+Sn.ny*Tn)+Sn.surfacey)*Sn.c1.nMass,Cn=Sn.c1.jnAcc,Mn=Cn-gn,Mn<0&&(Mn=0),gn=Mn-Cn,Sn.c1.jnAcc=Mn,zn=Sn.nx*gn,bn=Sn.ny*gn,Sn.b2.velx+=zn*Sn.b2.imass,Sn.b2.vely+=bn*Sn.b2.imass,Sn.b1.velx-=zn*Sn.b1.imass,Sn.b1.vely-=bn*Sn.b1.imass,Sn.b2.angvel+=Sn.rn1b*gn*Sn.b2.iinertia,Sn.b1.angvel-=Sn.rn1a*gn*Sn.b1.iinertia}c.sweep_angvel=c.angvel%n,y.sweep_angvel=y.angvel%n}if(null!=pe&&pe.active&&0!=(1&pe.immState)&&pe.type==_n.COL){if(!c.sweepFrozen&&3!=c.type)if(c.sweepFrozen=!0,t.failed)c.angvel=c.sweep_angvel=0;else if(t.slipped){var Bn=c;Bn.sweep_angvel*=O.angularCCDSlipScale,c.angvel=Bn.sweep_angvel}else c.angvel=c.sweep_angvel;if(!y.sweepFrozen&&3!=y.type)if(y.sweepFrozen=!0,t.failed)y.angvel=y.sweep_angvel=0;else if(t.slipped){var Vn=y;Vn.sweep_angvel*=O.angularCCDSlipScale,y.angvel=Vn.sweep_angvel}else y.angvel=y.sweep_angvel}var Gn=t;Gn.next=On.zpp_pool,On.zpp_pool=Gn}for(;null!=this.toiEvents.head;){var Un=this.toiEvents.pop_unsafe(),Yn=Un;Yn.next=On.zpp_pool,On.zpp_pool=Yn}for(var Kn=this.kinematics.head;null!=Kn;){var Wn=Kn.elt,qn=e-Wn.sweepTime;if(0!=qn){Wn.sweepTime=e;var Xn=qn;if(Wn.posx+=Wn.velx*Xn,Wn.posy+=Wn.vely*Xn,0!=Wn.angvel){var Hn=Wn.sweep_angvel*qn;if(Wn.rot+=Hn,Hn*Hn>1e-4)Wn.axisx=Math.sin(Wn.rot),Wn.axisy=Math.cos(Wn.rot);else{var Zn=Hn*Hn,Jn=1-.5*Zn,Qn=1-Zn*Zn/8,$n=(Jn*Wn.axisx+Hn*Wn.axisy)*Qn;Wn.axisy=(Jn*Wn.axisy-Hn*Wn.axisx)*Qn,Wn.axisx=$n}}}Wn.sweepTime=0,Kn=Kn.next}for(var ei=this.live.head;null!=ei;){var ni=ei.elt;if(!ni.sweepFrozen){var ii=e-ni.sweepTime;if(0!=ii){ni.sweepTime=e;var ti=ii;if(ni.posx+=ni.velx*ti,ni.posy+=ni.vely*ti,0!=ni.angvel){var li=ni.sweep_angvel*ii;if(ni.rot+=li,li*li>1e-4)ni.axisx=Math.sin(ni.rot),ni.axisy=Math.cos(ni.rot);else{var ai=li*li,ri=1-.5*ai,pi=1-ai*ai/8,si=(ri*ni.axisx+li*ni.axisy)*pi;ni.axisy=(ri*ni.axisy-li*ni.axisx)*pi,ni.axisx=si}}}}ni.sweepTime=0,ei=ei.next}},continuousEvent:function(e,n,i,t,l){if(e.body.sweepFrozen&&n.body.sweepFrozen)return t;if(e.body.disableCCD||n.body.disableCCD)return t;var a;if(null==t||null!=t.colarb){var r,p=e.body,s=n.body;r=!1;for(var o=p.constraints.head;null!=o;){var _=o.elt;if(_.ignore&&_.pair_exists(p.id,s.id)){r=!0;break}o=o.next}var h,x;if(r)x=!1;else{for(var u=e;null!=u&&null==u.group;)u=null!=u.ishape?u.ishape.body:null!=u.icompound?u.icompound.compound:u.ibody.compound;var d,v=null==u?null:u.group;if(null==v)d=!1;else{for(var c=n;null!=c&&null==c.group;)c=null!=c.ishape?c.ishape.body:null!=c.icompound?c.icompound.compound:c.ibody.compound;var y=null==c?null:c.group;if(null==y)d=!1;else{for(var m=!1;null!=v&&null!=y;){if(v==y){m=v.ignore;break}v.depth<y.depth?y=y.group:v=v.group}d=m}}x=!d}if(x){var z;if(e.sensorEnabled||n.sensorEnabled){var f=e.filter,b=n.filter;z=0!=(f.sensorMask&b.sensorGroup)&&0!=(b.sensorMask&f.sensorGroup)}else z=!1;if(z)h=2;else{var g;if(e.fluidEnabled||n.fluidEnabled){var w=e.filter,C=n.filter;g=0!=(w.fluidMask&C.fluidGroup)&&0!=(C.fluidMask&w.fluidGroup)}else g=!1;if(!!g&&!(0==p.imass&&0==s.imass&&0==p.iinertia&&0==s.iinertia))h=0;else{var M,k=e.filter,S=n.filter;M=0!=(k.collisionMask&S.collisionGroup)&&0!=(S.collisionMask&k.collisionGroup)&&!(0==p.imass&&0==s.imass&&0==p.iinertia&&0==s.iinertia),h=M?1:-1}}}else h=-1;a=h<=0}else a=!0;if(a)return t;var A=e.body,T=n.body;if(i||A.bullet||T.bullet){var E;null==On.zpp_pool?E=new On:(E=On.zpp_pool,On.zpp_pool=E.next,E.next=null),E.failed=!1,E.s1=E.s2=null,E.arbiter=null;var I=3==A.type||3==T.type;if(i&&!I)2!=e.body.type?(E.s2=e,E.s1=n):(E.s1=e,E.s2=n),E.kinematic=!1,kn.staticSweep(E,this.pre_dt,0,O.collisionSlopCCD);else if(E.s1=e,E.s2=n,E.kinematic=I,E.s1.body.sweepFrozen||E.s2.body.sweepFrozen){if(E.s1.body.sweepFrozen){var j=E.s1;E.s1=E.s2,E.s2=j,E.frozen1=!1,E.frozen2=!0}kn.staticSweep(E,this.pre_dt,0,O.collisionSlopCCD)}else kn.dynamicSweep(E,this.pre_dt,0,O.collisionSlopCCD);if(i&&E.toi<0||E.failed){var N=E;N.next=On.zpp_pool,On.zpp_pool=N}else this.toiEvents.add(E),E.frozen1=E.s1.body.sweepFrozen,E.frozen2=E.s2.body.sweepFrozen,E.arbiter=null!=t?t.colarb:null}return t},bodyCbWake:function(e){if(2==e.type&&null!=e.cbSet)if(this.midstep)for(var n=e.cbSet.bodylisteners.head;null!=n;){var i=n.elt;if(2==i.event){var t=this.push_callback(i);t.event=2,t.body=e,n=n.next}else n=n.next}else e.component.woken=!0},bodyCbSleep:function(e){if(2==e.type&&null!=e.cbSet)for(var n=e.cbSet.bodylisteners.head;null!=n;){var i=n.elt;if(3==i.event){var t=this.push_callback(i);t.event=3,t.body=e,n=n.next}else n=n.next}},constraintCbWake:function(e){if(null!=e.cbSet)if(this.midstep)for(var n=e.cbSet.conlisteners.head;null!=n;){var i=n.elt;if(2==i.event){var t=this.push_callback(i);t.event=2,t.constraint=e,n=n.next}else n=n.next}else e.component.woken=!0},constraintCbSleep:function(e){if(null!=e.cbSet)for(var n=e.cbSet.conlisteners.head;null!=n;){var i=n.elt;if(3==i.event){var t=this.push_callback(i);t.event=3,t.constraint=e,n=n.next}else n=n.next}},constraintCbBreak:function(e){if(null!=e.cbSet)for(var n=e.cbSet.conlisteners.head;null!=n;){var i=n.elt;if(4==i.event){var t=this.push_callback(i);t.event=4,t.constraint=e,n=n.next}else n=n.next}},nullListenerType:function(e,n){for(var i=new b,t=e.interactors.head;null!=t;){var l=t.elt;i.add(l),t=t.next}if(e!=n)for(var a=n.interactors.head;null!=a;){var r=a.elt;i.add(r),a=a.next}for(;null!=i.head;){var p=i.pop_unsafe();if(null!=p.icompound){for(var s=p.icompound,o=s.bodies.head;null!=o;){var _=o.elt;i.add(_),o=o.next}for(var h=s.compounds.head;null!=h;){var x=h.elt;i.add(x),h=h.next}}else for(var u=null!=p.ibody?p.ibody:p.ishape.body,d=null!=p.ishape?p.ishape:null,v=u.arbiters.head;null!=v;){var c=v.elt;if(0!=c.present)if(null==d||c.ws1==d||c.ws2==d){this.MRCA_chains(c.ws1,c.ws2);for(var y=this.mrca1.head;null!=y;){var m=y.elt;if(m.cbSet==e||m.cbSet==n){for(var z=this.mrca2.head;null!=z;){var f=z.elt;if(m.cbSet==e&&f.cbSet!=n||m.cbSet==n&&f.cbSet!=e)z=z.next;else{var g=Tn.get(m,f);if(null!=g){for(;null!=g.arbiters.head;){var w=g.arbiters.pop_unsafe();w.present--}this.remove_callbackset(g)}z=z.next}}y=y.next}else y=y.next}v=v.next}else v=v.next;else v=v.next}}},nullInteractorType:function(e,n){if(null==n&&(n=e),null!=e.icompound){for(var i=e.icompound,t=i.bodies.head;null!=t;){var l=t.elt;this.nullInteractorType(l,n),t=t.next}for(var a=i.compounds.head;null!=a;){var r=a.elt;this.nullInteractorType(r,n),a=a.next}}else for(var p=null!=e.ibody?e.ibody:e.ishape.body,s=null!=e.ishape?e.ishape:null,o=p.arbiters.head;null!=o;){var _=o.elt;if(0!=_.present)if(null==s||_.ws1==s||_.ws2==s){this.MRCA_chains(_.ws1,_.ws2);for(var h=this.mrca1.head;null!=h;){for(var x=h.elt,u=this.mrca2.head;null!=u;){var d=u.elt;if(x==n||d==n){var v=Tn.get(x,d);null!=v&&(_.present--,v.remove_arb(_),null==v.arbiters.head&&this.remove_callbackset(v)),u=u.next}else u=u.next}h=h.next}o=o.next}else o=o.next;else o=o.next}},freshListenerType:function(e,n){for(var i=new b,t=e.interactors.head;null!=t;){var l=t.elt;i.add(l),t=t.next}if(e!=n)for(var a=n.interactors.head;null!=a;){var r=a.elt;i.add(r),a=a.next}for(;null!=i.head;){var p=i.pop_unsafe();if(null!=p.icompound){for(var s=p.icompound,o=s.bodies.head;null!=o;){var _=o.elt;i.add(_),o=o.next}for(var h=s.compounds.head;null!=h;){var x=h.elt;i.add(x),h=h.next}}else for(var u=null!=p.ibody?p.ibody:p.ishape.body,d=null!=p.ishape?p.ishape:null,v=u.arbiters.head;null!=v;){var c=v.elt;if(c.presentable)if(null==d||c.ws1==d||c.ws2==d){this.MRCA_chains(c.ws1,c.ws2);for(var y=this.mrca1.head;null!=y;){var m=y.elt;if(m.cbSet==e||m.cbSet==n){for(var z=this.mrca2.head;null!=z;){var f=z.elt;if(m.cbSet==e&&f.cbSet!=n||m.cbSet==n&&f.cbSet!=e)z=z.next;else{var g=Tn.get(m,f);null==g&&(g=Wn.get(m,f),this.add_callbackset(g));var w,C;C=!1;for(var M=g.arbiters.head;null!=M;){var O=M.elt;if(O==c){C=!0;break}M=M.next}if(C)w=!1;else{var k,S=g.arbiters;null==bi.zpp_pool?k=new bi:(k=bi.zpp_pool,bi.zpp_pool=k.next,k.next=null),k.elt=c;var A=k;A.next=S.head,S.head=A,S.modified=!0,S.length++,w=!0}w&&c.present++,z=z.next}}y=y.next}else y=y.next}v=v.next}else v=v.next;else v=v.next}}},freshInteractorType:function(e,n){if(null==n&&(n=e),null!=e.icompound){for(var i=e.icompound,t=i.bodies.head;null!=t;){var l=t.elt;this.freshInteractorType(l,n),t=t.next}for(var a=i.compounds.head;null!=a;){var r=a.elt;this.freshInteractorType(r,n),a=a.next}}else for(var p=null!=e.ibody?e.ibody:e.ishape.body,s=null!=e.ishape?e.ishape:null,o=p.arbiters.head;null!=o;){var _=o.elt;if(_.presentable)if(null==s||_.ws1==s||_.ws2==s){this.MRCA_chains(_.ws1,_.ws2);for(var h=this.mrca1.head;null!=h;){for(var x=h.elt,u=this.mrca2.head;null!=u;){var d=u.elt;if(x==n||d==n){var v=x.cbSet,c=d.cbSet;v.validate(),c.validate();for(var y=(v.manager,null),m=v.cbpairs.length<c.cbpairs.length?v.cbpairs:c.cbpairs,z=m.head;null!=z;){var f=z.elt;if(f.a==v&&f.b==c||f.a==c&&f.b==v){y=f;break}z=z.next}if(null==y){var b;null==en.zpp_pool?b=new en:(b=en.zpp_pool,en.zpp_pool=b.next,b.next=null),b.zip_listeners=!0,$e.setlt(v,c)?(b.a=v,b.b=c):(b.a=c,b.b=v),y=b,v.cbpairs.add(y),c!=v&&c.cbpairs.add(y)}if(y.zip_listeners&&(y.zip_listeners=!1,y.__validate()),null!=y.listeners.head){var g=Tn.get(x,d)
;null==g&&(g=Wn.get(x,d),this.add_callbackset(g));var w,C;C=!1;for(var M=g.arbiters.head;null!=M;){var O=M.elt;if(O==_){C=!0;break}M=M.next}if(C)w=!1;else{var k,S=g.arbiters;null==bi.zpp_pool?k=new bi:(k=bi.zpp_pool,bi.zpp_pool=k.next,k.next=null),k.elt=_;var A=k;A.next=S.head,S.head=A,S.modified=!0,S.length++,w=!0}w&&_.present++}u=u.next}else u=u.next}h=h.next}o=o.next}else o=o.next;else o=o.next}},wakeCompound:function(e){for(var n=e.bodies.head;null!=n;){var i=n.elt,t=i;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1)),n=n.next}for(var l=e.constraints.head;null!=l;){var a=l.elt;this.wake_constraint(a),l=l.next}for(var r=e.compounds.head;null!=r;){var p=r.elt;this.wakeCompound(p),r=r.next}},wakeIsland:function(e){for(;null!=e.comps.head;){var n=e.comps.pop_unsafe();if(n.waket=this.stamp+(this.midstep?0:1),n.isBody){var i=n.body;this.live.add(i);for(var t=i.arbiters.head;null!=t;){var l=t.elt;if(l.sleeping)if(l.sleeping=!1,l.up_stamp+=this.stamp-l.sleep_stamp,l.type==_n.COL){var a=l.colarb;if(a.stat){var r,p=this.c_arbiters_true;null==Di.zpp_pool?r=new Di:(r=Di.zpp_pool,Di.zpp_pool=r.next,r.next=null),r.elt=a;var s=r;s.next=p.head,p.head=s,p.modified=!0,p.length++}else{var o,_=this.c_arbiters_false;null==Di.zpp_pool?o=new Di:(o=Di.zpp_pool,Di.zpp_pool=o.next,o.next=null),o.elt=a;var h=o;h.next=_.head,_.head=h,_.modified=!0,_.length++}}else if(l.type==_n.FLUID){var x,u=this.f_arbiters,d=l.fluidarb;null==Ii.zpp_pool?x=new Ii:(x=Ii.zpp_pool,Ii.zpp_pool=x.next,x.next=null),x.elt=d;var v=x;v.next=u.head,u.head=v,u.modified=!0,u.length++}else{var c,y=this.s_arbiters,m=l.sensorarb;null==ji.zpp_pool?c=new ji:(c=ji.zpp_pool,ji.zpp_pool=c.next,c.next=null),c.elt=m;var z=c;z.next=y.head,y.head=z,y.modified=!0,y.length++}t=t.next}if(this.bodyCbWake(i),n.sleeping=!1,n.island=null,n.parent=n,n.rank=0,1!=i.type)for(var f=i.shapes.head;null!=f;){var b=f.elt;null!=b.node&&this.bphase.sync(b),f=f.next}}else{var g,w=n.constraint,C=this.live_constraints;null==zi.zpp_pool?g=new zi:(g=zi.zpp_pool,zi.zpp_pool=g.next,g.next=null),g.elt=w;var M=g;M.next=C.head,C.head=M,C.modified=!0,C.length++,this.constraintCbWake(w),n.sleeping=!1,n.island=null,n.parent=n,n.rank=0}}var O=e;O.next=Yn.zpp_pool,Yn.zpp_pool=O},non_inlined_wake:function(e,n){null==n&&(n=!1);var i=e;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,n))},really_wake:function(e,n){if(null==n&&(n=!1),null==e.component.island){if(e.component.sleeping=!1,3==e.type||1==e.type){var i,t=this.staticsleep;null==mi.zpp_pool?i=new mi:(i=mi.zpp_pool,mi.zpp_pool=i.next,i.next=null),i.elt=e;var l=i;l.next=t.head,t.head=l,t.modified=!0,t.length++}else{var a,r=this.live;null==mi.zpp_pool?a=new mi:(a=mi.zpp_pool,mi.zpp_pool=a.next,a.next=null),a.elt=e;var p=a;p.next=r.head,r.head=p,r.modified=!0,r.length++}for(var s=e.constraints.head;null!=s;){var o=s.elt;o.space==this&&this.wake_constraint(o),s=s.next}for(var _=e.arbiters.head;null!=_;){var h=_.elt;if(h.sleeping)if(h.sleeping=!1,h.up_stamp+=this.stamp+(this.midstep?0:1)-h.sleep_stamp,h.type==_n.COL){var x=h.colarb;if(x.stat){var u,d=this.c_arbiters_true;null==Di.zpp_pool?u=new Di:(u=Di.zpp_pool,Di.zpp_pool=u.next,u.next=null),u.elt=x;var v=u;v.next=d.head,d.head=v,d.modified=!0,d.length++}else{var c,y=this.c_arbiters_false;null==Di.zpp_pool?c=new Di:(c=Di.zpp_pool,Di.zpp_pool=c.next,c.next=null),c.elt=x;var m=c;m.next=y.head,y.head=m,y.modified=!0,y.length++}}else if(h.type==_n.FLUID){var z,f=this.f_arbiters,b=h.fluidarb;null==Ii.zpp_pool?z=new Ii:(z=Ii.zpp_pool,Ii.zpp_pool=z.next,z.next=null),z.elt=b;var g=z;g.next=f.head,f.head=g,f.modified=!0,f.length++}else{var w,C=this.s_arbiters,M=h.sensorarb;null==ji.zpp_pool?w=new ji:(w=ji.zpp_pool,ji.zpp_pool=w.next,w.next=null),w.elt=M;var O=w;O.next=C.head,C.head=O,C.modified=!0,C.length++}if(h.type!=_n.SENSOR&&!h.cleared&&h.up_stamp>=this.stamp&&0!=(1&h.immState)){if(2==h.b1.type&&h.b1.component.sleeping){var k=h.b1;k.world||(k.component.waket=this.stamp+(this.midstep?0:1),3==k.type&&(k.kinematicDelaySleep=!0),k.component.sleeping&&this.really_wake(k,!1))}if(2==h.b2.type&&h.b2.component.sleeping){var S=h.b2;S.world||(S.component.waket=this.stamp+(this.midstep?0:1),3==S.type&&(S.kinematicDelaySleep=!0),S.component.sleeping&&this.really_wake(S,!1))}}_=_.next}if(n||2!=e.type||this.bodyCbWake(e),!n&&!this.bphase.is_sweep&&1!=e.type)for(var A=e.shapes.head;null!=A;){var T=A.elt;null!=T.node&&this.bphase.sync(T),A=A.next}}else this.wakeIsland(e.component.island)},wake_constraint:function(e,n){if(null==n&&(n=!1),e.active){if(e.component.waket=this.stamp+(this.midstep?0:1),e.component.sleeping){if(null==e.component.island){e.component.sleeping=!1;var i,t=this.live_constraints;null==zi.zpp_pool?i=new zi:(i=zi.zpp_pool,zi.zpp_pool=i.next,i.next=null),i.elt=e;var l=i;l.next=t.head,t.head=l,t.modified=!0,t.length++,e.wake_connected(),n||this.constraintCbWake(e)}else this.wakeIsland(e.component.island);return!0}return!1}return!1},doForests:function(e){for(var n=this.c_arbiters_false.head;null!=n;){var i=n.elt;if(!i.cleared&&i.up_stamp==this.stamp&&0!=(1&i.immState)&&2==i.b1.type&&2==i.b2.type){var t;if(i.b1.component==i.b1.component.parent)t=i.b1.component;else{for(var l=i.b1.component,a=null;l!=l.parent;){var r=l.parent;l.parent=a,a=l,l=r}for(;null!=a;){var p=a.parent;a.parent=l,a=p}t=l}var s;if(i.b2.component==i.b2.component.parent)s=i.b2.component;else{for(var o=i.b2.component,_=null;o!=o.parent;){var h=o.parent;o.parent=_,_=o,o=h}for(;null!=_;){var x=_.parent;_.parent=o,_=x}s=o}t!=s&&(t.rank<s.rank?t.parent=s:t.rank>s.rank?s.parent=t:(s.parent=t,t.rank++))}n=n.next}for(var u=this.f_arbiters.head;null!=u;){var d=u.elt;if(!d.cleared&&d.up_stamp==this.stamp&&0!=(1&d.immState)&&2==d.b1.type&&2==d.b2.type){var v;if(d.b1.component==d.b1.component.parent)v=d.b1.component;else{for(var c=d.b1.component,y=null;c!=c.parent;){var m=c.parent;c.parent=y,y=c,c=m}for(;null!=y;){var z=y.parent;y.parent=c,y=z}v=c}var f;if(d.b2.component==d.b2.component.parent)f=d.b2.component;else{for(var b=d.b2.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var C=g.parent;g.parent=b,g=C}f=b}v!=f&&(v.rank<f.rank?v.parent=f:v.rank>f.rank?f.parent=v:(f.parent=v,v.rank++))}u=u.next}for(var M=this.live_constraints.head;null!=M;){M.elt.forest(),M=M.next}for(;null!=this.live.head;){var O=this.live,k=O.head.elt;O.pop();var S,A=k,T=A.component;if(T==T.parent)S=T;else{for(var E=T,I=null;E!=E.parent;){var j=E.parent;E.parent=I,I=E,E=j}for(;null!=I;){var N=I.parent;I.parent=E,I=N}S=E}if(null==S.island){null==Yn.zpp_pool?S.island=new Yn:(S.island=Yn.zpp_pool,Yn.zpp_pool=S.island.next,S.island.next=null),S.island.waket=0;var D=this.islands,L=S.island;L._inuse=!0;var F=L;F.next=D.next,D.next=F,D.modified=!0,D.length++,S.island.sleep=!0}T.island=S.island;var P,R=T.island.comps;null==Ei.zpp_pool?P=new Ei:(P=Ei.zpp_pool,Ei.zpp_pool=P.next,P.next=null),P.elt=T;var B=P;B.next=R.head,R.head=B,R.modified=!0,R.length++;var V=A.atRest(e);T.island.sleep=T.island.sleep&&V,T.waket>T.island.waket&&(T.island.waket=T.waket)}for(;null!=this.live_constraints.head;){var G=this.live_constraints,U=G.head.elt;G.pop();var Y,K=U,W=K.component;if(W==W.parent)Y=W;else{for(var q=W,X=null;q!=q.parent;){var H=q.parent;q.parent=X,X=q,q=H}for(;null!=X;){var Z=X.parent;X.parent=q,X=Z}Y=q}W.island=Y.island;var J,Q=W.island.comps;null==Ei.zpp_pool?J=new Ei:(J=Ei.zpp_pool,Ei.zpp_pool=J.next,J.next=null),J.elt=W;var $=J;$.next=Q.head,Q.head=$,Q.modified=!0,Q.length++,W.waket>W.island.waket&&(W.island.waket=W.waket)}for(;null!=this.islands.next;){var ee=this.islands,ne=ee.next;ee.pop();var ie=ne;if(ie.sleep)for(var te=ie.comps.head;null!=te;){var le=te.elt;if(le.isBody){var ae=le.body;ae.velx=0,ae.vely=0,ae.angvel=0,le.sleeping=!0;for(var re=ae.shapes.head;null!=re;){var pe=re.elt;this.bphase.sync(pe),re=re.next}this.bodyCbSleep(ae)}else{var se=le.constraint;this.constraintCbSleep(se),le.sleeping=!0}te=te.next}else{for(;null!=ie.comps.head;){var oe=ie.comps,_e=oe.head.elt;oe.pop();var he=_e;if(he.waket=ie.waket,he.isBody){var xe,ue=this.live,de=he.body;null==mi.zpp_pool?xe=new mi:(xe=mi.zpp_pool,mi.zpp_pool=xe.next,xe.next=null),xe.elt=de;var ve=xe;ve.next=ue.head,ue.head=ve,ue.modified=!0,ue.length++}else{var ce,ye=this.live_constraints,me=he.constraint;null==zi.zpp_pool?ce=new zi:(ce=zi.zpp_pool,zi.zpp_pool=ce.next,ce.next=null),ce.elt=me;var ze=ce;ze.next=ye.head,ye.head=ze,ye.modified=!0,ye.length++}he.sleeping=!1,he.island=null,he.parent=he,he.rank=0}var fe=ie;fe.next=Yn.zpp_pool,Yn.zpp_pool=fe}}},sleepArbiters:function(){var e=null,n=this.c_arbiters_true,i=n.head,t=null!=this.c_arbiters_false;for(t&&null==i&&(t=!1,i=this.c_arbiters_false.head,n=this.c_arbiters_false,e=null);null!=i;){var l=i.elt;if(l.b1.component.sleeping&&l.b2.component.sleeping){l.sleep_stamp=this.stamp,l.sleeping=!0;var a,r;null==e?(a=n.head,r=a.next,n.head=r,null==n.head&&(n.pushmod=!0)):(a=e.next,r=a.next,e.next=r,null==r&&(n.pushmod=!0));var p=a;p.elt=null,p.next=Di.zpp_pool,Di.zpp_pool=p,n.modified=!0,n.length--,n.pushmod=!0,i=r,t&&null==i&&(t=!1,i=this.c_arbiters_false.head,n=this.c_arbiters_false,e=null)}else e=i,i=i.next,t&&null==i&&(t=!1,i=this.c_arbiters_false.head,n=this.c_arbiters_false,e=null)}var s=null,o=this.f_arbiters,_=o.head,h=!1;for(h&&null==_&&(h=!1,o=null,s=null);null!=_;){var x=_.elt;if(x.b1.component.sleeping&&x.b2.component.sleeping){x.sleep_stamp=this.stamp,x.sleeping=!0;var u,d;null==s?(u=o.head,d=u.next,o.head=d,null==o.head&&(o.pushmod=!0)):(u=s.next,d=u.next,s.next=d,null==d&&(o.pushmod=!0));var v=u;v.elt=null,v.next=Ii.zpp_pool,Ii.zpp_pool=v,o.modified=!0,o.length--,o.pushmod=!0,_=d,h&&null==_&&(h=!1,o=null,s=null)}else s=_,_=_.next,h&&null==_&&(h=!1,o=null,s=null)}var c=null,y=this.s_arbiters,m=y.head,z=!1;for(z&&null==m&&(z=!1,y=null,c=null);null!=m;){var f=m.elt;if(f.b1.component.sleeping&&f.b2.component.sleeping){f.sleep_stamp=this.stamp,f.sleeping=!0;var b,g;null==c?(b=y.head,g=b.next,y.head=g,null==y.head&&(y.pushmod=!0)):(b=c.next,g=b.next,c.next=g,null==g&&(y.pushmod=!0));var w=b;w.elt=null,w.next=ji.zpp_pool,ji.zpp_pool=w,y.modified=!0,y.length--,y.pushmod=!0,m=g,z&&null==m&&(z=!1,y=null,c=null)}else c=m,m=m.next,z&&null==m&&(z=!1,y=null,c=null)}},static_validation:function(e){if(null!=e.shapes.head&&e.zip_aabb){e.zip_aabb=!1,e.aabb.minx=1/0,e.aabb.miny=1/0,e.aabb.maxx=-1/0,e.aabb.maxy=-1/0;for(var n=e.shapes.head;null!=n;){var i=n.elt;if(i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,0==i.type){var t=i.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var l=t.polygon;if(null==l.lverts.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;else if(null==l.lverts.next.next.next){l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;l.localCOMx+=1*l.lverts.next.next.x,l.localCOMy+=1*l.lverts.next.next.y;l.localCOMx*=.5,l.localCOMy*=.5}else{l.localCOMx=0,l.localCOMy=0;var a=0,r=l.lverts.next,p=r;r=r.next;var s=r;for(r=r.next;null!=r;){var o=r;a+=s.x*(o.y-p.y);var _=o.y*s.x-o.x*s.y;l.localCOMx+=(s.x+o.x)*_,l.localCOMy+=(s.y+o.y)*_,p=s,s=o,r=r.next}r=l.lverts.next;var h=r;a+=s.x*(h.y-p.y);var x=h.y*s.x-h.x*s.y;l.localCOMx+=(s.x+h.x)*x,l.localCOMy+=(s.y+h.y)*x,p=s,s=h,r=r.next;var u=r;a+=s.x*(u.y-p.y);var d=u.y*s.x-u.x*s.y;l.localCOMx+=(s.x+u.x)*d,l.localCOMy+=(s.y+u.y)*d,a=1/(3*a);var v=a;l.localCOMx*=v,l.localCOMy*=v}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var c=t.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var y=t.radius,m=t.radius;t.aabb.minx=t.worldCOMx-y,t.aabb.miny=t.worldCOMy-m,t.aabb.maxx=t.worldCOMx+y,t.aabb.maxy=t.worldCOMy+m}else{var z=i.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var f=z.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var b=z.lverts.next,g=z.gverts.next;null!=g;){var w=g,C=b;b=b.next,w.x=z.body.posx+(z.body.axisy*C.x-z.body.axisx*C.y),w.y=z.body.posy+(C.x*z.body.axisx+C.y*z.body.axisy),g=g.next}}var M=z.gverts.next;z.aabb.minx=M.x,z.aabb.miny=M.y,z.aabb.maxx=M.x,z.aabb.maxy=M.y;for(var O=z.gverts.next.next;null!=O;){var k=O;k.x<z.aabb.minx&&(z.aabb.minx=k.x),k.x>z.aabb.maxx&&(z.aabb.maxx=k.x),k.y<z.aabb.miny&&(z.aabb.miny=k.y),k.y>z.aabb.maxy&&(z.aabb.maxy=k.y),O=O.next}}var S=e.aabb,A=i.aabb;A.minx<S.minx&&(S.minx=A.minx),A.maxx>S.maxx&&(S.maxx=A.maxx),A.miny<S.miny&&(S.miny=A.miny),A.maxy>S.maxy&&(S.maxy=A.maxy),n=n.next}}e.validate_mass(),e.validate_inertia();for(var T=e.shapes.head;null!=T;){var E=T.elt;if(1==E.type){var I=E.polygon;I.zip_sanitation&&(I.zip_sanitation=!1,I.splice_collinear_real());var j=E.polygon;if(j.zip_gaxi&&null!=j.body){j.zip_gaxi=!1,j.validate_laxi();var N=j.body;if(N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),j.zip_gverts&&null!=j.body){j.zip_gverts=!1,j.validate_lverts();var D=j.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot));for(var L=j.lverts.next,F=j.gverts.next;null!=F;){var P=F,R=L;L=L.next,P.x=j.body.posx+(j.body.axisy*R.x-j.body.axisx*R.y),P.y=j.body.posy+(R.x*j.body.axisx+R.y*j.body.axisy),F=F.next}}var B=j.edges.head,V=j.gverts.next,G=V;for(V=V.next;null!=V;){var U=V,Y=B.elt;B=B.next,Y.gp0=G,Y.gp1=U,Y.gnormx=j.body.axisy*Y.lnormx-j.body.axisx*Y.lnormy,Y.gnormy=Y.lnormx*j.body.axisx+Y.lnormy*j.body.axisy,Y.gprojection=j.body.posx*Y.gnormx+j.body.posy*Y.gnormy+Y.lprojection,null!=Y.wrap_gnorm&&(Y.wrap_gnorm.zpp_inner.x=Y.gnormx,Y.wrap_gnorm.zpp_inner.y=Y.gnormy),Y.tp0=Y.gp0.y*Y.gnormx-Y.gp0.x*Y.gnormy,Y.tp1=Y.gp1.y*Y.gnormx-Y.gp1.x*Y.gnormy,G=U,V=V.next}var K=j.gverts.next,W=B.elt;B=B.next,W.gp0=G,W.gp1=K,W.gnormx=j.body.axisy*W.lnormx-j.body.axisx*W.lnormy,W.gnormy=W.lnormx*j.body.axisx+W.lnormy*j.body.axisy,W.gprojection=j.body.posx*W.gnormx+j.body.posy*W.gnormy+W.lprojection,null!=W.wrap_gnorm&&(W.wrap_gnorm.zpp_inner.x=W.gnormx,W.wrap_gnorm.zpp_inner.y=W.gnormy),W.tp0=W.gp0.y*W.gnormx-W.gp0.x*W.gnormy,W.tp1=W.gp1.y*W.gnormx-W.gp1.x*W.gnormy}}T=T.next}e.sweepFrozen=!0},validation:function(){var e=this.cbsets;if(!e.cbsets.empty()){for(var n=e.cbsets.parent;null!=n.prev;)n=n.prev;for(;null!=n;){if(n.data.validate(),null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}for(var i=this.live.head;null!=i;){var t=i.elt;t.sweepRadius=0;for(var l=t.shapes.head;null!=l;){var a=l.elt;if(1==a.type){var r=a.polygon;r.zip_sanitation&&(r.zip_sanitation=!1,r.splice_collinear_real());var p=a.polygon;if(p.zip_gaxi&&null!=p.body){p.zip_gaxi=!1,p.validate_laxi();var s=p.body;if(s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)),p.zip_gverts&&null!=p.body){p.zip_gverts=!1,p.validate_lverts();var o=p.body;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));for(var _=p.lverts.next,h=p.gverts.next;null!=h;){var x=h,u=_;_=_.next,x.x=p.body.posx+(p.body.axisy*u.x-p.body.axisx*u.y),x.y=p.body.posy+(u.x*p.body.axisx+u.y*p.body.axisy),h=h.next}}var d=p.edges.head,v=p.gverts.next,c=v;for(v=v.next;null!=v;){var y=v,m=d.elt;d=d.next,m.gp0=c,m.gp1=y,m.gnormx=p.body.axisy*m.lnormx-p.body.axisx*m.lnormy,m.gnormy=m.lnormx*p.body.axisx+m.lnormy*p.body.axisy,m.gprojection=p.body.posx*m.gnormx+p.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy,c=y,v=v.next}var z=p.gverts.next,f=d.elt;d=d.next,f.gp0=c,f.gp1=z,f.gnormx=p.body.axisy*f.lnormx-p.body.axisx*f.lnormy,f.gnormy=f.lnormx*p.body.axisx+f.lnormy*p.body.axisy,f.gprojection=p.body.posx*f.gnormx+p.body.posy*f.gnormy+f.lprojection,null!=f.wrap_gnorm&&(f.wrap_gnorm.zpp_inner.x=f.gnormx,f.wrap_gnorm.zpp_inner.y=f.gnormy),f.tp0=f.gp0.y*f.gnormx-f.gp0.x*f.gnormy,f.tp1=f.gp1.y*f.gnormx-f.gp1.x*f.gnormy}}a.validate_sweepRadius(),a.sweepRadius>t.sweepRadius&&(t.sweepRadius=a.sweepRadius),l=l.next}if(t.validate_mass(),t.validate_inertia(),null!=t.shapes.head){if(t.zip_aabb){t.zip_aabb=!1,t.aabb.minx=1/0,t.aabb.miny=1/0,t.aabb.maxx=-1/0,t.aabb.maxy=-1/0;for(var b=t.shapes.head;null!=b;){var g=b.elt;if(g.zip_aabb&&null!=g.body)if(g.zip_aabb=!1,0==g.type){var w=g.circle;if(w.zip_worldCOM&&null!=w.body){if(w.zip_worldCOM=!1,w.zip_localCOM){if(w.zip_localCOM=!1,1==w.type){var C=w.polygon;if(null==C.lverts.next.next)C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;else if(null==C.lverts.next.next.next){C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;C.localCOMx+=1*C.lverts.next.next.x,C.localCOMy+=1*C.lverts.next.next.y;C.localCOMx*=.5,C.localCOMy*=.5}else{C.localCOMx=0,C.localCOMy=0;var M=0,O=C.lverts.next,k=O;O=O.next;var S=O;for(O=O.next;null!=O;){var A=O;M+=S.x*(A.y-k.y);var T=A.y*S.x-A.x*S.y;C.localCOMx+=(S.x+A.x)*T,C.localCOMy+=(S.y+A.y)*T,k=S,S=A,O=O.next}O=C.lverts.next;var E=O;M+=S.x*(E.y-k.y);var I=E.y*S.x-E.x*S.y;C.localCOMx+=(S.x+E.x)*I,C.localCOMy+=(S.y+E.y)*I,k=S,S=E,O=O.next;var j=O;M+=S.x*(j.y-k.y);var N=j.y*S.x-j.x*S.y;C.localCOMx+=(S.x+j.x)*N,C.localCOMy+=(S.y+j.y)*N,M=1/(3*M);var D=M;C.localCOMx*=D,C.localCOMy*=D}}null!=w.wrap_localCOM&&(w.wrap_localCOM.zpp_inner.x=w.localCOMx,w.wrap_localCOM.zpp_inner.y=w.localCOMy)}var L=w.body;L.zip_axis&&(L.zip_axis=!1,L.axisx=Math.sin(L.rot),L.axisy=Math.cos(L.rot)),w.worldCOMx=w.body.posx+(w.body.axisy*w.localCOMx-w.body.axisx*w.localCOMy),w.worldCOMy=w.body.posy+(w.localCOMx*w.body.axisx+w.localCOMy*w.body.axisy)}var F=w.radius,P=w.radius;w.aabb.minx=w.worldCOMx-F,w.aabb.miny=w.worldCOMy-P,w.aabb.maxx=w.worldCOMx+F,w.aabb.maxy=w.worldCOMy+P}else{var R=g.polygon;if(R.zip_gverts&&null!=R.body){R.zip_gverts=!1,R.validate_lverts();var B=R.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var V=R.lverts.next,G=R.gverts.next;null!=G;){var U=G,Y=V;V=V.next,U.x=R.body.posx+(R.body.axisy*Y.x-R.body.axisx*Y.y),U.y=R.body.posy+(Y.x*R.body.axisx+Y.y*R.body.axisy),G=G.next}}var K=R.gverts.next;R.aabb.minx=K.x,R.aabb.miny=K.y,R.aabb.maxx=K.x,R.aabb.maxy=K.y;for(var W=R.gverts.next.next;null!=W;){var q=W;q.x<R.aabb.minx&&(R.aabb.minx=q.x),q.x>R.aabb.maxx&&(R.aabb.maxx=q.x),q.y<R.aabb.miny&&(R.aabb.miny=q.y),q.y>R.aabb.maxy&&(R.aabb.maxy=q.y),W=W.next}}var X=t.aabb,H=g.aabb;H.minx<X.minx&&(X.minx=H.minx),H.maxx>X.maxx&&(X.maxx=H.maxx),H.miny<X.miny&&(X.miny=H.miny),H.maxy>X.maxy&&(X.maxy=H.maxy),b=b.next}}t.validate_worldCOM()}if(t.validate_gravMass(),t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),t.component.woken&&null!=t.cbSet)for(var Z=t.cbSet.bodylisteners.head;null!=Z;){var J=Z.elt;if(2==J.event){var Q=this.push_callback(J);Q.event=2,Q.body=t,Z=Z.next}else Z=Z.next}t.component.woken=!1;for(var $=t.shapes.head;null!=$;){var ee=$.elt;this.bphase.sync(ee),$=$.next}i=i.next}for(var ne=this.kinematics.head;null!=ne;){var ie=ne.elt;ie.sweepRadius=0;for(var te=ie.shapes.head;null!=te;){var le=te.elt;if(1==le.type){var ae=le.polygon;ae.zip_sanitation&&(ae.zip_sanitation=!1,ae.splice_collinear_real());var re=le.polygon;if(re.zip_gaxi&&null!=re.body){re.zip_gaxi=!1,re.validate_laxi();var pe=re.body;if(pe.zip_axis&&(pe.zip_axis=!1,pe.axisx=Math.sin(pe.rot),pe.axisy=Math.cos(pe.rot)),re.zip_gverts&&null!=re.body){re.zip_gverts=!1,re.validate_lverts();var se=re.body;se.zip_axis&&(se.zip_axis=!1,se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot));for(var oe=re.lverts.next,_e=re.gverts.next;null!=_e;){var he=_e,xe=oe;oe=oe.next,he.x=re.body.posx+(re.body.axisy*xe.x-re.body.axisx*xe.y),he.y=re.body.posy+(xe.x*re.body.axisx+xe.y*re.body.axisy),_e=_e.next}}var ue=re.edges.head,de=re.gverts.next,ve=de;for(de=de.next;null!=de;){var ce=de,ye=ue.elt;ue=ue.next,ye.gp0=ve,ye.gp1=ce,ye.gnormx=re.body.axisy*ye.lnormx-re.body.axisx*ye.lnormy,ye.gnormy=ye.lnormx*re.body.axisx+ye.lnormy*re.body.axisy,ye.gprojection=re.body.posx*ye.gnormx+re.body.posy*ye.gnormy+ye.lprojection,null!=ye.wrap_gnorm&&(ye.wrap_gnorm.zpp_inner.x=ye.gnormx,ye.wrap_gnorm.zpp_inner.y=ye.gnormy),ye.tp0=ye.gp0.y*ye.gnormx-ye.gp0.x*ye.gnormy,ye.tp1=ye.gp1.y*ye.gnormx-ye.gp1.x*ye.gnormy,ve=ce,de=de.next}var me=re.gverts.next,ze=ue.elt;ue=ue.next,ze.gp0=ve,ze.gp1=me,ze.gnormx=re.body.axisy*ze.lnormx-re.body.axisx*ze.lnormy,ze.gnormy=ze.lnormx*re.body.axisx+ze.lnormy*re.body.axisy,ze.gprojection=re.body.posx*ze.gnormx+re.body.posy*ze.gnormy+ze.lprojection,null!=ze.wrap_gnorm&&(ze.wrap_gnorm.zpp_inner.x=ze.gnormx,ze.wrap_gnorm.zpp_inner.y=ze.gnormy),ze.tp0=ze.gp0.y*ze.gnormx-ze.gp0.x*ze.gnormy,ze.tp1=ze.gp1.y*ze.gnormx-ze.gp1.x*ze.gnormy}}le.validate_sweepRadius(),le.sweepRadius>ie.sweepRadius&&(ie.sweepRadius=le.sweepRadius),te=te.next}if(ie.validate_mass(),ie.validate_inertia(),null!=ie.shapes.head){if(ie.zip_aabb){ie.zip_aabb=!1,ie.aabb.minx=1/0,ie.aabb.miny=1/0,ie.aabb.maxx=-1/0,ie.aabb.maxy=-1/0;for(var fe=ie.shapes.head;null!=fe;){var be=fe.elt;if(be.zip_aabb&&null!=be.body)if(be.zip_aabb=!1,0==be.type){var ge=be.circle;if(ge.zip_worldCOM&&null!=ge.body){if(ge.zip_worldCOM=!1,ge.zip_localCOM){if(ge.zip_localCOM=!1,1==ge.type){var we=ge.polygon;if(null==we.lverts.next.next)we.localCOMx=we.lverts.next.x,we.localCOMy=we.lverts.next.y;else if(null==we.lverts.next.next.next){we.localCOMx=we.lverts.next.x,we.localCOMy=we.lverts.next.y;we.localCOMx+=1*we.lverts.next.next.x,we.localCOMy+=1*we.lverts.next.next.y;we.localCOMx*=.5,we.localCOMy*=.5}else{we.localCOMx=0,we.localCOMy=0;var Ce=0,Me=we.lverts.next,Oe=Me;Me=Me.next;var ke=Me;for(Me=Me.next;null!=Me;){var Se=Me;Ce+=ke.x*(Se.y-Oe.y);var Ae=Se.y*ke.x-Se.x*ke.y;we.localCOMx+=(ke.x+Se.x)*Ae,we.localCOMy+=(ke.y+Se.y)*Ae,Oe=ke,ke=Se,Me=Me.next}Me=we.lverts.next;var Te=Me;Ce+=ke.x*(Te.y-Oe.y);var Ee=Te.y*ke.x-Te.x*ke.y;we.localCOMx+=(ke.x+Te.x)*Ee,we.localCOMy+=(ke.y+Te.y)*Ee,Oe=ke,ke=Te,Me=Me.next;var Ie=Me;Ce+=ke.x*(Ie.y-Oe.y);var je=Ie.y*ke.x-Ie.x*ke.y;we.localCOMx+=(ke.x+Ie.x)*je,we.localCOMy+=(ke.y+Ie.y)*je,Ce=1/(3*Ce);var Ne=Ce;we.localCOMx*=Ne,we.localCOMy*=Ne}}null!=ge.wrap_localCOM&&(ge.wrap_localCOM.zpp_inner.x=ge.localCOMx,ge.wrap_localCOM.zpp_inner.y=ge.localCOMy)}var De=ge.body;De.zip_axis&&(De.zip_axis=!1,De.axisx=Math.sin(De.rot),De.axisy=Math.cos(De.rot)),ge.worldCOMx=ge.body.posx+(ge.body.axisy*ge.localCOMx-ge.body.axisx*ge.localCOMy),ge.worldCOMy=ge.body.posy+(ge.localCOMx*ge.body.axisx+ge.localCOMy*ge.body.axisy)}var Le=ge.radius,Fe=ge.radius;ge.aabb.minx=ge.worldCOMx-Le,ge.aabb.miny=ge.worldCOMy-Fe,ge.aabb.maxx=ge.worldCOMx+Le,ge.aabb.maxy=ge.worldCOMy+Fe}else{var Pe=be.polygon;if(Pe.zip_gverts&&null!=Pe.body){Pe.zip_gverts=!1,Pe.validate_lverts();var Re=Pe.body;Re.zip_axis&&(Re.zip_axis=!1,Re.axisx=Math.sin(Re.rot),Re.axisy=Math.cos(Re.rot));for(var Be=Pe.lverts.next,Ve=Pe.gverts.next;null!=Ve;){var Ge=Ve,Ue=Be;Be=Be.next,Ge.x=Pe.body.posx+(Pe.body.axisy*Ue.x-Pe.body.axisx*Ue.y),Ge.y=Pe.body.posy+(Ue.x*Pe.body.axisx+Ue.y*Pe.body.axisy),Ve=Ve.next}}var Ye=Pe.gverts.next;Pe.aabb.minx=Ye.x,Pe.aabb.miny=Ye.y,Pe.aabb.maxx=Ye.x,Pe.aabb.maxy=Ye.y;for(var Ke=Pe.gverts.next.next;null!=Ke;){var We=Ke;We.x<Pe.aabb.minx&&(Pe.aabb.minx=We.x),We.x>Pe.aabb.maxx&&(Pe.aabb.maxx=We.x),We.y<Pe.aabb.miny&&(Pe.aabb.miny=We.y),We.y>Pe.aabb.maxy&&(Pe.aabb.maxy=We.y),Ke=Ke.next}}var qe=ie.aabb,Xe=be.aabb;Xe.minx<qe.minx&&(qe.minx=Xe.minx),Xe.maxx>qe.maxx&&(qe.maxx=Xe.maxx),Xe.miny<qe.miny&&(qe.miny=Xe.miny),Xe.maxy>qe.maxy&&(qe.maxy=Xe.maxy),fe=fe.next}}ie.validate_worldCOM()}ie.validate_gravMass(),ie.zip_axis&&(ie.zip_axis=!1,ie.axisx=Math.sin(ie.rot),ie.axisy=Math.cos(ie.rot));for(var He=ie.shapes.head;null!=He;){var Ze=He.elt;this.bphase.sync(Ze),He=He.next}ne=ne.next}for(var Je=this.live_constraints.head;null!=Je;){var Qe=Je.elt;if(Qe.active){if(Qe.component.woken&&null!=Qe.cbSet)for(var $e=Qe.cbSet.conlisteners.head;null!=$e;){var en=$e.elt;if(2==en.event){var nn=this.push_callback(en);nn.event=2,nn.constraint=Qe,$e=$e.next}else $e=$e.next}Qe.component.woken=!1}Je=Je.next}},updateVel:function(e){for(var n=1-e*this.global_lin_drag,i=1-e*this.global_ang_drag,t=this.live.head;null!=t;){var l=t.elt;if(0!=l.smass){var a=e*l.imass;l.velx=n*l.velx+(l.forcex+this.gravityx*l.gravMass)*a,l.vely=n*l.vely+(l.forcey+this.gravityy*l.gravMass)*a}if(0!=l.sinertia){var r=0,p=0;r=l.worldCOMx-l.posx,p=l.worldCOMy-l.posy;var s=l.torque+(this.gravityy*r-this.gravityx*p)*l.gravMass;l.angvel=i*l.angvel+s*e*l.iinertia}t,t=t.next}},updatePos:function(e){for(var n=2*Math.PI/e,i=this.live.head;null!=i;){var t=i.elt;t.pre_posx=t.posx,t.pre_posy=t.posy,t.pre_rot=t.rot,t.sweepTime=0,t.sweep_angvel=t.angvel%n;var l=e-t.sweepTime;if(0!=l){t.sweepTime=e;var a=l;if(t.posx+=t.velx*a,t.posy+=t.vely*a,0!=t.angvel){var r=t.sweep_angvel*l;if(t.rot+=r,r*r>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var p=r*r,s=1-.5*p,o=1-p*p/8,_=(s*t.axisx+r*t.axisy)*o;t.axisy=(s*t.axisy-r*t.axisx)*o,t.axisx=_}}}if(t.disableCCD)t.sweepFrozen=!0,t.bullet=!1;else{var h=O.staticCCDLinearThreshold*t.sweepRadius,x=O.staticCCDAngularThreshold;if((t.velx*t.velx+t.vely*t.vely)*e*e>h*h||t.angvel*t.angvel*e*e>x*x||3==t.type){var u=t.sweep_angvel;u<0&&(u=-u);for(var d=1/u,v=t.shapes.head;null!=v;){var c=v.elt,y=c.aabb,m=y.minx,z=y.miny,f=y.maxx,b=y.maxy,g=u*e*c.sweepCoef*.008333333333333333|0;g>8&&(g=8);var w=u*e/g,C=e-t.sweepTime;if(0!=C){t.sweepTime=e;var M=C;if(t.posx+=t.velx*M,t.posy+=t.vely*M,0!=t.angvel){var k=t.sweep_angvel*C;if(t.rot+=k,k*k>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var S=k*k,A=1-.5*S,T=1-S*S/8,E=(A*t.axisx+k*t.axisy)*T;t.axisy=(A*t.axisy-k*t.axisx)*T,t.axisx=E}}}if(0==c.type){var I=c.circle;I.worldCOMx=I.body.posx+(I.body.axisy*I.localCOMx-I.body.axisx*I.localCOMy),I.worldCOMy=I.body.posy+(I.localCOMx*I.body.axisx+I.localCOMy*I.body.axisy),I.aabb.minx=I.worldCOMx-I.radius,I.aabb.miny=I.worldCOMy-I.radius,I.aabb.maxx=I.worldCOMx+I.radius,I.aabb.maxy=I.worldCOMy+I.radius}else{var j=c.polygon,N=j.lverts.next,D=j.gverts.next,L=N;N=N.next,D.x=j.body.posx+(j.body.axisy*L.x-j.body.axisx*L.y),D.y=j.body.posy+(L.x*j.body.axisx+L.y*j.body.axisy),j.aabb.minx=D.x,j.aabb.miny=D.y,j.aabb.maxx=D.x,j.aabb.maxy=D.y;for(var F=j.gverts.next.next;null!=F;){var P=F,R=N;N=N.next,P.x=j.body.posx+(j.body.axisy*R.x-j.body.axisx*R.y),P.y=j.body.posy+(R.x*j.body.axisx+R.y*j.body.axisy),P.x<j.aabb.minx&&(j.aabb.minx=P.x),P.x>j.aabb.maxx&&(j.aabb.maxx=P.x),P.y<j.aabb.miny&&(j.aabb.miny=P.y),P.y>j.aabb.maxy&&(j.aabb.maxy=P.y),F=F.next}}m<y.minx?y.minx=m:m=y.minx,z<y.miny?y.miny=z:z=y.miny,f>y.maxx?y.maxx=f:f=y.maxx,b>y.maxy?y.maxy=b:b=y.maxy;for(var B=1,V=g;B<V;){var G=B++,U=w*G*d,Y=U-t.sweepTime;if(0!=Y){t.sweepTime=U;var K=Y;if(t.posx+=t.velx*K,t.posy+=t.vely*K,0!=t.angvel){var W=t.sweep_angvel*Y;if(t.rot+=W,W*W>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var q=W*W,X=1-.5*q,H=1-q*q/8,Z=(X*t.axisx+W*t.axisy)*H;t.axisy=(X*t.axisy-W*t.axisx)*H,t.axisx=Z}}}if(0==c.type){var J=c.circle;J.worldCOMx=J.body.posx+(J.body.axisy*J.localCOMx-J.body.axisx*J.localCOMy),J.worldCOMy=J.body.posy+(J.localCOMx*J.body.axisx+J.localCOMy*J.body.axisy),J.aabb.minx=J.worldCOMx-J.radius,J.aabb.miny=J.worldCOMy-J.radius,J.aabb.maxx=J.worldCOMx+J.radius,J.aabb.maxy=J.worldCOMy+J.radius}else{var Q=c.polygon,$=Q.lverts.next,ee=Q.gverts.next,ne=$;$=$.next,ee.x=Q.body.posx+(Q.body.axisy*ne.x-Q.body.axisx*ne.y),ee.y=Q.body.posy+(ne.x*Q.body.axisx+ne.y*Q.body.axisy),Q.aabb.minx=ee.x,Q.aabb.miny=ee.y,Q.aabb.maxx=ee.x,Q.aabb.maxy=ee.y;for(var ie=Q.gverts.next.next;null!=ie;){var te=ie,le=$;$=$.next,te.x=Q.body.posx+(Q.body.axisy*le.x-Q.body.axisx*le.y),te.y=Q.body.posy+(le.x*Q.body.axisx+le.y*Q.body.axisy),te.x<Q.aabb.minx&&(Q.aabb.minx=te.x),te.x>Q.aabb.maxx&&(Q.aabb.maxx=te.x),te.y<Q.aabb.miny&&(Q.aabb.miny=te.y),te.y>Q.aabb.maxy&&(Q.aabb.maxy=te.y),ie=ie.next}}m<y.minx?y.minx=m:m=y.minx,z<y.miny?y.miny=z:z=y.miny,f>y.maxx?y.maxx=f:f=y.maxx,b>y.maxy?y.maxy=b:b=y.maxy}this.bphase.sync(c),v=v.next}if(t.sweepFrozen=!1,2==t.type&&t.bulletEnabled){var ae=O.bulletCCDLinearThreshold*t.sweepRadius,re=O.bulletCCDAngularThreshold;((t.velx*t.velx+t.vely*t.vely)*e*e>ae*ae||t.angvel*t.angvel*e*e>re*re)&&(t.bullet=!0)}}else t.sweepFrozen=!0,t.bullet=!1}i=i.next}for(var pe=this.kinematics.head;null!=pe;){var se=pe.elt;se.pre_posx=se.posx,se.pre_posy=se.posy,se.pre_rot=se.rot,se.sweepTime=0,se.sweep_angvel=se.angvel%n;var oe=e-se.sweepTime;if(0!=oe){se.sweepTime=e;var _e=oe;if(se.posx+=se.velx*_e,se.posy+=se.vely*_e,0!=se.angvel){var he=se.sweep_angvel*oe;if(se.rot+=he,he*he>1e-4)se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot);else{var xe=he*he,ue=1-.5*xe,de=1-xe*xe/8,ve=(ue*se.axisx+he*se.axisy)*de;se.axisy=(ue*se.axisy-he*se.axisx)*de,se.axisx=ve}}}if(se.disableCCD)se.sweepFrozen=!0,se.bullet=!1;else{var ce=O.staticCCDLinearThreshold*se.sweepRadius,ye=O.staticCCDAngularThreshold;if((se.velx*se.velx+se.vely*se.vely)*e*e>ce*ce||se.angvel*se.angvel*e*e>ye*ye||3==se.type){var me=se.sweep_angvel;me<0&&(me=-me);for(var ze=1/me,fe=se.shapes.head;null!=fe;){var be=fe.elt,ge=be.aabb,we=ge.minx,Ce=ge.miny,Me=ge.maxx,Oe=ge.maxy,ke=me*e*be.sweepCoef*.008333333333333333|0;ke>8&&(ke=8);var Se=me*e/ke,Ae=e-se.sweepTime;if(0!=Ae){se.sweepTime=e;var Te=Ae;if(se.posx+=se.velx*Te,se.posy+=se.vely*Te,0!=se.angvel){var Ee=se.sweep_angvel*Ae;if(se.rot+=Ee,Ee*Ee>1e-4)se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot);else{var Ie=Ee*Ee,je=1-.5*Ie,Ne=1-Ie*Ie/8,De=(je*se.axisx+Ee*se.axisy)*Ne;se.axisy=(je*se.axisy-Ee*se.axisx)*Ne,se.axisx=De}}}if(0==be.type){var Le=be.circle;Le.worldCOMx=Le.body.posx+(Le.body.axisy*Le.localCOMx-Le.body.axisx*Le.localCOMy),Le.worldCOMy=Le.body.posy+(Le.localCOMx*Le.body.axisx+Le.localCOMy*Le.body.axisy),Le.aabb.minx=Le.worldCOMx-Le.radius,Le.aabb.miny=Le.worldCOMy-Le.radius,Le.aabb.maxx=Le.worldCOMx+Le.radius,Le.aabb.maxy=Le.worldCOMy+Le.radius}else{var Fe=be.polygon,Pe=Fe.lverts.next,Re=Fe.gverts.next,Be=Pe;Pe=Pe.next,Re.x=Fe.body.posx+(Fe.body.axisy*Be.x-Fe.body.axisx*Be.y),Re.y=Fe.body.posy+(Be.x*Fe.body.axisx+Be.y*Fe.body.axisy),Fe.aabb.minx=Re.x,Fe.aabb.miny=Re.y,Fe.aabb.maxx=Re.x,Fe.aabb.maxy=Re.y;for(var Ve=Fe.gverts.next.next;null!=Ve;){var Ge=Ve,Ue=Pe;Pe=Pe.next,Ge.x=Fe.body.posx+(Fe.body.axisy*Ue.x-Fe.body.axisx*Ue.y),Ge.y=Fe.body.posy+(Ue.x*Fe.body.axisx+Ue.y*Fe.body.axisy),Ge.x<Fe.aabb.minx&&(Fe.aabb.minx=Ge.x),Ge.x>Fe.aabb.maxx&&(Fe.aabb.maxx=Ge.x),Ge.y<Fe.aabb.miny&&(Fe.aabb.miny=Ge.y),Ge.y>Fe.aabb.maxy&&(Fe.aabb.maxy=Ge.y),Ve=Ve.next}}we<ge.minx?ge.minx=we:we=ge.minx,Ce<ge.miny?ge.miny=Ce:Ce=ge.miny,Me>ge.maxx?ge.maxx=Me:Me=ge.maxx,Oe>ge.maxy?ge.maxy=Oe:Oe=ge.maxy;for(var Ye=1,Ke=ke;Ye<Ke;){var We=Ye++,qe=Se*We*ze,Xe=qe-se.sweepTime;if(0!=Xe){se.sweepTime=qe;var He=Xe;if(se.posx+=se.velx*He,se.posy+=se.vely*He,0!=se.angvel){var Ze=se.sweep_angvel*Xe;if(se.rot+=Ze,Ze*Ze>1e-4)se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot);else{var Je=Ze*Ze,Qe=1-.5*Je,$e=1-Je*Je/8,en=(Qe*se.axisx+Ze*se.axisy)*$e;se.axisy=(Qe*se.axisy-Ze*se.axisx)*$e,se.axisx=en}}}if(0==be.type){var nn=be.circle;nn.worldCOMx=nn.body.posx+(nn.body.axisy*nn.localCOMx-nn.body.axisx*nn.localCOMy),nn.worldCOMy=nn.body.posy+(nn.localCOMx*nn.body.axisx+nn.localCOMy*nn.body.axisy),nn.aabb.minx=nn.worldCOMx-nn.radius,nn.aabb.miny=nn.worldCOMy-nn.radius,nn.aabb.maxx=nn.worldCOMx+nn.radius,nn.aabb.maxy=nn.worldCOMy+nn.radius}else{var tn=be.polygon,ln=tn.lverts.next,an=tn.gverts.next,rn=ln;ln=ln.next,an.x=tn.body.posx+(tn.body.axisy*rn.x-tn.body.axisx*rn.y),an.y=tn.body.posy+(rn.x*tn.body.axisx+rn.y*tn.body.axisy),tn.aabb.minx=an.x,tn.aabb.miny=an.y,tn.aabb.maxx=an.x,tn.aabb.maxy=an.y;for(var pn=tn.gverts.next.next;null!=pn;){var sn=pn,on=ln;ln=ln.next,sn.x=tn.body.posx+(tn.body.axisy*on.x-tn.body.axisx*on.y),
sn.y=tn.body.posy+(on.x*tn.body.axisx+on.y*tn.body.axisy),sn.x<tn.aabb.minx&&(tn.aabb.minx=sn.x),sn.x>tn.aabb.maxx&&(tn.aabb.maxx=sn.x),sn.y<tn.aabb.miny&&(tn.aabb.miny=sn.y),sn.y>tn.aabb.maxy&&(tn.aabb.maxy=sn.y),pn=pn.next}}we<ge.minx?ge.minx=we:we=ge.minx,Ce<ge.miny?ge.miny=Ce:Ce=ge.miny,Me>ge.maxx?ge.maxx=Me:Me=ge.maxx,Oe>ge.maxy?ge.maxy=Oe:Oe=ge.maxy}this.bphase.sync(be),fe=fe.next}if(se.sweepFrozen=!1,2==se.type&&se.bulletEnabled){var _n=O.bulletCCDLinearThreshold*se.sweepRadius,hn=O.bulletCCDAngularThreshold;((se.velx*se.velx+se.vely*se.vely)*e*e>_n*_n||se.angvel*se.angvel*e*e>hn*hn)&&(se.bullet=!0)}}else se.sweepFrozen=!0,se.bullet=!1}pe=pe.next}},presteparb:function(e,n,i){null==i&&(i=!1);var t=this;if(!e.cleared&&e.b1.component.sleeping&&e.b2.component.sleeping)return e.sleep_stamp=this.stamp,e.sleeping=!0,!0;if(!e.cleared||0!=e.present||e.intchange){var l=!i&&e.up_stamp==this.stamp-1&&!e.cleared&&!e.intchange,a=e.fresh&&!e.cleared&&!e.intchange;if(l&&(e.endGenerated=this.stamp),a||l||e.cleared||e.intchange){for(var r=e.ws1,p=e.ws2,s=this.mrca1;null!=s.head;){var o=s.head;s.head=o.next;var _=o;_.elt=null,_.next=Ci.zpp_pool,Ci.zpp_pool=_,null==s.head&&(s.pushmod=!0),s.modified=!0,s.length--}s.pushmod=!0;for(var h=this.mrca2;null!=h.head;){var x=h.head;h.head=x.next;var u=x;u.elt=null,u.next=Ci.zpp_pool,Ci.zpp_pool=u,null==h.head&&(h.pushmod=!0),h.modified=!0,h.length--}if(h.pushmod=!0,null!=r.cbSet){var d,v=this.mrca1;null==Ci.zpp_pool?d=new Ci:(d=Ci.zpp_pool,Ci.zpp_pool=d.next,d.next=null),d.elt=r;var c=d;c.next=v.head,v.head=c,v.modified=!0,v.length++}if(null!=r.body.cbSet){var y,m=this.mrca1,z=r.body;null==Ci.zpp_pool?y=new Ci:(y=Ci.zpp_pool,Ci.zpp_pool=y.next,y.next=null),y.elt=z;var f=y;f.next=m.head,m.head=f,m.modified=!0,m.length++}if(null!=p.cbSet){var b,g=this.mrca2;null==Ci.zpp_pool?b=new Ci:(b=Ci.zpp_pool,Ci.zpp_pool=b.next,b.next=null),b.elt=p;var w=b;w.next=g.head,g.head=w,g.modified=!0,g.length++}if(null!=p.body.cbSet){var C,M=this.mrca2,k=p.body;null==Ci.zpp_pool?C=new Ci:(C=Ci.zpp_pool,Ci.zpp_pool=C.next,C.next=null),C.elt=k;var S=C;S.next=M.head,M.head=S,M.modified=!0,M.length++}for(var A=r.body.compound,T=p.body.compound;A!=T;){if((null==A?0:A.depth)<(null==T?0:T.depth)){if(null!=T.cbSet){var E,I=this.mrca2;null==Ci.zpp_pool?E=new Ci:(E=Ci.zpp_pool,Ci.zpp_pool=E.next,E.next=null),E.elt=T;var j=E;j.next=I.head,I.head=j,I.modified=!0,I.length++}T=T.compound}else{if(null!=A.cbSet){var N,D=this.mrca1;null==Ci.zpp_pool?N=new Ci:(N=Ci.zpp_pool,Ci.zpp_pool=N.next,N.next=null),N.elt=A;var L=N;L.next=D.head,D.head=L,D.modified=!0,D.length++}A=A.compound}}for(var F=this.mrca1.head;null!=F;){for(var P=F.elt,R=this.mrca2.head;null!=R;){for(var B=R.elt,V=P.cbSet,G=B.cbSet,U=(V.manager,null),Y=V.cbpairs.length<G.cbpairs.length?V.cbpairs:G.cbpairs,K=Y.head;null!=K;){var W=K.elt;if(W.a==V&&W.b==G||W.a==G&&W.b==V){U=W;break}K=K.next}if(null==U){var q;null==en.zpp_pool?q=new en:(q=en.zpp_pool,en.zpp_pool=q.next,q.next=null),q.zip_listeners=!0,$e.setlt(V,G)?(q.a=V,q.b=G):(q.a=G,q.b=V),U=q,V.cbpairs.add(U),G!=V&&G.cbpairs.add(U)}if(U.zip_listeners&&(U.zip_listeners=!1,U.__validate()),null!=U.listeners.head){var X=Tn.get(P,B);if(a||e.intchange){null==X&&(X=Wn.get(P,B),this.add_callbackset(X));for(var H=(V.manager,null),Z=V.cbpairs.length<G.cbpairs.length?V.cbpairs:G.cbpairs,J=Z.head;null!=J;){var Q=J.elt;if(Q.a==V&&Q.b==G||Q.a==G&&Q.b==V){H=Q;break}J=J.next}if(null==H){var $;null==en.zpp_pool?$=new en:($=en.zpp_pool,en.zpp_pool=$.next,$.next=null),$.zip_listeners=!0,$e.setlt(V,G)?($.a=V,$.b=G):($.a=G,$.b=V),H=$,V.cbpairs.add(H),G!=V&&G.cbpairs.add(H)}H.zip_listeners&&(H.zip_listeners=!1,H.__validate());for(var ee=H.listeners.head;null!=ee;){var ne=ee.elt;if(0==ne.event&&0!=(ne.itype&e.type)&&X.empty_arb(ne.itype)){var ie=t.push_callback(ne);ie.event=0;var te,le=X.int1,ae=X.int2,re=ne.options1,pe=le.cbTypes;if(re.nonemptyintersection(pe,re.includes)&&!re.nonemptyintersection(pe,re.excludes)){var se=ne.options2,oe=ae.cbTypes;te=!!se.nonemptyintersection(oe,se.includes)&&!se.nonemptyintersection(oe,se.excludes)}else te=!1;te?(ie.int1=le,ie.int2=ae):(ie.int1=ae,ie.int2=le),ie.set=X}ee=ee.next}var _e,he;he=!1;for(var xe=X.arbiters.head;null!=xe;){if(xe.elt==e){he=!0;break}xe=xe.next}if(he)_e=!1;else{var ue,de=X.arbiters;null==bi.zpp_pool?ue=new bi:(ue=bi.zpp_pool,bi.zpp_pool=ue.next,ue.next=null),ue.elt=e;var ve=ue;ve.next=de.head,de.head=ve,de.modified=!0,de.length++,_e=!0}_e&&e.present++}else{e.present--,X.remove_arb(e);for(var ce=(V.manager,null),ye=V.cbpairs.length<G.cbpairs.length?V.cbpairs:G.cbpairs,me=ye.head;null!=me;){var ze=me.elt;if(ze.a==V&&ze.b==G||ze.a==G&&ze.b==V){ce=ze;break}me=me.next}if(null==ce){var fe;null==en.zpp_pool?fe=new en:(fe=en.zpp_pool,en.zpp_pool=fe.next,fe.next=null),fe.zip_listeners=!0,$e.setlt(V,G)?(fe.a=V,fe.b=G):(fe.a=G,fe.b=V),ce=fe,V.cbpairs.add(ce),G!=V&&G.cbpairs.add(ce)}ce.zip_listeners&&(ce.zip_listeners=!1,ce.__validate());for(var be=ce.listeners.head;null!=be;){var ge=be.elt;if(1==ge.event&&0!=(ge.itype&e.type)&&X.empty_arb(ge.itype)){var we=t.push_callback(ge);we.event=1;var Ce,Me=X.int1,Oe=X.int2,ke=ge.options1,Se=Me.cbTypes;if(ke.nonemptyintersection(Se,ke.includes)&&!ke.nonemptyintersection(Se,ke.excludes)){var Ae=ge.options2,Te=Oe.cbTypes;Ce=!!Ae.nonemptyintersection(Te,Ae.includes)&&!Ae.nonemptyintersection(Te,Ae.excludes)}else Ce=!1;Ce?(we.int1=Me,we.int2=Oe):(we.int1=Oe,we.int2=Me),we.set=X}be=be.next}null==X.arbiters.head&&this.remove_callbackset(X)}R=R.next}else R=R.next}F=F.next}}e.fresh=!1,e.intchange=!1}if(e.cleared||e.up_stamp+(e.type==_n.COL?O.arbiterExpirationDelay:0)<this.stamp){if(e.type==_n.SENSOR){var Ee=e.sensorarb;if(!Ee.cleared){for(var Ie=Ee.b1.arbiters,je=null,Ne=Ie.head;null!=Ne;){if(Ne.elt==Ee){var De,Le;null==je?(De=Ie.head,Le=De.next,Ie.head=Le,null==Ie.head&&(Ie.pushmod=!0)):(De=je.next,Le=De.next,je.next=Le,null==Le&&(Ie.pushmod=!0));var Fe=De;Fe.elt=null,Fe.next=bi.zpp_pool,bi.zpp_pool=Fe,Ie.modified=!0,Ie.length--,Ie.pushmod=!0,!0;break}je=Ne,Ne=Ne.next}for(var Pe=Ee.b2.arbiters,Re=null,Be=Pe.head;null!=Be;){if(Be.elt==Ee){var Ve,Ge;null==Re?(Ve=Pe.head,Ge=Ve.next,Pe.head=Ge,null==Pe.head&&(Pe.pushmod=!0)):(Ve=Re.next,Ge=Ve.next,Re.next=Ge,null==Ge&&(Pe.pushmod=!0));var Ue=Ve;Ue.elt=null,Ue.next=bi.zpp_pool,bi.zpp_pool=Ue,Pe.modified=!0,Pe.length--,Pe.pushmod=!0,!0;break}Re=Be,Be=Be.next}null!=Ee.pair&&(Ee.pair.arb=null,Ee.pair=null)}Ee.b1=Ee.b2=null,Ee.active=!1,Ee.intchange=!1;var Ye=Ee;Ye.next=hn.zpp_pool,hn.zpp_pool=Ye}else if(e.type==_n.FLUID){var Ke=e.fluidarb;if(!Ke.cleared){for(var We=Ke.b1.arbiters,qe=null,Xe=We.head;null!=Xe;){if(Xe.elt==Ke){var He,Ze;null==qe?(He=We.head,Ze=He.next,We.head=Ze,null==We.head&&(We.pushmod=!0)):(He=qe.next,Ze=He.next,qe.next=Ze,null==Ze&&(We.pushmod=!0));var Je=He;Je.elt=null,Je.next=bi.zpp_pool,bi.zpp_pool=Je,We.modified=!0,We.length--,We.pushmod=!0,!0;break}qe=Xe,Xe=Xe.next}for(var Qe=Ke.b2.arbiters,nn=null,tn=Qe.head;null!=tn;){if(tn.elt==Ke){var ln,an;null==nn?(ln=Qe.head,an=ln.next,Qe.head=an,null==Qe.head&&(Qe.pushmod=!0)):(ln=nn.next,an=ln.next,nn.next=an,null==an&&(Qe.pushmod=!0));var rn=ln;rn.elt=null,rn.next=bi.zpp_pool,bi.zpp_pool=rn,Qe.modified=!0,Qe.length--,Qe.pushmod=!0,!0;break}nn=tn,tn=tn.next}null!=Ke.pair&&(Ke.pair.arb=null,Ke.pair=null)}Ke.b1=Ke.b2=null,Ke.active=!1,Ke.intchange=!1;var pn=Ke;pn.next=xn.zpp_pool,xn.zpp_pool=pn,Ke.pre_dt=-1}else{var sn=e.colarb;if(!sn.cleared){for(var on=sn.b1.arbiters,vn=null,cn=on.head;null!=cn;){if(cn.elt==sn){var yn,mn;null==vn?(yn=on.head,mn=yn.next,on.head=mn,null==on.head&&(on.pushmod=!0)):(yn=vn.next,mn=yn.next,vn.next=mn,null==mn&&(on.pushmod=!0));var zn=yn;zn.elt=null,zn.next=bi.zpp_pool,bi.zpp_pool=zn,on.modified=!0,on.length--,on.pushmod=!0,!0;break}vn=cn,cn=cn.next}for(var fn=sn.b2.arbiters,bn=null,gn=fn.head;null!=gn;){if(gn.elt==sn){var wn,Cn;null==bn?(wn=fn.head,Cn=wn.next,fn.head=Cn,null==fn.head&&(fn.pushmod=!0)):(wn=bn.next,Cn=wn.next,bn.next=Cn,null==Cn&&(fn.pushmod=!0));var Mn=wn;Mn.elt=null,Mn.next=bi.zpp_pool,bi.zpp_pool=Mn,fn.modified=!0,fn.length--,fn.pushmod=!0,!0;break}bn=gn,gn=gn.next}null!=sn.pair&&(sn.pair.arb=null,sn.pair=null)}for(sn.b1=sn.b2=null,sn.active=!1,sn.intchange=!1;null!=sn.contacts.next;){var On=sn.contacts,kn=On.next;On.pop();var Sn=kn;Sn.arbiter=null,Sn.next=dn.zpp_pool,dn.zpp_pool=Sn;var An=sn.innards,En=An.next;An.next=En.next,En._inuse=!1,null==An.next&&(An.pushmod=!0),An.modified=!0,An.length--}var In=sn;In.userdef_dyn_fric=!1,In.userdef_stat_fric=!1,In.userdef_restitution=!1,In.userdef_rfric=!1,In.__ref_edge1=In.__ref_edge2=null,In.next=un.zpp_pool,un.zpp_pool=In,sn.pre_dt=-1}return!0}var jn=e.active;if(e.active=e.presentable=e.up_stamp==this.stamp,0!=(1&e.immState)){if(e.active&&e.type!=_n.SENSOR)if(null!=e.colarb){var Nn=e.colarb;Nn.invalidated&&(Nn.invalidated=!1,Nn.userdef_restitution||(Nn.s1.material.elasticity<=-1/0||Nn.s2.material.elasticity<=-1/0?Nn.restitution=0:Nn.s1.material.elasticity>=1/0||Nn.s2.material.elasticity>=1/0?Nn.restitution=1:Nn.restitution=(Nn.s1.material.elasticity+Nn.s2.material.elasticity)/2,Nn.restitution<0&&(Nn.restitution=0),Nn.restitution>1&&(Nn.restitution=1)),Nn.userdef_dyn_fric||(Nn.dyn_fric=Math.sqrt(Nn.s1.material.dynamicFriction*Nn.s2.material.dynamicFriction)),Nn.userdef_stat_fric||(Nn.stat_fric=Math.sqrt(Nn.s1.material.staticFriction*Nn.s2.material.staticFriction)),Nn.userdef_rfric||(Nn.rfric=Math.sqrt(Nn.s1.material.rollingFriction*Nn.s2.material.rollingFriction))),-1==Nn.pre_dt&&(Nn.pre_dt=n);var Dn=n/Nn.pre_dt;Nn.pre_dt=n;var Ln=Nn.b1.smass+Nn.b2.smass;Nn.hc2=!1;var Fn=!0,Pn=2!=Nn.b1.type||2!=Nn.b2.type,Rn=Pn?Nn.continuous?O.contactContinuousStaticBiasCoef:O.contactStaticBiasCoef:Nn.continuous?O.contactContinuousBiasCoef:O.contactBiasCoef;Nn.biasCoef=Rn,Nn.continuous=!1;for(var Bn=null,Vn=null,Gn=Nn.innards.next,Un=Nn.contacts.next;null!=Un;){var Yn=Un;if(Yn.stamp+O.arbiterExpirationDelay<Nn.stamp){var Kn,qn,Xn=Nn.contacts;null==Bn?(Kn=Xn.next,qn=Kn.next,Xn.next=qn,null==Xn.next&&(Xn.pushmod=!0)):(Kn=Bn.next,qn=Kn.next,Bn.next=qn,null==qn&&(Xn.pushmod=!0)),Kn._inuse=!1,Xn.modified=!0,Xn.length--,Xn.pushmod=!0,Un=qn;var Hn,Zn,Jn=Nn.innards;null==Vn?(Hn=Jn.next,Zn=Hn.next,Jn.next=Zn,null==Jn.next&&(Jn.pushmod=!0)):(Hn=Vn.next,Zn=Hn.next,Vn.next=Zn,null==Zn&&(Jn.pushmod=!0)),Hn._inuse=!1,Jn.modified=!0,Jn.length--,Jn.pushmod=!0,Gn=Zn;var Qn=Yn;Qn.arbiter=null,Qn.next=dn.zpp_pool,dn.zpp_pool=Qn}else{var $n=Yn.inner,ei=Yn.active;if(Yn.active=Yn.stamp==Nn.stamp,Yn.active){Fn?(Fn=!1,Nn.c1=$n,Nn.oc1=Yn):(Nn.hc2=!0,Nn.c2=$n,Nn.oc2=Yn),$n.r2x=Yn.px-Nn.b2.posx,$n.r2y=Yn.py-Nn.b2.posy,$n.r1x=Yn.px-Nn.b1.posx,$n.r1y=Yn.py-Nn.b1.posy;var ni=$n.r2x*Nn.nx+$n.r2y*Nn.ny,ii=Ln+Nn.b2.sinertia*(ni*ni),ti=$n.r1x*Nn.nx+$n.r1y*Nn.ny;ii+=Nn.b1.sinertia*(ti*ti),$n.tMass=ii<O.epsilon*O.epsilon?0:1/ii;var li=Nn.ny*$n.r2x-Nn.nx*$n.r2y,ai=Ln+Nn.b2.sinertia*(li*li),ri=Nn.ny*$n.r1x-Nn.nx*$n.r1y;ai+=Nn.b1.sinertia*(ri*ri),$n.nMass=ai<O.epsilon*O.epsilon?0:1/ai;var pi=0,si=0,oi=Nn.b2.angvel+Nn.b2.kinangvel;pi=Nn.b2.velx+Nn.b2.kinvelx-$n.r2y*oi,si=Nn.b2.vely+Nn.b2.kinvely+$n.r2x*oi,oi=Nn.b1.angvel+Nn.b1.kinangvel,pi-=Nn.b1.velx+Nn.b1.kinvelx-$n.r1y*oi,si-=Nn.b1.vely+Nn.b1.kinvely+$n.r1x*oi;var _i=Nn.nx*pi+Nn.ny*si;Yn.elasticity=Nn.restitution,$n.bounce=_i*Yn.elasticity,$n.bounce>-O.elasticThreshold&&($n.bounce=0),_i=si*Nn.nx-pi*Nn.ny;var hi=O.staticFrictionThreshold;$n.friction=_i*_i>hi*hi?Nn.dyn_fric:Nn.stat_fric,$n.jnAcc*=Dn,$n.jtAcc*=Dn}ei!=Yn.active&&(Nn.contacts.modified=!0),Bn=Un,Vn=Gn,Gn=Gn.next,Un=Un.next}}if(Nn.hc2){if(Nn.hpc2=!0,Nn.oc1.posOnly){var xi=Nn.c1;Nn.c1=Nn.c2,Nn.c2=xi;var ui=Nn.oc1;Nn.oc1=Nn.oc2,Nn.oc2=ui,Nn.hc2=!1}else Nn.oc2.posOnly&&(Nn.hc2=!1);Nn.oc1.posOnly&&(Fn=!0)}else Nn.hpc2=!1;if(Nn.jrAcc*=Dn,Fn||(Nn.rn1a=Nn.ny*Nn.c1.r1x-Nn.nx*Nn.c1.r1y,Nn.rt1a=Nn.c1.r1x*Nn.nx+Nn.c1.r1y*Nn.ny,Nn.rn1b=Nn.ny*Nn.c1.r2x-Nn.nx*Nn.c1.r2y,Nn.rt1b=Nn.c1.r2x*Nn.nx+Nn.c1.r2y*Nn.ny,Nn.k1x=Nn.b2.kinvelx-Nn.c1.r2y*Nn.b2.kinangvel-(Nn.b1.kinvelx-Nn.c1.r1y*Nn.b1.kinangvel),Nn.k1y=Nn.b2.kinvely+Nn.c1.r2x*Nn.b2.kinangvel-(Nn.b1.kinvely+Nn.c1.r1x*Nn.b1.kinangvel)),Nn.hc2){Nn.rn2a=Nn.ny*Nn.c2.r1x-Nn.nx*Nn.c2.r1y,Nn.rt2a=Nn.c2.r1x*Nn.nx+Nn.c2.r1y*Nn.ny,Nn.rn2b=Nn.ny*Nn.c2.r2x-Nn.nx*Nn.c2.r2y,Nn.rt2b=Nn.c2.r2x*Nn.nx+Nn.c2.r2y*Nn.ny,Nn.k2x=Nn.b2.kinvelx-Nn.c2.r2y*Nn.b2.kinangvel-(Nn.b1.kinvelx-Nn.c2.r1y*Nn.b1.kinangvel),Nn.k2y=Nn.b2.kinvely+Nn.c2.r2x*Nn.b2.kinangvel-(Nn.b1.kinvely+Nn.c2.r1x*Nn.b1.kinangvel),Nn.kMassa=Ln+Nn.b1.sinertia*Nn.rn1a*Nn.rn1a+Nn.b2.sinertia*Nn.rn1b*Nn.rn1b,Nn.kMassb=Ln+Nn.b1.sinertia*Nn.rn1a*Nn.rn2a+Nn.b2.sinertia*Nn.rn1b*Nn.rn2b,Nn.kMassc=Ln+Nn.b1.sinertia*Nn.rn2a*Nn.rn2a+Nn.b2.sinertia*Nn.rn2b*Nn.rn2b;var di=Nn.kMassa*Nn.kMassa+2*Nn.kMassb*Nn.kMassb+Nn.kMassc*Nn.kMassc;if(di<O.illConditionedThreshold*(Nn.kMassa*Nn.kMassc-Nn.kMassb*Nn.kMassb)){Nn.Ka=Nn.kMassa,Nn.Kb=Nn.kMassb,Nn.Kc=Nn.kMassc;var vi=Nn.kMassa*Nn.kMassc-Nn.kMassb*Nn.kMassb;if(vi!=vi)Nn.kMassa=Nn.kMassb=Nn.kMassc=0;else if(0==vi){var ci=0;0!=Nn.kMassa?Nn.kMassa=1/Nn.kMassa:(Nn.kMassa=0,ci|=1),0!=Nn.kMassc?Nn.kMassc=1/Nn.kMassc:(Nn.kMassc=0,ci|=2),Nn.kMassb=0}else{vi=1/vi;var yi=Nn.kMassc*vi;Nn.kMassc=Nn.kMassa*vi,Nn.kMassa=yi,Nn.kMassb*=-vi}}else{if(Nn.hc2=!1,Nn.oc2.dist<Nn.oc1.dist){var mi=Nn.c1;Nn.c1=Nn.c2,Nn.c2=mi}Nn.oc2.active=!1,Nn.contacts.modified=!0}}Nn.surfacex=Nn.b2.svelx,Nn.surfacey=Nn.b2.svely;Nn.surfacex+=1*Nn.b1.svelx,Nn.surfacey+=1*Nn.b1.svely,Nn.surfacex=-Nn.surfacex,Nn.surfacey=-Nn.surfacey,Nn.rMass=Nn.b1.sinertia+Nn.b2.sinertia,0!=Nn.rMass&&(Nn.rMass=1/Nn.rMass),Fn&&(e.active=!1)}else{var zi=e.fluidarb;-1==zi.pre_dt&&(zi.pre_dt=n);var fi=n/zi.pre_dt;zi.pre_dt=n,zi.r1x=zi.centroidx-zi.b1.posx,zi.r1y=zi.centroidy-zi.b1.posy,zi.r2x=zi.centroidx-zi.b2.posx,zi.r2y=zi.centroidy-zi.b2.posy;var gi=0,wi=0;zi.ws1.fluidEnabled&&null!=zi.ws1.fluidProperties.wrap_gravity?(gi=zi.ws1.fluidProperties.gravityx,wi=zi.ws1.fluidProperties.gravityy):(gi=this.gravityx,wi=this.gravityy);var Mi=0,Oi=0;zi.ws2.fluidEnabled&&null!=zi.ws2.fluidProperties.wrap_gravity?(Mi=zi.ws2.fluidProperties.gravityx,Oi=zi.ws2.fluidProperties.gravityy):(Mi=this.gravityx,Oi=this.gravityy);var ki=0,Si=0;if(zi.ws1.fluidEnabled&&zi.ws2.fluidEnabled){var Ai=zi.overlap*zi.ws1.fluidProperties.density,Ti=zi.overlap*zi.ws2.fluidProperties.density;if(Ai>Ti){var Ei=Ai+Ti;ki-=gi*Ei,Si-=wi*Ei}else if(Ai<Ti){var Ii=Ai+Ti;ki+=Mi*Ii,Si+=Oi*Ii}else{var ji=0,Ni=0;ji=gi+Mi,Ni=wi+Oi;if(ji*=.5,Ni*=.5,zi.ws1.worldCOMx*ji+zi.ws1.worldCOMy*Ni>zi.ws2.worldCOMx*ji+zi.ws2.worldCOMy*Ni){var Di=Ai+Ti;ki-=ji*Di,Si-=Ni*Di}else{var Li=Ai+Ti;ki+=ji*Li,Si+=Ni*Li}}}else if(zi.ws1.fluidEnabled){var Fi=zi.overlap*zi.ws1.fluidProperties.density,Pi=Fi;ki-=gi*Pi,Si-=wi*Pi}else if(zi.ws2.fluidEnabled){var Ri=zi.overlap*zi.ws2.fluidProperties.density,Bi=Ri;ki+=Mi*Bi,Si+=Oi*Bi}var Vi=n;if(ki*=Vi,Si*=Vi,zi.buoyx=ki,zi.buoyy=Si,2==zi.b1.type){var Gi=zi.b1.imass;zi.b1.velx-=ki*Gi,zi.b1.vely-=Si*Gi,zi.b1.angvel-=(Si*zi.r1x-ki*zi.r1y)*zi.b1.iinertia}if(2==zi.b2.type){var Ui=zi.b2.imass;zi.b2.velx+=ki*Ui,zi.b2.vely+=Si*Ui,zi.b2.angvel+=(Si*zi.r2x-ki*zi.r2y)*zi.b2.iinertia}if(zi.ws1.fluidEnabled&&0!=zi.ws1.fluidProperties.viscosity||zi.ws2.fluidEnabled&&0!=zi.ws2.fluidProperties.viscosity){zi.nodrag=!1;var Yi=0;if(zi.ws1.fluidEnabled&&(zi.ws2.validate_angDrag(),Yi+=zi.ws1.fluidProperties.viscosity*zi.ws2.angDrag*zi.overlap/zi.ws2.area),zi.ws2.fluidEnabled&&(zi.ws1.validate_angDrag(),Yi+=zi.ws2.fluidProperties.viscosity*zi.ws1.angDrag*zi.overlap/zi.ws1.area),0!=Yi){var Ki=zi.b1.sinertia+zi.b2.sinertia;zi.wMass=0!=Ki?1/Ki:0;Yi*=4e-4;var Wi=2*Math.PI*Yi;zi.agamma=1/(n*Wi*(2+Wi*n));var qi=1/(1+zi.agamma);n*Wi*Wi*zi.agamma,zi.agamma*=qi,zi.wMass*=qi}else zi.wMass=0,zi.agamma=0;var Xi=zi.b2.velx+zi.b2.kinvelx-zi.r2y*(zi.b2.angvel+zi.b2.kinangvel)-(zi.b1.velx+zi.b1.kinvelx-zi.r1y*(zi.b2.angvel+zi.b2.kinangvel)),Hi=zi.b2.vely+zi.b2.kinvely+zi.r2x*(zi.b2.angvel+zi.b2.kinangvel)-(zi.b1.vely+zi.b1.kinvely+zi.r1x*(zi.b1.angvel+zi.b1.kinangvel));if(!(Xi*Xi+Hi*Hi<O.epsilon*O.epsilon)){var Zi=Xi*Xi+Hi*Hi,Ji=1/Math.sqrt(Zi),Qi=Ji;Xi*=Qi,Hi*=Qi,zi.nx=Xi,zi.ny=Hi}var $i=0;if(zi.ws1.fluidEnabled){var et=-zi.ws1.fluidProperties.viscosity*zi.overlap/zi.ws2.area;if(0==zi.ws2.type)$i-=et*zi.ws2.circle.radius*O.fluidLinearDrag/(2*zi.ws2.circle.radius*Math.PI);else{for(var nt=zi.ws2.polygon,it=0,tt=0,lt=nt.edges.head;null!=lt;){var at=lt.elt;it+=at.length;var rt=et*at.length*(at.gnormx*zi.nx+at.gnormy*zi.ny);rt>0&&(rt*=-O.fluidVacuumDrag,rt=rt),tt-=.5*rt*O.fluidLinearDrag,lt=lt.next}$i+=tt/it}}if(zi.ws2.fluidEnabled){var pt=-zi.ws2.fluidProperties.viscosity*zi.overlap/zi.ws1.area;if(0==zi.ws1.type)$i-=pt*zi.ws1.circle.radius*O.fluidLinearDrag/(2*zi.ws1.circle.radius*Math.PI);else{for(var st=zi.ws1.polygon,ot=0,_t=0,ht=st.edges.head;null!=ht;){var xt=ht.elt;ot+=xt.length;var ut=pt*xt.length*(xt.gnormx*zi.nx+xt.gnormy*zi.ny);ut>0&&(ut*=-O.fluidVacuumDrag,ut=ut),_t-=.5*ut*O.fluidLinearDrag,ht=ht.next}$i+=_t/ot}}if(0!=$i){var dt=zi.b1.smass+zi.b2.smass,vt=0,ct=0,yt=0;if(vt=dt,ct=0,yt=dt,0!=zi.b1.sinertia){var mt=zi.r1x*zi.b1.sinertia,zt=zi.r1y*zi.b1.sinertia;vt+=zt*zi.r1y,ct+=-zt*zi.r1x,yt+=mt*zi.r1x}if(0!=zi.b2.sinertia){var ft=zi.r2x*zi.b2.sinertia,bt=zi.r2y*zi.b2.sinertia;vt+=bt*zi.r2y,ct+=-bt*zi.r2x,yt+=ft*zi.r2x}var gt=vt*yt-ct*ct;if(gt!=gt)yt=0,ct=yt,vt=ct;else if(0==gt){var wt=0;0!=vt?vt=1/vt:(vt=0,wt|=1),0!=yt?yt=1/yt:(yt=0,wt|=2),ct=0}else{gt=1/gt;var Ct=yt*gt;yt=vt*gt,vt=Ct,ct*=-gt}zi.vMassa=vt,zi.vMassb=ct,zi.vMassc=yt;var Mt=2*Math.PI*$i;zi.lgamma=1/(n*Mt*(2+Mt*n));var Ot=1/(1+zi.lgamma);n*Mt*Mt*zi.lgamma,zi.lgamma*=Ot;var kt=Ot;zi.vMassa*=kt,zi.vMassb*=kt,zi.vMassc*=kt}else zi.vMassa=0,zi.vMassb=0,zi.vMassc=0,zi.lgamma=0}else zi.nodrag=!0,zi.dampx=0,zi.dampy=0,zi.adamp=0;var St=fi;zi.dampx*=St,zi.dampy*=St,zi.adamp*=fi}}else if(null!=e.colarb){var At=e.colarb,Tt=!0,Et=null,It=null,jt=At.innards.next;At.hc2=!1;for(var Nt=At.contacts.next;null!=Nt;){var Dt=Nt;if(Dt.stamp+O.arbiterExpirationDelay<At.stamp){var Lt,Ft,Pt=At.contacts;null==Et?(Lt=Pt.next,Ft=Lt.next,Pt.next=Ft,null==Pt.next&&(Pt.pushmod=!0)):(Lt=Et.next,Ft=Lt.next,Et.next=Ft,null==Ft&&(Pt.pushmod=!0)),Lt._inuse=!1,Pt.modified=!0,Pt.length--,Pt.pushmod=!0,Nt=Ft;var Rt,Bt,Vt=At.innards;null==It?(Rt=Vt.next,Bt=Rt.next,Vt.next=Bt,null==Vt.next&&(Vt.pushmod=!0)):(Rt=It.next,Bt=Rt.next,It.next=Bt,null==Bt&&(Vt.pushmod=!0)),Rt._inuse=!1,Vt.modified=!0,Vt.length--,Vt.pushmod=!0,jt=Bt;var Gt=Dt;Gt.arbiter=null,Gt.next=dn.zpp_pool,dn.zpp_pool=Gt}else{var Ut=Dt.inner,Yt=Dt.active;Dt.active=Dt.stamp==At.stamp,Dt.active&&(Tt?(Tt=!1,At.c1=Ut,At.oc1=Dt):(At.hc2=!0,At.c2=Ut,At.oc2=Dt)),Yt!=Dt.active&&(At.contacts.modified=!0),Et=Nt,It=jt,jt=jt.next,Nt=Nt.next}}if(At.hc2){if(At.hpc2=!0,At.oc1.posOnly){var Kt=At.c1;At.c1=At.c2,At.c2=Kt;var Wt=At.oc1;At.oc1=At.oc2,At.oc2=Wt,At.hc2=!1}else At.oc2.posOnly&&(At.hc2=!1);At.oc1.posOnly&&(Tt=!0)}else At.hpc2=!1;Tt&&(e.active=!1)}return jn!=e.active&&(e.b1.arbiters.modified=!0,e.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},prestep:function(e){for(var n=null,i=this.live_constraints.head;null!=i;){var t=i.elt;t.preStep(e)?(i=this.live_constraints.erase(n),t.broken(),this.constraintCbBreak(t),t.removeOnBreak?(t.component.sleeping=!0,this.midstep=!1,null!=t.compound?t.compound.wrap_constraints.remove(t.outer):this.wrap_constraints.remove(t.outer),this.midstep=!0):t.active=!1,t.clearcache()):(n=i,i=i.next)}var l=null,a=this.c_arbiters_true,r=a.head,p=null!=this.c_arbiters_false;for(p&&null==r&&(p=!1,r=this.c_arbiters_false.head,a=this.c_arbiters_false,l=null);null!=r;){var s=r.elt;if(this.presteparb(s,e)){var o,_;null==l?(o=a.head,_=o.next,a.head=_,null==a.head&&(a.pushmod=!0)):(o=l.next,_=o.next,l.next=_,null==_&&(a.pushmod=!0));var h=o;h.elt=null,h.next=Di.zpp_pool,Di.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0,r=_,p&&null==r&&(p=!1,r=this.c_arbiters_false.head,a=this.c_arbiters_false,l=null)}else l=r,r=r.next,p&&null==r&&(p=!1,r=this.c_arbiters_false.head,a=this.c_arbiters_false,l=null)}var x=null,u=this.f_arbiters,d=u.head,v=!1;for(v&&null==d&&(v=!1,u=null,x=null);null!=d;){var c=d.elt;if(this.presteparb(c,e)){var y,m;null==x?(y=u.head,m=y.next,u.head=m,null==u.head&&(u.pushmod=!0)):(y=x.next,m=y.next,x.next=m,null==m&&(u.pushmod=!0));var z=y;z.elt=null,z.next=Ii.zpp_pool,Ii.zpp_pool=z,u.modified=!0,u.length--,u.pushmod=!0,d=m,v&&null==d&&(v=!1,u=null,x=null)}else x=d,d=d.next,v&&null==d&&(v=!1,u=null,x=null)}var f=null,b=this.s_arbiters,g=b.head,w=!1;for(w&&null==g&&(w=!1,b=null,f=null);null!=g;){var C=g.elt;if(this.presteparb(C,e)){var M,O;null==f?(M=b.head,O=M.next,b.head=O,null==b.head&&(b.pushmod=!0)):(M=f.next,O=M.next,f.next=O,null==O&&(b.pushmod=!0));var k=M;k.elt=null,k.next=ji.zpp_pool,ji.zpp_pool=k,b.modified=!0,b.length--,b.pushmod=!0,g=O,w&&null==g&&(w=!1,b=null,f=null)}else f=g,g=g.next,w&&null==g&&(w=!1,b=null,f=null)}},warmStart:function(){for(var e=this.f_arbiters.head;null!=e;){var n=e.elt;if(n.active&&0!=(1&n.immState)){var i=n.b1.imass;n.b1.velx-=n.dampx*i,n.b1.vely-=n.dampy*i;var t=n.b2.imass;n.b2.velx+=n.dampx*t,n.b2.vely+=n.dampy*t,n.b1.angvel-=n.b1.iinertia*(n.dampy*n.r1x-n.dampx*n.r1y),n.b2.angvel+=n.b2.iinertia*(n.dampy*n.r2x-n.dampx*n.r2y),n.b1.angvel-=n.adamp*n.b1.iinertia,n.b2.angvel+=n.adamp*n.b2.iinertia}e=e.next}var l=this.c_arbiters_false.head,a=!0;for(null==l&&(l=this.c_arbiters_true.head,a=!1);null!=l;){var r=l.elt;if(r.active&&0!=(1&r.immState)){var p=r.nx*r.c1.jnAcc-r.ny*r.c1.jtAcc,s=r.ny*r.c1.jnAcc+r.nx*r.c1.jtAcc,o=r.b1.imass;r.b1.velx-=p*o,r.b1.vely-=s*o,r.b1.angvel-=r.b1.iinertia*(s*r.c1.r1x-p*r.c1.r1y);var _=r.b2.imass;if(r.b2.velx+=p*_,r.b2.vely+=s*_,r.b2.angvel+=r.b2.iinertia*(s*r.c1.r2x-p*r.c1.r2y),r.hc2){var h=r.nx*r.c2.jnAcc-r.ny*r.c2.jtAcc,x=r.ny*r.c2.jnAcc+r.nx*r.c2.jtAcc,u=r.b1.imass;r.b1.velx-=h*u,r.b1.vely-=x*u,r.b1.angvel-=r.b1.iinertia*(x*r.c2.r1x-h*r.c2.r1y);var d=r.b2.imass;r.b2.velx+=h*d,r.b2.vely+=x*d,r.b2.angvel+=r.b2.iinertia*(x*r.c2.r2x-h*r.c2.r2y)}r.b2.angvel+=r.jrAcc*r.b2.iinertia,r.b1.angvel-=r.jrAcc*r.b1.iinertia}l=l.next,a&&null==l&&(l=this.c_arbiters_true.head,a=!1)}for(var v=this.live_constraints.head;null!=v;){v.elt.warmStart(),v=v.next}},iterateVel:function(e){for(var n=0,i=e;n<i;){for(var t=(n++,this.f_arbiters.head);null!=t;){var l=t.elt;if(l.active&&0!=(1&l.immState)&&!l.nodrag){var a=l.b1.angvel+l.b1.kinangvel,r=l.b2.angvel+l.b2.kinangvel,p=l.b1.velx+l.b1.kinvelx-l.r1y*a-(l.b2.velx+l.b2.kinvelx-l.r2y*r),s=l.b1.vely+l.b1.kinvely+l.r1x*a-(l.b2.vely+l.b2.kinvely+l.r2x*r),o=l.vMassa*p+l.vMassb*s;s=l.vMassb*p+l.vMassc*s,p=o;var _=l.lgamma;p-=l.dampx*_,s-=l.dampy*_;l.dampx+=1*p,l.dampy+=1*s;var h=l.b1.imass;l.b1.velx-=p*h,l.b1.vely-=s*h;var x=l.b2.imass;l.b2.velx+=p*x,l.b2.vely+=s*x,l.b1.angvel-=l.b1.iinertia*(s*l.r1x-p*l.r1y),l.b2.angvel+=l.b2.iinertia*(s*l.r2x-p*l.r2y);var u=(a-r)*l.wMass-l.adamp*l.agamma;l.adamp+=u,l.b1.angvel-=u*l.b1.iinertia,l.b2.angvel+=u*l.b2.iinertia}t=t.next}for(var d=null,v=this.live_constraints.head;null!=v;){var c=v.elt;c.applyImpulseVel()?(v=this.live_constraints.erase(d),c.broken(),this.constraintCbBreak(c),c.removeOnBreak?(c.component.sleeping=!0,this.midstep=!1,null!=c.compound?c.compound.wrap_constraints.remove(c.outer):this.wrap_constraints.remove(c.outer),this.midstep=!0):c.active=!1,c.clearcache()):(d=v,v=v.next)}var y=this.c_arbiters_false.head,m=!0;for(null==y&&(y=this.c_arbiters_true.head,m=!1);null!=y;){var z=y.elt;if(z.active&&0!=(1&z.immState)){var f,b,g,w,C,M,O=z.k1x+z.b2.velx-z.c1.r2y*z.b2.angvel-(z.b1.velx-z.c1.r1y*z.b1.angvel),k=z.k1y+z.b2.vely+z.c1.r2x*z.b2.angvel-(z.b1.vely+z.c1.r1x*z.b1.angvel);if(g=(k*z.nx-O*z.ny+z.surfacex)*z.c1.tMass,w=z.c1.friction*z.c1.jnAcc,C=z.c1.jtAcc,M=C-g,M>w?M=w:M<-w&&(M=-w),g=M-C,z.c1.jtAcc=M,f=-z.ny*g,b=z.nx*g,z.b2.velx+=f*z.b2.imass,z.b2.vely+=b*z.b2.imass,z.b1.velx-=f*z.b1.imass,z.b1.vely-=b*z.b1.imass,z.b2.angvel+=z.rt1b*g*z.b2.iinertia,z.b1.angvel-=z.rt1a*g*z.b1.iinertia,z.hc2){var S=z.k2x+z.b2.velx-z.c2.r2y*z.b2.angvel-(z.b1.velx-z.c2.r1y*z.b1.angvel),A=z.k2y+z.b2.vely+z.c2.r2x*z.b2.angvel-(z.b1.vely+z.c2.r1x*z.b1.angvel);g=(A*z.nx-S*z.ny+z.surfacex)*z.c2.tMass,w=z.c2.friction*z.c2.jnAcc,C=z.c2.jtAcc,M=C-g,M>w?M=w:M<-w&&(M=-w),g=M-C,z.c2.jtAcc=M,f=-z.ny*g,b=z.nx*g,z.b2.velx+=f*z.b2.imass,z.b2.vely+=b*z.b2.imass,z.b1.velx-=f*z.b1.imass,z.b1.vely-=b*z.b1.imass,z.b2.angvel+=z.rt2b*g*z.b2.iinertia,z.b1.angvel-=z.rt2a*g*z.b1.iinertia,O=z.k1x+z.b2.velx-z.c1.r2y*z.b2.angvel-(z.b1.velx-z.c1.r1y*z.b1.angvel),k=z.k1y+z.b2.vely+z.c1.r2x*z.b2.angvel-(z.b1.vely+z.c1.r1x*z.b1.angvel),S=z.k2x+z.b2.velx-z.c2.r2y*z.b2.angvel-(z.b1.velx-z.c2.r1y*z.b1.angvel),A=z.k2y+z.b2.vely+z.c2.r2x*z.b2.angvel-(z.b1.vely+z.c2.r1x*z.b1.angvel);var T=z.c1.jnAcc,E=z.c2.jnAcc,I=O*z.nx+k*z.ny+z.surfacey+z.c1.bounce-(z.Ka*T+z.Kb*E),j=S*z.nx+A*z.ny+z.surfacey+z.c2.bounce-(z.Kb*T+z.Kc*E),N=-(z.kMassa*I+z.kMassb*j),D=-(z.kMassb*I+z.kMassc*j);N>=0&&D>=0?(I=N-T,j=D-E,z.c1.jnAcc=N,z.c2.jnAcc=D):(N=-z.c1.nMass*I,N>=0&&z.Kb*N+j>=0?(I=N-T,j=-E,z.c1.jnAcc=N,z.c2.jnAcc=0):(D=-z.c2.nMass*j,D>=0&&z.Kb*D+I>=0?(I=-T,j=D-E,z.c1.jnAcc=0,z.c2.jnAcc=D):I>=0&&j>=0?(I=-T,j=-E,z.c1.jnAcc=z.c2.jnAcc=0):(I=0,j=0))),g=I+j,f=z.nx*g,b=z.ny*g,z.b2.velx+=f*z.b2.imass,z.b2.vely+=b*z.b2.imass,z.b1.velx-=f*z.b1.imass,z.b1.vely-=b*z.b1.imass,z.b2.angvel+=(z.rn1b*I+z.rn2b*j)*z.b2.iinertia,z.b1.angvel-=(z.rn1a*I+z.rn2a*j)*z.b1.iinertia}else{if(0!=z.radius){g=(z.b2.angvel-z.b1.angvel)*z.rMass,w=z.rfric*z.c1.jnAcc,C=z.jrAcc,z.jrAcc-=g,z.jrAcc>w?z.jrAcc=w:z.jrAcc<-w&&(z.jrAcc=-w),g=z.jrAcc-C,z.b2.angvel+=g*z.b2.iinertia,z.b1.angvel-=g*z.b1.iinertia}O=z.k1x+z.b2.velx-z.c1.r2y*z.b2.angvel-(z.b1.velx-z.c1.r1y*z.b1.angvel),k=z.k1y+z.b2.vely+z.c1.r2x*z.b2.angvel-(z.b1.vely+z.c1.r1x*z.b1.angvel),g=(z.c1.bounce+(z.nx*O+z.ny*k)+z.surfacey)*z.c1.nMass,C=z.c1.jnAcc,M=C-g,M<0&&(M=0),g=M-C,z.c1.jnAcc=M,f=z.nx*g,b=z.ny*g,z.b2.velx+=f*z.b2.imass,z.b2.vely+=b*z.b2.imass,z.b1.velx-=f*z.b1.imass,z.b1.vely-=b*z.b1.imass,z.b2.angvel+=z.rn1b*g*z.b2.iinertia,z.b1.angvel-=z.rn1a*g*z.b1.iinertia}}y=y.next,m&&null==y&&(y=this.c_arbiters_true.head,m=!1)}}},iteratePos:function(e){for(var n=0,i=e;n<i;){for(var t=(n++,null),l=this.live_constraints.head;null!=l;){var a=l.elt;!a.__velocity&&a.stiff&&a.applyImpulsePos()?(l=this.live_constraints.erase(t),a.broken(),this.constraintCbBreak(a),a.removeOnBreak?(a.component.sleeping=!0,this.midstep=!1,null!=a.compound?a.compound.wrap_constraints.remove(a.outer):this.wrap_constraints.remove(a.outer),this.midstep=!0):a.active=!1,a.clearcache()):(t=l,l=l.next)}var r=this.c_arbiters_false.head,p=!0;for(null==r&&(r=this.c_arbiters_true.head,p=!1);null!=r;){var s=r.elt;if(s.active&&0!=(1&s.immState))if(2==s.ptype){var o=s.c1,_=0,h=0;_=s.b2.axisy*o.lr2x-s.b2.axisx*o.lr2y,h=o.lr2x*s.b2.axisx+o.lr2y*s.b2.axisy;_+=1*s.b2.posx,h+=1*s.b2.posy;var x=0,u=0;x=s.b1.axisy*o.lr1x-s.b1.axisx*o.lr1y,u=o.lr1x*s.b1.axisx+o.lr1y*s.b1.axisy;x+=1*s.b1.posx,u+=1*s.b1.posy;var d=0,v=0;d=_-x,v=h-u;var c=Math.sqrt(d*d+v*v),y=s.radius-O.collisionSlop,m=c-y;if(d*s.nx+v*s.ny<0&&(d=-d,v=-v,m-=s.radius),m<0)if(c<O.epsilon)0!=s.b1.smass?s.b1.posx+=10*O.epsilon:s.b2.posx+=10*O.epsilon;else{var z=1/c;d*=z,v*=z;var f=.5*(x+_),b=.5*(u+h),g=c-y;x=f-s.b1.posx,u=b-s.b1.posy,_=f-s.b2.posx,h=b-s.b2.posy;var w=v*x-d*u,C=v*_-d*h,M=s.b2.smass+C*C*s.b2.sinertia+s.b1.smass+w*w*s.b1.sinertia;if(0!=M){var k=-s.biasCoef*g/M,S=0,A=0,T=k;S=d*T,A=v*T;var E=s.b1.imass;s.b1.posx-=S*E,s.b1.posy-=A*E;var I=s.b1,j=-w*s.b1.iinertia*k;if(I.rot+=j,j*j>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var N=j*j,D=1-.5*N,L=1-N*N/8,F=(D*I.axisx+j*I.axisy)*L;I.axisy=(D*I.axisy-j*I.axisx)*L,I.axisx=F}var P=s.b2.imass;s.b2.posx+=S*P,s.b2.posy+=A*P;var R=s.b2,B=C*s.b2.iinertia*k;if(R.rot+=B,B*B>1e-4)R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot);else{var V=B*B,G=1-.5*V,U=1-V*V/8,Y=(G*R.axisx+B*R.axisy)*U;R.axisy=(G*R.axisy-B*R.axisx)*U,R.axisx=Y}}}}else{var K,W=0,q=0,X=0,H=0,Z=0,J=0;if(0==s.ptype){W=s.b1.axisy*s.lnormx-s.b1.axisx*s.lnormy,q=s.lnormx*s.b1.axisx+s.lnormy*s.b1.axisy,K=s.lproj+(W*s.b1.posx+q*s.b1.posy),X=s.b2.axisy*s.c1.lr1x-s.b2.axisx*s.c1.lr1y,H=s.c1.lr1x*s.b2.axisx+s.c1.lr1y*s.b2.axisy;if(X+=1*s.b2.posx,H+=1*s.b2.posy,s.hpc2){Z=s.b2.axisy*s.c2.lr1x-s.b2.axisx*s.c2.lr1y,J=s.c2.lr1x*s.b2.axisx+s.c2.lr1y*s.b2.axisy;Z+=1*s.b2.posx,J+=1*s.b2.posy}}else{W=s.b2.axisy*s.lnormx-s.b2.axisx*s.lnormy,q=s.lnormx*s.b2.axisx+s.lnormy*s.b2.axisy,K=s.lproj+(W*s.b2.posx+q*s.b2.posy),X=s.b1.axisy*s.c1.lr1x-s.b1.axisx*s.c1.lr1y,H=s.c1.lr1x*s.b1.axisx+s.c1.lr1y*s.b1.axisy;if(X+=1*s.b1.posx,H+=1*s.b1.posy,s.hpc2){Z=s.b1.axisy*s.c2.lr1x-s.b1.axisx*s.c2.lr1y,J=s.c2.lr1x*s.b1.axisx+s.c2.lr1y*s.b1.axisy;Z+=1*s.b1.posx,J+=1*s.b1.posy}}var Q=X*W+H*q-K-s.radius;Q+=O.collisionSlop;var $=0;if(s.hpc2&&($=Z*W+J*q-K-s.radius,$+=O.collisionSlop),Q<0||$<0){s.rev&&(W=-W,q=-q);var ee=0,ne=0;ee=X-s.b1.posx,ne=H-s.b1.posy;var ie=0,te=0;ie=X-s.b2.posx,te=H-s.b2.posy;var le=0,ae=0,re=0,pe=0;if(s.hpc2){le=Z-s.b1.posx,ae=J-s.b1.posy,re=Z-s.b2.posx,pe=J-s.b2.posy;var se=q*ee-W*ne,oe=q*ie-W*te,_e=q*le-W*ae,he=q*re-W*pe,xe=s.b1.smass+s.b2.smass;s.kMassa=xe+s.b1.sinertia*se*se+s.b2.sinertia*oe*oe,s.kMassb=xe+s.b1.sinertia*se*_e+s.b2.sinertia*oe*he,s.kMassc=xe+s.b1.sinertia*_e*_e+s.b2.sinertia*he*he;var ue=0,de=0,ve=0;ue=s.kMassa,de=s.kMassb,ve=s.kMassc;for(var ce=Q*s.biasCoef,ye=$*s.biasCoef;;){var me=0,ze=0;me=ce,ze=ye,me=-me,ze=-ze;var fe=s.kMassa*s.kMassc-s.kMassb*s.kMassb;if(fe!=fe)ze=0,me=ze;else if(0==fe)0!=s.kMassa?me/=s.kMassa:me=0,0!=s.kMassc?ze/=s.kMassc:ze=0;else{fe=1/fe;var be=fe*(s.kMassc*me-s.kMassb*ze);ze=fe*(s.kMassa*ze-s.kMassb*me),me=be}if(me>=0&&ze>=0){var ge=(me+ze)*s.b1.imass;s.b1.posx-=W*ge,s.b1.posy-=q*ge;var we=s.b1,Ce=-s.b1.iinertia*(se*me+_e*ze);if(we.rot+=Ce,Ce*Ce>1e-4)we.axisx=Math.sin(we.rot),we.axisy=Math.cos(we.rot);else{var Me=Ce*Ce,Oe=1-.5*Me,ke=1-Me*Me/8,Se=(Oe*we.axisx+Ce*we.axisy)*ke;we.axisy=(Oe*we.axisy-Ce*we.axisx)*ke,we.axisx=Se}var Ae=(me+ze)*s.b2.imass;s.b2.posx+=W*Ae,s.b2.posy+=q*Ae;var Te=s.b2,Ee=s.b2.iinertia*(oe*me+he*ze);if(Te.rot+=Ee,Ee*Ee>1e-4)Te.axisx=Math.sin(Te.rot),Te.axisy=Math.cos(Te.rot);else{var Ie=Ee*Ee,je=1-.5*Ie,Ne=1-Ie*Ie/8,De=(je*Te.axisx+Ee*Te.axisy)*Ne;Te.axisy=(je*Te.axisy-Ee*Te.axisx)*Ne,Te.axisx=De}break}me=-ce/ue,ze=0;var Le=de*me+ye;if(me>=0&&Le>=0){var Fe=(me+ze)*s.b1.imass;s.b1.posx-=W*Fe,s.b1.posy-=q*Fe;var Pe=s.b1,Re=-s.b1.iinertia*(se*me+_e*ze);if(Pe.rot+=Re,Re*Re>1e-4)Pe.axisx=Math.sin(Pe.rot),Pe.axisy=Math.cos(Pe.rot);else{var Be=Re*Re,Ve=1-.5*Be,Ge=1-Be*Be/8,Ue=(Ve*Pe.axisx+Re*Pe.axisy)*Ge;Pe.axisy=(Ve*Pe.axisy-Re*Pe.axisx)*Ge,Pe.axisx=Ue}var Ye=(me+ze)*s.b2.imass;s.b2.posx+=W*Ye,s.b2.posy+=q*Ye;var Ke=s.b2,We=s.b2.iinertia*(oe*me+he*ze);if(Ke.rot+=We,We*We>1e-4)Ke.axisx=Math.sin(Ke.rot),Ke.axisy=Math.cos(Ke.rot);else{var qe=We*We,Xe=1-.5*qe,He=1-qe*qe/8,Ze=(Xe*Ke.axisx+We*Ke.axisy)*He;Ke.axisy=(Xe*Ke.axisy-We*Ke.axisx)*He,Ke.axisx=Ze}break}me=0,ze=-ye/ve;var Je=de*ze+ce;if(ze>=0&&Je>=0){var Qe=(me+ze)*s.b1.imass;s.b1.posx-=W*Qe,s.b1.posy-=q*Qe;var $e=s.b1,en=-s.b1.iinertia*(se*me+_e*ze);if($e.rot+=en,en*en>1e-4)$e.axisx=Math.sin($e.rot),$e.axisy=Math.cos($e.rot);else{var nn=en*en,tn=1-.5*nn,ln=1-nn*nn/8,an=(tn*$e.axisx+en*$e.axisy)*ln;$e.axisy=(tn*$e.axisy-en*$e.axisx)*ln,$e.axisx=an}var rn=(me+ze)*s.b2.imass;s.b2.posx+=W*rn,s.b2.posy+=q*rn;var pn=s.b2,sn=s.b2.iinertia*(oe*me+he*ze);if(pn.rot+=sn,sn*sn>1e-4)pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot);else{var on=sn*sn,_n=1-.5*on,hn=1-on*on/8,xn=(_n*pn.axisx+sn*pn.axisy)*hn;pn.axisy=(_n*pn.axisy-sn*pn.axisx)*hn,pn.axisx=xn}break}break}}else{var un=q*ee-W*ne,dn=q*ie-W*te,vn=s.b2.smass+dn*dn*s.b2.sinertia+s.b1.smass+un*un*s.b1.sinertia;if(0!=vn){var cn=-s.biasCoef*Q/vn,yn=0,mn=0,zn=cn;yn=W*zn,mn=q*zn;var fn=s.b1.imass;s.b1.posx-=yn*fn,s.b1.posy-=mn*fn;var bn=s.b1,gn=-un*s.b1.iinertia*cn;if(bn.rot+=gn,gn*gn>1e-4)bn.axisx=Math.sin(bn.rot),bn.axisy=Math.cos(bn.rot);else{var wn=gn*gn,Cn=1-.5*wn,Mn=1-wn*wn/8,On=(Cn*bn.axisx+gn*bn.axisy)*Mn
;bn.axisy=(Cn*bn.axisy-gn*bn.axisx)*Mn,bn.axisx=On}var kn=s.b2.imass;s.b2.posx+=yn*kn,s.b2.posy+=mn*kn;var Sn=s.b2,An=dn*s.b2.iinertia*cn;if(Sn.rot+=An,An*An>1e-4)Sn.axisx=Math.sin(Sn.rot),Sn.axisy=Math.cos(Sn.rot);else{var Tn=An*An,En=1-.5*Tn,In=1-Tn*Tn/8,jn=(En*Sn.axisx+An*Sn.axisy)*In;Sn.axisy=(En*Sn.axisy-An*Sn.axisx)*In,Sn.axisx=jn}}}}}r=r.next,p&&null==r&&(r=this.c_arbiters_true.head,p=!1)}}},narrowPhase:function(e,n,i,t,l){var a,r=this,p=null,s=e.body,o=n.body;a=!1;for(var _=s.constraints.head;null!=_;){var h=_.elt;if(h.ignore&&h.pair_exists(s.id,o.id)){a=!0;break}_=_.next}var x,u;if(a)u=!1;else{for(var d=e;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var v,c=null==d?null:d.group;if(null==c)v=!1;else{for(var y=n;null!=y&&null==y.group;)y=null!=y.ishape?y.ishape.body:null!=y.icompound?y.icompound.compound:y.ibody.compound;var m=null==y?null:y.group;if(null==m)v=!1;else{for(var z=!1;null!=c&&null!=m;){if(c==m){z=c.ignore;break}c.depth<m.depth?m=m.group:c=c.group}v=z}}u=!v}if(u){var f;if(e.sensorEnabled||n.sensorEnabled){var b=e.filter,g=n.filter;f=0!=(b.sensorMask&g.sensorGroup)&&0!=(g.sensorMask&b.sensorGroup)}else f=!1;if(f)x=2;else{var w;if(e.fluidEnabled||n.fluidEnabled){var C=e.filter,M=n.filter;w=0!=(C.fluidMask&M.fluidGroup)&&0!=(M.fluidMask&C.fluidGroup)}else w=!1;if(!!w&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia))x=0;else{var k,S=e.filter,A=n.filter;k=0!=(S.collisionMask&A.collisionGroup)&&0!=(A.collisionMask&S.collisionGroup)&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia),x=k?1:-1}}}else x=-1;if(-1!=x){var T,E;e.type>n.type?(T=n,E=e):e.type==n.type?e.id<n.id?(T=e,E=n):(E=e,T=n):(T=e,E=n);var I=T==n;if(0==x){var j;if(null==t){for(var N=null,D=s.arbiters.length<o.arbiters.length?s:o,L=D.arbiters.head;null!=L;){var F=L.elt;if(F.id==T.id&&F.di==E.id){N=F;break}L=L.next}j=N}else j=t;var P,R=null==j,B=!1;if(R)null==xn.zpp_pool?P=new xn:(P=xn.zpp_pool,xn.zpp_pool=P.next,P.next=null);else if(null==j.fluidarb){j.cleared=!0;for(var V=j.b1.arbiters,G=null,U=V.head;null!=U;){if(U.elt==j){var K,W;null==G?(K=V.head,W=K.next,V.head=W,null==V.head&&(V.pushmod=!0)):(K=G.next,W=K.next,G.next=W,null==W&&(V.pushmod=!0));var q=K;q.elt=null,q.next=bi.zpp_pool,bi.zpp_pool=q,V.modified=!0,V.length--,V.pushmod=!0,!0;break}G=U,U=U.next}for(var X=j.b2.arbiters,H=null,Z=X.head;null!=Z;){if(Z.elt==j){var J,Q;null==H?(J=X.head,Q=J.next,X.head=Q,null==X.head&&(X.pushmod=!0)):(J=H.next,Q=J.next,H.next=Q,null==Q&&(X.pushmod=!0));var $=J;$.elt=null,$.next=bi.zpp_pool,bi.zpp_pool=$,X.modified=!0,X.length--,X.pushmod=!0,!0;break}H=Z,Z=Z.next}null!=j.pair&&(j.pair.arb=null,j.pair=null),j.active=!1,this.f_arbiters.modified=!0,null==xn.zpp_pool?P=new xn:(P=xn.zpp_pool,xn.zpp_pool=P.next,P.next=null),P.intchange=!0,R=!0,B=!0}else P=j.fluidarb;if(R||P.stamp!=this.stamp||l)if(P.stamp=this.stamp,fn.flowCollide(T,E,P)){if(R){var ee=E.id;P.b1=e.body,P.ws1=e,P.b2=n.body,P.ws2=n,P.id=T.id,P.di=ee;var ne,ie=P.b1.arbiters;null==bi.zpp_pool?ne=new bi:(ne=bi.zpp_pool,bi.zpp_pool=ne.next,ne.next=null),ne.elt=P;var te=ne;te.next=ie.head,ie.head=te,ie.modified=!0,ie.length++;var le,ae=P.b2.arbiters;null==bi.zpp_pool?le=new bi:(le=bi.zpp_pool,bi.zpp_pool=le.next,le.next=null),le.elt=P;var re=le;re.next=ae.head,ae.head=re,ae.modified=!0,ae.length++,P.active=!0,P.present=0,P.cleared=!1,P.sleeping=!1,P.fresh=!1,P.presentable=!1,P.nx=0,P.ny=1,P.dampx=0,P.dampy=0,P.adamp=0;var pe,se=this.f_arbiters;null==Ii.zpp_pool?pe=new Ii:(pe=Ii.zpp_pool,Ii.zpp_pool=pe.next,pe.next=null),pe.elt=P;var oe=pe;oe.next=se.head,se.head=oe,se.modified=!0,se.length++,P.fresh=!B}else P.fresh=P.up_stamp<this.stamp-1||P.endGenerated==this.stamp&&l;if(P.up_stamp=P.stamp,P.fresh||0==(4&P.immState)){P.immState=1;for(var _e=!1,he=P.ws1.id>P.ws2.id?P.ws2:P.ws1,xe=P.ws1.id>P.ws2.id?P.ws1:P.ws2,ue=this.mrca1;null!=ue.head;){var de=ue.head;ue.head=de.next;var ve=de;ve.elt=null,ve.next=Ci.zpp_pool,Ci.zpp_pool=ve,null==ue.head&&(ue.pushmod=!0),ue.modified=!0,ue.length--}ue.pushmod=!0;for(var ce=this.mrca2;null!=ce.head;){var ye=ce.head;ce.head=ye.next;var me=ye;me.elt=null,me.next=Ci.zpp_pool,Ci.zpp_pool=me,null==ce.head&&(ce.pushmod=!0),ce.modified=!0,ce.length--}if(ce.pushmod=!0,null!=he.cbSet){var ze,fe=this.mrca1;null==Ci.zpp_pool?ze=new Ci:(ze=Ci.zpp_pool,Ci.zpp_pool=ze.next,ze.next=null),ze.elt=he;var be=ze;be.next=fe.head,fe.head=be,fe.modified=!0,fe.length++}if(null!=he.body.cbSet){var ge,we=this.mrca1,Ce=he.body;null==Ci.zpp_pool?ge=new Ci:(ge=Ci.zpp_pool,Ci.zpp_pool=ge.next,ge.next=null),ge.elt=Ce;var Me=ge;Me.next=we.head,we.head=Me,we.modified=!0,we.length++}if(null!=xe.cbSet){var Oe,ke=this.mrca2;null==Ci.zpp_pool?Oe=new Ci:(Oe=Ci.zpp_pool,Ci.zpp_pool=Oe.next,Oe.next=null),Oe.elt=xe;var Se=Oe;Se.next=ke.head,ke.head=Se,ke.modified=!0,ke.length++}if(null!=xe.body.cbSet){var Ae,Te=this.mrca2,Ee=xe.body;null==Ci.zpp_pool?Ae=new Ci:(Ae=Ci.zpp_pool,Ci.zpp_pool=Ae.next,Ae.next=null),Ae.elt=Ee;var Ie=Ae;Ie.next=Te.head,Te.head=Ie,Te.modified=!0,Te.length++}for(var je=he.body.compound,Ne=xe.body.compound;je!=Ne;){var De=null==je?0:je.depth,Le=null==Ne?0:Ne.depth;if(De<Le){if(null!=Ne.cbSet){var Fe,Pe=this.mrca2;null==Ci.zpp_pool?Fe=new Ci:(Fe=Ci.zpp_pool,Ci.zpp_pool=Fe.next,Fe.next=null),Fe.elt=Ne;var Re=Fe;Re.next=Pe.head,Pe.head=Re,Pe.modified=!0,Pe.length++}Ne=Ne.compound}else{if(null!=je.cbSet){var Be,Ve=this.mrca1;null==Ci.zpp_pool?Be=new Ci:(Be=Ci.zpp_pool,Ci.zpp_pool=Be.next,Be.next=null),Be.elt=je;var Ge=Be;Ge.next=Ve.head,Ve.head=Ge,Ve.modified=!0,Ve.length++}je=je.compound}}for(var Ue=this.mrca1.head;null!=Ue;){for(var Ye=Ue.elt,Ke=this.mrca2.head;null!=Ke;){for(var We=Ke.elt,qe=Ye.cbSet,Xe=We.cbSet,He=(qe.manager,null),Ze=qe.cbpairs.length<Xe.cbpairs.length?qe.cbpairs:Xe.cbpairs,Je=Ze.head;null!=Je;){var Qe=Je.elt;if(Qe.a==qe&&Qe.b==Xe||Qe.a==Xe&&Qe.b==qe){He=Qe;break}Je=Je.next}if(null==He){var tn;null==en.zpp_pool?tn=new en:(tn=en.zpp_pool,en.zpp_pool=tn.next,tn.next=null),tn.zip_listeners=!0,$e.setlt(qe,Xe)?(tn.a=qe,tn.b=Xe):(tn.a=Xe,tn.b=qe),He=tn,qe.cbpairs.add(He),Xe!=qe&&Xe.cbpairs.add(He)}if(He.zip_listeners&&(He.zip_listeners=!1,He.__validate()),null!=He.listeners.head){for(var ln=null,an=null,rn=this.prelisteners;null!=rn.head;){var pn=rn.head;rn.head=pn.next;var sn=pn;sn.elt=null,sn.next=gi.zpp_pool,gi.zpp_pool=sn,null==rn.head&&(rn.pushmod=!0),rn.modified=!0,rn.length--}rn.pushmod=!0;for(var on=null,_n=(qe.manager,null),vn=qe.cbpairs.length<Xe.cbpairs.length?qe.cbpairs:Xe.cbpairs,cn=vn.head;null!=cn;){var yn=cn.elt;if(yn.a==qe&&yn.b==Xe||yn.a==Xe&&yn.b==qe){_n=yn;break}cn=cn.next}if(null==_n){var mn;null==en.zpp_pool?mn=new en:(mn=en.zpp_pool,en.zpp_pool=mn.next,mn.next=null),mn.zip_listeners=!0,$e.setlt(qe,Xe)?(mn.a=qe,mn.b=Xe):(mn.a=Xe,mn.b=qe),_n=mn,qe.cbpairs.add(_n),Xe!=qe&&Xe.cbpairs.add(_n)}_n.zip_listeners&&(_n.zip_listeners=!1,_n.__validate());for(var zn=_n.listeners.head;null!=zn;){var bn=zn.elt;if(5==bn.event&&0!=(4&bn.itype)){var gn,wn=r.prelisteners;null==gi.zpp_pool?gn=new gi:(gn=gi.zpp_pool,gi.zpp_pool=gn.next,gn.next=null),gn.elt=bn;var Cn=gn;null==on?(Cn.next=wn.head,wn.head=Cn):(Cn.next=on.next,on.next=Cn),wn.pushmod=wn.modified=!0,wn.length++,on=Cn,_e=!!_e||!bn.pure}zn=zn.next}if(null!=this.prelisteners.head){if(ln=Tn.get(Ye,We),null==ln&&(an=Wn.get(Ye,We),this.add_callbackset(an)),null==ln||(ln.FLUIDstamp!=this.stamp||l)&&0==(4&ln.FLUIDstate)){if(null!=an&&(ln=an),null!=ln)for(var Mn=this.prelisteners.head;null!=Mn;){var On=Mn.elt;7==On.itype?(ln.COLLISIONstamp=this.stamp,ln.SENSORstamp=this.stamp,ln.FLUIDstamp=this.stamp):ln.FLUIDstamp=this.stamp,Mn=Mn.next}var kn=P.active;P.active=!0;this.precb.zpp_inner.pre_arbiter=P,this.precb.zpp_inner.set=ln;for(var Sn=this.prelisteners.head;null!=Sn;){var An=Sn.elt;this.precb.zpp_inner.listener=An;var En,In=this.precb.zpp_inner,jn=ln.int1,Nn=ln.int2,Dn=An.options1,Ln=jn.cbTypes;if(Dn.nonemptyintersection(Ln,Dn.includes)&&!Dn.nonemptyintersection(Ln,Dn.excludes)){var Fn=An.options2,Pn=Nn.cbTypes;En=!!Fn.nonemptyintersection(Pn,Fn.includes)&&!Fn.nonemptyintersection(Pn,Fn.excludes)}else En=!1;En?(In.int1=jn,In.int2=Nn):(In.int1=Nn,In.int2=jn),this.precb.zpp_inner.pre_swapped=Ye!=this.precb.zpp_inner.int1;var Rn=An.handlerp(this.precb);if(null!=Rn){var Bn;null==nn.PreFlag_ACCEPT&&(nn.internal=!0,nn.PreFlag_ACCEPT=new Y,nn.internal=!1),Rn==nn.PreFlag_ACCEPT?Bn=5:(null==nn.PreFlag_ACCEPT_ONCE&&(nn.internal=!0,nn.PreFlag_ACCEPT_ONCE=new Y,nn.internal=!1),Rn==nn.PreFlag_ACCEPT_ONCE?Bn=1:(null==nn.PreFlag_IGNORE&&(nn.internal=!0,nn.PreFlag_IGNORE=new Y,nn.internal=!1),Bn=Rn==nn.PreFlag_IGNORE?6:2)),P.immState=Bn}Sn=Sn.next}if(P.active=kn,null!=ln)for(var Vn=this.prelisteners.head;null!=Vn;){var Gn=Vn.elt;7==Gn.itype?(ln.COLLISIONstate=P.immState,ln.SENSORstate=P.immState,ln.FLUIDstate=P.immState):ln.FLUIDstate=P.immState,Vn=Vn.next}}else null==ln?0==(4&P.immState)&&(P.immState=1):P.immState=ln.FLUIDstate;Ke=Ke.next}else Ke=Ke.next}else Ke=Ke.next}Ue=Ue.next}if(_e&&0==(4&P.immState)){if(2==P.b1.type){var Un=P.b1;Un.world||(Un.component.waket=this.stamp+(this.midstep?0:1),3==Un.type&&(Un.kinematicDelaySleep=!0),Un.component.sleeping&&this.really_wake(Un,!1))}if(2==P.b1.type){var Yn=P.b2;Yn.world||(Yn.component.waket=this.stamp+(this.midstep?0:1),3==Yn.type&&(Yn.kinematicDelaySleep=!0),Yn.component.sleeping&&this.really_wake(Yn,!1))}}}if(0!=(1&P.immState)){if(2==P.b1.type&&P.b1.component.sleeping){var Kn=P.b1;Kn.world||(Kn.component.waket=this.stamp+(this.midstep?0:1),3==Kn.type&&(Kn.kinematicDelaySleep=!0),Kn.component.sleeping&&this.really_wake(Kn,!1))}if(2==P.b2.type&&P.b2.component.sleeping){var qn=P.b2;qn.world||(qn.component.waket=this.stamp+(this.midstep?0:1),3==qn.type&&(qn.kinematicDelaySleep=!0),qn.component.sleeping&&this.really_wake(qn,!1))}}if(P.sleeping){P.sleeping=!1;var Xn,Hn=this.f_arbiters;null==Ii.zpp_pool?Xn=new Ii:(Xn=Ii.zpp_pool,Ii.zpp_pool=Xn.next,Xn.next=null),Xn.elt=P;var Zn=Xn;Zn.next=Hn.head,Hn.head=Zn,Hn.modified=!0,Hn.length++}p=P}else if(R){var Jn=P;Jn.next=xn.zpp_pool,xn.zpp_pool=Jn,p=null}else p=P;else p=P}else if(1==x){var Qn,$n=i?this.c_arbiters_true:this.c_arbiters_false;if(null==t){for(var ei=null,ni=s.arbiters.length<o.arbiters.length?s:o,ii=ni.arbiters.head;null!=ii;){var ti=ii.elt;if(ti.id==T.id&&ti.di==E.id){ei=ti;break}ii=ii.next}Qn=ei}else Qn=t;var li,ai=null==Qn,ri=!1;if(ai)null==un.zpp_pool?li=new un:(li=un.zpp_pool,un.zpp_pool=li.next,li.next=null),li.stat=i;else if(null==Qn.colarb){Qn.cleared=!0;for(var pi=Qn.b1.arbiters,si=null,oi=pi.head;null!=oi;){if(oi.elt==Qn){var _i,hi;null==si?(_i=pi.head,hi=_i.next,pi.head=hi,null==pi.head&&(pi.pushmod=!0)):(_i=si.next,hi=_i.next,si.next=hi,null==hi&&(pi.pushmod=!0));var xi=_i;xi.elt=null,xi.next=bi.zpp_pool,bi.zpp_pool=xi,pi.modified=!0,pi.length--,pi.pushmod=!0,!0;break}si=oi,oi=oi.next}for(var ui=Qn.b2.arbiters,di=null,vi=ui.head;null!=vi;){if(vi.elt==Qn){var ci,yi;null==di?(ci=ui.head,yi=ci.next,ui.head=yi,null==ui.head&&(ui.pushmod=!0)):(ci=di.next,yi=ci.next,di.next=yi,null==yi&&(ui.pushmod=!0));var mi=ci;mi.elt=null,mi.next=bi.zpp_pool,bi.zpp_pool=mi,ui.modified=!0,ui.length--,ui.pushmod=!0,!0;break}di=vi,vi=vi.next}null!=Qn.pair&&(Qn.pair.arb=null,Qn.pair=null),Qn.active=!1,this.f_arbiters.modified=!0,null==un.zpp_pool?li=new un:(li=un.zpp_pool,un.zpp_pool=li.next,li.next=null),li.intchange=!0,li.stat=i,ai=!0,ri=!0}else li=Qn.colarb,I=T!=li.s1,li.stat!=i&&(li.stat=i,li.sleeping||((i?this.c_arbiters_false:this.c_arbiters_true).remove(li),$n.add(li)));if(ai||li.stamp!=this.stamp||l)if(li.stamp=this.stamp,fn.contactCollide(T,E,li,I)){if(ai){var zi=E.id;li.b1=e.body,li.ws1=e,li.b2=n.body,li.ws2=n,li.id=T.id,li.di=zi;var fi,wi=li.b1.arbiters;null==bi.zpp_pool?fi=new bi:(fi=bi.zpp_pool,bi.zpp_pool=fi.next,fi.next=null),fi.elt=li;var Mi=fi;Mi.next=wi.head,wi.head=Mi,wi.modified=!0,wi.length++;var Oi,ki=li.b2.arbiters;null==bi.zpp_pool?Oi=new bi:(Oi=bi.zpp_pool,bi.zpp_pool=Oi.next,Oi.next=null),Oi.elt=li;var Si=Oi;Si.next=ki.head,ki.head=Si,ki.modified=!0,ki.length++,li.active=!0,li.present=0,li.cleared=!1,li.sleeping=!1,li.fresh=!1,li.presentable=!1,li.s1=e,li.s2=n,li.userdef_restitution||(li.s1.material.elasticity<=-1/0||li.s2.material.elasticity<=-1/0?li.restitution=0:li.s1.material.elasticity>=1/0||li.s2.material.elasticity>=1/0?li.restitution=1:li.restitution=(li.s1.material.elasticity+li.s2.material.elasticity)/2,li.restitution<0&&(li.restitution=0),li.restitution>1&&(li.restitution=1)),li.userdef_dyn_fric||(li.dyn_fric=Math.sqrt(li.s1.material.dynamicFriction*li.s2.material.dynamicFriction)),li.userdef_stat_fric||(li.stat_fric=Math.sqrt(li.s1.material.staticFriction*li.s2.material.staticFriction)),li.userdef_rfric||(li.rfric=Math.sqrt(li.s1.material.rollingFriction*li.s2.material.rollingFriction));var Ai;null==Di.zpp_pool?Ai=new Di:(Ai=Di.zpp_pool,Di.zpp_pool=Ai.next,Ai.next=null),Ai.elt=li;var Ti=Ai;Ti.next=$n.head,$n.head=Ti,$n.modified=!0,$n.length++,li.fresh=!ri}else li.fresh=li.up_stamp<this.stamp-1||li.endGenerated==this.stamp&&l;if(li.up_stamp=li.stamp,li.fresh||0==(4&li.immState)){li.immState=1;for(var Ei=!1,Ni=li.ws1.id>li.ws2.id?li.ws2:li.ws1,Li=li.ws1.id>li.ws2.id?li.ws1:li.ws2,Fi=this.mrca1;null!=Fi.head;){var Pi=Fi.head;Fi.head=Pi.next;var Ri=Pi;Ri.elt=null,Ri.next=Ci.zpp_pool,Ci.zpp_pool=Ri,null==Fi.head&&(Fi.pushmod=!0),Fi.modified=!0,Fi.length--}Fi.pushmod=!0;for(var Bi=this.mrca2;null!=Bi.head;){var Vi=Bi.head;Bi.head=Vi.next;var Gi=Vi;Gi.elt=null,Gi.next=Ci.zpp_pool,Ci.zpp_pool=Gi,null==Bi.head&&(Bi.pushmod=!0),Bi.modified=!0,Bi.length--}if(Bi.pushmod=!0,null!=Ni.cbSet){var Ui,Yi=this.mrca1;null==Ci.zpp_pool?Ui=new Ci:(Ui=Ci.zpp_pool,Ci.zpp_pool=Ui.next,Ui.next=null),Ui.elt=Ni;var Ki=Ui;Ki.next=Yi.head,Yi.head=Ki,Yi.modified=!0,Yi.length++}if(null!=Ni.body.cbSet){var Wi,qi=this.mrca1,Xi=Ni.body;null==Ci.zpp_pool?Wi=new Ci:(Wi=Ci.zpp_pool,Ci.zpp_pool=Wi.next,Wi.next=null),Wi.elt=Xi;var Hi=Wi;Hi.next=qi.head,qi.head=Hi,qi.modified=!0,qi.length++}if(null!=Li.cbSet){var Zi,Ji=this.mrca2;null==Ci.zpp_pool?Zi=new Ci:(Zi=Ci.zpp_pool,Ci.zpp_pool=Zi.next,Zi.next=null),Zi.elt=Li;var Qi=Zi;Qi.next=Ji.head,Ji.head=Qi,Ji.modified=!0,Ji.length++}if(null!=Li.body.cbSet){var $i,et=this.mrca2,nt=Li.body;null==Ci.zpp_pool?$i=new Ci:($i=Ci.zpp_pool,Ci.zpp_pool=$i.next,$i.next=null),$i.elt=nt;var it=$i;it.next=et.head,et.head=it,et.modified=!0,et.length++}for(var tt=Ni.body.compound,lt=Li.body.compound;tt!=lt;){var at=null==tt?0:tt.depth,rt=null==lt?0:lt.depth;if(at<rt){if(null!=lt.cbSet){var pt,st=this.mrca2;null==Ci.zpp_pool?pt=new Ci:(pt=Ci.zpp_pool,Ci.zpp_pool=pt.next,pt.next=null),pt.elt=lt;var ot=pt;ot.next=st.head,st.head=ot,st.modified=!0,st.length++}lt=lt.compound}else{if(null!=tt.cbSet){var _t,ht=this.mrca1;null==Ci.zpp_pool?_t=new Ci:(_t=Ci.zpp_pool,Ci.zpp_pool=_t.next,_t.next=null),_t.elt=tt;var xt=_t;xt.next=ht.head,ht.head=xt,ht.modified=!0,ht.length++}tt=tt.compound}}for(var ut=this.mrca1.head;null!=ut;){for(var dt=ut.elt,vt=this.mrca2.head;null!=vt;){for(var ct=vt.elt,yt=dt.cbSet,mt=ct.cbSet,zt=(yt.manager,null),ft=yt.cbpairs.length<mt.cbpairs.length?yt.cbpairs:mt.cbpairs,bt=ft.head;null!=bt;){var gt=bt.elt;if(gt.a==yt&&gt.b==mt||gt.a==mt&&gt.b==yt){zt=gt;break}bt=bt.next}if(null==zt){var wt;null==en.zpp_pool?wt=new en:(wt=en.zpp_pool,en.zpp_pool=wt.next,wt.next=null),wt.zip_listeners=!0,$e.setlt(yt,mt)?(wt.a=yt,wt.b=mt):(wt.a=mt,wt.b=yt),zt=wt,yt.cbpairs.add(zt),mt!=yt&&mt.cbpairs.add(zt)}if(zt.zip_listeners&&(zt.zip_listeners=!1,zt.__validate()),null!=zt.listeners.head){for(var Ct=null,Mt=null,Ot=this.prelisteners;null!=Ot.head;){var kt=Ot.head;Ot.head=kt.next;var St=kt;St.elt=null,St.next=gi.zpp_pool,gi.zpp_pool=St,null==Ot.head&&(Ot.pushmod=!0),Ot.modified=!0,Ot.length--}Ot.pushmod=!0;for(var At=null,Tt=(yt.manager,null),Et=yt.cbpairs.length<mt.cbpairs.length?yt.cbpairs:mt.cbpairs,It=Et.head;null!=It;){var jt=It.elt;if(jt.a==yt&&jt.b==mt||jt.a==mt&&jt.b==yt){Tt=jt;break}It=It.next}if(null==Tt){var Nt;null==en.zpp_pool?Nt=new en:(Nt=en.zpp_pool,en.zpp_pool=Nt.next,Nt.next=null),Nt.zip_listeners=!0,$e.setlt(yt,mt)?(Nt.a=yt,Nt.b=mt):(Nt.a=mt,Nt.b=yt),Tt=Nt,yt.cbpairs.add(Tt),mt!=yt&&mt.cbpairs.add(Tt)}Tt.zip_listeners&&(Tt.zip_listeners=!1,Tt.__validate());for(var Dt=Tt.listeners.head;null!=Dt;){var Lt=Dt.elt;if(5==Lt.event&&0!=(1&Lt.itype)){var Ft,Pt=r.prelisteners;null==gi.zpp_pool?Ft=new gi:(Ft=gi.zpp_pool,gi.zpp_pool=Ft.next,Ft.next=null),Ft.elt=Lt;var Rt=Ft;null==At?(Rt.next=Pt.head,Pt.head=Rt):(Rt.next=At.next,At.next=Rt),Pt.pushmod=Pt.modified=!0,Pt.length++,At=Rt,Ei=!!Ei||!Lt.pure}Dt=Dt.next}if(null!=this.prelisteners.head){if(Ct=Tn.get(dt,ct),null==Ct&&(Mt=Wn.get(dt,ct),this.add_callbackset(Mt)),null==Ct||(Ct.COLLISIONstamp!=this.stamp||l)&&0==(4&Ct.COLLISIONstate)){if(null!=Mt&&(Ct=Mt),null!=Ct)for(var Bt=this.prelisteners.head;null!=Bt;){var Vt=Bt.elt;7==Vt.itype?(Ct.COLLISIONstamp=this.stamp,Ct.SENSORstamp=this.stamp,Ct.FLUIDstamp=this.stamp):Ct.COLLISIONstamp=this.stamp,Bt=Bt.next}var Gt=li.active;li.active=!0;var Ut=!0,Yt=null,Kt=null,Wt=li.innards.next;li.hc2=!1;for(var qt=li.contacts.next;null!=qt;){var Xt=qt;if(Xt.stamp+O.arbiterExpirationDelay<li.stamp){var Ht,Zt,Jt=li.contacts;null==Yt?(Ht=Jt.next,Zt=Ht.next,Jt.next=Zt,null==Jt.next&&(Jt.pushmod=!0)):(Ht=Yt.next,Zt=Ht.next,Yt.next=Zt,null==Zt&&(Jt.pushmod=!0)),Ht._inuse=!1,Jt.modified=!0,Jt.length--,Jt.pushmod=!0,qt=Zt;var Qt,$t,el=li.innards;null==Kt?(Qt=el.next,$t=Qt.next,el.next=$t,null==el.next&&(el.pushmod=!0)):(Qt=Kt.next,$t=Qt.next,Kt.next=$t,null==$t&&(el.pushmod=!0)),Qt._inuse=!1,el.modified=!0,el.length--,el.pushmod=!0,Wt=$t;var nl=Xt;nl.arbiter=null,nl.next=dn.zpp_pool,dn.zpp_pool=nl}else{var il=Xt.inner,tl=Xt.active;Xt.active=Xt.stamp==li.stamp,Xt.active&&(Ut?(Ut=!1,li.c1=il,li.oc1=Xt):(li.hc2=!0,li.c2=il,li.oc2=Xt)),tl!=Xt.active&&(li.contacts.modified=!0),Yt=qt,Kt=Wt,Wt=Wt.next,qt=qt.next}}if(li.hc2){if(li.hpc2=!0,li.oc1.posOnly){var ll=li.c1;li.c1=li.c2,li.c2=ll;var al=li.oc1;li.oc1=li.oc2,li.oc2=al,li.hc2=!1}else li.oc2.posOnly&&(li.hc2=!1);li.oc1.posOnly&&(Ut=!0)}else li.hpc2=!1;this.precb.zpp_inner.pre_arbiter=li,this.precb.zpp_inner.set=Ct;for(var rl=this.prelisteners.head;null!=rl;){var pl=rl.elt;this.precb.zpp_inner.listener=pl;var sl,ol=this.precb.zpp_inner,_l=Ct.int1,hl=Ct.int2,xl=pl.options1,ul=_l.cbTypes;if(xl.nonemptyintersection(ul,xl.includes)&&!xl.nonemptyintersection(ul,xl.excludes)){var dl=pl.options2,vl=hl.cbTypes;sl=!!dl.nonemptyintersection(vl,dl.includes)&&!dl.nonemptyintersection(vl,dl.excludes)}else sl=!1;sl?(ol.int1=_l,ol.int2=hl):(ol.int1=hl,ol.int2=_l),this.precb.zpp_inner.pre_swapped=dt!=this.precb.zpp_inner.int1;var cl=pl.handlerp(this.precb);if(null!=cl){var yl;null==nn.PreFlag_ACCEPT&&(nn.internal=!0,nn.PreFlag_ACCEPT=new Y,nn.internal=!1),cl==nn.PreFlag_ACCEPT?yl=5:(null==nn.PreFlag_ACCEPT_ONCE&&(nn.internal=!0,nn.PreFlag_ACCEPT_ONCE=new Y,nn.internal=!1),cl==nn.PreFlag_ACCEPT_ONCE?yl=1:(null==nn.PreFlag_IGNORE&&(nn.internal=!0,nn.PreFlag_IGNORE=new Y,nn.internal=!1),yl=cl==nn.PreFlag_IGNORE?6:2)),li.immState=yl}rl=rl.next}if(li.active=Gt,null!=Ct)for(var ml=this.prelisteners.head;null!=ml;){var zl=ml.elt;7==zl.itype?(Ct.COLLISIONstate=li.immState,Ct.SENSORstate=li.immState,Ct.FLUIDstate=li.immState):Ct.COLLISIONstate=li.immState,ml=ml.next}}else null==Ct?0==(4&li.immState)&&(li.immState=1):li.immState=Ct.COLLISIONstate;vt=vt.next}else vt=vt.next}else vt=vt.next}ut=ut.next}if(Ei&&0==(4&li.immState)){if(2==li.b1.type){var fl=li.b1;fl.world||(fl.component.waket=this.stamp+(this.midstep?0:1),3==fl.type&&(fl.kinematicDelaySleep=!0),fl.component.sleeping&&this.really_wake(fl,!1))}if(2==li.b1.type){var bl=li.b2;bl.world||(bl.component.waket=this.stamp+(this.midstep?0:1),3==bl.type&&(bl.kinematicDelaySleep=!0),bl.component.sleeping&&this.really_wake(bl,!1))}}}if(0!=(1&li.immState)){if(2==li.b1.type&&li.b1.component.sleeping){var gl=li.b1;gl.world||(gl.component.waket=this.stamp+(this.midstep?0:1),3==gl.type&&(gl.kinematicDelaySleep=!0),gl.component.sleeping&&this.really_wake(gl,!1))}if(2==li.b2.type&&li.b2.component.sleeping){var wl=li.b2;wl.world||(wl.component.waket=this.stamp+(this.midstep?0:1),3==wl.type&&(wl.kinematicDelaySleep=!0),wl.component.sleeping&&this.really_wake(wl,!1))}}if(li.sleeping){li.sleeping=!1;var Cl;null==Di.zpp_pool?Cl=new Di:(Cl=Di.zpp_pool,Di.zpp_pool=Cl.next,Cl.next=null),Cl.elt=li;var Ml=Cl;Ml.next=$n.head,$n.head=Ml,$n.modified=!0,$n.length++}p=li}else if(ai){var Ol=li;Ol.userdef_dyn_fric=!1,Ol.userdef_stat_fric=!1,Ol.userdef_restitution=!1,Ol.userdef_rfric=!1,Ol.__ref_edge1=Ol.__ref_edge2=null,Ol.next=un.zpp_pool,un.zpp_pool=Ol,p=null}else p=li;else p=li}else{var kl;if(null==t){for(var Sl=null,Al=s.arbiters.length<o.arbiters.length?s:o,Tl=Al.arbiters.head;null!=Tl;){var El=Tl.elt;if(El.id==T.id&&El.di==E.id){Sl=El;break}Tl=Tl.next}kl=Sl}else kl=t;var Il,jl=null==kl,Nl=!1;if(jl)null==hn.zpp_pool?Il=new hn:(Il=hn.zpp_pool,hn.zpp_pool=Il.next,Il.next=null);else if(null==kl.sensorarb){kl.cleared=!0;for(var Dl=kl.b1.arbiters,Ll=null,Fl=Dl.head;null!=Fl;){if(Fl.elt==kl){var Pl,Rl;null==Ll?(Pl=Dl.head,Rl=Pl.next,Dl.head=Rl,null==Dl.head&&(Dl.pushmod=!0)):(Pl=Ll.next,Rl=Pl.next,Ll.next=Rl,null==Rl&&(Dl.pushmod=!0));var Bl=Pl;Bl.elt=null,Bl.next=bi.zpp_pool,bi.zpp_pool=Bl,Dl.modified=!0,Dl.length--,Dl.pushmod=!0,!0;break}Ll=Fl,Fl=Fl.next}for(var Vl=kl.b2.arbiters,Gl=null,Ul=Vl.head;null!=Ul;){if(Ul.elt==kl){var Yl,Kl;null==Gl?(Yl=Vl.head,Kl=Yl.next,Vl.head=Kl,null==Vl.head&&(Vl.pushmod=!0)):(Yl=Gl.next,Kl=Yl.next,Gl.next=Kl,null==Kl&&(Vl.pushmod=!0));var Wl=Yl;Wl.elt=null,Wl.next=bi.zpp_pool,bi.zpp_pool=Wl,Vl.modified=!0,Vl.length--,Vl.pushmod=!0,!0;break}Gl=Ul,Ul=Ul.next}null!=kl.pair&&(kl.pair.arb=null,kl.pair=null),kl.active=!1,this.f_arbiters.modified=!0,null==hn.zpp_pool?Il=new hn:(Il=hn.zpp_pool,hn.zpp_pool=Il.next,Il.next=null),Il.intchange=!0,jl=!0,Nl=!0}else Il=kl.sensorarb;if(jl||Il.stamp!=this.stamp||l)if(Il.stamp=this.stamp,fn.testCollide(T,E)){if(jl){var ql=E.id;Il.b1=e.body,Il.ws1=e,Il.b2=n.body,Il.ws2=n,Il.id=T.id,Il.di=ql;var Xl,Hl=Il.b1.arbiters;null==bi.zpp_pool?Xl=new bi:(Xl=bi.zpp_pool,bi.zpp_pool=Xl.next,Xl.next=null),Xl.elt=Il;var Zl=Xl;Zl.next=Hl.head,Hl.head=Zl,Hl.modified=!0,Hl.length++;var Jl,Ql=Il.b2.arbiters;null==bi.zpp_pool?Jl=new bi:(Jl=bi.zpp_pool,bi.zpp_pool=Jl.next,Jl.next=null),Jl.elt=Il;var $l=Jl;$l.next=Ql.head,Ql.head=$l,Ql.modified=!0,Ql.length++,Il.active=!0,Il.present=0,Il.cleared=!1,Il.sleeping=!1,Il.fresh=!1,Il.presentable=!1;var ea,na=this.s_arbiters;null==ji.zpp_pool?ea=new ji:(ea=ji.zpp_pool,ji.zpp_pool=ea.next,ea.next=null),ea.elt=Il;var ia=ea;ia.next=na.head,na.head=ia,na.modified=!0,na.length++,Il.fresh=!Nl}else Il.fresh=Il.up_stamp<this.stamp-1||Il.endGenerated==this.stamp&&l;if(Il.up_stamp=Il.stamp,Il.fresh||0==(4&Il.immState)){Il.immState=1;for(var ta=!1,la=Il.ws1.id>Il.ws2.id?Il.ws2:Il.ws1,aa=Il.ws1.id>Il.ws2.id?Il.ws1:Il.ws2,ra=this.mrca1;null!=ra.head;){var pa=ra.head;ra.head=pa.next;var sa=pa;sa.elt=null,sa.next=Ci.zpp_pool,Ci.zpp_pool=sa,null==ra.head&&(ra.pushmod=!0),ra.modified=!0,ra.length--}ra.pushmod=!0;for(var oa=this.mrca2;null!=oa.head;){var _a=oa.head;oa.head=_a.next;var ha=_a;ha.elt=null,ha.next=Ci.zpp_pool,Ci.zpp_pool=ha,null==oa.head&&(oa.pushmod=!0),oa.modified=!0,oa.length--}if(oa.pushmod=!0,null!=la.cbSet){var xa,ua=this.mrca1;null==Ci.zpp_pool?xa=new Ci:(xa=Ci.zpp_pool,Ci.zpp_pool=xa.next,xa.next=null),xa.elt=la;var da=xa;da.next=ua.head,ua.head=da,ua.modified=!0,ua.length++}if(null!=la.body.cbSet){var va,ca=this.mrca1,ya=la.body;null==Ci.zpp_pool?va=new Ci:(va=Ci.zpp_pool,Ci.zpp_pool=va.next,va.next=null),va.elt=ya;var ma=va;ma.next=ca.head,ca.head=ma,ca.modified=!0,ca.length++}if(null!=aa.cbSet){var za,fa=this.mrca2;null==Ci.zpp_pool?za=new Ci:(za=Ci.zpp_pool,Ci.zpp_pool=za.next,za.next=null),za.elt=aa;var ba=za;ba.next=fa.head,fa.head=ba,fa.modified=!0,fa.length++}if(null!=aa.body.cbSet){var ga,wa=this.mrca2,Ca=aa.body;null==Ci.zpp_pool?ga=new Ci:(ga=Ci.zpp_pool,Ci.zpp_pool=ga.next,ga.next=null),ga.elt=Ca;var Ma=ga;Ma.next=wa.head,wa.head=Ma,wa.modified=!0,wa.length++}for(var Oa=la.body.compound,ka=aa.body.compound;Oa!=ka;){var Sa=null==Oa?0:Oa.depth,Aa=null==ka?0:ka.depth;if(Sa<Aa){if(null!=ka.cbSet){var Ta,Ea=this.mrca2;null==Ci.zpp_pool?Ta=new Ci:(Ta=Ci.zpp_pool,Ci.zpp_pool=Ta.next,Ta.next=null),Ta.elt=ka;var Ia=Ta;Ia.next=Ea.head,Ea.head=Ia,Ea.modified=!0,Ea.length++}ka=ka.compound}else{if(null!=Oa.cbSet){var ja,Na=this.mrca1;null==Ci.zpp_pool?ja=new Ci:(ja=Ci.zpp_pool,Ci.zpp_pool=ja.next,ja.next=null),ja.elt=Oa;var Da=ja;Da.next=Na.head,Na.head=Da,Na.modified=!0,Na.length++}Oa=Oa.compound}}for(var La=this.mrca1.head;null!=La;){for(var Fa=La.elt,Pa=this.mrca2.head;null!=Pa;){for(var Ra=Pa.elt,Ba=Fa.cbSet,Va=Ra.cbSet,Ga=(Ba.manager,null),Ua=Ba.cbpairs.length<Va.cbpairs.length?Ba.cbpairs:Va.cbpairs,Ya=Ua.head;null!=Ya;){var Ka=Ya.elt;if(Ka.a==Ba&&Ka.b==Va||Ka.a==Va&&Ka.b==Ba){Ga=Ka;break}Ya=Ya.next}if(null==Ga){var Wa;null==en.zpp_pool?Wa=new en:(Wa=en.zpp_pool,en.zpp_pool=Wa.next,Wa.next=null),Wa.zip_listeners=!0,$e.setlt(Ba,Va)?(Wa.a=Ba,Wa.b=Va):(Wa.a=Va,Wa.b=Ba),Ga=Wa,Ba.cbpairs.add(Ga),Va!=Ba&&Va.cbpairs.add(Ga)}if(Ga.zip_listeners&&(Ga.zip_listeners=!1,Ga.__validate()),null!=Ga.listeners.head){for(var qa=null,Xa=null,Ha=this.prelisteners;null!=Ha.head;){var Za=Ha.head;Ha.head=Za.next;var Ja=Za;Ja.elt=null,Ja.next=gi.zpp_pool,gi.zpp_pool=Ja,null==Ha.head&&(Ha.pushmod=!0),Ha.modified=!0,Ha.length--}Ha.pushmod=!0;for(var Qa=null,$a=(Ba.manager,null),er=Ba.cbpairs.length<Va.cbpairs.length?Ba.cbpairs:Va.cbpairs,nr=er.head;null!=nr;){var ir=nr.elt;if(ir.a==Ba&&ir.b==Va||ir.a==Va&&ir.b==Ba){$a=ir;break}nr=nr.next}if(null==$a){var tr;null==en.zpp_pool?tr=new en:(tr=en.zpp_pool,en.zpp_pool=tr.next,tr.next=null),tr.zip_listeners=!0,$e.setlt(Ba,Va)?(tr.a=Ba,tr.b=Va):(tr.a=Va,tr.b=Ba),$a=tr,Ba.cbpairs.add($a),Va!=Ba&&Va.cbpairs.add($a)}$a.zip_listeners&&($a.zip_listeners=!1,$a.__validate());for(var lr=$a.listeners.head;null!=lr;){var ar=lr.elt;if(5==ar.event&&0!=(2&ar.itype)){var rr,pr=r.prelisteners;null==gi.zpp_pool?rr=new gi:(rr=gi.zpp_pool,gi.zpp_pool=rr.next,rr.next=null),rr.elt=ar;var sr=rr;null==Qa?(sr.next=pr.head,pr.head=sr):(sr.next=Qa.next,Qa.next=sr),pr.pushmod=pr.modified=!0,pr.length++,Qa=sr,ta=!!ta||!ar.pure}lr=lr.next}if(null!=this.prelisteners.head){if(qa=Tn.get(Fa,Ra),null==qa&&(Xa=Wn.get(Fa,Ra),this.add_callbackset(Xa)),null==qa||(qa.SENSORstamp!=this.stamp||l)&&0==(4&qa.SENSORstate)){if(null!=Xa&&(qa=Xa),null!=qa)for(var or=this.prelisteners.head;null!=or;){var _r=or.elt;7==_r.itype?(qa.COLLISIONstamp=this.stamp,qa.SENSORstamp=this.stamp,qa.FLUIDstamp=this.stamp):qa.SENSORstamp=this.stamp,or=or.next}var hr=Il.active;Il.active=!0;this.precb.zpp_inner.pre_arbiter=Il,this.precb.zpp_inner.set=qa;for(var xr=this.prelisteners.head;null!=xr;){var ur=xr.elt;this.precb.zpp_inner.listener=ur;var dr,vr=this.precb.zpp_inner,cr=qa.int1,yr=qa.int2,mr=ur.options1,zr=cr.cbTypes;if(mr.nonemptyintersection(zr,mr.includes)&&!mr.nonemptyintersection(zr,mr.excludes)){var fr=ur.options2,br=yr.cbTypes;dr=!!fr.nonemptyintersection(br,fr.includes)&&!fr.nonemptyintersection(br,fr.excludes)}else dr=!1;dr?(vr.int1=cr,vr.int2=yr):(vr.int1=yr,vr.int2=cr),this.precb.zpp_inner.pre_swapped=Fa!=this.precb.zpp_inner.int1;var gr=ur.handlerp(this.precb);if(null!=gr){var wr;null==nn.PreFlag_ACCEPT&&(nn.internal=!0,nn.PreFlag_ACCEPT=new Y,nn.internal=!1),gr==nn.PreFlag_ACCEPT?wr=5:(null==nn.PreFlag_ACCEPT_ONCE&&(nn.internal=!0,nn.PreFlag_ACCEPT_ONCE=new Y,nn.internal=!1),gr==nn.PreFlag_ACCEPT_ONCE?wr=1:(null==nn.PreFlag_IGNORE&&(nn.internal=!0,nn.PreFlag_IGNORE=new Y,nn.internal=!1),wr=gr==nn.PreFlag_IGNORE?6:2)),Il.immState=wr}xr=xr.next}if(Il.active=hr,null!=qa)for(var Cr=this.prelisteners.head;null!=Cr;){var Mr=Cr.elt;7==Mr.itype?(qa.COLLISIONstate=Il.immState,qa.SENSORstate=Il.immState,qa.FLUIDstate=Il.immState):qa.SENSORstate=Il.immState,Cr=Cr.next}}else null==qa?0==(4&Il.immState)&&(Il.immState=1):Il.immState=qa.SENSORstate;Pa=Pa.next}else Pa=Pa.next}else Pa=Pa.next}La=La.next}if(ta&&0==(4&Il.immState)){if(1!=Il.b1.type){var Or=Il.b1;Or.world||(Or.component.waket=this.stamp+(this.midstep?0:1),3==Or.type&&(Or.kinematicDelaySleep=!0),Or.component.sleeping&&this.really_wake(Or,!1))}if(1!=Il.b2.type){var kr=Il.b2;kr.world||(kr.component.waket=this.stamp+(this.midstep?0:1),3==kr.type&&(kr.kinematicDelaySleep=!0),kr.component.sleeping&&this.really_wake(kr,!1))}}}if(Il.sleeping){Il.sleeping=!1;var Sr,Ar=this.s_arbiters;null==ji.zpp_pool?Sr=new ji:(Sr=ji.zpp_pool,ji.zpp_pool=Sr.next,Sr.next=null),Sr.elt=Il;var Tr=Sr;Tr.next=Ar.head,Ar.head=Tr,Ar.modified=!0,Ar.length++}p=Il}else if(jl){var Er=Il;Er.next=hn.zpp_pool,hn.zpp_pool=Er,p=null}else p=Il;else p=Il}}return p},MRCA_chains:function(e,n){for(var i=this.mrca1;null!=i.head;){var t=i.head;i.head=t.next;var l=t;l.elt=null,l.next=Ci.zpp_pool,Ci.zpp_pool=l,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var a=this.mrca2;null!=a.head;){var r=a.head;a.head=r.next;var p=r;p.elt=null,p.next=Ci.zpp_pool,Ci.zpp_pool=p,null==a.head&&(a.pushmod=!0),a.modified=!0,a.length--}if(a.pushmod=!0,null!=e.cbSet){var s,o=this.mrca1;null==Ci.zpp_pool?s=new Ci:(s=Ci.zpp_pool,Ci.zpp_pool=s.next,s.next=null),s.elt=e;var _=s;_.next=o.head,o.head=_,o.modified=!0,o.length++}if(null!=e.body.cbSet){var h,x=this.mrca1,u=e.body;null==Ci.zpp_pool?h=new Ci:(h=Ci.zpp_pool,Ci.zpp_pool=h.next,h.next=null),h.elt=u;var d=h;d.next=x.head,x.head=d,x.modified=!0,x.length++}if(null!=n.cbSet){var v,c=this.mrca2;null==Ci.zpp_pool?v=new Ci:(v=Ci.zpp_pool,Ci.zpp_pool=v.next,v.next=null),v.elt=n;var y=v;y.next=c.head,c.head=y,c.modified=!0,c.length++}if(null!=n.body.cbSet){var m,z=this.mrca2,f=n.body;null==Ci.zpp_pool?m=new Ci:(m=Ci.zpp_pool,Ci.zpp_pool=m.next,m.next=null),m.elt=f;var b=m;b.next=z.head,z.head=b,z.modified=!0,z.length++}for(var g=e.body.compound,w=n.body.compound;g!=w;){if((null==g?0:g.depth)<(null==w?0:w.depth)){if(null!=w.cbSet){var C,M=this.mrca2;null==Ci.zpp_pool?C=new Ci:(C=Ci.zpp_pool,Ci.zpp_pool=C.next,C.next=null),C.elt=w;var O=C;O.next=M.head,M.head=O,M.modified=!0,M.length++}w=w.compound}else{if(null!=g.cbSet){var k,S=this.mrca1;null==Ci.zpp_pool?k=new Ci:(k=Ci.zpp_pool,Ci.zpp_pool=k.next,k.next=null),k.elt=g;var A=k;A.next=S.head,S.head=A,S.modified=!0,S.length++}g=g.compound}}},__class__:Xn};var Hn=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};Hn.__name__=!0,Hn.prototype={__class__:Hn};var Zn=function(e){this.list=null,Rn.call(this),this.space=e,this.is_sweep=!0,this.sweep=this};Zn.__name__=!0,Zn.__super__=Rn,Zn.prototype=n(Rn.prototype,{__insert:function(e){var n;null==Hn.zpp_pool?n=new Hn:(n=Hn.zpp_pool,Hn.zpp_pool=n.next,n.next=null),e.sweep=n,n.shape=e,n.aabb=e.aabb,n.next=this.list,null!=this.list&&(this.list.prev=n),this.list=n},__remove:function(e){var n=e.sweep;null==n.prev?this.list=n.next:n.prev.next=n.next,null!=n.next&&(n.next.prev=n.prev),e.sweep=null;var i=n;i.prev=null,i.shape=null,i.aabb=null,i.next=Hn.zpp_pool,Hn.zpp_pool=i},broadphase:function(e,n){if(null!=this.list){for(var i=this.list.next;null!=i;){var t=i.next,l=i.prev;if(i.aabb.minx>l.aabb.minx)i=t;else{for(;null!=l.prev&&l.prev.aabb.minx>i.aabb.minx;)l=l.prev;var a=i.prev;a.next=i.next,null!=i.next&&(i.next.prev=a),null==l.prev?(i.prev=null,this.list=i,i.next=l,l.prev=i):(i.prev=l.prev,l.prev=i,i.prev.next=i,i.next=l),i=t}}for(var r=this.list;null!=r;){for(var p=r.next,s=r.shape,o=s.body,_=r.aabb.maxx;null!=p&&!(p.aabb.minx>_);){var h=p.shape,x=h.body;if(x!=o)if(1!=o.type||1!=x.type)if(o.component.sleeping&&x.component.sleeping)p=p.next;else{var u=s.aabb,d=h.aabb;d.miny>u.maxy||u.miny>d.maxy||(n?e.narrowPhase(s,h,2!=o.type||2!=x.type,null,!1):e.continuousEvent(s,h,2!=o.type||2!=x.type,null,!1)),p=p.next}else p=p.next;else p=p.next}r=r.next}}},__class__:Zn});var Jn=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Jn.__name__=!0,
Jn.prototype={__class__:Jn};var Qn=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Qn.__name__=!0,Qn.prototype={add:function(e){var n;null==yi.zpp_pool?n=new yi:(n=yi.zpp_pool,yi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},insert:function(e,n){var i;null==yi.zpp_pool?i=new yi:(i=yi.zpp_pool,yi.zpp_pool=i.next,i.next=null),i.elt=n;var t=i;return null==e?(t.next=this.head,this.head=t):(t.next=e.next,e.next=t),this.pushmod=this.modified=!0,this.length++,t},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=yi.zpp_pool,yi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:Qn};var $n=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};$n.__name__=!0,$n.prototype={add:function(e){var n;null==mi.zpp_pool?n=new mi:(n=mi.zpp_pool,mi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},insert:function(e,n){var i;null==mi.zpp_pool?i=new mi:(i=mi.zpp_pool,mi.zpp_pool=i.next,i.next=null),i.elt=n;var t=i;return null==e?(t.next=this.head,this.head=t):(t.next=e.next,e.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=mi.zpp_pool,mi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:$n};var ei=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ei.__name__=!0,ei.prototype={remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=fi.zpp_pool,fi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:ei};var ni=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ni.__name__=!0,ni.prototype={pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=bi.zpp_pool,bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},erase:function(e){var n,i;null==e?(n=this.head,i=n.next,this.head=i,null==this.head&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0));var t=n;return t.elt=null,t.next=bi.zpp_pool,bi.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},__class__:ni};var ii=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ii.__name__=!0,ii.prototype={add:function(e){var n;null==Oi.zpp_pool?n=new Oi:(n=Oi.zpp_pool,Oi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Oi.zpp_pool,Oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=Oi.zpp_pool,Oi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},__class__:ii};var ti=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ti.__name__=!0,ti.prototype={pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Ai.zpp_pool,Ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=Ai.zpp_pool,Ai.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},__class__:ti};var li=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};li.__name__=!0,li.prototype={add:function(e){var n;null==Ti.zpp_pool?n=new Ti:(n=Ti.zpp_pool,Ti.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},insert:function(e,n){var i;null==Ti.zpp_pool?i=new Ti:(i=Ti.zpp_pool,Ti.zpp_pool=i.next,i.next=null),i.elt=n;var t=i;return null==e?(t.next=this.head,this.head=t):(t.next=e.next,e.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Ti.zpp_pool,Ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},erase:function(e){var n,i;null==e?(n=this.head,i=n.next,this.head=i,null==this.head&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0));var t=n;return t.elt=null,t.next=Ti.zpp_pool,Ti.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},reverse:function(){for(var e=this.head,n=null;null!=e;){var i=e.next;e.next=n,this.head=e,n=e,e=i}this.modified=!0,this.pushmod=!0},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:li};var ai=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ai.__name__=!0,ai.prototype={pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Ei.zpp_pool,Ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},__class__:ai};var ri=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ri.__name__=!0,ri.prototype={__class__:ri};var pi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};pi.__name__=!0,pi.prototype={__class__:pi};var si=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};si.__name__=!0,si.prototype={add:function(e){var n;null==Ni.zpp_pool?n=new Ni:(n=Ni.zpp_pool,Ni.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},insert:function(e,n){var i;null==Ni.zpp_pool?i=new Ni:(i=Ni.zpp_pool,Ni.zpp_pool=i.next,i.next=null),i.elt=n;var t=i;return null==e?(t.next=this.head,this.head=t):(t.next=e.next,e.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Ni.zpp_pool,Ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=Ni.zpp_pool,Ni.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},erase:function(e){var n,i;null==e?(n=this.head,i=n.next,this.head=i,null==this.head&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0));var t=n;return t.elt=null,t.next=Ni.zpp_pool,Ni.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:si};var oi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};oi.__name__=!0,oi.prototype={add:function(e){var n;null==Di.zpp_pool?n=new Di:(n=Di.zpp_pool,Di.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},remove:function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var t,l;null==n?(t=this.head,l=t.next,this.head=l,null==this.head&&(this.pushmod=!0)):(t=n.next,l=t.next,n.next=l,null==l&&(this.pushmod=!0));var a=t;a.elt=null,a.next=Di.zpp_pool,Di.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,!0;break}n=i,i=i.next}},__class__:oi};var _i=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};_i.__name__=!0,_i.prototype={iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:_i};var hi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};hi.__name__=!0,hi.prototype={add:function(e){var n;null==Fi.zpp_pool?n=new Fi:(n=Fi.zpp_pool,Fi.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},pop:function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var e=this.head.elt;return this.pop(),e},erase:function(e){var n,i;null==e?(n=this.head,i=n.next,this.head=i,null==this.head&&(this.pushmod=!0)):(n=e.next,i=n.next,e.next=i,null==i&&(this.pushmod=!0));var t=n;return t.elt=null,t.next=Fi.zpp_pool,Fi.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},__class__:hi};var xi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};xi.__name__=!0,xi.prototype={iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:xi};var ui=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ui.__name__=!0,ui.prototype={iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:ui};var di=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};di.__name__=!0,di.prototype={iterator_at:function(e){for(var n=this.head;e-- >0&&null!=n;)n=n.next;return n},__class__:di};var vi=function(){this.elt=null,this.next=null};vi.__name__=!0,vi.prototype={__class__:vi};var ci=function(){this.elt=null,this.next=null};ci.__name__=!0,ci.prototype={__class__:ci};var yi=function(){this.elt=null,this.next=null};yi.__name__=!0,yi.prototype={__class__:yi};var mi=function(){this.elt=null,this.next=null};mi.__name__=!0,mi.prototype={__class__:mi};var zi=function(){this.elt=null,this.next=null};zi.__name__=!0,zi.prototype={__class__:zi};var fi=function(){this.elt=null,this.next=null};fi.__name__=!0,fi.prototype={__class__:fi};var bi=function(){this.elt=null,this.next=null};bi.__name__=!0,bi.prototype={__class__:bi};var gi=function(){this.elt=null,this.next=null};gi.__name__=!0,gi.prototype={__class__:gi};var wi=function(){this.elt=null,this.next=null};wi.__name__=!0,wi.prototype={__class__:wi};var Ci=function(){this.elt=null,this.next=null};Ci.__name__=!0,Ci.prototype={__class__:Ci};var Mi=function(){this.elt=null,this.next=null};Mi.__name__=!0,Mi.prototype={__class__:Mi};var Oi=function(){this.elt=null,this.next=null};Oi.__name__=!0,Oi.prototype={__class__:Oi};var ki=function(){this.elt=null,this.next=null};ki.__name__=!0,ki.prototype={__class__:ki};var Si=function(){this.elt=null,this.next=null};Si.__name__=!0,Si.prototype={__class__:Si};var Ai=function(){this.elt=null,this.next=null};Ai.__name__=!0,Ai.prototype={__class__:Ai};var Ti=function(){this.elt=null,this.next=null};Ti.__name__=!0,Ti.prototype={__class__:Ti};var Ei=function(){this.elt=null,this.next=null};Ei.__name__=!0,Ei.prototype={__class__:Ei};var Ii=function(){this.elt=null,this.next=null};Ii.__name__=!0,Ii.prototype={__class__:Ii};var ji=function(){this.elt=null,this.next=null};ji.__name__=!0,ji.prototype={__class__:ji};var Ni=function(){this.elt=null,this.next=null};Ni.__name__=!0,Ni.prototype={__class__:Ni};var Di=function(){this.elt=null,this.next=null};Di.__name__=!0,Di.prototype={__class__:Di};var Li=function(){this.elt=null,this.next=null};Li.__name__=!0,Li.prototype={__class__:Li};var Fi=function(){this.elt=null,this.next=null};Fi.__name__=!0,Fi.prototype={__class__:Fi};var Pi=function(){this.elt=null,this.next=null};Pi.__name__=!0,Pi.prototype={__class__:Pi};var Ri=function(){this.elt=null,this.next=null};Ri.__name__=!0,Ri.prototype={__class__:Ri};var Bi=function(){this.elt=null,this.next=null};Bi.__name__=!0,Bi.prototype={__class__:Bi};var Vi=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,ge.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};Vi.__name__=!0,Vi.get=function(e,n){null==n&&(n=!1);var i=new Vi;return i.inner=e,i.zpp_inner.immutable=n,i},Vi.__super__=ge,Vi.prototype=n(ge.prototype,{zpp_gl:function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var e=this.inner.next;null!=e;){this._length++,e=e.next}this.zip_length=!1}return this._length},zpp_vm:function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},at:function(e){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(e=this.zpp_gl()-1-e),e<this.at_index||null==this.at_ite)for(this.at_index=0,this.at_ite=this.inner.next;;){this.at_ite;break}for(;this.at_index!=e;)for(this.at_index++,this.at_ite=this.at_ite.next;;){this.at_ite;break}var n=this.at_ite;if(null==n.outer){n.outer=new fe;var i=n.outer.zpp_inner;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Sn.zpp_pool,Sn.zpp_pool=i,n.outer.zpp_inner=n}return n.outer},push:function(e){this.zpp_inner.modify_test(),this.zpp_vm();var n=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(n){if(this.zpp_inner.reverse_flag)this.inner.add(e.zpp_inner);else{var i=this.inner.iterator_at(this.zpp_gl()-1);this.inner.insert(i,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return n},__class__:Vi});var Gi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new f,this._invalidated=!0};Gi.__name__=!0,Gi.get=function(e,n){null==n&&(n=!1);var i=new X;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Gi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:Gi};var Ui=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new $n,this._invalidated=!0};Ui.__name__=!0,Ui.get=function(e,n){null==n&&(n=!1);var i=new Se;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Ui.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:Ui};var Yi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};Yi.__name__=!0,Yi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Yi};var Ki=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ei,this._invalidated=!0};Ki.__name__=!0,Ki.get=function(e,n){null==n&&(n=!1);var i=new Ie;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Ki.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:Ki};var Wi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new si,this._invalidated=!0};Wi.__name__=!0,Wi.get=function(e,n){null==n&&(n=!1);var i=new B;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Wi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:Wi};var qi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new rn,this._invalidated=!0};qi.__name__=!0,qi.get=function(e,n){null==n&&(n=!1);var i=new j;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},qi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:qi};var Xi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.subber=null,this.post_adder=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new zn,this._invalidated=!0};Xi.__name__=!0,Xi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:Xi};var Hi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};Hi.__name__=!0,Hi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Hi};var Zi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};Zi.__name__=!0,Zi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Zi};var Ji=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};Ji.__name__=!0,Ji.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Ji};var Qi=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};Qi.__name__=!0,Qi.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Qi};var $i=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Qn,this._invalidated=!0};$i.__name__=!0,$i.get=function(e,n){null==n&&(n=!1);var i=new qe;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},$i.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},__class__:$i};var et=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};et.__name__=!0,et.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:et};var nt=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ni,this._invalidated=!0};nt.__name__=!0,nt.get=function(e,n){null==n&&(n=!1);var i=new J;return i.zpp_inner.inner=e,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},nt.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:nt};var it=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this._validate=null,this._invalidated=!1,this.inner=null};it.__name__=!0,it.prototype={valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:it};var tt=function(){};tt.__name__=!0;var lt=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};lt.__name__=!0,lt.prototype={__fix_dbl_red:function(e){for(;;){var n=e.parent,i=n.parent;if(null==i){n.colour=1;break}var t,l,a,r,p,s,o;n==i.prev?(a=i,o=i.next,e==n.prev?(t=e,l=n,r=e.prev,p=e.next,s=n.next):(t=n,l=e,r=n.prev,p=e.prev,s=e.next)):(t=i,r=i.prev,e==n.prev?(l=e,a=n,p=e.prev,s=e.next,o=n.next):(l=n,a=e,p=n.prev,s=e.prev,o=e.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=p,null!=p&&(p.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=a,null!=a&&(a.parent=l),a.prev=s,null!=s&&(s.parent=a),a.next=o,null!=o&&(o.parent=a),l.colour=i.colour-1,t.colour=1,a.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){e=l;continue}break}},try_insert:function(e){var n=null,i=null;if(null==this.parent)null==lt.zpp_pool?n=new lt:(n=lt.zpp_pool,lt.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==lt.zpp_pool?n=new lt:(n=lt.zpp_pool,lt.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==lt.zpp_pool?n=new lt:(n=lt.zpp_pool,lt.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},__class__:lt};var at=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};at.__name__=!0,at.prototype={empty:function(){return null==this.parent},find:function(e){for(var n=this.parent;null!=n&&n.data!=e;)n=this.lt(e,n.data)?n.prev:n.next;return n},find_weak:function(e){for(var n=this.parent;null!=n;)if(this.lt(e,n.data))n=n.prev;else{if(!this.lt(n.data,e))break;n=n.next}return n},remove:function(e){var n=this.find(e);this.remove_node(n)},remove_node:function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var t=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)t.colour=1;else if(null!=e.parent)for(var l=e.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var a=l.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=e.parent;null==p?this.parent=t:p.prev==e?p.prev=t:p.next=t,null!=t&&(t.parent=p),e.parent=e.prev=e.next=null;var s=e;s.data=null,s.lt=null,s.swapped=null,s.next=at.zpp_pool,at.zpp_pool=s},__fix_neg_red:function(e){var n,i=e.parent;if(i.prev==e){var t=e.prev,l=e.next,a=l.prev,r=l.next;t.colour=0,e.colour=i.colour=1,e.next=a,null!=a&&(a.parent=e);var p=i.data;i.data=l.data,l.data=p,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),n=t}else{var s=e.next,o=e.prev,_=o.next,h=o.prev;s.colour=0,e.colour=i.colour=1,e.prev=_,null!=_&&(_.parent=e);var x=i.data;i.data=o.data,o.data=x,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),n=s}null!=n.prev&&0==n.prev.colour?this.__fix_dbl_red(n.prev):null!=n.next&&0==n.next.colour&&this.__fix_dbl_red(n.next)},__fix_dbl_red:function(e){for(;;){var n=e.parent,i=n.parent;if(null==i){n.colour=1;break}var t,l,a,r,p,s,o;n==i.prev?(a=i,o=i.next,e==n.prev?(t=e,l=n,r=e.prev,p=e.next,s=n.next):(t=n,l=e,r=n.prev,p=e.prev,s=e.next)):(t=i,r=i.prev,e==n.prev?(l=e,a=n,p=e.prev,s=e.next,o=n.next):(l=n,a=e,p=n.prev,s=e.prev,o=e.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=p,null!=p&&(p.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=a,null!=a&&(a.parent=l),a.prev=s,null!=s&&(s.parent=a),a.next=o,null!=o&&(o.parent=a),l.colour=i.colour-1,t.colour=1,a.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){e=l;continue}break}},insert:function(e){var n;if(null==at.zpp_pool?n=new at:(n=at.zpp_pool,at.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},__class__:at};var rt=0;String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var pt={__name__:["Int"]},st={__name__:["Dynamic"]},ot=Number;ot.__name__=["Float"];var _t=Boolean;_t.__ename__=["Bool"];var ht={__name__:["Class"]},xt={};a.totalTime=0,s.first=!0,v.ANY_SHAPE=new d,v.ANY_BODY=new d,v.ANY_COMPOUND=new d,v.ANY_CONSTRAINT=new d,c._Interactor=0,c._CbType=0,c._CbSet=0,c._Listener=0,w.CB_TYPE=new d,w.CB_TYPE_ELASTIC=new d,C.CB_TYPE=new d,M.__toStr={}.toString,O.epsilon=1e-8,O.fluidAngularDragFriction=2.5,O.fluidAngularDrag=100,O.fluidVacuumDrag=.5,O.fluidLinearDrag=.5,O.collisionSlop=.2,O.collisionSlopCCD=.5,O.distanceThresholdCCD=.05,O.staticCCDLinearThreshold=.05,O.staticCCDAngularThreshold=.005,O.bulletCCDLinearThreshold=.125,O.bulletCCDAngularThreshold=.0125,O.dynamicSweepLinearThreshold=17,O.dynamicSweepAngularThreshold=.6,O.angularCCDSlipScale=.75,O.arbiterExpirationDelay=6,O.staticFrictionThreshold=2,O.elasticThreshold=20,O.sleepDelay=60,O.linearSleepThreshold=.2,O.angularSleepThreshold=.4,O.contactBiasCoef=.3,O.contactStaticBiasCoef=.6,O.contactContinuousBiasCoef=.4,O.contactContinuousStaticBiasCoef=.5,O.illConditionedThreshold=2e8,nn.internal=!1,pn.UCbSet=new g,pn.VCbSet=new g,pn.WCbSet=new g,pn.UCbType=new rn,pn.VCbType=new rn,pn.WCbType=new rn,_n.internal=!1,_n.COL=1,_n.FLUID=4,_n.SENSOR=2,dn.internal=!1,fn.flowpoly=new zn,fn.flowsegs=new zn,En.types=function(e){null==nn.BodyType_STATIC&&(nn.internal=!0,nn.BodyType_STATIC=new Ae,nn.internal=!1);var n=nn.BodyType_STATIC;null==nn.BodyType_DYNAMIC&&(nn.internal=!0,nn.BodyType_DYNAMIC=new Ae,nn.internal=!1);var i=nn.BodyType_DYNAMIC;return null==nn.BodyType_KINEMATIC&&(nn.internal=!0,nn.BodyType_KINEMATIC=new Ae,nn.internal=!1),[null,n,i,nn.BodyType_KINEMATIC]}(),Nn.WAKE=1,Nn.PROPS=2,Nn.ANGDRAG=4,Nn.ARBITERS=8,Fn.internal=!1,Gn.tmpaabb=new mn,Gi.internal=!1,Ui.internal=!1,Yi.internal=!1,Ki.internal=!1,Wi.internal=!1,qi.internal=!1,Xi.internal=!1,Hi.internal=!1,Zi.internal=!1,Ji.internal=!1,Qi.internal=!1,$i.internal=!1,et.internal=!1,nt.internal=!1,it.internal=!1,p.main()
}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);